var qT=Object.defineProperty;var ZT=(i,t,e)=>t in i?qT(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var ht=(i,t,e)=>(ZT(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const m of o.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();var xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Td(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function JT(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){if(this instanceof r){var n=[null];n.push.apply(n,arguments);var o=Function.bind.apply(t,n);return new o}return t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var Kh={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Kh.exports;(function(i,t){(function(){var e,r="4.17.21",n=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",m="Expected a function",a="Invalid `variable` option passed into `_.template`",s="__lodash_hash_undefined__",h=500,d="__lodash_placeholder__",l=1,u=2,c=4,f=1,v=2,p=1,y=2,b=4,x=8,S=16,w=32,E=64,P=128,A=256,N=512,k=30,U="...",j=800,X=16,W=1,Q=2,ot=3,it=1/0,ct=9007199254740991,O=17976931348623157e292,M=0/0,L=4294967295,H=L-1,Z=L>>>1,G=[["ary",P],["bind",p],["bindKey",y],["curry",x],["curryRight",S],["flip",N],["partial",w],["partialRight",E],["rearg",A]],F="[object Arguments]",Y="[object Array]",R="[object AsyncFunction]",z="[object Boolean]",$="[object Date]",st="[object DOMException]",nt="[object Error]",ft="[object Function]",et="[object GeneratorFunction]",q="[object Map]",rt="[object Number]",ut="[object Null]",at="[object Object]",dt="[object Promise]",xt="[object Proxy]",Ft="[object RegExp]",wt="[object Set]",gt="[object String]",Et="[object Symbol]",Nt="[object Undefined]",zt="[object WeakMap]",ge="[object WeakSet]",ie="[object ArrayBuffer]",Me="[object DataView]",_e="[object Float32Array]",zi="[object Float64Array]",Ir="[object Int8Array]",mi="[object Int16Array]",va="[object Int32Array]",ms="[object Uint8Array]",_a="[object Uint8ClampedArray]",ya="[object Uint16Array]",Cc="[object Uint32Array]",vy=/\b__p \+= '';/g,_y=/\b(__p \+=) '' \+/g,yy=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ng=/&(?:amp|lt|gt|quot|#39);/g,sg=/[&<>"']/g,xy=RegExp(ng.source),by=RegExp(sg.source),Sy=/<%-([\s\S]+?)%>/g,Cy=/<%([\s\S]+?)%>/g,ag=/<%=([\s\S]+?)%>/g,wy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ty=/^\w*$/,Ey=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wc=/[\\^$.*+?()[\]{}|]/g,Ay=RegExp(wc.source),Tc=/^\s+/,Py=/\s/,Iy=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,My=/\{\n\/\* \[wrapped with (.+)\] \*/,Oy=/,? & /,Ry=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Dy=/[()=,{}\[\]\/\s]/,Fy=/\\(\\)?/g,Ly=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,og=/\w*$/,ky=/^[-+]0x[0-9a-f]+$/i,By=/^0b[01]+$/i,Ny=/^\[object .+?Constructor\]$/,Uy=/^0o[0-7]+$/i,Gy=/^(?:0|[1-9]\d*)$/,Hy=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,xo=/($^)/,Wy=/['\n\r\u2028\u2029\\]/g,bo="\\ud800-\\udfff",Xy="\\u0300-\\u036f",Vy="\\ufe20-\\ufe2f",zy="\\u20d0-\\u20ff",hg=Xy+Vy+zy,lg="\\u2700-\\u27bf",cg="a-z\\xdf-\\xf6\\xf8-\\xff",jy="\\xac\\xb1\\xd7\\xf7",Yy="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",$y="\\u2000-\\u206f",Ky=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ug="A-Z\\xc0-\\xd6\\xd8-\\xde",fg="\\ufe0e\\ufe0f",dg=jy+Yy+$y+Ky,Ec="['’]",qy="["+bo+"]",gg="["+dg+"]",So="["+hg+"]",pg="\\d+",Zy="["+lg+"]",mg="["+cg+"]",vg="[^"+bo+dg+pg+lg+cg+ug+"]",Ac="\\ud83c[\\udffb-\\udfff]",Jy="(?:"+So+"|"+Ac+")",_g="[^"+bo+"]",Pc="(?:\\ud83c[\\udde6-\\uddff]){2}",Ic="[\\ud800-\\udbff][\\udc00-\\udfff]",vs="["+ug+"]",yg="\\u200d",xg="(?:"+mg+"|"+vg+")",Qy="(?:"+vs+"|"+vg+")",bg="(?:"+Ec+"(?:d|ll|m|re|s|t|ve))?",Sg="(?:"+Ec+"(?:D|LL|M|RE|S|T|VE))?",Cg=Jy+"?",wg="["+fg+"]?",t2="(?:"+yg+"(?:"+[_g,Pc,Ic].join("|")+")"+wg+Cg+")*",e2="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",i2="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Tg=wg+Cg+t2,r2="(?:"+[Zy,Pc,Ic].join("|")+")"+Tg,n2="(?:"+[_g+So+"?",So,Pc,Ic,qy].join("|")+")",s2=RegExp(Ec,"g"),a2=RegExp(So,"g"),Mc=RegExp(Ac+"(?="+Ac+")|"+n2+Tg,"g"),o2=RegExp([vs+"?"+mg+"+"+bg+"(?="+[gg,vs,"$"].join("|")+")",Qy+"+"+Sg+"(?="+[gg,vs+xg,"$"].join("|")+")",vs+"?"+xg+"+"+bg,vs+"+"+Sg,i2,e2,pg,r2].join("|"),"g"),h2=RegExp("["+yg+bo+hg+fg+"]"),l2=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,c2=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],u2=-1,ve={};ve[_e]=ve[zi]=ve[Ir]=ve[mi]=ve[va]=ve[ms]=ve[_a]=ve[ya]=ve[Cc]=!0,ve[F]=ve[Y]=ve[ie]=ve[z]=ve[Me]=ve[$]=ve[nt]=ve[ft]=ve[q]=ve[rt]=ve[at]=ve[Ft]=ve[wt]=ve[gt]=ve[zt]=!1;var pe={};pe[F]=pe[Y]=pe[ie]=pe[Me]=pe[z]=pe[$]=pe[_e]=pe[zi]=pe[Ir]=pe[mi]=pe[va]=pe[q]=pe[rt]=pe[at]=pe[Ft]=pe[wt]=pe[gt]=pe[Et]=pe[ms]=pe[_a]=pe[ya]=pe[Cc]=!0,pe[nt]=pe[ft]=pe[zt]=!1;var f2={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},d2={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},g2={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},p2={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},m2=parseFloat,v2=parseInt,Eg=typeof xr=="object"&&xr&&xr.Object===Object&&xr,_2=typeof self=="object"&&self&&self.Object===Object&&self,Je=Eg||_2||Function("return this")(),Oc=t&&!t.nodeType&&t,On=Oc&&!0&&i&&!i.nodeType&&i,Ag=On&&On.exports===Oc,Rc=Ag&&Eg.process,Di=function(){try{var J=On&&On.require&&On.require("util").types;return J||Rc&&Rc.binding&&Rc.binding("util")}catch{}}(),Pg=Di&&Di.isArrayBuffer,Ig=Di&&Di.isDate,Mg=Di&&Di.isMap,Og=Di&&Di.isRegExp,Rg=Di&&Di.isSet,Dg=Di&&Di.isTypedArray;function Si(J,pt,lt){switch(lt.length){case 0:return J.call(pt);case 1:return J.call(pt,lt[0]);case 2:return J.call(pt,lt[0],lt[1]);case 3:return J.call(pt,lt[0],lt[1],lt[2])}return J.apply(pt,lt)}function y2(J,pt,lt,Tt){for(var Ut=-1,ae=J==null?0:J.length;++Ut<ae;){var Ne=J[Ut];pt(Tt,Ne,lt(Ne),J)}return Tt}function Fi(J,pt){for(var lt=-1,Tt=J==null?0:J.length;++lt<Tt&&pt(J[lt],lt,J)!==!1;);return J}function x2(J,pt){for(var lt=J==null?0:J.length;lt--&&pt(J[lt],lt,J)!==!1;);return J}function Fg(J,pt){for(var lt=-1,Tt=J==null?0:J.length;++lt<Tt;)if(!pt(J[lt],lt,J))return!1;return!0}function rn(J,pt){for(var lt=-1,Tt=J==null?0:J.length,Ut=0,ae=[];++lt<Tt;){var Ne=J[lt];pt(Ne,lt,J)&&(ae[Ut++]=Ne)}return ae}function Co(J,pt){var lt=J==null?0:J.length;return!!lt&&_s(J,pt,0)>-1}function Dc(J,pt,lt){for(var Tt=-1,Ut=J==null?0:J.length;++Tt<Ut;)if(lt(pt,J[Tt]))return!0;return!1}function ye(J,pt){for(var lt=-1,Tt=J==null?0:J.length,Ut=Array(Tt);++lt<Tt;)Ut[lt]=pt(J[lt],lt,J);return Ut}function nn(J,pt){for(var lt=-1,Tt=pt.length,Ut=J.length;++lt<Tt;)J[Ut+lt]=pt[lt];return J}function Fc(J,pt,lt,Tt){var Ut=-1,ae=J==null?0:J.length;for(Tt&&ae&&(lt=J[++Ut]);++Ut<ae;)lt=pt(lt,J[Ut],Ut,J);return lt}function b2(J,pt,lt,Tt){var Ut=J==null?0:J.length;for(Tt&&Ut&&(lt=J[--Ut]);Ut--;)lt=pt(lt,J[Ut],Ut,J);return lt}function Lc(J,pt){for(var lt=-1,Tt=J==null?0:J.length;++lt<Tt;)if(pt(J[lt],lt,J))return!0;return!1}var S2=kc("length");function C2(J){return J.split("")}function w2(J){return J.match(Ry)||[]}function Lg(J,pt,lt){var Tt;return lt(J,function(Ut,ae,Ne){if(pt(Ut,ae,Ne))return Tt=ae,!1}),Tt}function wo(J,pt,lt,Tt){for(var Ut=J.length,ae=lt+(Tt?1:-1);Tt?ae--:++ae<Ut;)if(pt(J[ae],ae,J))return ae;return-1}function _s(J,pt,lt){return pt===pt?k2(J,pt,lt):wo(J,kg,lt)}function T2(J,pt,lt,Tt){for(var Ut=lt-1,ae=J.length;++Ut<ae;)if(Tt(J[Ut],pt))return Ut;return-1}function kg(J){return J!==J}function Bg(J,pt){var lt=J==null?0:J.length;return lt?Nc(J,pt)/lt:M}function kc(J){return function(pt){return pt==null?e:pt[J]}}function Bc(J){return function(pt){return J==null?e:J[pt]}}function Ng(J,pt,lt,Tt,Ut){return Ut(J,function(ae,Ne,fe){lt=Tt?(Tt=!1,ae):pt(lt,ae,Ne,fe)}),lt}function E2(J,pt){var lt=J.length;for(J.sort(pt);lt--;)J[lt]=J[lt].value;return J}function Nc(J,pt){for(var lt,Tt=-1,Ut=J.length;++Tt<Ut;){var ae=pt(J[Tt]);ae!==e&&(lt=lt===e?ae:lt+ae)}return lt}function Uc(J,pt){for(var lt=-1,Tt=Array(J);++lt<J;)Tt[lt]=pt(lt);return Tt}function A2(J,pt){return ye(pt,function(lt){return[lt,J[lt]]})}function Ug(J){return J&&J.slice(0,Xg(J)+1).replace(Tc,"")}function Ci(J){return function(pt){return J(pt)}}function Gc(J,pt){return ye(pt,function(lt){return J[lt]})}function xa(J,pt){return J.has(pt)}function Gg(J,pt){for(var lt=-1,Tt=J.length;++lt<Tt&&_s(pt,J[lt],0)>-1;);return lt}function Hg(J,pt){for(var lt=J.length;lt--&&_s(pt,J[lt],0)>-1;);return lt}function P2(J,pt){for(var lt=J.length,Tt=0;lt--;)J[lt]===pt&&++Tt;return Tt}var I2=Bc(f2),M2=Bc(d2);function O2(J){return"\\"+p2[J]}function R2(J,pt){return J==null?e:J[pt]}function ys(J){return h2.test(J)}function D2(J){return l2.test(J)}function F2(J){for(var pt,lt=[];!(pt=J.next()).done;)lt.push(pt.value);return lt}function Hc(J){var pt=-1,lt=Array(J.size);return J.forEach(function(Tt,Ut){lt[++pt]=[Ut,Tt]}),lt}function Wg(J,pt){return function(lt){return J(pt(lt))}}function sn(J,pt){for(var lt=-1,Tt=J.length,Ut=0,ae=[];++lt<Tt;){var Ne=J[lt];(Ne===pt||Ne===d)&&(J[lt]=d,ae[Ut++]=lt)}return ae}function To(J){var pt=-1,lt=Array(J.size);return J.forEach(function(Tt){lt[++pt]=Tt}),lt}function L2(J){var pt=-1,lt=Array(J.size);return J.forEach(function(Tt){lt[++pt]=[Tt,Tt]}),lt}function k2(J,pt,lt){for(var Tt=lt-1,Ut=J.length;++Tt<Ut;)if(J[Tt]===pt)return Tt;return-1}function B2(J,pt,lt){for(var Tt=lt+1;Tt--;)if(J[Tt]===pt)return Tt;return Tt}function xs(J){return ys(J)?U2(J):S2(J)}function ji(J){return ys(J)?G2(J):C2(J)}function Xg(J){for(var pt=J.length;pt--&&Py.test(J.charAt(pt)););return pt}var N2=Bc(g2);function U2(J){for(var pt=Mc.lastIndex=0;Mc.test(J);)++pt;return pt}function G2(J){return J.match(Mc)||[]}function H2(J){return J.match(o2)||[]}var W2=function J(pt){pt=pt==null?Je:bs.defaults(Je.Object(),pt,bs.pick(Je,c2));var lt=pt.Array,Tt=pt.Date,Ut=pt.Error,ae=pt.Function,Ne=pt.Math,fe=pt.Object,Wc=pt.RegExp,X2=pt.String,Li=pt.TypeError,Eo=lt.prototype,V2=ae.prototype,Ss=fe.prototype,Ao=pt["__core-js_shared__"],Po=V2.toString,he=Ss.hasOwnProperty,z2=0,Vg=function(){var g=/[^.]+$/.exec(Ao&&Ao.keys&&Ao.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),Io=Ss.toString,j2=Po.call(fe),Y2=Je._,$2=Wc("^"+Po.call(he).replace(wc,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mo=Ag?pt.Buffer:e,an=pt.Symbol,Oo=pt.Uint8Array,zg=Mo?Mo.allocUnsafe:e,Ro=Wg(fe.getPrototypeOf,fe),jg=fe.create,Yg=Ss.propertyIsEnumerable,Do=Eo.splice,$g=an?an.isConcatSpreadable:e,ba=an?an.iterator:e,Rn=an?an.toStringTag:e,Fo=function(){try{var g=Bn(fe,"defineProperty");return g({},"",{}),g}catch{}}(),K2=pt.clearTimeout!==Je.clearTimeout&&pt.clearTimeout,q2=Tt&&Tt.now!==Je.Date.now&&Tt.now,Z2=pt.setTimeout!==Je.setTimeout&&pt.setTimeout,Lo=Ne.ceil,ko=Ne.floor,Xc=fe.getOwnPropertySymbols,J2=Mo?Mo.isBuffer:e,Kg=pt.isFinite,Q2=Eo.join,tx=Wg(fe.keys,fe),Ue=Ne.max,ni=Ne.min,ex=Tt.now,ix=pt.parseInt,qg=Ne.random,rx=Eo.reverse,Vc=Bn(pt,"DataView"),Sa=Bn(pt,"Map"),zc=Bn(pt,"Promise"),Cs=Bn(pt,"Set"),Ca=Bn(pt,"WeakMap"),wa=Bn(fe,"create"),Bo=Ca&&new Ca,ws={},nx=Nn(Vc),sx=Nn(Sa),ax=Nn(zc),ox=Nn(Cs),hx=Nn(Ca),No=an?an.prototype:e,Ta=No?No.valueOf:e,Zg=No?No.toString:e;function D(g){if(Oe(g)&&!Wt(g)&&!(g instanceof Jt)){if(g instanceof ki)return g;if(he.call(g,"__wrapped__"))return Jp(g)}return new ki(g)}var Ts=function(){function g(){}return function(_){if(!Te(_))return{};if(jg)return jg(_);g.prototype=_;var C=new g;return g.prototype=e,C}}();function Uo(){}function ki(g,_){this.__wrapped__=g,this.__actions__=[],this.__chain__=!!_,this.__index__=0,this.__values__=e}D.templateSettings={escape:Sy,evaluate:Cy,interpolate:ag,variable:"",imports:{_:D}},D.prototype=Uo.prototype,D.prototype.constructor=D,ki.prototype=Ts(Uo.prototype),ki.prototype.constructor=ki;function Jt(g){this.__wrapped__=g,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=L,this.__views__=[]}function lx(){var g=new Jt(this.__wrapped__);return g.__actions__=vi(this.__actions__),g.__dir__=this.__dir__,g.__filtered__=this.__filtered__,g.__iteratees__=vi(this.__iteratees__),g.__takeCount__=this.__takeCount__,g.__views__=vi(this.__views__),g}function cx(){if(this.__filtered__){var g=new Jt(this);g.__dir__=-1,g.__filtered__=!0}else g=this.clone(),g.__dir__*=-1;return g}function ux(){var g=this.__wrapped__.value(),_=this.__dir__,C=Wt(g),T=_<0,I=C?g.length:0,B=Cb(0,I,this.__views__),V=B.start,K=B.end,tt=K-V,mt=T?K:V-1,vt=this.__iteratees__,_t=vt.length,bt=0,At=ni(tt,this.__takeCount__);if(!C||!T&&I==tt&&At==tt)return bp(g,this.__actions__);var Lt=[];t:for(;tt--&&bt<At;){mt+=_;for(var jt=-1,kt=g[mt];++jt<_t;){var Zt=vt[jt],re=Zt.iteratee,Ei=Zt.type,gi=re(kt);if(Ei==Q)kt=gi;else if(!gi){if(Ei==W)continue t;break t}}Lt[bt++]=kt}return Lt}Jt.prototype=Ts(Uo.prototype),Jt.prototype.constructor=Jt;function Dn(g){var _=-1,C=g==null?0:g.length;for(this.clear();++_<C;){var T=g[_];this.set(T[0],T[1])}}function fx(){this.__data__=wa?wa(null):{},this.size=0}function dx(g){var _=this.has(g)&&delete this.__data__[g];return this.size-=_?1:0,_}function gx(g){var _=this.__data__;if(wa){var C=_[g];return C===s?e:C}return he.call(_,g)?_[g]:e}function px(g){var _=this.__data__;return wa?_[g]!==e:he.call(_,g)}function mx(g,_){var C=this.__data__;return this.size+=this.has(g)?0:1,C[g]=wa&&_===e?s:_,this}Dn.prototype.clear=fx,Dn.prototype.delete=dx,Dn.prototype.get=gx,Dn.prototype.has=px,Dn.prototype.set=mx;function Mr(g){var _=-1,C=g==null?0:g.length;for(this.clear();++_<C;){var T=g[_];this.set(T[0],T[1])}}function vx(){this.__data__=[],this.size=0}function _x(g){var _=this.__data__,C=Go(_,g);if(C<0)return!1;var T=_.length-1;return C==T?_.pop():Do.call(_,C,1),--this.size,!0}function yx(g){var _=this.__data__,C=Go(_,g);return C<0?e:_[C][1]}function xx(g){return Go(this.__data__,g)>-1}function bx(g,_){var C=this.__data__,T=Go(C,g);return T<0?(++this.size,C.push([g,_])):C[T][1]=_,this}Mr.prototype.clear=vx,Mr.prototype.delete=_x,Mr.prototype.get=yx,Mr.prototype.has=xx,Mr.prototype.set=bx;function Or(g){var _=-1,C=g==null?0:g.length;for(this.clear();++_<C;){var T=g[_];this.set(T[0],T[1])}}function Sx(){this.size=0,this.__data__={hash:new Dn,map:new(Sa||Mr),string:new Dn}}function Cx(g){var _=Jo(this,g).delete(g);return this.size-=_?1:0,_}function wx(g){return Jo(this,g).get(g)}function Tx(g){return Jo(this,g).has(g)}function Ex(g,_){var C=Jo(this,g),T=C.size;return C.set(g,_),this.size+=C.size==T?0:1,this}Or.prototype.clear=Sx,Or.prototype.delete=Cx,Or.prototype.get=wx,Or.prototype.has=Tx,Or.prototype.set=Ex;function Fn(g){var _=-1,C=g==null?0:g.length;for(this.__data__=new Or;++_<C;)this.add(g[_])}function Ax(g){return this.__data__.set(g,s),this}function Px(g){return this.__data__.has(g)}Fn.prototype.add=Fn.prototype.push=Ax,Fn.prototype.has=Px;function Yi(g){var _=this.__data__=new Mr(g);this.size=_.size}function Ix(){this.__data__=new Mr,this.size=0}function Mx(g){var _=this.__data__,C=_.delete(g);return this.size=_.size,C}function Ox(g){return this.__data__.get(g)}function Rx(g){return this.__data__.has(g)}function Dx(g,_){var C=this.__data__;if(C instanceof Mr){var T=C.__data__;if(!Sa||T.length<n-1)return T.push([g,_]),this.size=++C.size,this;C=this.__data__=new Or(T)}return C.set(g,_),this.size=C.size,this}Yi.prototype.clear=Ix,Yi.prototype.delete=Mx,Yi.prototype.get=Ox,Yi.prototype.has=Rx,Yi.prototype.set=Dx;function Jg(g,_){var C=Wt(g),T=!C&&Un(g),I=!C&&!T&&un(g),B=!C&&!T&&!I&&Is(g),V=C||T||I||B,K=V?Uc(g.length,X2):[],tt=K.length;for(var mt in g)(_||he.call(g,mt))&&!(V&&(mt=="length"||I&&(mt=="offset"||mt=="parent")||B&&(mt=="buffer"||mt=="byteLength"||mt=="byteOffset")||Lr(mt,tt)))&&K.push(mt);return K}function Qg(g){var _=g.length;return _?g[iu(0,_-1)]:e}function Fx(g,_){return Qo(vi(g),Ln(_,0,g.length))}function Lx(g){return Qo(vi(g))}function jc(g,_,C){(C!==e&&!$i(g[_],C)||C===e&&!(_ in g))&&Rr(g,_,C)}function Ea(g,_,C){var T=g[_];(!(he.call(g,_)&&$i(T,C))||C===e&&!(_ in g))&&Rr(g,_,C)}function Go(g,_){for(var C=g.length;C--;)if($i(g[C][0],_))return C;return-1}function kx(g,_,C,T){return on(g,function(I,B,V){_(T,I,C(I),V)}),T}function tp(g,_){return g&&dr(_,je(_),g)}function Bx(g,_){return g&&dr(_,yi(_),g)}function Rr(g,_,C){_=="__proto__"&&Fo?Fo(g,_,{configurable:!0,enumerable:!0,value:C,writable:!0}):g[_]=C}function Yc(g,_){for(var C=-1,T=_.length,I=lt(T),B=g==null;++C<T;)I[C]=B?e:Au(g,_[C]);return I}function Ln(g,_,C){return g===g&&(C!==e&&(g=g<=C?g:C),_!==e&&(g=g>=_?g:_)),g}function Bi(g,_,C,T,I,B){var V,K=_&l,tt=_&u,mt=_&c;if(C&&(V=I?C(g,T,I,B):C(g)),V!==e)return V;if(!Te(g))return g;var vt=Wt(g);if(vt){if(V=Tb(g),!K)return vi(g,V)}else{var _t=si(g),bt=_t==ft||_t==et;if(un(g))return wp(g,K);if(_t==at||_t==F||bt&&!I){if(V=tt||bt?{}:Xp(g),!K)return tt?gb(g,Bx(V,g)):db(g,tp(V,g))}else{if(!pe[_t])return I?g:{};V=Eb(g,_t,K)}}B||(B=new Yi);var At=B.get(g);if(At)return At;B.set(g,V),_0(g)?g.forEach(function(kt){V.add(Bi(kt,_,C,kt,g,B))}):m0(g)&&g.forEach(function(kt,Zt){V.set(Zt,Bi(kt,_,C,Zt,g,B))});var Lt=mt?tt?du:fu:tt?yi:je,jt=vt?e:Lt(g);return Fi(jt||g,function(kt,Zt){jt&&(Zt=kt,kt=g[Zt]),Ea(V,Zt,Bi(kt,_,C,Zt,g,B))}),V}function Nx(g){var _=je(g);return function(C){return ep(C,g,_)}}function ep(g,_,C){var T=C.length;if(g==null)return!T;for(g=fe(g);T--;){var I=C[T],B=_[I],V=g[I];if(V===e&&!(I in g)||!B(V))return!1}return!0}function ip(g,_,C){if(typeof g!="function")throw new Li(m);return Da(function(){g.apply(e,C)},_)}function Aa(g,_,C,T){var I=-1,B=Co,V=!0,K=g.length,tt=[],mt=_.length;if(!K)return tt;C&&(_=ye(_,Ci(C))),T?(B=Dc,V=!1):_.length>=n&&(B=xa,V=!1,_=new Fn(_));t:for(;++I<K;){var vt=g[I],_t=C==null?vt:C(vt);if(vt=T||vt!==0?vt:0,V&&_t===_t){for(var bt=mt;bt--;)if(_[bt]===_t)continue t;tt.push(vt)}else B(_,_t,T)||tt.push(vt)}return tt}var on=Ip(fr),rp=Ip(Kc,!0);function Ux(g,_){var C=!0;return on(g,function(T,I,B){return C=!!_(T,I,B),C}),C}function Ho(g,_,C){for(var T=-1,I=g.length;++T<I;){var B=g[T],V=_(B);if(V!=null&&(K===e?V===V&&!Ti(V):C(V,K)))var K=V,tt=B}return tt}function Gx(g,_,C,T){var I=g.length;for(C=Vt(C),C<0&&(C=-C>I?0:I+C),T=T===e||T>I?I:Vt(T),T<0&&(T+=I),T=C>T?0:x0(T);C<T;)g[C++]=_;return g}function np(g,_){var C=[];return on(g,function(T,I,B){_(T,I,B)&&C.push(T)}),C}function Qe(g,_,C,T,I){var B=-1,V=g.length;for(C||(C=Pb),I||(I=[]);++B<V;){var K=g[B];_>0&&C(K)?_>1?Qe(K,_-1,C,T,I):nn(I,K):T||(I[I.length]=K)}return I}var $c=Mp(),sp=Mp(!0);function fr(g,_){return g&&$c(g,_,je)}function Kc(g,_){return g&&sp(g,_,je)}function Wo(g,_){return rn(_,function(C){return kr(g[C])})}function kn(g,_){_=ln(_,g);for(var C=0,T=_.length;g!=null&&C<T;)g=g[gr(_[C++])];return C&&C==T?g:e}function ap(g,_,C){var T=_(g);return Wt(g)?T:nn(T,C(g))}function fi(g){return g==null?g===e?Nt:ut:Rn&&Rn in fe(g)?Sb(g):Lb(g)}function qc(g,_){return g>_}function Hx(g,_){return g!=null&&he.call(g,_)}function Wx(g,_){return g!=null&&_ in fe(g)}function Xx(g,_,C){return g>=ni(_,C)&&g<Ue(_,C)}function Zc(g,_,C){for(var T=C?Dc:Co,I=g[0].length,B=g.length,V=B,K=lt(B),tt=1/0,mt=[];V--;){var vt=g[V];V&&_&&(vt=ye(vt,Ci(_))),tt=ni(vt.length,tt),K[V]=!C&&(_||I>=120&&vt.length>=120)?new Fn(V&&vt):e}vt=g[0];var _t=-1,bt=K[0];t:for(;++_t<I&&mt.length<tt;){var At=vt[_t],Lt=_?_(At):At;if(At=C||At!==0?At:0,!(bt?xa(bt,Lt):T(mt,Lt,C))){for(V=B;--V;){var jt=K[V];if(!(jt?xa(jt,Lt):T(g[V],Lt,C)))continue t}bt&&bt.push(Lt),mt.push(At)}}return mt}function Vx(g,_,C,T){return fr(g,function(I,B,V){_(T,C(I),B,V)}),T}function Pa(g,_,C){_=ln(_,g),g=Yp(g,_);var T=g==null?g:g[gr(Ui(_))];return T==null?e:Si(T,g,C)}function op(g){return Oe(g)&&fi(g)==F}function zx(g){return Oe(g)&&fi(g)==ie}function jx(g){return Oe(g)&&fi(g)==$}function Ia(g,_,C,T,I){return g===_?!0:g==null||_==null||!Oe(g)&&!Oe(_)?g!==g&&_!==_:Yx(g,_,C,T,Ia,I)}function Yx(g,_,C,T,I,B){var V=Wt(g),K=Wt(_),tt=V?Y:si(g),mt=K?Y:si(_);tt=tt==F?at:tt,mt=mt==F?at:mt;var vt=tt==at,_t=mt==at,bt=tt==mt;if(bt&&un(g)){if(!un(_))return!1;V=!0,vt=!1}if(bt&&!vt)return B||(B=new Yi),V||Is(g)?Gp(g,_,C,T,I,B):xb(g,_,tt,C,T,I,B);if(!(C&f)){var At=vt&&he.call(g,"__wrapped__"),Lt=_t&&he.call(_,"__wrapped__");if(At||Lt){var jt=At?g.value():g,kt=Lt?_.value():_;return B||(B=new Yi),I(jt,kt,C,T,B)}}return bt?(B||(B=new Yi),bb(g,_,C,T,I,B)):!1}function $x(g){return Oe(g)&&si(g)==q}function Jc(g,_,C,T){var I=C.length,B=I,V=!T;if(g==null)return!B;for(g=fe(g);I--;){var K=C[I];if(V&&K[2]?K[1]!==g[K[0]]:!(K[0]in g))return!1}for(;++I<B;){K=C[I];var tt=K[0],mt=g[tt],vt=K[1];if(V&&K[2]){if(mt===e&&!(tt in g))return!1}else{var _t=new Yi;if(T)var bt=T(mt,vt,tt,g,_,_t);if(!(bt===e?Ia(vt,mt,f|v,T,_t):bt))return!1}}return!0}function hp(g){if(!Te(g)||Mb(g))return!1;var _=kr(g)?$2:Ny;return _.test(Nn(g))}function Kx(g){return Oe(g)&&fi(g)==Ft}function qx(g){return Oe(g)&&si(g)==wt}function Zx(g){return Oe(g)&&sh(g.length)&&!!ve[fi(g)]}function lp(g){return typeof g=="function"?g:g==null?xi:typeof g=="object"?Wt(g)?fp(g[0],g[1]):up(g):O0(g)}function Qc(g){if(!Ra(g))return tx(g);var _=[];for(var C in fe(g))he.call(g,C)&&C!="constructor"&&_.push(C);return _}function Jx(g){if(!Te(g))return Fb(g);var _=Ra(g),C=[];for(var T in g)T=="constructor"&&(_||!he.call(g,T))||C.push(T);return C}function tu(g,_){return g<_}function cp(g,_){var C=-1,T=_i(g)?lt(g.length):[];return on(g,function(I,B,V){T[++C]=_(I,B,V)}),T}function up(g){var _=pu(g);return _.length==1&&_[0][2]?zp(_[0][0],_[0][1]):function(C){return C===g||Jc(C,g,_)}}function fp(g,_){return vu(g)&&Vp(_)?zp(gr(g),_):function(C){var T=Au(C,g);return T===e&&T===_?Pu(C,g):Ia(_,T,f|v)}}function Xo(g,_,C,T,I){g!==_&&$c(_,function(B,V){if(I||(I=new Yi),Te(B))Qx(g,_,V,C,Xo,T,I);else{var K=T?T(yu(g,V),B,V+"",g,_,I):e;K===e&&(K=B),jc(g,V,K)}},yi)}function Qx(g,_,C,T,I,B,V){var K=yu(g,C),tt=yu(_,C),mt=V.get(tt);if(mt){jc(g,C,mt);return}var vt=B?B(K,tt,C+"",g,_,V):e,_t=vt===e;if(_t){var bt=Wt(tt),At=!bt&&un(tt),Lt=!bt&&!At&&Is(tt);vt=tt,bt||At||Lt?Wt(K)?vt=K:De(K)?vt=vi(K):At?(_t=!1,vt=wp(tt,!0)):Lt?(_t=!1,vt=Tp(tt,!0)):vt=[]:Fa(tt)||Un(tt)?(vt=K,Un(K)?vt=b0(K):(!Te(K)||kr(K))&&(vt=Xp(tt))):_t=!1}_t&&(V.set(tt,vt),I(vt,tt,T,B,V),V.delete(tt)),jc(g,C,vt)}function dp(g,_){var C=g.length;if(C)return _+=_<0?C:0,Lr(_,C)?g[_]:e}function gp(g,_,C){_.length?_=ye(_,function(B){return Wt(B)?function(V){return kn(V,B.length===1?B[0]:B)}:B}):_=[xi];var T=-1;_=ye(_,Ci(Dt()));var I=cp(g,function(B,V,K){var tt=ye(_,function(mt){return mt(B)});return{criteria:tt,index:++T,value:B}});return E2(I,function(B,V){return fb(B,V,C)})}function tb(g,_){return pp(g,_,function(C,T){return Pu(g,T)})}function pp(g,_,C){for(var T=-1,I=_.length,B={};++T<I;){var V=_[T],K=kn(g,V);C(K,V)&&Ma(B,ln(V,g),K)}return B}function eb(g){return function(_){return kn(_,g)}}function eu(g,_,C,T){var I=T?T2:_s,B=-1,V=_.length,K=g;for(g===_&&(_=vi(_)),C&&(K=ye(g,Ci(C)));++B<V;)for(var tt=0,mt=_[B],vt=C?C(mt):mt;(tt=I(K,vt,tt,T))>-1;)K!==g&&Do.call(K,tt,1),Do.call(g,tt,1);return g}function mp(g,_){for(var C=g?_.length:0,T=C-1;C--;){var I=_[C];if(C==T||I!==B){var B=I;Lr(I)?Do.call(g,I,1):su(g,I)}}return g}function iu(g,_){return g+ko(qg()*(_-g+1))}function ib(g,_,C,T){for(var I=-1,B=Ue(Lo((_-g)/(C||1)),0),V=lt(B);B--;)V[T?B:++I]=g,g+=C;return V}function ru(g,_){var C="";if(!g||_<1||_>ct)return C;do _%2&&(C+=g),_=ko(_/2),_&&(g+=g);while(_);return C}function Yt(g,_){return xu(jp(g,_,xi),g+"")}function rb(g){return Qg(Ms(g))}function nb(g,_){var C=Ms(g);return Qo(C,Ln(_,0,C.length))}function Ma(g,_,C,T){if(!Te(g))return g;_=ln(_,g);for(var I=-1,B=_.length,V=B-1,K=g;K!=null&&++I<B;){var tt=gr(_[I]),mt=C;if(tt==="__proto__"||tt==="constructor"||tt==="prototype")return g;if(I!=V){var vt=K[tt];mt=T?T(vt,tt,K):e,mt===e&&(mt=Te(vt)?vt:Lr(_[I+1])?[]:{})}Ea(K,tt,mt),K=K[tt]}return g}var vp=Bo?function(g,_){return Bo.set(g,_),g}:xi,sb=Fo?function(g,_){return Fo(g,"toString",{configurable:!0,enumerable:!1,value:Mu(_),writable:!0})}:xi;function ab(g){return Qo(Ms(g))}function Ni(g,_,C){var T=-1,I=g.length;_<0&&(_=-_>I?0:I+_),C=C>I?I:C,C<0&&(C+=I),I=_>C?0:C-_>>>0,_>>>=0;for(var B=lt(I);++T<I;)B[T]=g[T+_];return B}function ob(g,_){var C;return on(g,function(T,I,B){return C=_(T,I,B),!C}),!!C}function Vo(g,_,C){var T=0,I=g==null?T:g.length;if(typeof _=="number"&&_===_&&I<=Z){for(;T<I;){var B=T+I>>>1,V=g[B];V!==null&&!Ti(V)&&(C?V<=_:V<_)?T=B+1:I=B}return I}return nu(g,_,xi,C)}function nu(g,_,C,T){var I=0,B=g==null?0:g.length;if(B===0)return 0;_=C(_);for(var V=_!==_,K=_===null,tt=Ti(_),mt=_===e;I<B;){var vt=ko((I+B)/2),_t=C(g[vt]),bt=_t!==e,At=_t===null,Lt=_t===_t,jt=Ti(_t);if(V)var kt=T||Lt;else mt?kt=Lt&&(T||bt):K?kt=Lt&&bt&&(T||!At):tt?kt=Lt&&bt&&!At&&(T||!jt):At||jt?kt=!1:kt=T?_t<=_:_t<_;kt?I=vt+1:B=vt}return ni(B,H)}function _p(g,_){for(var C=-1,T=g.length,I=0,B=[];++C<T;){var V=g[C],K=_?_(V):V;if(!C||!$i(K,tt)){var tt=K;B[I++]=V===0?0:V}}return B}function yp(g){return typeof g=="number"?g:Ti(g)?M:+g}function wi(g){if(typeof g=="string")return g;if(Wt(g))return ye(g,wi)+"";if(Ti(g))return Zg?Zg.call(g):"";var _=g+"";return _=="0"&&1/g==-it?"-0":_}function hn(g,_,C){var T=-1,I=Co,B=g.length,V=!0,K=[],tt=K;if(C)V=!1,I=Dc;else if(B>=n){var mt=_?null:_b(g);if(mt)return To(mt);V=!1,I=xa,tt=new Fn}else tt=_?[]:K;t:for(;++T<B;){var vt=g[T],_t=_?_(vt):vt;if(vt=C||vt!==0?vt:0,V&&_t===_t){for(var bt=tt.length;bt--;)if(tt[bt]===_t)continue t;_&&tt.push(_t),K.push(vt)}else I(tt,_t,C)||(tt!==K&&tt.push(_t),K.push(vt))}return K}function su(g,_){return _=ln(_,g),g=Yp(g,_),g==null||delete g[gr(Ui(_))]}function xp(g,_,C,T){return Ma(g,_,C(kn(g,_)),T)}function zo(g,_,C,T){for(var I=g.length,B=T?I:-1;(T?B--:++B<I)&&_(g[B],B,g););return C?Ni(g,T?0:B,T?B+1:I):Ni(g,T?B+1:0,T?I:B)}function bp(g,_){var C=g;return C instanceof Jt&&(C=C.value()),Fc(_,function(T,I){return I.func.apply(I.thisArg,nn([T],I.args))},C)}function au(g,_,C){var T=g.length;if(T<2)return T?hn(g[0]):[];for(var I=-1,B=lt(T);++I<T;)for(var V=g[I],K=-1;++K<T;)K!=I&&(B[I]=Aa(B[I]||V,g[K],_,C));return hn(Qe(B,1),_,C)}function Sp(g,_,C){for(var T=-1,I=g.length,B=_.length,V={};++T<I;){var K=T<B?_[T]:e;C(V,g[T],K)}return V}function ou(g){return De(g)?g:[]}function hu(g){return typeof g=="function"?g:xi}function ln(g,_){return Wt(g)?g:vu(g,_)?[g]:Zp(oe(g))}var hb=Yt;function cn(g,_,C){var T=g.length;return C=C===e?T:C,!_&&C>=T?g:Ni(g,_,C)}var Cp=K2||function(g){return Je.clearTimeout(g)};function wp(g,_){if(_)return g.slice();var C=g.length,T=zg?zg(C):new g.constructor(C);return g.copy(T),T}function lu(g){var _=new g.constructor(g.byteLength);return new Oo(_).set(new Oo(g)),_}function lb(g,_){var C=_?lu(g.buffer):g.buffer;return new g.constructor(C,g.byteOffset,g.byteLength)}function cb(g){var _=new g.constructor(g.source,og.exec(g));return _.lastIndex=g.lastIndex,_}function ub(g){return Ta?fe(Ta.call(g)):{}}function Tp(g,_){var C=_?lu(g.buffer):g.buffer;return new g.constructor(C,g.byteOffset,g.length)}function Ep(g,_){if(g!==_){var C=g!==e,T=g===null,I=g===g,B=Ti(g),V=_!==e,K=_===null,tt=_===_,mt=Ti(_);if(!K&&!mt&&!B&&g>_||B&&V&&tt&&!K&&!mt||T&&V&&tt||!C&&tt||!I)return 1;if(!T&&!B&&!mt&&g<_||mt&&C&&I&&!T&&!B||K&&C&&I||!V&&I||!tt)return-1}return 0}function fb(g,_,C){for(var T=-1,I=g.criteria,B=_.criteria,V=I.length,K=C.length;++T<V;){var tt=Ep(I[T],B[T]);if(tt){if(T>=K)return tt;var mt=C[T];return tt*(mt=="desc"?-1:1)}}return g.index-_.index}function Ap(g,_,C,T){for(var I=-1,B=g.length,V=C.length,K=-1,tt=_.length,mt=Ue(B-V,0),vt=lt(tt+mt),_t=!T;++K<tt;)vt[K]=_[K];for(;++I<V;)(_t||I<B)&&(vt[C[I]]=g[I]);for(;mt--;)vt[K++]=g[I++];return vt}function Pp(g,_,C,T){for(var I=-1,B=g.length,V=-1,K=C.length,tt=-1,mt=_.length,vt=Ue(B-K,0),_t=lt(vt+mt),bt=!T;++I<vt;)_t[I]=g[I];for(var At=I;++tt<mt;)_t[At+tt]=_[tt];for(;++V<K;)(bt||I<B)&&(_t[At+C[V]]=g[I++]);return _t}function vi(g,_){var C=-1,T=g.length;for(_||(_=lt(T));++C<T;)_[C]=g[C];return _}function dr(g,_,C,T){var I=!C;C||(C={});for(var B=-1,V=_.length;++B<V;){var K=_[B],tt=T?T(C[K],g[K],K,C,g):e;tt===e&&(tt=g[K]),I?Rr(C,K,tt):Ea(C,K,tt)}return C}function db(g,_){return dr(g,mu(g),_)}function gb(g,_){return dr(g,Hp(g),_)}function jo(g,_){return function(C,T){var I=Wt(C)?y2:kx,B=_?_():{};return I(C,g,Dt(T,2),B)}}function Es(g){return Yt(function(_,C){var T=-1,I=C.length,B=I>1?C[I-1]:e,V=I>2?C[2]:e;for(B=g.length>3&&typeof B=="function"?(I--,B):e,V&&di(C[0],C[1],V)&&(B=I<3?e:B,I=1),_=fe(_);++T<I;){var K=C[T];K&&g(_,K,T,B)}return _})}function Ip(g,_){return function(C,T){if(C==null)return C;if(!_i(C))return g(C,T);for(var I=C.length,B=_?I:-1,V=fe(C);(_?B--:++B<I)&&T(V[B],B,V)!==!1;);return C}}function Mp(g){return function(_,C,T){for(var I=-1,B=fe(_),V=T(_),K=V.length;K--;){var tt=V[g?K:++I];if(C(B[tt],tt,B)===!1)break}return _}}function pb(g,_,C){var T=_&p,I=Oa(g);function B(){var V=this&&this!==Je&&this instanceof B?I:g;return V.apply(T?C:this,arguments)}return B}function Op(g){return function(_){_=oe(_);var C=ys(_)?ji(_):e,T=C?C[0]:_.charAt(0),I=C?cn(C,1).join(""):_.slice(1);return T[g]()+I}}function As(g){return function(_){return Fc(I0(P0(_).replace(s2,"")),g,"")}}function Oa(g){return function(){var _=arguments;switch(_.length){case 0:return new g;case 1:return new g(_[0]);case 2:return new g(_[0],_[1]);case 3:return new g(_[0],_[1],_[2]);case 4:return new g(_[0],_[1],_[2],_[3]);case 5:return new g(_[0],_[1],_[2],_[3],_[4]);case 6:return new g(_[0],_[1],_[2],_[3],_[4],_[5]);case 7:return new g(_[0],_[1],_[2],_[3],_[4],_[5],_[6])}var C=Ts(g.prototype),T=g.apply(C,_);return Te(T)?T:C}}function mb(g,_,C){var T=Oa(g);function I(){for(var B=arguments.length,V=lt(B),K=B,tt=Ps(I);K--;)V[K]=arguments[K];var mt=B<3&&V[0]!==tt&&V[B-1]!==tt?[]:sn(V,tt);if(B-=mt.length,B<C)return kp(g,_,Yo,I.placeholder,e,V,mt,e,e,C-B);var vt=this&&this!==Je&&this instanceof I?T:g;return Si(vt,this,V)}return I}function Rp(g){return function(_,C,T){var I=fe(_);if(!_i(_)){var B=Dt(C,3);_=je(_),C=function(K){return B(I[K],K,I)}}var V=g(_,C,T);return V>-1?I[B?_[V]:V]:e}}function Dp(g){return Fr(function(_){var C=_.length,T=C,I=ki.prototype.thru;for(g&&_.reverse();T--;){var B=_[T];if(typeof B!="function")throw new Li(m);if(I&&!V&&Zo(B)=="wrapper")var V=new ki([],!0)}for(T=V?T:C;++T<C;){B=_[T];var K=Zo(B),tt=K=="wrapper"?gu(B):e;tt&&_u(tt[0])&&tt[1]==(P|x|w|A)&&!tt[4].length&&tt[9]==1?V=V[Zo(tt[0])].apply(V,tt[3]):V=B.length==1&&_u(B)?V[K]():V.thru(B)}return function(){var mt=arguments,vt=mt[0];if(V&&mt.length==1&&Wt(vt))return V.plant(vt).value();for(var _t=0,bt=C?_[_t].apply(this,mt):vt;++_t<C;)bt=_[_t].call(this,bt);return bt}})}function Yo(g,_,C,T,I,B,V,K,tt,mt){var vt=_&P,_t=_&p,bt=_&y,At=_&(x|S),Lt=_&N,jt=bt?e:Oa(g);function kt(){for(var Zt=arguments.length,re=lt(Zt),Ei=Zt;Ei--;)re[Ei]=arguments[Ei];if(At)var gi=Ps(kt),Ai=P2(re,gi);if(T&&(re=Ap(re,T,I,At)),B&&(re=Pp(re,B,V,At)),Zt-=Ai,At&&Zt<mt){var Fe=sn(re,gi);return kp(g,_,Yo,kt.placeholder,C,re,Fe,K,tt,mt-Zt)}var Ki=_t?C:this,Nr=bt?Ki[g]:g;return Zt=re.length,K?re=kb(re,K):Lt&&Zt>1&&re.reverse(),vt&&tt<Zt&&(re.length=tt),this&&this!==Je&&this instanceof kt&&(Nr=jt||Oa(Nr)),Nr.apply(Ki,re)}return kt}function Fp(g,_){return function(C,T){return Vx(C,g,_(T),{})}}function $o(g,_){return function(C,T){var I;if(C===e&&T===e)return _;if(C!==e&&(I=C),T!==e){if(I===e)return T;typeof C=="string"||typeof T=="string"?(C=wi(C),T=wi(T)):(C=yp(C),T=yp(T)),I=g(C,T)}return I}}function cu(g){return Fr(function(_){return _=ye(_,Ci(Dt())),Yt(function(C){var T=this;return g(_,function(I){return Si(I,T,C)})})})}function Ko(g,_){_=_===e?" ":wi(_);var C=_.length;if(C<2)return C?ru(_,g):_;var T=ru(_,Lo(g/xs(_)));return ys(_)?cn(ji(T),0,g).join(""):T.slice(0,g)}function vb(g,_,C,T){var I=_&p,B=Oa(g);function V(){for(var K=-1,tt=arguments.length,mt=-1,vt=T.length,_t=lt(vt+tt),bt=this&&this!==Je&&this instanceof V?B:g;++mt<vt;)_t[mt]=T[mt];for(;tt--;)_t[mt++]=arguments[++K];return Si(bt,I?C:this,_t)}return V}function Lp(g){return function(_,C,T){return T&&typeof T!="number"&&di(_,C,T)&&(C=T=e),_=Br(_),C===e?(C=_,_=0):C=Br(C),T=T===e?_<C?1:-1:Br(T),ib(_,C,T,g)}}function qo(g){return function(_,C){return typeof _=="string"&&typeof C=="string"||(_=Gi(_),C=Gi(C)),g(_,C)}}function kp(g,_,C,T,I,B,V,K,tt,mt){var vt=_&x,_t=vt?V:e,bt=vt?e:V,At=vt?B:e,Lt=vt?e:B;_|=vt?w:E,_&=~(vt?E:w),_&b||(_&=~(p|y));var jt=[g,_,I,At,_t,Lt,bt,K,tt,mt],kt=C.apply(e,jt);return _u(g)&&$p(kt,jt),kt.placeholder=T,Kp(kt,g,_)}function uu(g){var _=Ne[g];return function(C,T){if(C=Gi(C),T=T==null?0:ni(Vt(T),292),T&&Kg(C)){var I=(oe(C)+"e").split("e"),B=_(I[0]+"e"+(+I[1]+T));return I=(oe(B)+"e").split("e"),+(I[0]+"e"+(+I[1]-T))}return _(C)}}var _b=Cs&&1/To(new Cs([,-0]))[1]==it?function(g){return new Cs(g)}:Du;function Bp(g){return function(_){var C=si(_);return C==q?Hc(_):C==wt?L2(_):A2(_,g(_))}}function Dr(g,_,C,T,I,B,V,K){var tt=_&y;if(!tt&&typeof g!="function")throw new Li(m);var mt=T?T.length:0;if(mt||(_&=~(w|E),T=I=e),V=V===e?V:Ue(Vt(V),0),K=K===e?K:Vt(K),mt-=I?I.length:0,_&E){var vt=T,_t=I;T=I=e}var bt=tt?e:gu(g),At=[g,_,C,T,I,vt,_t,B,V,K];if(bt&&Db(At,bt),g=At[0],_=At[1],C=At[2],T=At[3],I=At[4],K=At[9]=At[9]===e?tt?0:g.length:Ue(At[9]-mt,0),!K&&_&(x|S)&&(_&=~(x|S)),!_||_==p)var Lt=pb(g,_,C);else _==x||_==S?Lt=mb(g,_,K):(_==w||_==(p|w))&&!I.length?Lt=vb(g,_,C,T):Lt=Yo.apply(e,At);var jt=bt?vp:$p;return Kp(jt(Lt,At),g,_)}function Np(g,_,C,T){return g===e||$i(g,Ss[C])&&!he.call(T,C)?_:g}function Up(g,_,C,T,I,B){return Te(g)&&Te(_)&&(B.set(_,g),Xo(g,_,e,Up,B),B.delete(_)),g}function yb(g){return Fa(g)?e:g}function Gp(g,_,C,T,I,B){var V=C&f,K=g.length,tt=_.length;if(K!=tt&&!(V&&tt>K))return!1;var mt=B.get(g),vt=B.get(_);if(mt&&vt)return mt==_&&vt==g;var _t=-1,bt=!0,At=C&v?new Fn:e;for(B.set(g,_),B.set(_,g);++_t<K;){var Lt=g[_t],jt=_[_t];if(T)var kt=V?T(jt,Lt,_t,_,g,B):T(Lt,jt,_t,g,_,B);if(kt!==e){if(kt)continue;bt=!1;break}if(At){if(!Lc(_,function(Zt,re){if(!xa(At,re)&&(Lt===Zt||I(Lt,Zt,C,T,B)))return At.push(re)})){bt=!1;break}}else if(!(Lt===jt||I(Lt,jt,C,T,B))){bt=!1;break}}return B.delete(g),B.delete(_),bt}function xb(g,_,C,T,I,B,V){switch(C){case Me:if(g.byteLength!=_.byteLength||g.byteOffset!=_.byteOffset)return!1;g=g.buffer,_=_.buffer;case ie:return!(g.byteLength!=_.byteLength||!B(new Oo(g),new Oo(_)));case z:case $:case rt:return $i(+g,+_);case nt:return g.name==_.name&&g.message==_.message;case Ft:case gt:return g==_+"";case q:var K=Hc;case wt:var tt=T&f;if(K||(K=To),g.size!=_.size&&!tt)return!1;var mt=V.get(g);if(mt)return mt==_;T|=v,V.set(g,_);var vt=Gp(K(g),K(_),T,I,B,V);return V.delete(g),vt;case Et:if(Ta)return Ta.call(g)==Ta.call(_)}return!1}function bb(g,_,C,T,I,B){var V=C&f,K=fu(g),tt=K.length,mt=fu(_),vt=mt.length;if(tt!=vt&&!V)return!1;for(var _t=tt;_t--;){var bt=K[_t];if(!(V?bt in _:he.call(_,bt)))return!1}var At=B.get(g),Lt=B.get(_);if(At&&Lt)return At==_&&Lt==g;var jt=!0;B.set(g,_),B.set(_,g);for(var kt=V;++_t<tt;){bt=K[_t];var Zt=g[bt],re=_[bt];if(T)var Ei=V?T(re,Zt,bt,_,g,B):T(Zt,re,bt,g,_,B);if(!(Ei===e?Zt===re||I(Zt,re,C,T,B):Ei)){jt=!1;break}kt||(kt=bt=="constructor")}if(jt&&!kt){var gi=g.constructor,Ai=_.constructor;gi!=Ai&&"constructor"in g&&"constructor"in _&&!(typeof gi=="function"&&gi instanceof gi&&typeof Ai=="function"&&Ai instanceof Ai)&&(jt=!1)}return B.delete(g),B.delete(_),jt}function Fr(g){return xu(jp(g,e,e0),g+"")}function fu(g){return ap(g,je,mu)}function du(g){return ap(g,yi,Hp)}var gu=Bo?function(g){return Bo.get(g)}:Du;function Zo(g){for(var _=g.name+"",C=ws[_],T=he.call(ws,_)?C.length:0;T--;){var I=C[T],B=I.func;if(B==null||B==g)return I.name}return _}function Ps(g){var _=he.call(D,"placeholder")?D:g;return _.placeholder}function Dt(){var g=D.iteratee||Ou;return g=g===Ou?lp:g,arguments.length?g(arguments[0],arguments[1]):g}function Jo(g,_){var C=g.__data__;return Ib(_)?C[typeof _=="string"?"string":"hash"]:C.map}function pu(g){for(var _=je(g),C=_.length;C--;){var T=_[C],I=g[T];_[C]=[T,I,Vp(I)]}return _}function Bn(g,_){var C=R2(g,_);return hp(C)?C:e}function Sb(g){var _=he.call(g,Rn),C=g[Rn];try{g[Rn]=e;var T=!0}catch{}var I=Io.call(g);return T&&(_?g[Rn]=C:delete g[Rn]),I}var mu=Xc?function(g){return g==null?[]:(g=fe(g),rn(Xc(g),function(_){return Yg.call(g,_)}))}:Fu,Hp=Xc?function(g){for(var _=[];g;)nn(_,mu(g)),g=Ro(g);return _}:Fu,si=fi;(Vc&&si(new Vc(new ArrayBuffer(1)))!=Me||Sa&&si(new Sa)!=q||zc&&si(zc.resolve())!=dt||Cs&&si(new Cs)!=wt||Ca&&si(new Ca)!=zt)&&(si=function(g){var _=fi(g),C=_==at?g.constructor:e,T=C?Nn(C):"";if(T)switch(T){case nx:return Me;case sx:return q;case ax:return dt;case ox:return wt;case hx:return zt}return _});function Cb(g,_,C){for(var T=-1,I=C.length;++T<I;){var B=C[T],V=B.size;switch(B.type){case"drop":g+=V;break;case"dropRight":_-=V;break;case"take":_=ni(_,g+V);break;case"takeRight":g=Ue(g,_-V);break}}return{start:g,end:_}}function wb(g){var _=g.match(My);return _?_[1].split(Oy):[]}function Wp(g,_,C){_=ln(_,g);for(var T=-1,I=_.length,B=!1;++T<I;){var V=gr(_[T]);if(!(B=g!=null&&C(g,V)))break;g=g[V]}return B||++T!=I?B:(I=g==null?0:g.length,!!I&&sh(I)&&Lr(V,I)&&(Wt(g)||Un(g)))}function Tb(g){var _=g.length,C=new g.constructor(_);return _&&typeof g[0]=="string"&&he.call(g,"index")&&(C.index=g.index,C.input=g.input),C}function Xp(g){return typeof g.constructor=="function"&&!Ra(g)?Ts(Ro(g)):{}}function Eb(g,_,C){var T=g.constructor;switch(_){case ie:return lu(g);case z:case $:return new T(+g);case Me:return lb(g,C);case _e:case zi:case Ir:case mi:case va:case ms:case _a:case ya:case Cc:return Tp(g,C);case q:return new T;case rt:case gt:return new T(g);case Ft:return cb(g);case wt:return new T;case Et:return ub(g)}}function Ab(g,_){var C=_.length;if(!C)return g;var T=C-1;return _[T]=(C>1?"& ":"")+_[T],_=_.join(C>2?", ":" "),g.replace(Iy,`{
/* [wrapped with `+_+`] */
`)}function Pb(g){return Wt(g)||Un(g)||!!($g&&g&&g[$g])}function Lr(g,_){var C=typeof g;return _=_??ct,!!_&&(C=="number"||C!="symbol"&&Gy.test(g))&&g>-1&&g%1==0&&g<_}function di(g,_,C){if(!Te(C))return!1;var T=typeof _;return(T=="number"?_i(C)&&Lr(_,C.length):T=="string"&&_ in C)?$i(C[_],g):!1}function vu(g,_){if(Wt(g))return!1;var C=typeof g;return C=="number"||C=="symbol"||C=="boolean"||g==null||Ti(g)?!0:Ty.test(g)||!wy.test(g)||_!=null&&g in fe(_)}function Ib(g){var _=typeof g;return _=="string"||_=="number"||_=="symbol"||_=="boolean"?g!=="__proto__":g===null}function _u(g){var _=Zo(g),C=D[_];if(typeof C!="function"||!(_ in Jt.prototype))return!1;if(g===C)return!0;var T=gu(C);return!!T&&g===T[0]}function Mb(g){return!!Vg&&Vg in g}var Ob=Ao?kr:Lu;function Ra(g){var _=g&&g.constructor,C=typeof _=="function"&&_.prototype||Ss;return g===C}function Vp(g){return g===g&&!Te(g)}function zp(g,_){return function(C){return C==null?!1:C[g]===_&&(_!==e||g in fe(C))}}function Rb(g){var _=rh(g,function(T){return C.size===h&&C.clear(),T}),C=_.cache;return _}function Db(g,_){var C=g[1],T=_[1],I=C|T,B=I<(p|y|P),V=T==P&&C==x||T==P&&C==A&&g[7].length<=_[8]||T==(P|A)&&_[7].length<=_[8]&&C==x;if(!(B||V))return g;T&p&&(g[2]=_[2],I|=C&p?0:b);var K=_[3];if(K){var tt=g[3];g[3]=tt?Ap(tt,K,_[4]):K,g[4]=tt?sn(g[3],d):_[4]}return K=_[5],K&&(tt=g[5],g[5]=tt?Pp(tt,K,_[6]):K,g[6]=tt?sn(g[5],d):_[6]),K=_[7],K&&(g[7]=K),T&P&&(g[8]=g[8]==null?_[8]:ni(g[8],_[8])),g[9]==null&&(g[9]=_[9]),g[0]=_[0],g[1]=I,g}function Fb(g){var _=[];if(g!=null)for(var C in fe(g))_.push(C);return _}function Lb(g){return Io.call(g)}function jp(g,_,C){return _=Ue(_===e?g.length-1:_,0),function(){for(var T=arguments,I=-1,B=Ue(T.length-_,0),V=lt(B);++I<B;)V[I]=T[_+I];I=-1;for(var K=lt(_+1);++I<_;)K[I]=T[I];return K[_]=C(V),Si(g,this,K)}}function Yp(g,_){return _.length<2?g:kn(g,Ni(_,0,-1))}function kb(g,_){for(var C=g.length,T=ni(_.length,C),I=vi(g);T--;){var B=_[T];g[T]=Lr(B,C)?I[B]:e}return g}function yu(g,_){if(!(_==="constructor"&&typeof g[_]=="function")&&_!="__proto__")return g[_]}var $p=qp(vp),Da=Z2||function(g,_){return Je.setTimeout(g,_)},xu=qp(sb);function Kp(g,_,C){var T=_+"";return xu(g,Ab(T,Bb(wb(T),C)))}function qp(g){var _=0,C=0;return function(){var T=ex(),I=X-(T-C);if(C=T,I>0){if(++_>=j)return arguments[0]}else _=0;return g.apply(e,arguments)}}function Qo(g,_){var C=-1,T=g.length,I=T-1;for(_=_===e?T:_;++C<_;){var B=iu(C,I),V=g[B];g[B]=g[C],g[C]=V}return g.length=_,g}var Zp=Rb(function(g){var _=[];return g.charCodeAt(0)===46&&_.push(""),g.replace(Ey,function(C,T,I,B){_.push(I?B.replace(Fy,"$1"):T||C)}),_});function gr(g){if(typeof g=="string"||Ti(g))return g;var _=g+"";return _=="0"&&1/g==-it?"-0":_}function Nn(g){if(g!=null){try{return Po.call(g)}catch{}try{return g+""}catch{}}return""}function Bb(g,_){return Fi(G,function(C){var T="_."+C[0];_&C[1]&&!Co(g,T)&&g.push(T)}),g.sort()}function Jp(g){if(g instanceof Jt)return g.clone();var _=new ki(g.__wrapped__,g.__chain__);return _.__actions__=vi(g.__actions__),_.__index__=g.__index__,_.__values__=g.__values__,_}function Nb(g,_,C){(C?di(g,_,C):_===e)?_=1:_=Ue(Vt(_),0);var T=g==null?0:g.length;if(!T||_<1)return[];for(var I=0,B=0,V=lt(Lo(T/_));I<T;)V[B++]=Ni(g,I,I+=_);return V}function Ub(g){for(var _=-1,C=g==null?0:g.length,T=0,I=[];++_<C;){var B=g[_];B&&(I[T++]=B)}return I}function Gb(){var g=arguments.length;if(!g)return[];for(var _=lt(g-1),C=arguments[0],T=g;T--;)_[T-1]=arguments[T];return nn(Wt(C)?vi(C):[C],Qe(_,1))}var Hb=Yt(function(g,_){return De(g)?Aa(g,Qe(_,1,De,!0)):[]}),Wb=Yt(function(g,_){var C=Ui(_);return De(C)&&(C=e),De(g)?Aa(g,Qe(_,1,De,!0),Dt(C,2)):[]}),Xb=Yt(function(g,_){var C=Ui(_);return De(C)&&(C=e),De(g)?Aa(g,Qe(_,1,De,!0),e,C):[]});function Vb(g,_,C){var T=g==null?0:g.length;return T?(_=C||_===e?1:Vt(_),Ni(g,_<0?0:_,T)):[]}function zb(g,_,C){var T=g==null?0:g.length;return T?(_=C||_===e?1:Vt(_),_=T-_,Ni(g,0,_<0?0:_)):[]}function jb(g,_){return g&&g.length?zo(g,Dt(_,3),!0,!0):[]}function Yb(g,_){return g&&g.length?zo(g,Dt(_,3),!0):[]}function $b(g,_,C,T){var I=g==null?0:g.length;return I?(C&&typeof C!="number"&&di(g,_,C)&&(C=0,T=I),Gx(g,_,C,T)):[]}function Qp(g,_,C){var T=g==null?0:g.length;if(!T)return-1;var I=C==null?0:Vt(C);return I<0&&(I=Ue(T+I,0)),wo(g,Dt(_,3),I)}function t0(g,_,C){var T=g==null?0:g.length;if(!T)return-1;var I=T-1;return C!==e&&(I=Vt(C),I=C<0?Ue(T+I,0):ni(I,T-1)),wo(g,Dt(_,3),I,!0)}function e0(g){var _=g==null?0:g.length;return _?Qe(g,1):[]}function Kb(g){var _=g==null?0:g.length;return _?Qe(g,it):[]}function qb(g,_){var C=g==null?0:g.length;return C?(_=_===e?1:Vt(_),Qe(g,_)):[]}function Zb(g){for(var _=-1,C=g==null?0:g.length,T={};++_<C;){var I=g[_];T[I[0]]=I[1]}return T}function i0(g){return g&&g.length?g[0]:e}function Jb(g,_,C){var T=g==null?0:g.length;if(!T)return-1;var I=C==null?0:Vt(C);return I<0&&(I=Ue(T+I,0)),_s(g,_,I)}function Qb(g){var _=g==null?0:g.length;return _?Ni(g,0,-1):[]}var tS=Yt(function(g){var _=ye(g,ou);return _.length&&_[0]===g[0]?Zc(_):[]}),eS=Yt(function(g){var _=Ui(g),C=ye(g,ou);return _===Ui(C)?_=e:C.pop(),C.length&&C[0]===g[0]?Zc(C,Dt(_,2)):[]}),iS=Yt(function(g){var _=Ui(g),C=ye(g,ou);return _=typeof _=="function"?_:e,_&&C.pop(),C.length&&C[0]===g[0]?Zc(C,e,_):[]});function rS(g,_){return g==null?"":Q2.call(g,_)}function Ui(g){var _=g==null?0:g.length;return _?g[_-1]:e}function nS(g,_,C){var T=g==null?0:g.length;if(!T)return-1;var I=T;return C!==e&&(I=Vt(C),I=I<0?Ue(T+I,0):ni(I,T-1)),_===_?B2(g,_,I):wo(g,kg,I,!0)}function sS(g,_){return g&&g.length?dp(g,Vt(_)):e}var aS=Yt(r0);function r0(g,_){return g&&g.length&&_&&_.length?eu(g,_):g}function oS(g,_,C){return g&&g.length&&_&&_.length?eu(g,_,Dt(C,2)):g}function hS(g,_,C){return g&&g.length&&_&&_.length?eu(g,_,e,C):g}var lS=Fr(function(g,_){var C=g==null?0:g.length,T=Yc(g,_);return mp(g,ye(_,function(I){return Lr(I,C)?+I:I}).sort(Ep)),T});function cS(g,_){var C=[];if(!(g&&g.length))return C;var T=-1,I=[],B=g.length;for(_=Dt(_,3);++T<B;){var V=g[T];_(V,T,g)&&(C.push(V),I.push(T))}return mp(g,I),C}function bu(g){return g==null?g:rx.call(g)}function uS(g,_,C){var T=g==null?0:g.length;return T?(C&&typeof C!="number"&&di(g,_,C)?(_=0,C=T):(_=_==null?0:Vt(_),C=C===e?T:Vt(C)),Ni(g,_,C)):[]}function fS(g,_){return Vo(g,_)}function dS(g,_,C){return nu(g,_,Dt(C,2))}function gS(g,_){var C=g==null?0:g.length;if(C){var T=Vo(g,_);if(T<C&&$i(g[T],_))return T}return-1}function pS(g,_){return Vo(g,_,!0)}function mS(g,_,C){return nu(g,_,Dt(C,2),!0)}function vS(g,_){var C=g==null?0:g.length;if(C){var T=Vo(g,_,!0)-1;if($i(g[T],_))return T}return-1}function _S(g){return g&&g.length?_p(g):[]}function yS(g,_){return g&&g.length?_p(g,Dt(_,2)):[]}function xS(g){var _=g==null?0:g.length;return _?Ni(g,1,_):[]}function bS(g,_,C){return g&&g.length?(_=C||_===e?1:Vt(_),Ni(g,0,_<0?0:_)):[]}function SS(g,_,C){var T=g==null?0:g.length;return T?(_=C||_===e?1:Vt(_),_=T-_,Ni(g,_<0?0:_,T)):[]}function CS(g,_){return g&&g.length?zo(g,Dt(_,3),!1,!0):[]}function wS(g,_){return g&&g.length?zo(g,Dt(_,3)):[]}var TS=Yt(function(g){return hn(Qe(g,1,De,!0))}),ES=Yt(function(g){var _=Ui(g);return De(_)&&(_=e),hn(Qe(g,1,De,!0),Dt(_,2))}),AS=Yt(function(g){var _=Ui(g);return _=typeof _=="function"?_:e,hn(Qe(g,1,De,!0),e,_)});function PS(g){return g&&g.length?hn(g):[]}function IS(g,_){return g&&g.length?hn(g,Dt(_,2)):[]}function MS(g,_){return _=typeof _=="function"?_:e,g&&g.length?hn(g,e,_):[]}function Su(g){if(!(g&&g.length))return[];var _=0;return g=rn(g,function(C){if(De(C))return _=Ue(C.length,_),!0}),Uc(_,function(C){return ye(g,kc(C))})}function n0(g,_){if(!(g&&g.length))return[];var C=Su(g);return _==null?C:ye(C,function(T){return Si(_,e,T)})}var OS=Yt(function(g,_){return De(g)?Aa(g,_):[]}),RS=Yt(function(g){return au(rn(g,De))}),DS=Yt(function(g){var _=Ui(g);return De(_)&&(_=e),au(rn(g,De),Dt(_,2))}),FS=Yt(function(g){var _=Ui(g);return _=typeof _=="function"?_:e,au(rn(g,De),e,_)}),LS=Yt(Su);function kS(g,_){return Sp(g||[],_||[],Ea)}function BS(g,_){return Sp(g||[],_||[],Ma)}var NS=Yt(function(g){var _=g.length,C=_>1?g[_-1]:e;return C=typeof C=="function"?(g.pop(),C):e,n0(g,C)});function s0(g){var _=D(g);return _.__chain__=!0,_}function US(g,_){return _(g),g}function th(g,_){return _(g)}var GS=Fr(function(g){var _=g.length,C=_?g[0]:0,T=this.__wrapped__,I=function(B){return Yc(B,g)};return _>1||this.__actions__.length||!(T instanceof Jt)||!Lr(C)?this.thru(I):(T=T.slice(C,+C+(_?1:0)),T.__actions__.push({func:th,args:[I],thisArg:e}),new ki(T,this.__chain__).thru(function(B){return _&&!B.length&&B.push(e),B}))});function HS(){return s0(this)}function WS(){return new ki(this.value(),this.__chain__)}function XS(){this.__values__===e&&(this.__values__=y0(this.value()));var g=this.__index__>=this.__values__.length,_=g?e:this.__values__[this.__index__++];return{done:g,value:_}}function VS(){return this}function zS(g){for(var _,C=this;C instanceof Uo;){var T=Jp(C);T.__index__=0,T.__values__=e,_?I.__wrapped__=T:_=T;var I=T;C=C.__wrapped__}return I.__wrapped__=g,_}function jS(){var g=this.__wrapped__;if(g instanceof Jt){var _=g;return this.__actions__.length&&(_=new Jt(this)),_=_.reverse(),_.__actions__.push({func:th,args:[bu],thisArg:e}),new ki(_,this.__chain__)}return this.thru(bu)}function YS(){return bp(this.__wrapped__,this.__actions__)}var $S=jo(function(g,_,C){he.call(g,C)?++g[C]:Rr(g,C,1)});function KS(g,_,C){var T=Wt(g)?Fg:Ux;return C&&di(g,_,C)&&(_=e),T(g,Dt(_,3))}function qS(g,_){var C=Wt(g)?rn:np;return C(g,Dt(_,3))}var ZS=Rp(Qp),JS=Rp(t0);function QS(g,_){return Qe(eh(g,_),1)}function tC(g,_){return Qe(eh(g,_),it)}function eC(g,_,C){return C=C===e?1:Vt(C),Qe(eh(g,_),C)}function a0(g,_){var C=Wt(g)?Fi:on;return C(g,Dt(_,3))}function o0(g,_){var C=Wt(g)?x2:rp;return C(g,Dt(_,3))}var iC=jo(function(g,_,C){he.call(g,C)?g[C].push(_):Rr(g,C,[_])});function rC(g,_,C,T){g=_i(g)?g:Ms(g),C=C&&!T?Vt(C):0;var I=g.length;return C<0&&(C=Ue(I+C,0)),ah(g)?C<=I&&g.indexOf(_,C)>-1:!!I&&_s(g,_,C)>-1}var nC=Yt(function(g,_,C){var T=-1,I=typeof _=="function",B=_i(g)?lt(g.length):[];return on(g,function(V){B[++T]=I?Si(_,V,C):Pa(V,_,C)}),B}),sC=jo(function(g,_,C){Rr(g,C,_)});function eh(g,_){var C=Wt(g)?ye:cp;return C(g,Dt(_,3))}function aC(g,_,C,T){return g==null?[]:(Wt(_)||(_=_==null?[]:[_]),C=T?e:C,Wt(C)||(C=C==null?[]:[C]),gp(g,_,C))}var oC=jo(function(g,_,C){g[C?0:1].push(_)},function(){return[[],[]]});function hC(g,_,C){var T=Wt(g)?Fc:Ng,I=arguments.length<3;return T(g,Dt(_,4),C,I,on)}function lC(g,_,C){var T=Wt(g)?b2:Ng,I=arguments.length<3;return T(g,Dt(_,4),C,I,rp)}function cC(g,_){var C=Wt(g)?rn:np;return C(g,nh(Dt(_,3)))}function uC(g){var _=Wt(g)?Qg:rb;return _(g)}function fC(g,_,C){(C?di(g,_,C):_===e)?_=1:_=Vt(_);var T=Wt(g)?Fx:nb;return T(g,_)}function dC(g){var _=Wt(g)?Lx:ab;return _(g)}function gC(g){if(g==null)return 0;if(_i(g))return ah(g)?xs(g):g.length;var _=si(g);return _==q||_==wt?g.size:Qc(g).length}function pC(g,_,C){var T=Wt(g)?Lc:ob;return C&&di(g,_,C)&&(_=e),T(g,Dt(_,3))}var mC=Yt(function(g,_){if(g==null)return[];var C=_.length;return C>1&&di(g,_[0],_[1])?_=[]:C>2&&di(_[0],_[1],_[2])&&(_=[_[0]]),gp(g,Qe(_,1),[])}),ih=q2||function(){return Je.Date.now()};function vC(g,_){if(typeof _!="function")throw new Li(m);return g=Vt(g),function(){if(--g<1)return _.apply(this,arguments)}}function h0(g,_,C){return _=C?e:_,_=g&&_==null?g.length:_,Dr(g,P,e,e,e,e,_)}function l0(g,_){var C;if(typeof _!="function")throw new Li(m);return g=Vt(g),function(){return--g>0&&(C=_.apply(this,arguments)),g<=1&&(_=e),C}}var Cu=Yt(function(g,_,C){var T=p;if(C.length){var I=sn(C,Ps(Cu));T|=w}return Dr(g,T,_,C,I)}),c0=Yt(function(g,_,C){var T=p|y;if(C.length){var I=sn(C,Ps(c0));T|=w}return Dr(_,T,g,C,I)});function u0(g,_,C){_=C?e:_;var T=Dr(g,x,e,e,e,e,e,_);return T.placeholder=u0.placeholder,T}function f0(g,_,C){_=C?e:_;var T=Dr(g,S,e,e,e,e,e,_);return T.placeholder=f0.placeholder,T}function d0(g,_,C){var T,I,B,V,K,tt,mt=0,vt=!1,_t=!1,bt=!0;if(typeof g!="function")throw new Li(m);_=Gi(_)||0,Te(C)&&(vt=!!C.leading,_t="maxWait"in C,B=_t?Ue(Gi(C.maxWait)||0,_):B,bt="trailing"in C?!!C.trailing:bt);function At(Fe){var Ki=T,Nr=I;return T=I=e,mt=Fe,V=g.apply(Nr,Ki),V}function Lt(Fe){return mt=Fe,K=Da(Zt,_),vt?At(Fe):V}function jt(Fe){var Ki=Fe-tt,Nr=Fe-mt,R0=_-Ki;return _t?ni(R0,B-Nr):R0}function kt(Fe){var Ki=Fe-tt,Nr=Fe-mt;return tt===e||Ki>=_||Ki<0||_t&&Nr>=B}function Zt(){var Fe=ih();if(kt(Fe))return re(Fe);K=Da(Zt,jt(Fe))}function re(Fe){return K=e,bt&&T?At(Fe):(T=I=e,V)}function Ei(){K!==e&&Cp(K),mt=0,T=tt=I=K=e}function gi(){return K===e?V:re(ih())}function Ai(){var Fe=ih(),Ki=kt(Fe);if(T=arguments,I=this,tt=Fe,Ki){if(K===e)return Lt(tt);if(_t)return Cp(K),K=Da(Zt,_),At(tt)}return K===e&&(K=Da(Zt,_)),V}return Ai.cancel=Ei,Ai.flush=gi,Ai}var _C=Yt(function(g,_){return ip(g,1,_)}),yC=Yt(function(g,_,C){return ip(g,Gi(_)||0,C)});function xC(g){return Dr(g,N)}function rh(g,_){if(typeof g!="function"||_!=null&&typeof _!="function")throw new Li(m);var C=function(){var T=arguments,I=_?_.apply(this,T):T[0],B=C.cache;if(B.has(I))return B.get(I);var V=g.apply(this,T);return C.cache=B.set(I,V)||B,V};return C.cache=new(rh.Cache||Or),C}rh.Cache=Or;function nh(g){if(typeof g!="function")throw new Li(m);return function(){var _=arguments;switch(_.length){case 0:return!g.call(this);case 1:return!g.call(this,_[0]);case 2:return!g.call(this,_[0],_[1]);case 3:return!g.call(this,_[0],_[1],_[2])}return!g.apply(this,_)}}function bC(g){return l0(2,g)}var SC=hb(function(g,_){_=_.length==1&&Wt(_[0])?ye(_[0],Ci(Dt())):ye(Qe(_,1),Ci(Dt()));var C=_.length;return Yt(function(T){for(var I=-1,B=ni(T.length,C);++I<B;)T[I]=_[I].call(this,T[I]);return Si(g,this,T)})}),wu=Yt(function(g,_){var C=sn(_,Ps(wu));return Dr(g,w,e,_,C)}),g0=Yt(function(g,_){var C=sn(_,Ps(g0));return Dr(g,E,e,_,C)}),CC=Fr(function(g,_){return Dr(g,A,e,e,e,_)});function wC(g,_){if(typeof g!="function")throw new Li(m);return _=_===e?_:Vt(_),Yt(g,_)}function TC(g,_){if(typeof g!="function")throw new Li(m);return _=_==null?0:Ue(Vt(_),0),Yt(function(C){var T=C[_],I=cn(C,0,_);return T&&nn(I,T),Si(g,this,I)})}function EC(g,_,C){var T=!0,I=!0;if(typeof g!="function")throw new Li(m);return Te(C)&&(T="leading"in C?!!C.leading:T,I="trailing"in C?!!C.trailing:I),d0(g,_,{leading:T,maxWait:_,trailing:I})}function AC(g){return h0(g,1)}function PC(g,_){return wu(hu(_),g)}function IC(){if(!arguments.length)return[];var g=arguments[0];return Wt(g)?g:[g]}function MC(g){return Bi(g,c)}function OC(g,_){return _=typeof _=="function"?_:e,Bi(g,c,_)}function RC(g){return Bi(g,l|c)}function DC(g,_){return _=typeof _=="function"?_:e,Bi(g,l|c,_)}function FC(g,_){return _==null||ep(g,_,je(_))}function $i(g,_){return g===_||g!==g&&_!==_}var LC=qo(qc),kC=qo(function(g,_){return g>=_}),Un=op(function(){return arguments}())?op:function(g){return Oe(g)&&he.call(g,"callee")&&!Yg.call(g,"callee")},Wt=lt.isArray,BC=Pg?Ci(Pg):zx;function _i(g){return g!=null&&sh(g.length)&&!kr(g)}function De(g){return Oe(g)&&_i(g)}function NC(g){return g===!0||g===!1||Oe(g)&&fi(g)==z}var un=J2||Lu,UC=Ig?Ci(Ig):jx;function GC(g){return Oe(g)&&g.nodeType===1&&!Fa(g)}function HC(g){if(g==null)return!0;if(_i(g)&&(Wt(g)||typeof g=="string"||typeof g.splice=="function"||un(g)||Is(g)||Un(g)))return!g.length;var _=si(g);if(_==q||_==wt)return!g.size;if(Ra(g))return!Qc(g).length;for(var C in g)if(he.call(g,C))return!1;return!0}function WC(g,_){return Ia(g,_)}function XC(g,_,C){C=typeof C=="function"?C:e;var T=C?C(g,_):e;return T===e?Ia(g,_,e,C):!!T}function Tu(g){if(!Oe(g))return!1;var _=fi(g);return _==nt||_==st||typeof g.message=="string"&&typeof g.name=="string"&&!Fa(g)}function VC(g){return typeof g=="number"&&Kg(g)}function kr(g){if(!Te(g))return!1;var _=fi(g);return _==ft||_==et||_==R||_==xt}function p0(g){return typeof g=="number"&&g==Vt(g)}function sh(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=ct}function Te(g){var _=typeof g;return g!=null&&(_=="object"||_=="function")}function Oe(g){return g!=null&&typeof g=="object"}var m0=Mg?Ci(Mg):$x;function zC(g,_){return g===_||Jc(g,_,pu(_))}function jC(g,_,C){return C=typeof C=="function"?C:e,Jc(g,_,pu(_),C)}function YC(g){return v0(g)&&g!=+g}function $C(g){if(Ob(g))throw new Ut(o);return hp(g)}function KC(g){return g===null}function qC(g){return g==null}function v0(g){return typeof g=="number"||Oe(g)&&fi(g)==rt}function Fa(g){if(!Oe(g)||fi(g)!=at)return!1;var _=Ro(g);if(_===null)return!0;var C=he.call(_,"constructor")&&_.constructor;return typeof C=="function"&&C instanceof C&&Po.call(C)==j2}var Eu=Og?Ci(Og):Kx;function ZC(g){return p0(g)&&g>=-ct&&g<=ct}var _0=Rg?Ci(Rg):qx;function ah(g){return typeof g=="string"||!Wt(g)&&Oe(g)&&fi(g)==gt}function Ti(g){return typeof g=="symbol"||Oe(g)&&fi(g)==Et}var Is=Dg?Ci(Dg):Zx;function JC(g){return g===e}function QC(g){return Oe(g)&&si(g)==zt}function tw(g){return Oe(g)&&fi(g)==ge}var ew=qo(tu),iw=qo(function(g,_){return g<=_});function y0(g){if(!g)return[];if(_i(g))return ah(g)?ji(g):vi(g);if(ba&&g[ba])return F2(g[ba]());var _=si(g),C=_==q?Hc:_==wt?To:Ms;return C(g)}function Br(g){if(!g)return g===0?g:0;if(g=Gi(g),g===it||g===-it){var _=g<0?-1:1;return _*O}return g===g?g:0}function Vt(g){var _=Br(g),C=_%1;return _===_?C?_-C:_:0}function x0(g){return g?Ln(Vt(g),0,L):0}function Gi(g){if(typeof g=="number")return g;if(Ti(g))return M;if(Te(g)){var _=typeof g.valueOf=="function"?g.valueOf():g;g=Te(_)?_+"":_}if(typeof g!="string")return g===0?g:+g;g=Ug(g);var C=By.test(g);return C||Uy.test(g)?v2(g.slice(2),C?2:8):ky.test(g)?M:+g}function b0(g){return dr(g,yi(g))}function rw(g){return g?Ln(Vt(g),-ct,ct):g===0?g:0}function oe(g){return g==null?"":wi(g)}var nw=Es(function(g,_){if(Ra(_)||_i(_)){dr(_,je(_),g);return}for(var C in _)he.call(_,C)&&Ea(g,C,_[C])}),S0=Es(function(g,_){dr(_,yi(_),g)}),oh=Es(function(g,_,C,T){dr(_,yi(_),g,T)}),sw=Es(function(g,_,C,T){dr(_,je(_),g,T)}),aw=Fr(Yc);function ow(g,_){var C=Ts(g);return _==null?C:tp(C,_)}var hw=Yt(function(g,_){g=fe(g);var C=-1,T=_.length,I=T>2?_[2]:e;for(I&&di(_[0],_[1],I)&&(T=1);++C<T;)for(var B=_[C],V=yi(B),K=-1,tt=V.length;++K<tt;){var mt=V[K],vt=g[mt];(vt===e||$i(vt,Ss[mt])&&!he.call(g,mt))&&(g[mt]=B[mt])}return g}),lw=Yt(function(g){return g.push(e,Up),Si(C0,e,g)});function cw(g,_){return Lg(g,Dt(_,3),fr)}function uw(g,_){return Lg(g,Dt(_,3),Kc)}function fw(g,_){return g==null?g:$c(g,Dt(_,3),yi)}function dw(g,_){return g==null?g:sp(g,Dt(_,3),yi)}function gw(g,_){return g&&fr(g,Dt(_,3))}function pw(g,_){return g&&Kc(g,Dt(_,3))}function mw(g){return g==null?[]:Wo(g,je(g))}function vw(g){return g==null?[]:Wo(g,yi(g))}function Au(g,_,C){var T=g==null?e:kn(g,_);return T===e?C:T}function _w(g,_){return g!=null&&Wp(g,_,Hx)}function Pu(g,_){return g!=null&&Wp(g,_,Wx)}var yw=Fp(function(g,_,C){_!=null&&typeof _.toString!="function"&&(_=Io.call(_)),g[_]=C},Mu(xi)),xw=Fp(function(g,_,C){_!=null&&typeof _.toString!="function"&&(_=Io.call(_)),he.call(g,_)?g[_].push(C):g[_]=[C]},Dt),bw=Yt(Pa);function je(g){return _i(g)?Jg(g):Qc(g)}function yi(g){return _i(g)?Jg(g,!0):Jx(g)}function Sw(g,_){var C={};return _=Dt(_,3),fr(g,function(T,I,B){Rr(C,_(T,I,B),T)}),C}function Cw(g,_){var C={};return _=Dt(_,3),fr(g,function(T,I,B){Rr(C,I,_(T,I,B))}),C}var ww=Es(function(g,_,C){Xo(g,_,C)}),C0=Es(function(g,_,C,T){Xo(g,_,C,T)}),Tw=Fr(function(g,_){var C={};if(g==null)return C;var T=!1;_=ye(_,function(B){return B=ln(B,g),T||(T=B.length>1),B}),dr(g,du(g),C),T&&(C=Bi(C,l|u|c,yb));for(var I=_.length;I--;)su(C,_[I]);return C});function Ew(g,_){return w0(g,nh(Dt(_)))}var Aw=Fr(function(g,_){return g==null?{}:tb(g,_)});function w0(g,_){if(g==null)return{};var C=ye(du(g),function(T){return[T]});return _=Dt(_),pp(g,C,function(T,I){return _(T,I[0])})}function Pw(g,_,C){_=ln(_,g);var T=-1,I=_.length;for(I||(I=1,g=e);++T<I;){var B=g==null?e:g[gr(_[T])];B===e&&(T=I,B=C),g=kr(B)?B.call(g):B}return g}function Iw(g,_,C){return g==null?g:Ma(g,_,C)}function Mw(g,_,C,T){return T=typeof T=="function"?T:e,g==null?g:Ma(g,_,C,T)}var T0=Bp(je),E0=Bp(yi);function Ow(g,_,C){var T=Wt(g),I=T||un(g)||Is(g);if(_=Dt(_,4),C==null){var B=g&&g.constructor;I?C=T?new B:[]:Te(g)?C=kr(B)?Ts(Ro(g)):{}:C={}}return(I?Fi:fr)(g,function(V,K,tt){return _(C,V,K,tt)}),C}function Rw(g,_){return g==null?!0:su(g,_)}function Dw(g,_,C){return g==null?g:xp(g,_,hu(C))}function Fw(g,_,C,T){return T=typeof T=="function"?T:e,g==null?g:xp(g,_,hu(C),T)}function Ms(g){return g==null?[]:Gc(g,je(g))}function Lw(g){return g==null?[]:Gc(g,yi(g))}function kw(g,_,C){return C===e&&(C=_,_=e),C!==e&&(C=Gi(C),C=C===C?C:0),_!==e&&(_=Gi(_),_=_===_?_:0),Ln(Gi(g),_,C)}function Bw(g,_,C){return _=Br(_),C===e?(C=_,_=0):C=Br(C),g=Gi(g),Xx(g,_,C)}function Nw(g,_,C){if(C&&typeof C!="boolean"&&di(g,_,C)&&(_=C=e),C===e&&(typeof _=="boolean"?(C=_,_=e):typeof g=="boolean"&&(C=g,g=e)),g===e&&_===e?(g=0,_=1):(g=Br(g),_===e?(_=g,g=0):_=Br(_)),g>_){var T=g;g=_,_=T}if(C||g%1||_%1){var I=qg();return ni(g+I*(_-g+m2("1e-"+((I+"").length-1))),_)}return iu(g,_)}var Uw=As(function(g,_,C){return _=_.toLowerCase(),g+(C?A0(_):_)});function A0(g){return Iu(oe(g).toLowerCase())}function P0(g){return g=oe(g),g&&g.replace(Hy,I2).replace(a2,"")}function Gw(g,_,C){g=oe(g),_=wi(_);var T=g.length;C=C===e?T:Ln(Vt(C),0,T);var I=C;return C-=_.length,C>=0&&g.slice(C,I)==_}function Hw(g){return g=oe(g),g&&by.test(g)?g.replace(sg,M2):g}function Ww(g){return g=oe(g),g&&Ay.test(g)?g.replace(wc,"\\$&"):g}var Xw=As(function(g,_,C){return g+(C?"-":"")+_.toLowerCase()}),Vw=As(function(g,_,C){return g+(C?" ":"")+_.toLowerCase()}),zw=Op("toLowerCase");function jw(g,_,C){g=oe(g),_=Vt(_);var T=_?xs(g):0;if(!_||T>=_)return g;var I=(_-T)/2;return Ko(ko(I),C)+g+Ko(Lo(I),C)}function Yw(g,_,C){g=oe(g),_=Vt(_);var T=_?xs(g):0;return _&&T<_?g+Ko(_-T,C):g}function $w(g,_,C){g=oe(g),_=Vt(_);var T=_?xs(g):0;return _&&T<_?Ko(_-T,C)+g:g}function Kw(g,_,C){return C||_==null?_=0:_&&(_=+_),ix(oe(g).replace(Tc,""),_||0)}function qw(g,_,C){return(C?di(g,_,C):_===e)?_=1:_=Vt(_),ru(oe(g),_)}function Zw(){var g=arguments,_=oe(g[0]);return g.length<3?_:_.replace(g[1],g[2])}var Jw=As(function(g,_,C){return g+(C?"_":"")+_.toLowerCase()});function Qw(g,_,C){return C&&typeof C!="number"&&di(g,_,C)&&(_=C=e),C=C===e?L:C>>>0,C?(g=oe(g),g&&(typeof _=="string"||_!=null&&!Eu(_))&&(_=wi(_),!_&&ys(g))?cn(ji(g),0,C):g.split(_,C)):[]}var tT=As(function(g,_,C){return g+(C?" ":"")+Iu(_)});function eT(g,_,C){return g=oe(g),C=C==null?0:Ln(Vt(C),0,g.length),_=wi(_),g.slice(C,C+_.length)==_}function iT(g,_,C){var T=D.templateSettings;C&&di(g,_,C)&&(_=e),g=oe(g),_=oh({},_,T,Np);var I=oh({},_.imports,T.imports,Np),B=je(I),V=Gc(I,B),K,tt,mt=0,vt=_.interpolate||xo,_t="__p += '",bt=Wc((_.escape||xo).source+"|"+vt.source+"|"+(vt===ag?Ly:xo).source+"|"+(_.evaluate||xo).source+"|$","g"),At="//# sourceURL="+(he.call(_,"sourceURL")?(_.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++u2+"]")+`
`;g.replace(bt,function(kt,Zt,re,Ei,gi,Ai){return re||(re=Ei),_t+=g.slice(mt,Ai).replace(Wy,O2),Zt&&(K=!0,_t+=`' +
__e(`+Zt+`) +
'`),gi&&(tt=!0,_t+=`';
`+gi+`;
__p += '`),re&&(_t+=`' +
((__t = (`+re+`)) == null ? '' : __t) +
'`),mt=Ai+kt.length,kt}),_t+=`';
`;var Lt=he.call(_,"variable")&&_.variable;if(!Lt)_t=`with (obj) {
`+_t+`
}
`;else if(Dy.test(Lt))throw new Ut(a);_t=(tt?_t.replace(vy,""):_t).replace(_y,"$1").replace(yy,"$1;"),_t="function("+(Lt||"obj")+`) {
`+(Lt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(tt?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+_t+`return __p
}`;var jt=M0(function(){return ae(B,At+"return "+_t).apply(e,V)});if(jt.source=_t,Tu(jt))throw jt;return jt}function rT(g){return oe(g).toLowerCase()}function nT(g){return oe(g).toUpperCase()}function sT(g,_,C){if(g=oe(g),g&&(C||_===e))return Ug(g);if(!g||!(_=wi(_)))return g;var T=ji(g),I=ji(_),B=Gg(T,I),V=Hg(T,I)+1;return cn(T,B,V).join("")}function aT(g,_,C){if(g=oe(g),g&&(C||_===e))return g.slice(0,Xg(g)+1);if(!g||!(_=wi(_)))return g;var T=ji(g),I=Hg(T,ji(_))+1;return cn(T,0,I).join("")}function oT(g,_,C){if(g=oe(g),g&&(C||_===e))return g.replace(Tc,"");if(!g||!(_=wi(_)))return g;var T=ji(g),I=Gg(T,ji(_));return cn(T,I).join("")}function hT(g,_){var C=k,T=U;if(Te(_)){var I="separator"in _?_.separator:I;C="length"in _?Vt(_.length):C,T="omission"in _?wi(_.omission):T}g=oe(g);var B=g.length;if(ys(g)){var V=ji(g);B=V.length}if(C>=B)return g;var K=C-xs(T);if(K<1)return T;var tt=V?cn(V,0,K).join(""):g.slice(0,K);if(I===e)return tt+T;if(V&&(K+=tt.length-K),Eu(I)){if(g.slice(K).search(I)){var mt,vt=tt;for(I.global||(I=Wc(I.source,oe(og.exec(I))+"g")),I.lastIndex=0;mt=I.exec(vt);)var _t=mt.index;tt=tt.slice(0,_t===e?K:_t)}}else if(g.indexOf(wi(I),K)!=K){var bt=tt.lastIndexOf(I);bt>-1&&(tt=tt.slice(0,bt))}return tt+T}function lT(g){return g=oe(g),g&&xy.test(g)?g.replace(ng,N2):g}var cT=As(function(g,_,C){return g+(C?" ":"")+_.toUpperCase()}),Iu=Op("toUpperCase");function I0(g,_,C){return g=oe(g),_=C?e:_,_===e?D2(g)?H2(g):w2(g):g.match(_)||[]}var M0=Yt(function(g,_){try{return Si(g,e,_)}catch(C){return Tu(C)?C:new Ut(C)}}),uT=Fr(function(g,_){return Fi(_,function(C){C=gr(C),Rr(g,C,Cu(g[C],g))}),g});function fT(g){var _=g==null?0:g.length,C=Dt();return g=_?ye(g,function(T){if(typeof T[1]!="function")throw new Li(m);return[C(T[0]),T[1]]}):[],Yt(function(T){for(var I=-1;++I<_;){var B=g[I];if(Si(B[0],this,T))return Si(B[1],this,T)}})}function dT(g){return Nx(Bi(g,l))}function Mu(g){return function(){return g}}function gT(g,_){return g==null||g!==g?_:g}var pT=Dp(),mT=Dp(!0);function xi(g){return g}function Ou(g){return lp(typeof g=="function"?g:Bi(g,l))}function vT(g){return up(Bi(g,l))}function _T(g,_){return fp(g,Bi(_,l))}var yT=Yt(function(g,_){return function(C){return Pa(C,g,_)}}),xT=Yt(function(g,_){return function(C){return Pa(g,C,_)}});function Ru(g,_,C){var T=je(_),I=Wo(_,T);C==null&&!(Te(_)&&(I.length||!T.length))&&(C=_,_=g,g=this,I=Wo(_,je(_)));var B=!(Te(C)&&"chain"in C)||!!C.chain,V=kr(g);return Fi(I,function(K){var tt=_[K];g[K]=tt,V&&(g.prototype[K]=function(){var mt=this.__chain__;if(B||mt){var vt=g(this.__wrapped__),_t=vt.__actions__=vi(this.__actions__);return _t.push({func:tt,args:arguments,thisArg:g}),vt.__chain__=mt,vt}return tt.apply(g,nn([this.value()],arguments))})}),g}function bT(){return Je._===this&&(Je._=Y2),this}function Du(){}function ST(g){return g=Vt(g),Yt(function(_){return dp(_,g)})}var CT=cu(ye),wT=cu(Fg),TT=cu(Lc);function O0(g){return vu(g)?kc(gr(g)):eb(g)}function ET(g){return function(_){return g==null?e:kn(g,_)}}var AT=Lp(),PT=Lp(!0);function Fu(){return[]}function Lu(){return!1}function IT(){return{}}function MT(){return""}function OT(){return!0}function RT(g,_){if(g=Vt(g),g<1||g>ct)return[];var C=L,T=ni(g,L);_=Dt(_),g-=L;for(var I=Uc(T,_);++C<g;)_(C);return I}function DT(g){return Wt(g)?ye(g,gr):Ti(g)?[g]:vi(Zp(oe(g)))}function FT(g){var _=++z2;return oe(g)+_}var LT=$o(function(g,_){return g+_},0),kT=uu("ceil"),BT=$o(function(g,_){return g/_},1),NT=uu("floor");function UT(g){return g&&g.length?Ho(g,xi,qc):e}function GT(g,_){return g&&g.length?Ho(g,Dt(_,2),qc):e}function HT(g){return Bg(g,xi)}function WT(g,_){return Bg(g,Dt(_,2))}function XT(g){return g&&g.length?Ho(g,xi,tu):e}function VT(g,_){return g&&g.length?Ho(g,Dt(_,2),tu):e}var zT=$o(function(g,_){return g*_},1),jT=uu("round"),YT=$o(function(g,_){return g-_},0);function $T(g){return g&&g.length?Nc(g,xi):0}function KT(g,_){return g&&g.length?Nc(g,Dt(_,2)):0}return D.after=vC,D.ary=h0,D.assign=nw,D.assignIn=S0,D.assignInWith=oh,D.assignWith=sw,D.at=aw,D.before=l0,D.bind=Cu,D.bindAll=uT,D.bindKey=c0,D.castArray=IC,D.chain=s0,D.chunk=Nb,D.compact=Ub,D.concat=Gb,D.cond=fT,D.conforms=dT,D.constant=Mu,D.countBy=$S,D.create=ow,D.curry=u0,D.curryRight=f0,D.debounce=d0,D.defaults=hw,D.defaultsDeep=lw,D.defer=_C,D.delay=yC,D.difference=Hb,D.differenceBy=Wb,D.differenceWith=Xb,D.drop=Vb,D.dropRight=zb,D.dropRightWhile=jb,D.dropWhile=Yb,D.fill=$b,D.filter=qS,D.flatMap=QS,D.flatMapDeep=tC,D.flatMapDepth=eC,D.flatten=e0,D.flattenDeep=Kb,D.flattenDepth=qb,D.flip=xC,D.flow=pT,D.flowRight=mT,D.fromPairs=Zb,D.functions=mw,D.functionsIn=vw,D.groupBy=iC,D.initial=Qb,D.intersection=tS,D.intersectionBy=eS,D.intersectionWith=iS,D.invert=yw,D.invertBy=xw,D.invokeMap=nC,D.iteratee=Ou,D.keyBy=sC,D.keys=je,D.keysIn=yi,D.map=eh,D.mapKeys=Sw,D.mapValues=Cw,D.matches=vT,D.matchesProperty=_T,D.memoize=rh,D.merge=ww,D.mergeWith=C0,D.method=yT,D.methodOf=xT,D.mixin=Ru,D.negate=nh,D.nthArg=ST,D.omit=Tw,D.omitBy=Ew,D.once=bC,D.orderBy=aC,D.over=CT,D.overArgs=SC,D.overEvery=wT,D.overSome=TT,D.partial=wu,D.partialRight=g0,D.partition=oC,D.pick=Aw,D.pickBy=w0,D.property=O0,D.propertyOf=ET,D.pull=aS,D.pullAll=r0,D.pullAllBy=oS,D.pullAllWith=hS,D.pullAt=lS,D.range=AT,D.rangeRight=PT,D.rearg=CC,D.reject=cC,D.remove=cS,D.rest=wC,D.reverse=bu,D.sampleSize=fC,D.set=Iw,D.setWith=Mw,D.shuffle=dC,D.slice=uS,D.sortBy=mC,D.sortedUniq=_S,D.sortedUniqBy=yS,D.split=Qw,D.spread=TC,D.tail=xS,D.take=bS,D.takeRight=SS,D.takeRightWhile=CS,D.takeWhile=wS,D.tap=US,D.throttle=EC,D.thru=th,D.toArray=y0,D.toPairs=T0,D.toPairsIn=E0,D.toPath=DT,D.toPlainObject=b0,D.transform=Ow,D.unary=AC,D.union=TS,D.unionBy=ES,D.unionWith=AS,D.uniq=PS,D.uniqBy=IS,D.uniqWith=MS,D.unset=Rw,D.unzip=Su,D.unzipWith=n0,D.update=Dw,D.updateWith=Fw,D.values=Ms,D.valuesIn=Lw,D.without=OS,D.words=I0,D.wrap=PC,D.xor=RS,D.xorBy=DS,D.xorWith=FS,D.zip=LS,D.zipObject=kS,D.zipObjectDeep=BS,D.zipWith=NS,D.entries=T0,D.entriesIn=E0,D.extend=S0,D.extendWith=oh,Ru(D,D),D.add=LT,D.attempt=M0,D.camelCase=Uw,D.capitalize=A0,D.ceil=kT,D.clamp=kw,D.clone=MC,D.cloneDeep=RC,D.cloneDeepWith=DC,D.cloneWith=OC,D.conformsTo=FC,D.deburr=P0,D.defaultTo=gT,D.divide=BT,D.endsWith=Gw,D.eq=$i,D.escape=Hw,D.escapeRegExp=Ww,D.every=KS,D.find=ZS,D.findIndex=Qp,D.findKey=cw,D.findLast=JS,D.findLastIndex=t0,D.findLastKey=uw,D.floor=NT,D.forEach=a0,D.forEachRight=o0,D.forIn=fw,D.forInRight=dw,D.forOwn=gw,D.forOwnRight=pw,D.get=Au,D.gt=LC,D.gte=kC,D.has=_w,D.hasIn=Pu,D.head=i0,D.identity=xi,D.includes=rC,D.indexOf=Jb,D.inRange=Bw,D.invoke=bw,D.isArguments=Un,D.isArray=Wt,D.isArrayBuffer=BC,D.isArrayLike=_i,D.isArrayLikeObject=De,D.isBoolean=NC,D.isBuffer=un,D.isDate=UC,D.isElement=GC,D.isEmpty=HC,D.isEqual=WC,D.isEqualWith=XC,D.isError=Tu,D.isFinite=VC,D.isFunction=kr,D.isInteger=p0,D.isLength=sh,D.isMap=m0,D.isMatch=zC,D.isMatchWith=jC,D.isNaN=YC,D.isNative=$C,D.isNil=qC,D.isNull=KC,D.isNumber=v0,D.isObject=Te,D.isObjectLike=Oe,D.isPlainObject=Fa,D.isRegExp=Eu,D.isSafeInteger=ZC,D.isSet=_0,D.isString=ah,D.isSymbol=Ti,D.isTypedArray=Is,D.isUndefined=JC,D.isWeakMap=QC,D.isWeakSet=tw,D.join=rS,D.kebabCase=Xw,D.last=Ui,D.lastIndexOf=nS,D.lowerCase=Vw,D.lowerFirst=zw,D.lt=ew,D.lte=iw,D.max=UT,D.maxBy=GT,D.mean=HT,D.meanBy=WT,D.min=XT,D.minBy=VT,D.stubArray=Fu,D.stubFalse=Lu,D.stubObject=IT,D.stubString=MT,D.stubTrue=OT,D.multiply=zT,D.nth=sS,D.noConflict=bT,D.noop=Du,D.now=ih,D.pad=jw,D.padEnd=Yw,D.padStart=$w,D.parseInt=Kw,D.random=Nw,D.reduce=hC,D.reduceRight=lC,D.repeat=qw,D.replace=Zw,D.result=Pw,D.round=jT,D.runInContext=J,D.sample=uC,D.size=gC,D.snakeCase=Jw,D.some=pC,D.sortedIndex=fS,D.sortedIndexBy=dS,D.sortedIndexOf=gS,D.sortedLastIndex=pS,D.sortedLastIndexBy=mS,D.sortedLastIndexOf=vS,D.startCase=tT,D.startsWith=eT,D.subtract=YT,D.sum=$T,D.sumBy=KT,D.template=iT,D.times=RT,D.toFinite=Br,D.toInteger=Vt,D.toLength=x0,D.toLower=rT,D.toNumber=Gi,D.toSafeInteger=rw,D.toString=oe,D.toUpper=nT,D.trim=sT,D.trimEnd=aT,D.trimStart=oT,D.truncate=hT,D.unescape=lT,D.uniqueId=FT,D.upperCase=cT,D.upperFirst=Iu,D.each=a0,D.eachRight=o0,D.first=i0,Ru(D,function(){var g={};return fr(D,function(_,C){he.call(D.prototype,C)||(g[C]=_)}),g}(),{chain:!1}),D.VERSION=r,Fi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(g){D[g].placeholder=D}),Fi(["drop","take"],function(g,_){Jt.prototype[g]=function(C){C=C===e?1:Ue(Vt(C),0);var T=this.__filtered__&&!_?new Jt(this):this.clone();return T.__filtered__?T.__takeCount__=ni(C,T.__takeCount__):T.__views__.push({size:ni(C,L),type:g+(T.__dir__<0?"Right":"")}),T},Jt.prototype[g+"Right"]=function(C){return this.reverse()[g](C).reverse()}}),Fi(["filter","map","takeWhile"],function(g,_){var C=_+1,T=C==W||C==ot;Jt.prototype[g]=function(I){var B=this.clone();return B.__iteratees__.push({iteratee:Dt(I,3),type:C}),B.__filtered__=B.__filtered__||T,B}}),Fi(["head","last"],function(g,_){var C="take"+(_?"Right":"");Jt.prototype[g]=function(){return this[C](1).value()[0]}}),Fi(["initial","tail"],function(g,_){var C="drop"+(_?"":"Right");Jt.prototype[g]=function(){return this.__filtered__?new Jt(this):this[C](1)}}),Jt.prototype.compact=function(){return this.filter(xi)},Jt.prototype.find=function(g){return this.filter(g).head()},Jt.prototype.findLast=function(g){return this.reverse().find(g)},Jt.prototype.invokeMap=Yt(function(g,_){return typeof g=="function"?new Jt(this):this.map(function(C){return Pa(C,g,_)})}),Jt.prototype.reject=function(g){return this.filter(nh(Dt(g)))},Jt.prototype.slice=function(g,_){g=Vt(g);var C=this;return C.__filtered__&&(g>0||_<0)?new Jt(C):(g<0?C=C.takeRight(-g):g&&(C=C.drop(g)),_!==e&&(_=Vt(_),C=_<0?C.dropRight(-_):C.take(_-g)),C)},Jt.prototype.takeRightWhile=function(g){return this.reverse().takeWhile(g).reverse()},Jt.prototype.toArray=function(){return this.take(L)},fr(Jt.prototype,function(g,_){var C=/^(?:filter|find|map|reject)|While$/.test(_),T=/^(?:head|last)$/.test(_),I=D[T?"take"+(_=="last"?"Right":""):_],B=T||/^find/.test(_);I&&(D.prototype[_]=function(){var V=this.__wrapped__,K=T?[1]:arguments,tt=V instanceof Jt,mt=K[0],vt=tt||Wt(V),_t=function(Zt){var re=I.apply(D,nn([Zt],K));return T&&bt?re[0]:re};vt&&C&&typeof mt=="function"&&mt.length!=1&&(tt=vt=!1);var bt=this.__chain__,At=!!this.__actions__.length,Lt=B&&!bt,jt=tt&&!At;if(!B&&vt){V=jt?V:new Jt(this);var kt=g.apply(V,K);return kt.__actions__.push({func:th,args:[_t],thisArg:e}),new ki(kt,bt)}return Lt&&jt?g.apply(this,K):(kt=this.thru(_t),Lt?T?kt.value()[0]:kt.value():kt)})}),Fi(["pop","push","shift","sort","splice","unshift"],function(g){var _=Eo[g],C=/^(?:push|sort|unshift)$/.test(g)?"tap":"thru",T=/^(?:pop|shift)$/.test(g);D.prototype[g]=function(){var I=arguments;if(T&&!this.__chain__){var B=this.value();return _.apply(Wt(B)?B:[],I)}return this[C](function(V){return _.apply(Wt(V)?V:[],I)})}}),fr(Jt.prototype,function(g,_){var C=D[_];if(C){var T=C.name+"";he.call(ws,T)||(ws[T]=[]),ws[T].push({name:_,func:C})}}),ws[Yo(e,y).name]=[{name:"wrapper",func:e}],Jt.prototype.clone=lx,Jt.prototype.reverse=cx,Jt.prototype.value=ux,D.prototype.at=GS,D.prototype.chain=HS,D.prototype.commit=WS,D.prototype.next=XS,D.prototype.plant=zS,D.prototype.reverse=jS,D.prototype.toJSON=D.prototype.valueOf=D.prototype.value=YS,D.prototype.first=D.prototype.head,ba&&(D.prototype[ba]=VS),D},bs=W2();On?((On.exports=bs)._=bs,Oc._=bs):Je._=bs}).call(xr)})(Kh,Kh.exports);var Ht=Kh.exports;class QT{constructor(t){ht(this,"container");ht(this,"draggables");ht(this,"selected");ht(this,"x_pos");ht(this,"y_pos");ht(this,"x_elem");ht(this,"y_elem");this.container=t,this.draggables=Array.from(this.container.children),this.selected=null,this.x_pos=0,this.y_pos=0,this.x_elem=0,this.y_elem=0,this._drag_init=this._drag_init.bind(this),this._move_elem=this._move_elem.bind(this),this._destroy=this._destroy.bind(this),this.container.onmousemove=this._move_elem,this.container.onmouseup=this._destroy;for(const e of this.draggables)e.onmousedown=()=>(this._drag_init(e),!1)}_drag_init(t){this.selected=t,this.x_elem=this.x_pos-this.selected.offsetLeft,this.y_elem=this.y_pos-this.selected.offsetTop}_move_elem(t){this.x_pos=t.clientX,this.y_pos=t.clientY,this.selected!==null&&(this.selected.style.left=this.x_pos-this.x_elem+"px",this.selected.style.top=this.y_pos-this.y_elem+"px")}_destroy(){this.selected=null}}const qe=800,Ze=800,me=50,be=50,ti={HTML:"html",SVG:"svg",CANVAS:"canvas",CANVAS_FABRIC:"canvasFabric",PIXIJS:"pixijs",CANVAS_KONVA:"canvasKonva",APP_CANVAS_1:"appCanvas1"};class ha{constructor({viewWidth:t,viewHeight:e}){ht(this,"positions");ht(this,"viewWidth");ht(this,"viewHeight");ht(this,"componentWidth");ht(this,"componentHeight");this.positions=[],this.viewWidth=t,this.viewHeight=e,this.componentWidth=be,this.componentHeight=me}addPosition(t,e){const r=Math.random()<.5?-1:1,n=Math.random()<.5?-1:1;this.positions.push({directionX:r,directionY:n,x:t,y:e})}calculateNextPosition(t){const e=this.positions[t];return e.x>this.viewWidth-this.componentHeight?e.directionX=-1:e.x<1&&(e.directionX=1),e.y>this.viewHeight-this.componentHeight?e.directionY=-1:e.y<1&&(e.directionY=1),e.x=e.x+1*e.directionX,e.y=e.y+1*e.directionY,[e.x,e.y]}}class D0{constructor(t,e){ht(this,"height");ht(this,"width");ht(this,"containerEl");ht(this,"components");ht(this,"wrappers");ht(this,"movedComponents");ht(this,"positionManager");this.components=[],this.wrappers=[],this.height=t,this.width=e,this.movedComponents=[],this.positionManager=new ha({viewWidth:this.width,viewHeight:this.height});const r=document.createElement("div");r.style.border="1px solid red",r.style.height=t+"px",r.style.width=e+"px",r.style.position="relative",this.containerEl=r}addComponent(t){this.components.push(t)}getComponentWrapper(){const t=document.createElement("div");return this.wrappers.push(t),t.style.border="1px solid green",t.style.height=me+"px",t.style.width=be+"px",t.style.position="absolute",t.style.top=Ht.random(this.height-me)+"px",t.style.left=Ht.random(this.width-be)+"px",t}moveTest(t=0){this.movedComponents=this.wrappers,t!==0&&(this.movedComponents=this.wrappers.slice(0,t)),this.movedComponents.forEach(e=>{const r=e.style.left,n=e.style.top;this.positionManager.addPosition(parseInt(r,10),parseInt(n,10))}),this.moveElements()}moveElements(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t),n=this.movedComponents[t];n.style.left=e+"px",n.style.top=r+"px"}requestAnimationFrame(()=>this.moveElements())}moveTest2(t=0){this.movedComponents=this.wrappers,t!==0&&(this.movedComponents=this.wrappers.slice(0,t)),this.movedComponents.forEach(e=>{const r=e.style.left,n=e.style.top;this.positionManager.addPosition(parseInt(r,10),parseInt(n,10)),e.style.left="0",e.style.top="0",e.style.transform=`translate(${r}, ${n})`}),this.moveElements2()}moveElements2(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t),n=this.movedComponents[t];n.style.transform="translate("+e+"px, "+r+"px)"}requestAnimationFrame(()=>this.moveElements2())}start(){this.containerEl.innerHTML="";for(let t=0;t<this.components.length;t++){const e=this.components[t].getUIElement(),r=this.getComponentWrapper();r.appendChild(e),this.containerEl.appendChild(r)}return new QT(this.containerEl),this.updateComponentsCount(),this.containerEl}updateComponentsCount(){const t=document.getElementById("componentCount");t.innerText=this.components.length.toString()}zoomTransform(t){this.containerEl.style.transform=`scale(${t})`}}let zr=class{constructor(t){ht(this,"componentUI");this.componentUI=t}getUIElement(){return this.componentUI.getElement()}draw(t){return this.componentUI.draw(t)}addSource(t){t.addListener(this)}onDataChange(t){this.draw(t)}};const F0=["Black","Red","Blue","Green","Yellow","Purple","Cyan","Magenta","Lime","Navy","Teal","Silver","Gray","Maroon","Olive","Fuchsia","Aqua","Orange","Pink","Brown","Violet","Gold","Crimson","Indigo","Khaki","Coral","Salmon","Turquoise","Chocolate","Plum","Orchid","PeachPuff","LightBlue","LightGreen","LightPink","MediumPurple","MediumBlue","MediumSeaGreen","MediumTurquoise","MediumVioletRed","DarkRed","DarkOrange","DarkCyan","DarkGreen","DarkBlue"],Xe=()=>F0[Ht.random(F0.length-1)];class t3{constructor(t=1){ht(this,"containerEl");this.containerEl=document.createElement("div"),this.containerEl.style.backgroundColor="orange";for(let r=1;r<t;r++){const n=document.createElement("div");n.style.width=Ht.random(5,95)+"%",n.style.height="1px",n.style.border="1px solid "+Xe(),this.containerEl.appendChild(n)}const e=document.createTextNode("[...]");this.containerEl.appendChild(e)}getElement(){return this.containerEl}draw(t){const e=this.containerEl.childNodes[this.containerEl.childNodes.length-1];e.nodeType===Node.TEXT_NODE&&(e.textContent=t.toString())}}const ai=i=>Ht.random(i).toString(),Os="http://www.w3.org/2000/svg";class i_{constructor(t,e="svg"){ht(this,"containerEl");ht(this,"textEl");const r=document.createElementNS(Os,e);r.setAttribute("width",be.toString()),r.setAttribute("height",me.toString()),e==="g"&&r.setAttribute("transform",`translate(${ai(Ze-be)}, ${ai(qe-me)})`),this.containerEl=r;const n=this.getRandomSVGElements(t);this.textEl=n[0],n.reverse().forEach(o=>{r.appendChild(o)})}getElement(){return this.containerEl}getRandomSVGElements(t){const e=[()=>{const n=document.createElementNS(Os,"text");return n.setAttribute("x",ai(be-10)),n.setAttribute("y",ai(me-10)),n.textContent="[...]",n},()=>{const n=document.createElementNS(Os,"rect");return n.setAttribute("x",ai(30)),n.setAttribute("y",ai(30)),n.setAttribute("width",ai(40)),n.setAttribute("height",ai(40)),n.setAttribute("fill",Xe()),n},()=>{const n=document.createElementNS(Os,"path");return n.setAttribute("d",`M${Ht.random(10)} 0 L${Ht.random(50)} ${Ht.random(50)} L${Ht.random(49)} ${Ht.random(50)} Z`),n.setAttribute("fill",Xe()),n},()=>{const n=document.createElementNS(Os,"line");return n.setAttribute("x1",ai(be)),n.setAttribute("y1",ai(me)),n.setAttribute("x2",ai(be)),n.setAttribute("y2",ai(me)),n.setAttribute("stroke-width",ai(4)),n.setAttribute("stroke",Xe()),n},()=>{const n=document.createElementNS(Os,"circle");return n.setAttribute("cx",ai(be-10)),n.setAttribute("cy",ai(me-10)),n.setAttribute("r",ai(me/2)),n.setAttribute("fill",Xe()),n}],r=[];for(let n=0;n<t;n++)n===0?r.push(e[0]()):r.push(e[Ht.random(e.length-1)]());return r}draw(t){this.textEl.textContent=t.toString()}}class e3{constructor(){ht(this,"context");ht(this,"containerEl");this.containerEl=document.createElement("canvas"),this.context=this.containerEl.getContext("2d"),this.containerEl.width=be,this.containerEl.height=me}draw(t){this.context.clearRect(0,0,this.containerEl.width,this.containerEl.height),this.context.fillStyle="yellow",this.context.fillRect(0,0,this.containerEl.width,this.containerEl.height),this.context.fillStyle="black",this.context.font="18px Arial",this.context.fillText(t.toString(),3,20)}getElement(){return this.containerEl}}var Wi={};const i3=new Proxy({},{get(i,t){throw new Error(`Module "" has been externalized for browser compatibility. Cannot access ".${t}" in client code.  See http://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)}}),r3=Object.freeze(Object.defineProperty({__proto__:null,default:i3},Symbol.toStringTag,{value:"Module"})),Uh=JT(r3);(function(i){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var t=t||{version:"5.3.0"};if(i.fabric=t,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?t.document=document:t.document=document.implementation.createHTMLDocument(""),t.window=window;else{var e=Uh,r=new e.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;t.document=r.document,t.jsdomImplForWrapper=Uh.implForWrapper,t.nodeCanvas=Uh.Canvas,t.window=r,DOMParser=t.window.DOMParser}t.isTouchSupported="ontouchstart"in t.window||"ontouchstart"in t.document||t.window&&t.window.navigator&&t.window.navigator.maxTouchPoints>0,t.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",t.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],t.DPI=96,t.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",t.commaWsp="(?:\\s+,?\\s*|,\\s*)",t.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,t.reNonWord=/[ \n\.,;!\?\-]/,t.fontPaths={},t.iMatrix=[1,0,0,1,0,0],t.svgNS="http://www.w3.org/2000/svg",t.perfLimitSizeTotal=2097152,t.maxCacheSideLimit=4096,t.minCacheSideLimit=256,t.charWidthsCache={},t.textureSize=2048,t.disableStyleCopyPaste=!1,t.enableGLFiltering=!0,t.devicePixelRatio=t.window.devicePixelRatio||t.window.webkitDevicePixelRatio||t.window.mozDevicePixelRatio||1,t.browserShadowBlurConstant=1,t.arcToSegmentsCache={},t.boundsOfCurveCache={},t.cachesBoundsOfCurve=!0,t.forceGLPutImageData=!1,t.initFilterBackend=function(){if(t.enableGLFiltering&&t.isWebglSupported&&t.isWebglSupported(t.textureSize))return console.log("max texture size: "+t.maxTextureSize),new t.WebglFilterBackend({tileSize:t.textureSize});if(t.Canvas2dFilterBackend)return new t.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=t),function(){function a(c,f){if(this.__eventListeners[c]){var v=this.__eventListeners[c];f?v[v.indexOf(f)]=!1:t.util.array.fill(v,!1)}}function s(c,f){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var v in c)this.on(v,c[v]);else this.__eventListeners[c]||(this.__eventListeners[c]=[]),this.__eventListeners[c].push(f);return this}function h(c,f){var v=function(){f.apply(this,arguments),this.off(c,v)}.bind(this);this.on(c,v)}function d(c,f){if(arguments.length===1)for(var v in c)h.call(this,v,c[v]);else h.call(this,c,f);return this}function l(c,f){if(!this.__eventListeners)return this;if(arguments.length===0)for(c in this.__eventListeners)a.call(this,c);else if(arguments.length===1&&typeof arguments[0]=="object")for(var v in c)a.call(this,v,c[v]);else a.call(this,c,f);return this}function u(c,f){if(!this.__eventListeners)return this;var v=this.__eventListeners[c];if(!v)return this;for(var p=0,y=v.length;p<y;p++)v[p]&&v[p].call(this,f||{});return this.__eventListeners[c]=v.filter(function(b){return b!==!1}),this}t.Observable={fire:u,on:s,once:d,off:l}}(),t.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,s=arguments.length;a<s;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,s,h){var d=this._objects;return h?d[s]=a:d.splice(s,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a=this._objects,s,h=!1,d=0,l=arguments.length;d<l;d++)s=a.indexOf(arguments[d]),s!==-1&&(h=!0,a.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&h&&this.requestRenderAll(),this},forEachObject:function(a,s){for(var h=this.getObjects(),d=0,l=h.length;d<l;d++)a.call(s,h[d],d,h);return this},getObjects:function(a){return typeof a>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(a,s){return this._objects.indexOf(a)>-1?!0:s?this._objects.some(function(h){return typeof h.contains=="function"&&h.contains(a,!0)}):!1},complexity:function(){return this._objects.reduce(function(a,s){return a+=s.complexity?s.complexity():0,a},0)}},t.CommonMethods={_setOptions:function(a){for(var s in a)this.set(s,a[s])},_initGradient:function(a,s){a&&a.colorStops&&!(a instanceof t.Gradient)&&this.set(s,new t.Gradient(a))},_initPattern:function(a,s,h){a&&a.source&&!(a instanceof t.Pattern)?this.set(s,new t.Pattern(a,h)):h&&h()},_setObject:function(a){for(var s in a)this._set(s,a[s])},set:function(a,s){return typeof a=="object"?this._setObject(a):this._set(a,s),this},_set:function(a,s){this[a]=s},toggle:function(a){var s=this.get(a);return typeof s=="boolean"&&this.set(a,!s),this},get:function(a){return this[a]}},function(a){var s=Math.sqrt,h=Math.atan2,d=Math.pow,l=Math.PI/180,u=Math.PI/2;t.util={cos:function(c){if(c===0)return 1;c<0&&(c=-c);var f=c/u;switch(f){case 1:case 3:return 0;case 2:return-1}return Math.cos(c)},sin:function(c){if(c===0)return 0;var f=c/u,v=1;switch(c<0&&(v=-1),f){case 1:return v;case 2:return 0;case 3:return-v}return Math.sin(c)},removeFromArray:function(c,f){var v=c.indexOf(f);return v!==-1&&c.splice(v,1),c},getRandomInt:function(c,f){return Math.floor(Math.random()*(f-c+1))+c},degreesToRadians:function(c){return c*l},radiansToDegrees:function(c){return c/l},rotatePoint:function(c,f,v){var p=new t.Point(c.x-f.x,c.y-f.y),y=t.util.rotateVector(p,v);return new t.Point(y.x,y.y).addEquals(f)},rotateVector:function(c,f){var v=t.util.sin(f),p=t.util.cos(f),y=c.x*p-c.y*v,b=c.x*v+c.y*p;return{x:y,y:b}},createVector:function(c,f){return new t.Point(f.x-c.x,f.y-c.y)},calcAngleBetweenVectors:function(c,f){return Math.acos((c.x*f.x+c.y*f.y)/(Math.hypot(c.x,c.y)*Math.hypot(f.x,f.y)))},getHatVector:function(c){return new t.Point(c.x,c.y).multiply(1/Math.hypot(c.x,c.y))},getBisector:function(c,f,v){var p=t.util.createVector(c,f),y=t.util.createVector(c,v),b=t.util.calcAngleBetweenVectors(p,y),x=t.util.calcAngleBetweenVectors(t.util.rotateVector(p,b),y),S=b*(x===0?1:-1)/2;return{vector:t.util.getHatVector(t.util.rotateVector(p,S)),angle:b}},projectStrokeOnPoints:function(c,f,v){var p=[],y=f.strokeWidth/2,b=f.strokeUniform?new t.Point(1/f.scaleX,1/f.scaleY):new t.Point(1,1),x=function(S){var w=y/Math.hypot(S.x,S.y);return new t.Point(S.x*w*b.x,S.y*w*b.y)};return c.length<=1||c.forEach(function(S,w){var E=new t.Point(S.x,S.y),P,A;w===0?(A=c[w+1],P=v?x(t.util.createVector(A,E)).addEquals(E):c[c.length-1]):w===c.length-1?(P=c[w-1],A=v?x(t.util.createVector(P,E)).addEquals(E):c[0]):(P=c[w-1],A=c[w+1]);var N=t.util.getBisector(E,P,A),k=N.vector,U=N.angle,j,X;if(f.strokeLineJoin==="miter"&&(j=-y/Math.sin(U/2),X=new t.Point(k.x*j*b.x,k.y*j*b.y),Math.hypot(X.x,X.y)/y<=f.strokeMiterLimit)){p.push(E.add(X)),p.push(E.subtract(X));return}j=-y*Math.SQRT2,X=new t.Point(k.x*j*b.x,k.y*j*b.y),p.push(E.add(X)),p.push(E.subtract(X))}),p},transformPoint:function(c,f,v){return v?new t.Point(f[0]*c.x+f[2]*c.y,f[1]*c.x+f[3]*c.y):new t.Point(f[0]*c.x+f[2]*c.y+f[4],f[1]*c.x+f[3]*c.y+f[5])},makeBoundingBoxFromPoints:function(c,f){if(f)for(var v=0;v<c.length;v++)c[v]=t.util.transformPoint(c[v],f);var p=[c[0].x,c[1].x,c[2].x,c[3].x],y=t.util.array.min(p),b=t.util.array.max(p),x=b-y,S=[c[0].y,c[1].y,c[2].y,c[3].y],w=t.util.array.min(S),E=t.util.array.max(S),P=E-w;return{left:y,top:w,width:x,height:P}},invertTransform:function(c){var f=1/(c[0]*c[3]-c[1]*c[2]),v=[f*c[3],-f*c[1],-f*c[2],f*c[0]],p=t.util.transformPoint({x:c[4],y:c[5]},v,!0);return v[4]=-p.x,v[5]=-p.y,v},toFixed:function(c,f){return parseFloat(Number(c).toFixed(f))},parseUnit:function(c,f){var v=/\D{0,2}$/.exec(c),p=parseFloat(c);switch(f||(f=t.Text.DEFAULT_SVG_FONT_SIZE),v[0]){case"mm":return p*t.DPI/25.4;case"cm":return p*t.DPI/2.54;case"in":return p*t.DPI;case"pt":return p*t.DPI/72;case"pc":return p*t.DPI/72*12;case"em":return p*f;default:return p}},falseFunction:function(){return!1},getKlass:function(c,f){return c=t.util.string.camelize(c.charAt(0).toUpperCase()+c.slice(1)),t.util.resolveNamespace(f)[c]},getSvgAttributes:function(c){var f=["instantiated_by_use","style","id","class"];switch(c){case"linearGradient":f=f.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":f=f.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":f=f.concat(["offset","stop-color","stop-opacity"]);break}return f},resolveNamespace:function(c){if(!c)return t;var f=c.split("."),v=f.length,p,y=a||t.window;for(p=0;p<v;++p)y=y[f[p]];return y},loadImage:function(c,f,v,p){if(!c){f&&f.call(v,c);return}var y=t.util.createImage(),b=function(){f&&f.call(v,y,!1),y=y.onload=y.onerror=null};y.onload=b,y.onerror=function(){t.log("Error loading "+y.src),f&&f.call(v,null,!0),y=y.onload=y.onerror=null},c.indexOf("data")!==0&&p!==void 0&&p!==null&&(y.crossOrigin=p),c.substring(0,14)==="data:image/svg"&&(y.onload=null,t.util.loadImageInDom(y,b)),y.src=c},loadImageInDom:function(c,f){var v=t.document.createElement("div");v.style.width=v.style.height="1px",v.style.left=v.style.top="-100%",v.style.position="absolute",v.appendChild(c),t.document.querySelector("body").appendChild(v),c.onload=function(){f(),v.parentNode.removeChild(v),v=null}},enlivenObjects:function(c,f,v,p){c=c||[];var y=[],b=0,x=c.length;function S(){++b===x&&f&&f(y.filter(function(w){return w}))}if(!x){f&&f(y);return}c.forEach(function(w,E){if(!w||!w.type){S();return}var P=t.util.getKlass(w.type,v);P.fromObject(w,function(A,N){N||(y[E]=A),p&&p(w,A,N),S()})})},enlivenObjectEnlivables:function(c,f,v){var p=t.Object.ENLIVEN_PROPS.filter(function(y){return!!c[y]});t.util.enlivenObjects(p.map(function(y){return c[y]}),function(y){var b={};p.forEach(function(x,S){b[x]=y[S],f&&(f[x]=y[S])}),v&&v(b)})},enlivenPatterns:function(c,f){c=c||[];function v(){++y===b&&f&&f(p)}var p=[],y=0,b=c.length;if(!b){f&&f(p);return}c.forEach(function(x,S){x&&x.source?new t.Pattern(x,function(w){p[S]=w,v()}):(p[S]=x,v())})},groupSVGElements:function(c,f,v){var p;return c&&c.length===1?(typeof v<"u"&&(c[0].sourcePath=v),c[0]):(f&&(f.width&&f.height?f.centerPoint={x:f.width/2,y:f.height/2}:(delete f.width,delete f.height)),p=new t.Group(c,f),typeof v<"u"&&(p.sourcePath=v),p)},populateWithProperties:function(c,f,v){if(v&&Array.isArray(v))for(var p=0,y=v.length;p<y;p++)v[p]in c&&(f[v[p]]=c[v[p]])},createCanvasElement:function(){return t.document.createElement("canvas")},copyCanvasElement:function(c){var f=t.util.createCanvasElement();return f.width=c.width,f.height=c.height,f.getContext("2d").drawImage(c,0,0),f},toDataURL:function(c,f,v){return c.toDataURL("image/"+f,v)},createImage:function(){return t.document.createElement("img")},multiplyTransformMatrices:function(c,f,v){return[c[0]*f[0]+c[2]*f[1],c[1]*f[0]+c[3]*f[1],c[0]*f[2]+c[2]*f[3],c[1]*f[2]+c[3]*f[3],v?0:c[0]*f[4]+c[2]*f[5]+c[4],v?0:c[1]*f[4]+c[3]*f[5]+c[5]]},qrDecompose:function(c){var f=h(c[1],c[0]),v=d(c[0],2)+d(c[1],2),p=s(v),y=(c[0]*c[3]-c[2]*c[1])/p,b=h(c[0]*c[2]+c[1]*c[3],v);return{angle:f/l,scaleX:p,scaleY:y,skewX:b/l,skewY:0,translateX:c[4],translateY:c[5]}},calcRotateMatrix:function(c){if(!c.angle)return t.iMatrix.concat();var f=t.util.degreesToRadians(c.angle),v=t.util.cos(f),p=t.util.sin(f);return[v,p,-p,v,0,0]},calcDimensionsMatrix:function(c){var f=typeof c.scaleX>"u"?1:c.scaleX,v=typeof c.scaleY>"u"?1:c.scaleY,p=[c.flipX?-f:f,0,0,c.flipY?-v:v,0,0],y=t.util.multiplyTransformMatrices,b=t.util.degreesToRadians;return c.skewX&&(p=y(p,[1,0,Math.tan(b(c.skewX)),1],!0)),c.skewY&&(p=y(p,[1,Math.tan(b(c.skewY)),0,1],!0)),p},composeMatrix:function(c){var f=[1,0,0,1,c.translateX||0,c.translateY||0],v=t.util.multiplyTransformMatrices;return c.angle&&(f=v(f,t.util.calcRotateMatrix(c))),(c.scaleX!==1||c.scaleY!==1||c.skewX||c.skewY||c.flipX||c.flipY)&&(f=v(f,t.util.calcDimensionsMatrix(c))),f},resetObjectTransform:function(c){c.scaleX=1,c.scaleY=1,c.skewX=0,c.skewY=0,c.flipX=!1,c.flipY=!1,c.rotate(0)},saveObjectTransform:function(c){return{scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,angle:c.angle,left:c.left,flipX:c.flipX,flipY:c.flipY,top:c.top}},isTransparent:function(c,f,v,p){p>0&&(f>p?f-=p:f=0,v>p?v-=p:v=0);var y=!0,b,x,S=c.getImageData(f,v,p*2||1,p*2||1),w=S.data.length;for(b=3;b<w&&(x=S.data[b],y=x<=0,y!==!1);b+=4);return S=null,y},parsePreserveAspectRatioAttribute:function(c){var f="meet",v="Mid",p="Mid",y=c.split(" "),b;return y&&y.length&&(f=y.pop(),f!=="meet"&&f!=="slice"?(b=f,f="meet"):y.length&&(b=y.pop())),v=b!=="none"?b.slice(1,4):"none",p=b!=="none"?b.slice(5,8):"none",{meetOrSlice:f,alignX:v,alignY:p}},clearFabricFontCache:function(c){c=(c||"").toLowerCase(),c?t.charWidthsCache[c]&&delete t.charWidthsCache[c]:t.charWidthsCache={}},limitDimsByArea:function(c,f){var v=Math.sqrt(f*c),p=Math.floor(f/v);return{x:Math.floor(v),y:p}},capValue:function(c,f,v){return Math.max(c,Math.min(f,v))},findScaleToFit:function(c,f){return Math.min(f.width/c.width,f.height/c.height)},findScaleToCover:function(c,f){return Math.max(f.width/c.width,f.height/c.height)},matrixToSVG:function(c){return"matrix("+c.map(function(f){return t.util.toFixed(f,t.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(c,f){var v=t.util.invertTransform(f),p=t.util.multiplyTransformMatrices(v,c.calcOwnMatrix());t.util.applyTransformToObject(c,p)},addTransformToObject:function(c,f){t.util.applyTransformToObject(c,t.util.multiplyTransformMatrices(f,c.calcOwnMatrix()))},applyTransformToObject:function(c,f){var v=t.util.qrDecompose(f),p=new t.Point(v.translateX,v.translateY);c.flipX=!1,c.flipY=!1,c.set("scaleX",v.scaleX),c.set("scaleY",v.scaleY),c.skewX=v.skewX,c.skewY=v.skewY,c.angle=v.angle,c.setPositionByOrigin(p,"center","center")},sizeAfterTransform:function(c,f,v){var p=c/2,y=f/2,b=[{x:-p,y:-y},{x:p,y:-y},{x:-p,y},{x:p,y}],x=t.util.calcDimensionsMatrix(v),S=t.util.makeBoundingBoxFromPoints(b,x);return{x:S.width,y:S.height}},mergeClipPaths:function(c,f){var v=c,p=f;v.inverted&&!p.inverted&&(v=f,p=c),t.util.applyTransformToObject(p,t.util.multiplyTransformMatrices(t.util.invertTransform(v.calcTransformMatrix()),p.calcTransformMatrix()));var y=v.inverted&&p.inverted;return y&&(v.inverted=p.inverted=!1),new t.Group([v],{clipPath:p,inverted:y})},hasStyleChanged:function(c,f,v){return v=v||!1,c.fill!==f.fill||c.stroke!==f.stroke||c.strokeWidth!==f.strokeWidth||c.fontSize!==f.fontSize||c.fontFamily!==f.fontFamily||c.fontWeight!==f.fontWeight||c.fontStyle!==f.fontStyle||c.textBackgroundColor!==f.textBackgroundColor||c.deltaY!==f.deltaY||v&&(c.overline!==f.overline||c.underline!==f.underline||c.linethrough!==f.linethrough)},stylesToArray:function(v,f){for(var v=t.util.object.clone(v,!0),p=f.split(`
`),y=-1,b={},x=[],S=0;S<p.length;S++){if(!v[S]){y+=p[S].length;continue}for(var w=0;w<p[S].length;w++){y++;var E=v[S][w];if(E&&Object.keys(E).length>0){var P=t.util.hasStyleChanged(b,E,!0);P?x.push({start:y,end:y+1,style:E}):x[x.length-1].end++}b=E||{}}}return x},stylesFromArray:function(c,f){if(!Array.isArray(c))return c;for(var v=f.split(`
`),p=-1,y=0,b={},x=0;x<v.length;x++)for(var S=0;S<v[x].length;S++)p++,c[y]&&c[y].start<=p&&p<c[y].end&&(b[x]=b[x]||{},b[x][S]=Object.assign({},c[y].style),p===c[y].end-1&&y++);return b}}}(i),function(){var a=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},h={m:"l",M:"L"};function d(O,M,L,H,Z,G,F,Y,R,z,$){var st=t.util.cos(O),nt=t.util.sin(O),ft=t.util.cos(M),et=t.util.sin(M),q=L*Z*ft-H*G*et+F,rt=H*Z*ft+L*G*et+Y,ut=z+R*(-L*Z*nt-H*G*st),at=$+R*(-H*Z*nt+L*G*st),dt=q+R*(L*Z*et+H*G*ft),xt=rt+R*(H*Z*et-L*G*ft);return["C",ut,at,dt,xt,q,rt]}function l(O,M,L,H,Z,G,F){var Y=Math.PI,R=F*Y/180,z=t.util.sin(R),$=t.util.cos(R),st=0,nt=0;L=Math.abs(L),H=Math.abs(H);var ft=-$*O*.5-z*M*.5,et=-$*M*.5+z*O*.5,q=L*L,rt=H*H,ut=et*et,at=ft*ft,dt=q*rt-q*ut-rt*at,xt=0;if(dt<0){var Ft=Math.sqrt(1-dt/(q*rt));L*=Ft,H*=Ft}else xt=(Z===G?-1:1)*Math.sqrt(dt/(q*ut+rt*at));var wt=xt*L*et/H,gt=-xt*H*ft/L,Et=$*wt-z*gt+O*.5,Nt=z*wt+$*gt+M*.5,zt=u(1,0,(ft-wt)/L,(et-gt)/H),ge=u((ft-wt)/L,(et-gt)/H,(-ft-wt)/L,(-et-gt)/H);G===0&&ge>0?ge-=2*Y:G===1&&ge<0&&(ge+=2*Y);for(var ie=Math.ceil(Math.abs(ge/Y*2)),Me=[],_e=ge/ie,zi=8/3*Math.sin(_e/4)*Math.sin(_e/4)/Math.sin(_e/2),Ir=zt+_e,mi=0;mi<ie;mi++)Me[mi]=d(zt,Ir,$,z,L,H,Et,Nt,zi,st,nt),st=Me[mi][5],nt=Me[mi][6],zt=Ir,Ir+=_e;return Me}function u(O,M,L,H){var Z=Math.atan2(M,O),G=Math.atan2(H,L);return G>=Z?G-Z:2*Math.PI-(Z-G)}function c(O,M,L,H,Z,G,F,Y){var R;if(t.cachesBoundsOfCurve&&(R=a.call(arguments),t.boundsOfCurveCache[R]))return t.boundsOfCurveCache[R];var z=Math.sqrt,$=Math.min,st=Math.max,nt=Math.abs,ft=[],et=[[],[]],q,rt,ut,at,dt,xt,Ft,wt;rt=6*O-12*L+6*Z,q=-3*O+9*L-9*Z+3*F,ut=3*L-3*O;for(var gt=0;gt<2;++gt){if(gt>0&&(rt=6*M-12*H+6*G,q=-3*M+9*H-9*G+3*Y,ut=3*H-3*M),nt(q)<1e-12){if(nt(rt)<1e-12)continue;at=-ut/rt,0<at&&at<1&&ft.push(at);continue}Ft=rt*rt-4*ut*q,!(Ft<0)&&(wt=z(Ft),dt=(-rt+wt)/(2*q),0<dt&&dt<1&&ft.push(dt),xt=(-rt-wt)/(2*q),0<xt&&xt<1&&ft.push(xt))}for(var Et,Nt,zt=ft.length,ge=zt,ie;zt--;)at=ft[zt],ie=1-at,Et=ie*ie*ie*O+3*ie*ie*at*L+3*ie*at*at*Z+at*at*at*F,et[0][zt]=Et,Nt=ie*ie*ie*M+3*ie*ie*at*H+3*ie*at*at*G+at*at*at*Y,et[1][zt]=Nt;et[0][ge]=O,et[1][ge]=M,et[0][ge+1]=F,et[1][ge+1]=Y;var Me=[{x:$.apply(null,et[0]),y:$.apply(null,et[1])},{x:st.apply(null,et[0]),y:st.apply(null,et[1])}];return t.cachesBoundsOfCurve&&(t.boundsOfCurveCache[R]=Me),Me}function f(O,M,L){for(var H=L[1],Z=L[2],G=L[3],F=L[4],Y=L[5],R=L[6],z=L[7],$=l(R-O,z-M,H,Z,F,Y,G),st=0,nt=$.length;st<nt;st++)$[st][1]+=O,$[st][2]+=M,$[st][3]+=O,$[st][4]+=M,$[st][5]+=O,$[st][6]+=M;return $}function v(O){var M=0,L=0,H=O.length,Z=0,G=0,F,Y,R,z=[],$,st,nt;for(Y=0;Y<H;++Y){switch(R=!1,F=O[Y].slice(0),F[0]){case"l":F[0]="L",F[1]+=M,F[2]+=L;case"L":M=F[1],L=F[2];break;case"h":F[1]+=M;case"H":F[0]="L",F[2]=L,M=F[1];break;case"v":F[1]+=L;case"V":F[0]="L",L=F[1],F[1]=M,F[2]=L;break;case"m":F[0]="M",F[1]+=M,F[2]+=L;case"M":M=F[1],L=F[2],Z=F[1],G=F[2];break;case"c":F[0]="C",F[1]+=M,F[2]+=L,F[3]+=M,F[4]+=L,F[5]+=M,F[6]+=L;case"C":st=F[3],nt=F[4],M=F[5],L=F[6];break;case"s":F[0]="S",F[1]+=M,F[2]+=L,F[3]+=M,F[4]+=L;case"S":$==="C"?(st=2*M-st,nt=2*L-nt):(st=M,nt=L),M=F[3],L=F[4],F[0]="C",F[5]=F[3],F[6]=F[4],F[3]=F[1],F[4]=F[2],F[1]=st,F[2]=nt,st=F[3],nt=F[4];break;case"q":F[0]="Q",F[1]+=M,F[2]+=L,F[3]+=M,F[4]+=L;case"Q":st=F[1],nt=F[2],M=F[3],L=F[4];break;case"t":F[0]="T",F[1]+=M,F[2]+=L;case"T":$==="Q"?(st=2*M-st,nt=2*L-nt):(st=M,nt=L),F[0]="Q",M=F[1],L=F[2],F[1]=st,F[2]=nt,F[3]=M,F[4]=L;break;case"a":F[0]="A",F[6]+=M,F[7]+=L;case"A":R=!0,z=z.concat(f(M,L,F)),M=F[6],L=F[7];break;case"z":case"Z":M=Z,L=G;break}R||z.push(F),$=F[0]}return z}function p(O,M,L,H){return Math.sqrt((L-O)*(L-O)+(H-M)*(H-M))}function y(O){return O*O*O}function b(O){return 3*O*O*(1-O)}function x(O){return 3*O*(1-O)*(1-O)}function S(O){return(1-O)*(1-O)*(1-O)}function w(O,M,L,H,Z,G,F,Y){return function(R){var z=y(R),$=b(R),st=x(R),nt=S(R);return{x:F*z+Z*$+L*st+O*nt,y:Y*z+G*$+H*st+M*nt}}}function E(O,M,L,H,Z,G,F,Y){return function(R){var z=1-R,$=3*z*z*(L-O)+6*z*R*(Z-L)+3*R*R*(F-Z),st=3*z*z*(H-M)+6*z*R*(G-H)+3*R*R*(Y-G);return Math.atan2(st,$)}}function P(O){return O*O}function A(O){return 2*O*(1-O)}function N(O){return(1-O)*(1-O)}function k(O,M,L,H,Z,G){return function(F){var Y=P(F),R=A(F),z=N(F);return{x:Z*Y+L*R+O*z,y:G*Y+H*R+M*z}}}function U(O,M,L,H,Z,G){return function(F){var Y=1-F,R=2*Y*(L-O)+2*F*(Z-L),z=2*Y*(H-M)+2*F*(G-H);return Math.atan2(z,R)}}function j(O,M,L){var H={x:M,y:L},Z,G=0,F;for(F=1;F<=100;F+=1)Z=O(F/100),G+=p(H.x,H.y,Z.x,Z.y),H=Z;return G}function X(O,M){for(var L=0,H=0,Z=O.iterator,G={x:O.x,y:O.y},F,Y,R=.01,z=O.angleFinder,$;H<M&&R>1e-4;)F=Z(L),$=L,Y=p(G.x,G.y,F.x,F.y),Y+H>M?(L-=R,R/=2):(G=F,L+=R,H+=Y);return F.angle=z($),F}function W(O){for(var M=0,L=O.length,H,Z=0,G=0,F=0,Y=0,R=[],z,$,st,nt=0;nt<L;nt++){switch(H=O[nt],$={x:Z,y:G,command:H[0]},H[0]){case"M":$.length=0,F=Z=H[1],Y=G=H[2];break;case"L":$.length=p(Z,G,H[1],H[2]),Z=H[1],G=H[2];break;case"C":z=w(Z,G,H[1],H[2],H[3],H[4],H[5],H[6]),st=E(Z,G,H[1],H[2],H[3],H[4],H[5],H[6]),$.iterator=z,$.angleFinder=st,$.length=j(z,Z,G),Z=H[5],G=H[6];break;case"Q":z=k(Z,G,H[1],H[2],H[3],H[4]),st=U(Z,G,H[1],H[2],H[3],H[4]),$.iterator=z,$.angleFinder=st,$.length=j(z,Z,G),Z=H[3],G=H[4];break;case"Z":case"z":$.destX=F,$.destY=Y,$.length=p(Z,G,F,Y),Z=F,G=Y;break}M+=$.length,R.push($)}return R.push({length:M,x:Z,y:G}),R}function Q(O,M,L){L||(L=W(O));for(var H=0;M-L[H].length>0&&H<L.length-2;)M-=L[H].length,H++;var Z=L[H],G=M/Z.length,F=Z.command,Y=O[H],R;switch(F){case"M":return{x:Z.x,y:Z.y,angle:0};case"Z":case"z":return R=new t.Point(Z.x,Z.y).lerp(new t.Point(Z.destX,Z.destY),G),R.angle=Math.atan2(Z.destY-Z.y,Z.destX-Z.x),R;case"L":return R=new t.Point(Z.x,Z.y).lerp(new t.Point(Y[1],Y[2]),G),R.angle=Math.atan2(Y[2]-Z.y,Y[1]-Z.x),R;case"C":return X(Z,M);case"Q":return X(Z,M)}}function ot(O){var M=[],L=[],H,Z,G=t.rePathCommand,F="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",Y="("+F+")"+t.commaWsp,R="([01])"+t.commaWsp+"?",z=Y+"?"+Y+"?"+Y+R+R+Y+"?("+F+")",$=new RegExp(z,"g"),st,nt,ft;if(!O||!O.match)return M;ft=O.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var et=0,q,rt=ft.length;et<rt;et++){H=ft[et],nt=H.slice(1).trim(),L.length=0;var ut=H.charAt(0);if(q=[ut],ut.toLowerCase()==="a")for(var at;at=$.exec(nt);)for(var dt=1;dt<at.length;dt++)L.push(at[dt]);else for(;st=G.exec(nt);)L.push(st[0]);for(var dt=0,xt=L.length;dt<xt;dt++)Z=parseFloat(L[dt]),isNaN(Z)||q.push(Z);var Ft=s[ut.toLowerCase()],wt=h[ut]||ut;if(q.length-1>Ft)for(var gt=1,Et=q.length;gt<Et;gt+=Ft)M.push([ut].concat(q.slice(gt,gt+Ft))),ut=wt;else M.push(q)}return M}function it(O,M){var L=[],H,Z=new t.Point(O[0].x,O[0].y),G=new t.Point(O[1].x,O[1].y),F=O.length,Y=1,R=0,z=F>2;for(M=M||0,z&&(Y=O[2].x<G.x?-1:O[2].x===G.x?0:1,R=O[2].y<G.y?-1:O[2].y===G.y?0:1),L.push(["M",Z.x-Y*M,Z.y-R*M]),H=1;H<F;H++){if(!Z.eq(G)){var $=Z.midPointFrom(G);L.push(["Q",Z.x,Z.y,$.x,$.y])}Z=O[H],H+1<O.length&&(G=O[H+1])}return z&&(Y=Z.x>O[H-2].x?1:Z.x===O[H-2].x?0:-1,R=Z.y>O[H-2].y?1:Z.y===O[H-2].y?0:-1),L.push(["L",Z.x+Y*M,Z.y+R*M]),L}function ct(O,M,L){return L&&(M=t.util.multiplyTransformMatrices(M,[1,0,0,1,-L.x,-L.y])),O.map(function(H){for(var Z=H.slice(0),G={},F=1;F<H.length-1;F+=2)G.x=H[F],G.y=H[F+1],G=t.util.transformPoint(G,M),Z[F]=G.x,Z[F+1]=G.y;return Z})}t.util.joinPath=function(O){return O.map(function(M){return M.join(" ")}).join(" ")},t.util.parsePath=ot,t.util.makePathSimpler=v,t.util.getSmoothPathFromPoints=it,t.util.getPathSegmentsInfo=W,t.util.getBoundsOfCurve=c,t.util.getPointOnPath=Q,t.util.transformPath=ct}(),function(){var a=Array.prototype.slice;function s(c,f){for(var v=a.call(arguments,2),p=[],y=0,b=c.length;y<b;y++)p[y]=v.length?c[y][f].apply(c[y],v):c[y][f].call(c[y]);return p}function h(c,f){return u(c,f,function(v,p){return v>=p})}function d(c,f){return u(c,f,function(v,p){return v<p})}function l(c,f){for(var v=c.length;v--;)c[v]=f;return c}function u(c,f,v){if(!(!c||c.length===0)){var p=c.length-1,y=f?c[p][f]:c[p];if(f)for(;p--;)v(c[p][f],y)&&(y=c[p][f]);else for(;p--;)v(c[p],y)&&(y=c[p]);return y}}t.util.array={fill:l,invoke:s,min:d,max:h}}(),function(){function a(h,d,l){if(l)if(!t.isLikelyNode&&d instanceof Element)h=d;else if(d instanceof Array){h=[];for(var u=0,c=d.length;u<c;u++)h[u]=a({},d[u],l)}else if(d&&typeof d=="object")for(var f in d)f==="canvas"||f==="group"?h[f]=null:d.hasOwnProperty(f)&&(h[f]=a({},d[f],l));else h=d;else for(var f in d)h[f]=d[f];return h}function s(h,d){return a({},h,d)}t.util.object={extend:a,clone:s},t.util.object.extend(t.util,t.Observable)}(),function(){function a(u){return u.replace(/-+(.)?/g,function(c,f){return f?f.toUpperCase():""})}function s(u,c){return u.charAt(0).toUpperCase()+(c?u.slice(1):u.slice(1).toLowerCase())}function h(u){return u.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function d(u){var c=0,f,v=[];for(c=0,f;c<u.length;c++)(f=l(u,c))!==!1&&v.push(f);return v}function l(u,c){var f=u.charCodeAt(c);if(isNaN(f))return"";if(f<55296||f>57343)return u.charAt(c);if(55296<=f&&f<=56319){if(u.length<=c+1)throw"High surrogate without following low surrogate";var v=u.charCodeAt(c+1);if(56320>v||v>57343)throw"High surrogate without following low surrogate";return u.charAt(c)+u.charAt(c+1)}if(c===0)throw"Low surrogate without preceding high surrogate";var p=u.charCodeAt(c-1);if(55296>p||p>56319)throw"Low surrogate without preceding high surrogate";return!1}t.util.string={camelize:a,capitalize:s,escapeXml:h,graphemeSplit:d}}(),function(){var a=Array.prototype.slice,s=function(){},h=function(){for(var f in{toString:1})if(f==="toString")return!1;return!0}(),d=function(f,v,p){for(var y in v)y in f.prototype&&typeof f.prototype[y]=="function"&&(v[y]+"").indexOf("callSuper")>-1?f.prototype[y]=function(b){return function(){var x=this.constructor.superclass;this.constructor.superclass=p;var S=v[b].apply(this,arguments);if(this.constructor.superclass=x,b!=="initialize")return S}}(y):f.prototype[y]=v[y],h&&(v.toString!==Object.prototype.toString&&(f.prototype.toString=v.toString),v.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=v.valueOf))};function l(){}function u(f){for(var v=null,p=this;p.constructor.superclass;){var y=p.constructor.superclass.prototype[f];if(p[f]!==y){v=y;break}p=p.constructor.superclass.prototype}return v?arguments.length>1?v.apply(this,a.call(arguments,1)):v.call(this):console.log("tried to callSuper "+f+", method not found in prototype chain",this)}function c(){var f=null,v=a.call(arguments,0);typeof v[0]=="function"&&(f=v.shift());function p(){this.initialize.apply(this,arguments)}p.superclass=f,p.subclasses=[],f&&(l.prototype=f.prototype,p.prototype=new l,f.subclasses.push(p));for(var y=0,b=v.length;y<b;y++)d(p,v[y],f);return p.prototype.initialize||(p.prototype.initialize=s),p.prototype.constructor=p,p.prototype.callSuper=u,p}t.util.createClass=c}(),function(){var a=!!t.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];t.util.addListener=function(d,l,u,c){d&&d.addEventListener(l,u,a?!1:c)},t.util.removeListener=function(d,l,u,c){d&&d.removeEventListener(l,u,a?!1:c)};function h(d){var l=d.changedTouches;return l&&l[0]?l[0]:d}t.util.getPointer=function(d){var l=d.target,u=t.util.getScrollLeftTop(l),c=h(d);return{x:c.clientX+u.left,y:c.clientY+u.top}},t.util.isTouchEvent=function(d){return s.indexOf(d.type)>-1||d.pointerType==="touch"}}(),function(){function a(c,f){var v=c.style;if(!v)return c;if(typeof f=="string")return c.style.cssText+=";"+f,f.indexOf("opacity")>-1?u(c,f.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var p in f)if(p==="opacity")u(c,f[p]);else{var y=p==="float"||p==="cssFloat"?typeof v.styleFloat>"u"?"cssFloat":"styleFloat":p;v.setProperty(y,f[p])}return c}var s=t.document.createElement("div"),h=typeof s.style.opacity=="string",d=typeof s.style.filter=="string",l=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,u=function(c){return c};h?u=function(c,f){return c.style.opacity=f,c}:d&&(u=function(c,f){var v=c.style;return c.currentStyle&&!c.currentStyle.hasLayout&&(v.zoom=1),l.test(v.filter)?(f=f>=.9999?"":"alpha(opacity="+f*100+")",v.filter=v.filter.replace(l,f)):v.filter+=" alpha(opacity="+f*100+")",c}),t.util.setStyle=a}(),function(){var a=Array.prototype.slice;function s(S){return typeof S=="string"?t.document.getElementById(S):S}var h,d=function(S){return a.call(S,0)};try{h=d(t.document.childNodes)instanceof Array}catch{}h||(d=function(S){for(var w=new Array(S.length),E=S.length;E--;)w[E]=S[E];return w});function l(S,w){var E=t.document.createElement(S);for(var P in w)P==="class"?E.className=w[P]:P==="for"?E.htmlFor=w[P]:E.setAttribute(P,w[P]);return E}function u(S,w){S&&(" "+S.className+" ").indexOf(" "+w+" ")===-1&&(S.className+=(S.className?" ":"")+w)}function c(S,w,E){return typeof w=="string"&&(w=l(w,E)),S.parentNode&&S.parentNode.replaceChild(w,S),w.appendChild(S),w}function f(S){for(var w=0,E=0,P=t.document.documentElement,A=t.document.body||{scrollLeft:0,scrollTop:0};S&&(S.parentNode||S.host)&&(S=S.parentNode||S.host,S===t.document?(w=A.scrollLeft||P.scrollLeft||0,E=A.scrollTop||P.scrollTop||0):(w+=S.scrollLeft||0,E+=S.scrollTop||0),!(S.nodeType===1&&S.style.position==="fixed")););return{left:w,top:E}}function v(S){var w,E=S&&S.ownerDocument,P={left:0,top:0},A={left:0,top:0},N,k={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!E)return A;for(var U in k)A[k[U]]+=parseInt(p(S,U),10)||0;return w=E.documentElement,typeof S.getBoundingClientRect<"u"&&(P=S.getBoundingClientRect()),N=f(S),{left:P.left+N.left-(w.clientLeft||0)+A.left,top:P.top+N.top-(w.clientTop||0)+A.top}}var p;t.document.defaultView&&t.document.defaultView.getComputedStyle?p=function(S,w){var E=t.document.defaultView.getComputedStyle(S,null);return E?E[w]:void 0}:p=function(S,w){var E=S.style[w];return!E&&S.currentStyle&&(E=S.currentStyle[w]),E},function(){var S=t.document.documentElement.style,w="userSelect"in S?"userSelect":"MozUserSelect"in S?"MozUserSelect":"WebkitUserSelect"in S?"WebkitUserSelect":"KhtmlUserSelect"in S?"KhtmlUserSelect":"";function E(A){return typeof A.onselectstart<"u"&&(A.onselectstart=t.util.falseFunction),w?A.style[w]="none":typeof A.unselectable=="string"&&(A.unselectable="on"),A}function P(A){return typeof A.onselectstart<"u"&&(A.onselectstart=null),w?A.style[w]="":typeof A.unselectable=="string"&&(A.unselectable=""),A}t.util.makeElementUnselectable=E,t.util.makeElementSelectable=P}();function y(S){var w=t.jsdomImplForWrapper(S);return w._canvas||w._image}function b(S){if(t.isLikelyNode){var w=t.jsdomImplForWrapper(S);w&&(w._image=null,w._canvas=null,w._currentSrc=null,w._attributes=null,w._classList=null)}}function x(S,w){S.imageSmoothingEnabled=S.imageSmoothingEnabled||S.webkitImageSmoothingEnabled||S.mozImageSmoothingEnabled||S.msImageSmoothingEnabled||S.oImageSmoothingEnabled,S.imageSmoothingEnabled=w}t.util.setImageSmoothing=x,t.util.getById=s,t.util.toArray=d,t.util.addClass=u,t.util.makeElement=l,t.util.wrapElement=c,t.util.getScrollLeftTop=f,t.util.getElementOffset=v,t.util.getNodeCanvas=y,t.util.cleanUpJsdomNode=b}(),function(){function a(d,l){return d+(/\?/.test(d)?"&":"?")+l}function s(){}function h(d,l){l||(l={});var u=l.method?l.method.toUpperCase():"GET",c=l.onComplete||function(){},f=new t.window.XMLHttpRequest,v=l.body||l.parameters;return f.onreadystatechange=function(){f.readyState===4&&(c(f),f.onreadystatechange=s)},u==="GET"&&(v=null,typeof l.parameters=="string"&&(d=a(d,l.parameters))),f.open(u,d,!0),(u==="POST"||u==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(v),f}t.util.request=h}(),t.log=console.log,t.warn=console.warn,function(){var a=t.util.object.extend,s=t.util.object.clone,h=[];t.util.object.extend(h,{cancelAll:function(){var y=this.splice(0);return y.forEach(function(b){b.cancel()}),y},cancelByCanvas:function(y){if(!y)return[];var b=this.filter(function(x){return typeof x.target=="object"&&x.target.canvas===y});return b.forEach(function(x){x.cancel()}),b},cancelByTarget:function(y){var b=this.findAnimationsByTarget(y);return b.forEach(function(x){x.cancel()}),b},findAnimationIndex:function(y){return this.indexOf(this.findAnimation(y))},findAnimation:function(y){return this.find(function(b){return b.cancel===y})},findAnimationsByTarget:function(y){return y?this.filter(function(b){return b.target===y}):[]}});function d(){return!1}function l(y,b,x,S){return-x*Math.cos(y/S*(Math.PI/2))+x+b}function u(y){y||(y={});var b=!1,x,S=function(){var w=t.runningAnimations.indexOf(x);return w>-1&&t.runningAnimations.splice(w,1)[0]};return x=a(s(y),{cancel:function(){return b=!0,S()},currentValue:"startValue"in y?y.startValue:0,completionRate:0,durationRate:0}),t.runningAnimations.push(x),v(function(w){var E=w||+new Date,P=y.duration||500,A=E+P,N,k=y.onChange||d,U=y.abort||d,j=y.onComplete||d,X=y.easing||l,W="startValue"in y?y.startValue.length>0:!1,Q="startValue"in y?y.startValue:0,ot="endValue"in y?y.endValue:100,it=y.byValue||(W?Q.map(function(ct,O){return ot[O]-Q[O]}):ot-Q);y.onStart&&y.onStart(),function ct(O){N=O||+new Date;var M=N>A?P:N-E,L=M/P,H=W?Q.map(function(G,F){return X(M,Q[F],it[F],P)}):X(M,Q,it,P),Z=Math.abs(W?(H[0]-Q[0])/it[0]:(H-Q)/it);if(x.currentValue=W?H.slice():H,x.completionRate=Z,x.durationRate=L,!b){if(U(H,Z,L)){S();return}if(N>A){x.currentValue=W?ot.slice():ot,x.completionRate=1,x.durationRate=1,k(W?ot.slice():ot,1,1),j(ot,1,1),S();return}else k(H,Z,L),v(ct)}}(E)}),x.cancel}var c=t.window.requestAnimationFrame||t.window.webkitRequestAnimationFrame||t.window.mozRequestAnimationFrame||t.window.oRequestAnimationFrame||t.window.msRequestAnimationFrame||function(y){return t.window.setTimeout(y,1e3/60)},f=t.window.cancelAnimationFrame||t.window.clearTimeout;function v(){return c.apply(t.window,arguments)}function p(){return f.apply(t.window,arguments)}t.util.animate=u,t.util.requestAnimFrame=v,t.util.cancelAnimFrame=p,t.runningAnimations=h}(),function(){function a(h,d,l){var u="rgba("+parseInt(h[0]+l*(d[0]-h[0]),10)+","+parseInt(h[1]+l*(d[1]-h[1]),10)+","+parseInt(h[2]+l*(d[2]-h[2]),10);return u+=","+(h&&d?parseFloat(h[3]+l*(d[3]-h[3])):1),u+=")",u}function s(h,d,l,u){var c=new t.Color(h).getSource(),f=new t.Color(d).getSource(),v=u.onComplete,p=u.onChange;return u=u||{},t.util.animate(t.util.object.extend(u,{duration:l||500,startValue:c,endValue:f,byValue:f,easing:function(y,b,x,S){var w=u.colorEasing?u.colorEasing(y,S):1-Math.cos(y/S*(Math.PI/2));return a(b,x,w)},onComplete:function(y,b,x){if(v)return v(a(f,f,0),b,x)},onChange:function(y,b,x){if(p){if(Array.isArray(y))return p(a(y,y,0),b,x);p(y,b,x)}}}))}t.util.animateColor=s}(),function(){function a(O,M,L,H){return O<Math.abs(M)?(O=M,H=L/4):M===0&&O===0?H=L/(2*Math.PI)*Math.asin(1):H=L/(2*Math.PI)*Math.asin(M/O),{a:O,c:M,p:L,s:H}}function s(O,M,L){return O.a*Math.pow(2,10*(M-=1))*Math.sin((M*L-O.s)*(2*Math.PI)/O.p)}function h(O,M,L,H){return L*((O=O/H-1)*O*O+1)+M}function d(O,M,L,H){return O/=H/2,O<1?L/2*O*O*O+M:L/2*((O-=2)*O*O+2)+M}function l(O,M,L,H){return L*(O/=H)*O*O*O+M}function u(O,M,L,H){return-L*((O=O/H-1)*O*O*O-1)+M}function c(O,M,L,H){return O/=H/2,O<1?L/2*O*O*O*O+M:-L/2*((O-=2)*O*O*O-2)+M}function f(O,M,L,H){return L*(O/=H)*O*O*O*O+M}function v(O,M,L,H){return L*((O=O/H-1)*O*O*O*O+1)+M}function p(O,M,L,H){return O/=H/2,O<1?L/2*O*O*O*O*O+M:L/2*((O-=2)*O*O*O*O+2)+M}function y(O,M,L,H){return-L*Math.cos(O/H*(Math.PI/2))+L+M}function b(O,M,L,H){return L*Math.sin(O/H*(Math.PI/2))+M}function x(O,M,L,H){return-L/2*(Math.cos(Math.PI*O/H)-1)+M}function S(O,M,L,H){return O===0?M:L*Math.pow(2,10*(O/H-1))+M}function w(O,M,L,H){return O===H?M+L:L*(-Math.pow(2,-10*O/H)+1)+M}function E(O,M,L,H){return O===0?M:O===H?M+L:(O/=H/2,O<1?L/2*Math.pow(2,10*(O-1))+M:L/2*(-Math.pow(2,-10*--O)+2)+M)}function P(O,M,L,H){return-L*(Math.sqrt(1-(O/=H)*O)-1)+M}function A(O,M,L,H){return L*Math.sqrt(1-(O=O/H-1)*O)+M}function N(O,M,L,H){return O/=H/2,O<1?-L/2*(Math.sqrt(1-O*O)-1)+M:L/2*(Math.sqrt(1-(O-=2)*O)+1)+M}function k(O,M,L,H){var Z=1.70158,G=0,F=L;if(O===0)return M;if(O/=H,O===1)return M+L;G||(G=H*.3);var Y=a(F,L,G,Z);return-s(Y,O,H)+M}function U(O,M,L,H){var Z=1.70158,G=0,F=L;if(O===0)return M;if(O/=H,O===1)return M+L;G||(G=H*.3);var Y=a(F,L,G,Z);return Y.a*Math.pow(2,-10*O)*Math.sin((O*H-Y.s)*(2*Math.PI)/Y.p)+Y.c+M}function j(O,M,L,H){var Z=1.70158,G=0,F=L;if(O===0)return M;if(O/=H/2,O===2)return M+L;G||(G=H*(.3*1.5));var Y=a(F,L,G,Z);return O<1?-.5*s(Y,O,H)+M:Y.a*Math.pow(2,-10*(O-=1))*Math.sin((O*H-Y.s)*(2*Math.PI)/Y.p)*.5+Y.c+M}function X(O,M,L,H,Z){return Z===void 0&&(Z=1.70158),L*(O/=H)*O*((Z+1)*O-Z)+M}function W(O,M,L,H,Z){return Z===void 0&&(Z=1.70158),L*((O=O/H-1)*O*((Z+1)*O+Z)+1)+M}function Q(O,M,L,H,Z){return Z===void 0&&(Z=1.70158),O/=H/2,O<1?L/2*(O*O*(((Z*=1.525)+1)*O-Z))+M:L/2*((O-=2)*O*(((Z*=1.525)+1)*O+Z)+2)+M}function ot(O,M,L,H){return L-it(H-O,0,L,H)+M}function it(O,M,L,H){return(O/=H)<1/2.75?L*(7.5625*O*O)+M:O<2/2.75?L*(7.5625*(O-=1.5/2.75)*O+.75)+M:O<2.5/2.75?L*(7.5625*(O-=2.25/2.75)*O+.9375)+M:L*(7.5625*(O-=2.625/2.75)*O+.984375)+M}function ct(O,M,L,H){return O<H/2?ot(O*2,0,L,H)*.5+M:it(O*2-H,0,L,H)*.5+L*.5+M}t.util.ease={easeInQuad:function(O,M,L,H){return L*(O/=H)*O+M},easeOutQuad:function(O,M,L,H){return-L*(O/=H)*(O-2)+M},easeInOutQuad:function(O,M,L,H){return O/=H/2,O<1?L/2*O*O+M:-L/2*(--O*(O-2)-1)+M},easeInCubic:function(O,M,L,H){return L*(O/=H)*O*O+M},easeOutCubic:h,easeInOutCubic:d,easeInQuart:l,easeOutQuart:u,easeInOutQuart:c,easeInQuint:f,easeOutQuint:v,easeInOutQuint:p,easeInSine:y,easeOutSine:b,easeInOutSine:x,easeInExpo:S,easeOutExpo:w,easeInOutExpo:E,easeInCirc:P,easeOutCirc:A,easeInOutCirc:N,easeInElastic:k,easeOutElastic:U,easeInOutElastic:j,easeInBack:X,easeOutBack:W,easeInOutBack:Q,easeInBounce:ot,easeOutBounce:it,easeInOutBounce:ct}}(),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.util.object.clone,l=s.util.toFixed,u=s.util.parseUnit,c=s.util.multiplyTransformMatrices,f=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],v=["symbol","image","marker","pattern","view","svg"],p=["pattern","defs","symbol","metadata","clipPath","mask","desc"],y=["symbol","g","a","svg","clipPath","defs"],b={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},x={stroke:"strokeOpacity",fill:"fillOpacity"},S="font-size",w="clip-path";s.svgValidTagNamesRegEx=A(f),s.svgViewBoxElementsRegEx=A(v),s.svgInvalidAncestorsRegEx=A(p),s.svgValidParentsRegEx=A(y),s.cssRules={},s.gradientDefs={},s.clipPaths={};function E(G){return G in b?b[G]:G}function P(G,F,Y,R){var z=Array.isArray(F),$;if((G==="fill"||G==="stroke")&&F==="none")F="";else{if(G==="strokeUniform")return F==="non-scaling-stroke";if(G==="strokeDashArray")F==="none"?F=null:F=F.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(G==="transformMatrix")Y&&Y.transformMatrix?F=c(Y.transformMatrix,s.parseTransformAttribute(F)):F=s.parseTransformAttribute(F);else if(G==="visible")F=F!=="none"&&F!=="hidden",Y&&Y.visible===!1&&(F=!1);else if(G==="opacity")F=parseFloat(F),Y&&typeof Y.opacity<"u"&&(F*=Y.opacity);else if(G==="textAnchor")F=F==="start"?"left":F==="end"?"right":"center";else if(G==="charSpacing")$=u(F,R)/R*1e3;else if(G==="paintFirst"){var st=F.indexOf("fill"),nt=F.indexOf("stroke"),F="fill";(st>-1&&nt>-1&&nt<st||st===-1&&nt>-1)&&(F="stroke")}else{if(G==="href"||G==="xlink:href"||G==="font")return F;if(G==="imageSmoothing")return F==="optimizeQuality";$=z?F.map(u):u(F,R)}}return!z&&isNaN($)?F:$}function A(G){return new RegExp("^("+G.join("|")+")\\b","i")}function N(G){for(var F in x)if(!(typeof G[x[F]]>"u"||G[F]==="")){if(typeof G[F]>"u"){if(!s.Object.prototype[F])continue;G[F]=s.Object.prototype[F]}if(G[F].indexOf("url(")!==0){var Y=new s.Color(G[F]);G[F]=Y.setAlpha(l(Y.getAlpha()*G[x[F]],2)).toRgba()}}return G}function k(G,F){var Y,R=[],z,$,st;for($=0,st=F.length;$<st;$++)Y=F[$],z=G.getElementsByTagName(Y),R=R.concat(Array.prototype.slice.call(z));return R}s.parseTransformAttribute=function(){function G(gt,Et){var Nt=s.util.cos(Et[0]),zt=s.util.sin(Et[0]),ge=0,ie=0;Et.length===3&&(ge=Et[1],ie=Et[2]),gt[0]=Nt,gt[1]=zt,gt[2]=-zt,gt[3]=Nt,gt[4]=ge-(Nt*ge-zt*ie),gt[5]=ie-(zt*ge+Nt*ie)}function F(gt,Et){var Nt=Et[0],zt=Et.length===2?Et[1]:Et[0];gt[0]=Nt,gt[3]=zt}function Y(gt,Et,Nt){gt[Nt]=Math.tan(s.util.degreesToRadians(Et[0]))}function R(gt,Et){gt[4]=Et[0],Et.length===2&&(gt[5]=Et[1])}var z=s.iMatrix,$=s.reNum,st=s.commaWsp,nt="(?:(skewX)\\s*\\(\\s*("+$+")\\s*\\))",ft="(?:(skewY)\\s*\\(\\s*("+$+")\\s*\\))",et="(?:(rotate)\\s*\\(\\s*("+$+")(?:"+st+"("+$+")"+st+"("+$+"))?\\s*\\))",q="(?:(scale)\\s*\\(\\s*("+$+")(?:"+st+"("+$+"))?\\s*\\))",rt="(?:(translate)\\s*\\(\\s*("+$+")(?:"+st+"("+$+"))?\\s*\\))",ut="(?:(matrix)\\s*\\(\\s*("+$+")"+st+"("+$+")"+st+"("+$+")"+st+"("+$+")"+st+"("+$+")"+st+"("+$+")\\s*\\))",at="(?:"+ut+"|"+rt+"|"+q+"|"+et+"|"+nt+"|"+ft+")",dt="(?:"+at+"(?:"+st+"*"+at+")*)",xt="^\\s*(?:"+dt+"?)\\s*$",Ft=new RegExp(xt),wt=new RegExp(at,"g");return function(gt){var Et=z.concat(),Nt=[];if(!gt||gt&&!Ft.test(gt))return Et;gt.replace(wt,function(ge){var ie=new RegExp(at).exec(ge).filter(function(zi){return!!zi}),Me=ie[1],_e=ie.slice(2).map(parseFloat);switch(Me){case"translate":R(Et,_e);break;case"rotate":_e[0]=s.util.degreesToRadians(_e[0]),G(Et,_e);break;case"scale":F(Et,_e);break;case"skewX":Y(Et,_e,2);break;case"skewY":Y(Et,_e,1);break;case"matrix":Et=_e;break}Nt.push(Et.concat()),Et=z.concat()});for(var zt=Nt[0];Nt.length>1;)Nt.shift(),zt=s.util.multiplyTransformMatrices(zt,Nt[0]);return zt}}();function U(G,F){var Y,R;G.replace(/;\s*$/,"").split(";").forEach(function(z){var $=z.split(":");Y=$[0].trim().toLowerCase(),R=$[1].trim(),F[Y]=R})}function j(G,F){var Y,R;for(var z in G)typeof G[z]>"u"||(Y=z.toLowerCase(),R=G[z],F[Y]=R)}function X(G,F){var Y={};for(var R in s.cssRules[F])if(W(G,R.split(" ")))for(var z in s.cssRules[F][R])Y[z]=s.cssRules[F][R][z];return Y}function W(G,F){var Y,R=!0;return Y=ot(G,F.pop()),Y&&F.length&&(R=Q(G,F)),Y&&R&&F.length===0}function Q(G,F){for(var Y,R=!0;G.parentNode&&G.parentNode.nodeType===1&&F.length;)R&&(Y=F.pop()),G=G.parentNode,R=ot(G,Y);return F.length===0}function ot(G,F){var Y=G.nodeName,R=G.getAttribute("class"),z=G.getAttribute("id"),$,st;if($=new RegExp("^"+Y,"i"),F=F.replace($,""),z&&F.length&&($=new RegExp("#"+z+"(?![a-zA-Z\\-]+)","i"),F=F.replace($,"")),R&&F.length)for(R=R.split(" "),st=R.length;st--;)$=new RegExp("\\."+R[st]+"(?![a-zA-Z\\-]+)","i"),F=F.replace($,"");return F.length===0}function it(G,F){var Y;if(G.getElementById&&(Y=G.getElementById(F)),Y)return Y;var R,z,$,st=G.getElementsByTagName("*");for(z=0,$=st.length;z<$;z++)if(R=st[z],F===R.getAttribute("id"))return R}function ct(G){for(var F=k(G,["use","svg:use"]),Y=0;F.length&&Y<F.length;){var R=F[Y],z=R.getAttribute("xlink:href")||R.getAttribute("href");if(z===null)return;var $=z.slice(1),st=R.getAttribute("x")||0,nt=R.getAttribute("y")||0,ft=it(G,$).cloneNode(!0),et=(ft.getAttribute("transform")||"")+" translate("+st+", "+nt+")",q,rt=F.length,ut,at,dt,xt,Ft=s.svgNS;if(M(ft),/^svg$/i.test(ft.nodeName)){var wt=ft.ownerDocument.createElementNS(Ft,"g");for(at=0,dt=ft.attributes,xt=dt.length;at<xt;at++)ut=dt.item(at),wt.setAttributeNS(Ft,ut.nodeName,ut.nodeValue);for(;ft.firstChild;)wt.appendChild(ft.firstChild);ft=wt}for(at=0,dt=R.attributes,xt=dt.length;at<xt;at++)ut=dt.item(at),!(ut.nodeName==="x"||ut.nodeName==="y"||ut.nodeName==="xlink:href"||ut.nodeName==="href")&&(ut.nodeName==="transform"?et=ut.nodeValue+" "+et:ft.setAttribute(ut.nodeName,ut.nodeValue));ft.setAttribute("transform",et),ft.setAttribute("instantiated_by_use","1"),ft.removeAttribute("id"),q=R.parentNode,q.replaceChild(ft,R),F.length===rt&&Y++}}var O=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function M(G){if(!s.svgViewBoxElementsRegEx.test(G.nodeName))return{};var F=G.getAttribute("viewBox"),Y=1,R=1,z=0,$=0,st,nt,ft,et,q=G.getAttribute("width"),rt=G.getAttribute("height"),ut=G.getAttribute("x")||0,at=G.getAttribute("y")||0,dt=G.getAttribute("preserveAspectRatio")||"",xt=!F||!(F=F.match(O)),Ft=!q||!rt||q==="100%"||rt==="100%",wt=xt&&Ft,gt={},Et="",Nt=0,zt=0;if(gt.width=0,gt.height=0,gt.toBeParsed=wt,xt&&(ut||at)&&G.parentNode&&G.parentNode.nodeName!=="#document"&&(Et=" translate("+u(ut)+" "+u(at)+") ",ft=(G.getAttribute("transform")||"")+Et,G.setAttribute("transform",ft),G.removeAttribute("x"),G.removeAttribute("y")),wt)return gt;if(xt)return gt.width=u(q),gt.height=u(rt),gt;if(z=-parseFloat(F[1]),$=-parseFloat(F[2]),st=parseFloat(F[3]),nt=parseFloat(F[4]),gt.minX=z,gt.minY=$,gt.viewBoxWidth=st,gt.viewBoxHeight=nt,Ft?(gt.width=st,gt.height=nt):(gt.width=u(q),gt.height=u(rt),Y=gt.width/st,R=gt.height/nt),dt=s.util.parsePreserveAspectRatioAttribute(dt),dt.alignX!=="none"&&(dt.meetOrSlice==="meet"&&(R=Y=Y>R?R:Y),dt.meetOrSlice==="slice"&&(R=Y=Y>R?Y:R),Nt=gt.width-st*Y,zt=gt.height-nt*Y,dt.alignX==="Mid"&&(Nt/=2),dt.alignY==="Mid"&&(zt/=2),dt.alignX==="Min"&&(Nt=0),dt.alignY==="Min"&&(zt=0)),Y===1&&R===1&&z===0&&$===0&&ut===0&&at===0)return gt;if((ut||at)&&G.parentNode.nodeName!=="#document"&&(Et=" translate("+u(ut)+" "+u(at)+") "),ft=Et+" matrix("+Y+" 0 0 "+R+" "+(z*Y+Nt)+" "+($*R+zt)+") ",G.nodeName==="svg"){for(et=G.ownerDocument.createElementNS(s.svgNS,"g");G.firstChild;)et.appendChild(G.firstChild);G.appendChild(et)}else et=G,et.removeAttribute("x"),et.removeAttribute("y"),ft=et.getAttribute("transform")+ft;return et.setAttribute("transform",ft),gt}function L(G,F){for(;G&&(G=G.parentNode);)if(G.nodeName&&F.test(G.nodeName.replace("svg:",""))&&!G.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(G,F,Y,R){if(G){ct(G);var z=s.Object.__uid++,$,st,nt=M(G),ft=s.util.toArray(G.getElementsByTagName("*"));if(nt.crossOrigin=R&&R.crossOrigin,nt.svgUid=z,ft.length===0&&s.isLikelyNode){ft=G.selectNodes('//*[name(.)!="svg"]');var et=[];for($=0,st=ft.length;$<st;$++)et[$]=ft[$];ft=et}var q=ft.filter(function(ut){return M(ut),s.svgValidTagNamesRegEx.test(ut.nodeName.replace("svg:",""))&&!L(ut,s.svgInvalidAncestorsRegEx)});if(!q||q&&!q.length){F&&F([],{});return}var rt={};ft.filter(function(ut){return ut.nodeName.replace("svg:","")==="clipPath"}).forEach(function(ut){var at=ut.getAttribute("id");rt[at]=s.util.toArray(ut.getElementsByTagName("*")).filter(function(dt){return s.svgValidTagNamesRegEx.test(dt.nodeName.replace("svg:",""))})}),s.gradientDefs[z]=s.getGradientDefs(G),s.cssRules[z]=s.getCSSRules(G),s.clipPaths[z]=rt,s.parseElements(q,function(ut,at){F&&(F(ut,nt,at,ft),delete s.gradientDefs[z],delete s.cssRules[z],delete s.clipPaths[z])},d(nt),Y,R)}};function H(G,F){var Y=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],R="xlink:href",z=F.getAttribute(R).slice(1),$=it(G,z);if($&&$.getAttribute(R)&&H(G,$),Y.forEach(function(nt){$&&!F.hasAttribute(nt)&&$.hasAttribute(nt)&&F.setAttribute(nt,$.getAttribute(nt))}),!F.children.length)for(var st=$.cloneNode(!0);st.firstChild;)F.appendChild(st.firstChild);F.removeAttribute(R)}var Z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");h(s,{parseFontDeclaration:function(G,F){var Y=G.match(Z);if(Y){var R=Y[1],z=Y[3],$=Y[4],st=Y[5],nt=Y[6];R&&(F.fontStyle=R),z&&(F.fontWeight=isNaN(parseFloat(z))?z:parseFloat(z)),$&&(F.fontSize=u($)),nt&&(F.fontFamily=nt),st&&(F.lineHeight=st==="normal"?1:st)}},getGradientDefs:function(G){var F=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],Y=k(G,F),R,z=0,$={};for(z=Y.length;z--;)R=Y[z],R.getAttribute("xlink:href")&&H(G,R),$[R.getAttribute("id")]=R;return $},parseAttributes:function(G,F,Y){if(G){var R,z={},$,st;typeof Y>"u"&&(Y=G.getAttribute("svgUid")),G.parentNode&&s.svgValidParentsRegEx.test(G.parentNode.nodeName)&&(z=s.parseAttributes(G.parentNode,F,Y));var nt=F.reduce(function(dt,xt){return R=G.getAttribute(xt),R&&(dt[xt]=R),dt},{}),ft=h(X(G,Y),s.parseStyleAttribute(G));nt=h(nt,ft),ft[w]&&G.setAttribute(w,ft[w]),$=st=z.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,nt[S]&&(nt[S]=$=u(nt[S],st));var et,q,rt={};for(var ut in nt)et=E(ut),q=P(et,nt[ut],z,$),rt[et]=q;rt&&rt.font&&s.parseFontDeclaration(rt.font,rt);var at=h(z,rt);return s.svgValidParentsRegEx.test(G.nodeName)?at:N(at)}},parseElements:function(G,F,Y,R,z){new s.ElementsParser(G,F,Y,R,z).parse()},parseStyleAttribute:function(G){var F={},Y=G.getAttribute("style");return Y&&(typeof Y=="string"?U(Y,F):j(Y,F)),F},parsePointsAttribute:function(G){if(!G)return null;G=G.replace(/,/g," ").trim(),G=G.split(/\s+/);var F=[],Y,R;for(Y=0,R=G.length;Y<R;Y+=2)F.push({x:parseFloat(G[Y]),y:parseFloat(G[Y+1])});return F},getCSSRules:function(G){var F=G.getElementsByTagName("style"),Y,R,z={},$;for(Y=0,R=F.length;Y<R;Y++){var st=F[Y].textContent;st=st.replace(/\/\*[\s\S]*?\*\//g,""),st.trim()!==""&&($=st.split("}"),$=$.filter(function(nt){return nt.trim()}),$.forEach(function(nt){var ft=nt.split("{"),et={},q=ft[1].trim(),rt=q.split(";").filter(function(xt){return xt.trim()});for(Y=0,R=rt.length;Y<R;Y++){var ut=rt[Y].split(":"),at=ut[0].trim(),dt=ut[1].trim();et[at]=dt}nt=ft[0].trim(),nt.split(",").forEach(function(xt){xt=xt.replace(/^svg/i,"").trim(),xt!==""&&(z[xt]?s.util.object.extend(z[xt],et):z[xt]=s.util.object.clone(et))})}))}return z},loadSVGFromURL:function(G,F,Y,R){G=G.replace(/^\n\s*/,"").trim(),new s.util.request(G,{method:"get",onComplete:z});function z($){var st=$.responseXML;if(!st||!st.documentElement)return F&&F(null),!1;s.parseSVGDocument(st.documentElement,function(nt,ft,et,q){F&&F(nt,ft,et,q)},Y,R)}},loadSVGFromString:function(G,F,Y,R){var z=new s.window.DOMParser,$=z.parseFromString(G.trim(),"text/xml");s.parseSVGDocument($.documentElement,function(st,nt,ft,et){F(st,nt,ft,et)},Y,R)}})}(i),t.ElementsParser=function(a,s,h,d,l,u){this.elements=a,this.callback=s,this.options=h,this.reviver=d,this.svgUid=h&&h.svgUid||0,this.parsingOptions=l,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=u},function(a){a.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},a.createObjects=function(){var s=this;this.elements.forEach(function(h,d){h.setAttribute("svgUid",s.svgUid),s.createObject(h,d)})},a.findTag=function(s){return t[t.util.string.capitalize(s.tagName.replace("svg:",""))]},a.createObject=function(s,h){var d=this.findTag(s);if(d&&d.fromElement)try{d.fromElement(s,this.createCallback(h,s),this.options)}catch(l){t.log(l)}else this.checkIfDone()},a.createCallback=function(s,h){var d=this;return function(l){var u;d.resolveGradient(l,h,"fill"),d.resolveGradient(l,h,"stroke"),l instanceof t.Image&&l._originalElement&&(u=l.parsePreserveAspectRatioAttribute(h)),l._removeTransformMatrix(u),d.resolveClipPath(l,h),d.reviver&&d.reviver(h,l),d.instances[s]=l,d.checkIfDone()}},a.extractPropertyDefinition=function(s,h,d){var l=s[h],u=this.regexUrl;if(u.test(l)){u.lastIndex=0;var c=u.exec(l)[1];return u.lastIndex=0,t[d][this.svgUid][c]}},a.resolveGradient=function(s,h,d){var l=this.extractPropertyDefinition(s,d,"gradientDefs");if(l){var u=h.getAttribute(d+"-opacity"),c=t.Gradient.fromElement(l,s,u,this.options);s.set(d,c)}},a.createClipPathCallback=function(s,h){return function(d){d._removeTransformMatrix(),d.fillRule=d.clipRule,h.push(d)}},a.resolveClipPath=function(s,h){var d=this.extractPropertyDefinition(s,"clipPath","clipPaths"),l,u,c,f,v,p;if(d){f=[],c=t.util.invertTransform(s.calcTransformMatrix());for(var y=d[0].parentNode,b=h;b.parentNode&&b.getAttribute("clip-path")!==s.clipPath;)b=b.parentNode;b.parentNode.appendChild(y);for(var x=0;x<d.length;x++)l=d[x],u=this.findTag(l),u.fromElement(l,this.createClipPathCallback(s,f),this.options);f.length===1?d=f[0]:d=new t.Group(f),v=t.util.multiplyTransformMatrices(c,d.calcTransformMatrix()),d.clipPath&&this.resolveClipPath(d,b);var p=t.util.qrDecompose(v);d.flipX=!1,d.flipY=!1,d.set("scaleX",p.scaleX),d.set("scaleY",p.scaleY),d.angle=p.angle,d.skewX=p.skewX,d.skewY=0,d.setPositionByOrigin({x:p.translateX,y:p.translateY},"center","center"),s.clipPath=d}else delete s.clipPath},a.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(t.ElementsParser.prototype),function(a){var s=a.fabric||(a.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=h;function h(d,l){this.x=d,this.y=l}h.prototype={type:"point",constructor:h,add:function(d){return new h(this.x+d.x,this.y+d.y)},addEquals:function(d){return this.x+=d.x,this.y+=d.y,this},scalarAdd:function(d){return new h(this.x+d,this.y+d)},scalarAddEquals:function(d){return this.x+=d,this.y+=d,this},subtract:function(d){return new h(this.x-d.x,this.y-d.y)},subtractEquals:function(d){return this.x-=d.x,this.y-=d.y,this},scalarSubtract:function(d){return new h(this.x-d,this.y-d)},scalarSubtractEquals:function(d){return this.x-=d,this.y-=d,this},multiply:function(d){return new h(this.x*d,this.y*d)},multiplyEquals:function(d){return this.x*=d,this.y*=d,this},divide:function(d){return new h(this.x/d,this.y/d)},divideEquals:function(d){return this.x/=d,this.y/=d,this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(d,l){return typeof l>"u"&&(l=.5),l=Math.max(Math.min(1,l),0),new h(this.x+(d.x-this.x)*l,this.y+(d.y-this.y)*l)},distanceFrom:function(d){var l=this.x-d.x,u=this.y-d.y;return Math.sqrt(l*l+u*u)},midPointFrom:function(d){return this.lerp(d)},min:function(d){return new h(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new h(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,l){return this.x=d,this.y=l,this},setX:function(d){return this.x=d,this},setY:function(d){return this.y=d,this},setFromPoint:function(d){return this.x=d.x,this.y=d.y,this},swap:function(d){var l=this.x,u=this.y;this.x=d.x,this.y=d.y,d.x=l,d.y=u},clone:function(){return new h(this.x,this.y)}}}(i),function(a){var s=a.fabric||(a.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function h(d){this.status=d,this.points=[]}s.Intersection=h,s.Intersection.prototype={constructor:h,appendPoint:function(d){return this.points.push(d),this},appendPoints:function(d){return this.points=this.points.concat(d),this}},s.Intersection.intersectLineLine=function(d,l,u,c){var f,v=(c.x-u.x)*(d.y-u.y)-(c.y-u.y)*(d.x-u.x),p=(l.x-d.x)*(d.y-u.y)-(l.y-d.y)*(d.x-u.x),y=(c.y-u.y)*(l.x-d.x)-(c.x-u.x)*(l.y-d.y);if(y!==0){var b=v/y,x=p/y;0<=b&&b<=1&&0<=x&&x<=1?(f=new h("Intersection"),f.appendPoint(new s.Point(d.x+b*(l.x-d.x),d.y+b*(l.y-d.y)))):f=new h}else v===0||p===0?f=new h("Coincident"):f=new h("Parallel");return f},s.Intersection.intersectLinePolygon=function(d,l,u){var c=new h,f=u.length,v,p,y,b;for(b=0;b<f;b++)v=u[b],p=u[(b+1)%f],y=h.intersectLineLine(d,l,v,p),c.appendPoints(y.points);return c.points.length>0&&(c.status="Intersection"),c},s.Intersection.intersectPolygonPolygon=function(d,l){var u=new h,c=d.length,f;for(f=0;f<c;f++){var v=d[f],p=d[(f+1)%c],y=h.intersectLinePolygon(v,p,l);u.appendPoints(y.points)}return u.points.length>0&&(u.status="Intersection"),u},s.Intersection.intersectPolygonRectangle=function(d,l,u){var c=l.min(u),f=l.max(u),v=new s.Point(f.x,c.y),p=new s.Point(c.x,f.y),y=h.intersectLinePolygon(c,v,d),b=h.intersectLinePolygon(v,f,d),x=h.intersectLinePolygon(f,p,d),S=h.intersectLinePolygon(p,c,d),w=new h;return w.appendPoints(y.points),w.appendPoints(b.points),w.appendPoints(x.points),w.appendPoints(S.points),w.points.length>0&&(w.status="Intersection"),w}}(i),function(a){var s=a.fabric||(a.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function h(l){l?this._tryParsingColor(l):this.setSource([0,0,0,1])}s.Color=h,s.Color.prototype={_tryParsingColor:function(l){var u;l in h.colorNameMap&&(l=h.colorNameMap[l]),l==="transparent"&&(u=[255,255,255,0]),u||(u=h.sourceFromHex(l)),u||(u=h.sourceFromRgb(l)),u||(u=h.sourceFromHsl(l)),u||(u=[0,0,0,1]),u&&this.setSource(u)},_rgbToHsl:function(l,u,c){l/=255,u/=255,c/=255;var f,v,p,y=s.util.array.max([l,u,c]),b=s.util.array.min([l,u,c]);if(p=(y+b)/2,y===b)f=v=0;else{var x=y-b;switch(v=p>.5?x/(2-y-b):x/(y+b),y){case l:f=(u-c)/x+(u<c?6:0);break;case u:f=(c-l)/x+2;break;case c:f=(l-u)/x+4;break}f/=6}return[Math.round(f*360),Math.round(v*100),Math.round(p*100)]},getSource:function(){return this._source},setSource:function(l){this._source=l},toRgb:function(){var l=this.getSource();return"rgb("+l[0]+","+l[1]+","+l[2]+")"},toRgba:function(){var l=this.getSource();return"rgba("+l[0]+","+l[1]+","+l[2]+","+l[3]+")"},toHsl:function(){var l=this.getSource(),u=this._rgbToHsl(l[0],l[1],l[2]);return"hsl("+u[0]+","+u[1]+"%,"+u[2]+"%)"},toHsla:function(){var l=this.getSource(),u=this._rgbToHsl(l[0],l[1],l[2]);return"hsla("+u[0]+","+u[1]+"%,"+u[2]+"%,"+l[3]+")"},toHex:function(){var l=this.getSource(),u,c,f;return u=l[0].toString(16),u=u.length===1?"0"+u:u,c=l[1].toString(16),c=c.length===1?"0"+c:c,f=l[2].toString(16),f=f.length===1?"0"+f:f,u.toUpperCase()+c.toUpperCase()+f.toUpperCase()},toHexa:function(){var l=this.getSource(),u;return u=Math.round(l[3]*255),u=u.toString(16),u=u.length===1?"0"+u:u,this.toHex()+u.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(l){var u=this.getSource();return u[3]=l,this.setSource(u),this},toGrayscale:function(){var l=this.getSource(),u=parseInt((l[0]*.3+l[1]*.59+l[2]*.11).toFixed(0),10),c=l[3];return this.setSource([u,u,u,c]),this},toBlackWhite:function(l){var u=this.getSource(),c=(u[0]*.3+u[1]*.59+u[2]*.11).toFixed(0),f=u[3];return l=l||127,c=Number(c)<Number(l)?0:255,this.setSource([c,c,c,f]),this},overlayWith:function(l){l instanceof h||(l=new h(l));var u=[],c=this.getAlpha(),f=.5,v=this.getSource(),p=l.getSource(),y;for(y=0;y<3;y++)u.push(Math.round(v[y]*(1-f)+p[y]*f));return u[3]=c,this.setSource(u),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function d(l,u,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?l+(u-l)*6*c:c<1/2?u:c<2/3?l+(u-l)*(2/3-c)*6:l}s.Color.fromRgb=function(l){return h.fromSource(h.sourceFromRgb(l))},s.Color.sourceFromRgb=function(l){var u=l.match(h.reRGBa);if(u){var c=parseInt(u[1],10)/(/%$/.test(u[1])?100:1)*(/%$/.test(u[1])?255:1),f=parseInt(u[2],10)/(/%$/.test(u[2])?100:1)*(/%$/.test(u[2])?255:1),v=parseInt(u[3],10)/(/%$/.test(u[3])?100:1)*(/%$/.test(u[3])?255:1);return[parseInt(c,10),parseInt(f,10),parseInt(v,10),u[4]?parseFloat(u[4]):1]}},s.Color.fromRgba=h.fromRgb,s.Color.fromHsl=function(l){return h.fromSource(h.sourceFromHsl(l))},s.Color.sourceFromHsl=function(l){var u=l.match(h.reHSLa);if(u){var c=(parseFloat(u[1])%360+360)%360/360,f=parseFloat(u[2])/(/%$/.test(u[2])?100:1),v=parseFloat(u[3])/(/%$/.test(u[3])?100:1),p,y,b;if(f===0)p=y=b=v;else{var x=v<=.5?v*(f+1):v+f-v*f,S=v*2-x;p=d(S,x,c+1/3),y=d(S,x,c),b=d(S,x,c-1/3)}return[Math.round(p*255),Math.round(y*255),Math.round(b*255),u[4]?parseFloat(u[4]):1]}},s.Color.fromHsla=h.fromHsl,s.Color.fromHex=function(l){return h.fromSource(h.sourceFromHex(l))},s.Color.sourceFromHex=function(l){if(l.match(h.reHex)){var u=l.slice(l.indexOf("#")+1),c=u.length===3||u.length===4,f=u.length===8||u.length===4,v=c?u.charAt(0)+u.charAt(0):u.substring(0,2),p=c?u.charAt(1)+u.charAt(1):u.substring(2,4),y=c?u.charAt(2)+u.charAt(2):u.substring(4,6),b=f?c?u.charAt(3)+u.charAt(3):u.substring(6,8):"FF";return[parseInt(v,16),parseInt(p,16),parseInt(y,16),parseFloat((parseInt(b,16)/255).toFixed(2))]}},s.Color.fromSource=function(l){var u=new h;return u.setSource(l),u}}(i),function(a){var s=a.fabric||(a.fabric={}),h=["e","se","s","sw","w","nw","n","ne","e"],d=["ns","nesw","ew","nwse"],l={},u="left",c="top",f="right",v="bottom",p="center",y={top:v,bottom:c,left:f,right:u,center:p},b=s.util.radiansToDegrees,x=Math.sign||function(et){return(et>0)-(et<0)||+et};function S(et,q){var rt=et.angle+b(Math.atan2(q.y,q.x))+360;return Math.round(rt%360/45)}function w(et,q){var rt=q.transform.target,ut=rt.canvas,at=s.util.object.clone(q);at.target=rt,ut&&ut.fire("object:"+et,at),rt.fire(et,q)}function E(et,q){var rt=q.canvas,ut=rt.uniScaleKey,at=et[ut];return rt.uniformScaling&&!at||!rt.uniformScaling&&at}function P(et){return et.originX===p&&et.originY===p}function A(et,q,rt){var ut=et.lockScalingX,at=et.lockScalingY;return!!(ut&&at||!q&&(ut||at)&&rt||ut&&q==="x"||at&&q==="y")}function N(et,q,rt){var ut="not-allowed",at=E(et,rt),dt="";if(q.x!==0&&q.y===0?dt="x":q.x===0&&q.y!==0&&(dt="y"),A(rt,dt,at))return ut;var xt=S(rt,q);return h[xt]+"-resize"}function k(et,q,rt){var ut="not-allowed";if(q.x!==0&&rt.lockSkewingY||q.y!==0&&rt.lockSkewingX)return ut;var at=S(rt,q)%4;return d[at]+"-resize"}function U(et,q,rt){return et[rt.canvas.altActionKey]?l.skewCursorStyleHandler(et,q,rt):l.scaleCursorStyleHandler(et,q,rt)}function j(et,q,rt){var ut=et[rt.canvas.altActionKey];if(q.x===0)return ut?"skewX":"scaleY";if(q.y===0)return ut?"skewY":"scaleX"}function X(et,q,rt){return rt.lockRotation?"not-allowed":q.cursorStyle}function W(et,q,rt,ut){return{e:et,transform:q,pointer:{x:rt,y:ut}}}function Q(et){return function(q,rt,ut,at){var dt=rt.target,xt=dt.getCenterPoint(),Ft=dt.translateToOriginPoint(xt,rt.originX,rt.originY),wt=et(q,rt,ut,at);return dt.setPositionByOrigin(Ft,rt.originX,rt.originY),wt}}function ot(et,q){return function(rt,ut,at,dt){var xt=q(rt,ut,at,dt);return xt&&w(et,W(rt,ut,at,dt)),xt}}function it(et,q,rt,ut,at){var dt=et.target,xt=dt.controls[et.corner],Ft=dt.canvas.getZoom(),wt=dt.padding/Ft,gt=dt.toLocalPoint(new s.Point(ut,at),q,rt);return gt.x>=wt&&(gt.x-=wt),gt.x<=-wt&&(gt.x+=wt),gt.y>=wt&&(gt.y-=wt),gt.y<=wt&&(gt.y+=wt),gt.x-=xt.offsetX,gt.y-=xt.offsetY,gt}function ct(et){return et.flipX!==et.flipY}function O(et,q,rt,ut,at){if(et[q]!==0){var dt=et._getTransformedDimensions()[ut],xt=at/dt*et[rt];et.set(rt,xt)}}function M(et,q,rt,ut){var at=q.target,dt=at._getTransformedDimensions(0,at.skewY),xt=it(q,q.originX,q.originY,rt,ut),Ft=Math.abs(xt.x*2)-dt.x,wt=at.skewX,gt;Ft<2?gt=0:(gt=b(Math.atan2(Ft/at.scaleX,dt.y/at.scaleY)),q.originX===u&&q.originY===v&&(gt=-gt),q.originX===f&&q.originY===c&&(gt=-gt),ct(at)&&(gt=-gt));var Et=wt!==gt;if(Et){var Nt=at._getTransformedDimensions().y;at.set("skewX",gt),O(at,"skewY","scaleY","y",Nt)}return Et}function L(et,q,rt,ut){var at=q.target,dt=at._getTransformedDimensions(at.skewX,0),xt=it(q,q.originX,q.originY,rt,ut),Ft=Math.abs(xt.y*2)-dt.y,wt=at.skewY,gt;Ft<2?gt=0:(gt=b(Math.atan2(Ft/at.scaleY,dt.x/at.scaleX)),q.originX===u&&q.originY===v&&(gt=-gt),q.originX===f&&q.originY===c&&(gt=-gt),ct(at)&&(gt=-gt));var Et=wt!==gt;if(Et){var Nt=at._getTransformedDimensions().x;at.set("skewY",gt),O(at,"skewX","scaleX","x",Nt)}return Et}function H(et,q,rt,ut){var at=q.target,dt=at.skewX,xt,Ft=q.originY;if(at.lockSkewingX)return!1;if(dt===0){var wt=it(q,p,p,rt,ut);wt.x>0?xt=u:xt=f}else dt>0&&(xt=Ft===c?u:f),dt<0&&(xt=Ft===c?f:u),ct(at)&&(xt=xt===u?f:u);q.originX=xt;var gt=ot("skewing",Q(M));return gt(et,q,rt,ut)}function Z(et,q,rt,ut){var at=q.target,dt=at.skewY,xt,Ft=q.originX;if(at.lockSkewingY)return!1;if(dt===0){var wt=it(q,p,p,rt,ut);wt.y>0?xt=c:xt=v}else dt>0&&(xt=Ft===u?c:v),dt<0&&(xt=Ft===u?v:c),ct(at)&&(xt=xt===c?v:c);q.originY=xt;var gt=ot("skewing",Q(L));return gt(et,q,rt,ut)}function G(et,q,rt,ut){var at=q,dt=at.target,xt=dt.translateToOriginPoint(dt.getCenterPoint(),at.originX,at.originY);if(dt.lockRotation)return!1;var Ft=Math.atan2(at.ey-xt.y,at.ex-xt.x),wt=Math.atan2(ut-xt.y,rt-xt.x),gt=b(wt-Ft+at.theta),Et=!0;if(dt.snapAngle>0){var Nt=dt.snapAngle,zt=dt.snapThreshold||Nt,ge=Math.ceil(gt/Nt)*Nt,ie=Math.floor(gt/Nt)*Nt;Math.abs(gt-ie)<zt?gt=ie:Math.abs(gt-ge)<zt&&(gt=ge)}return gt<0&&(gt=360+gt),gt%=360,Et=dt.angle!==gt,dt.angle=gt,Et}function F(et,q,rt,ut,at){at=at||{};var dt=q.target,xt=dt.lockScalingX,Ft=dt.lockScalingY,wt=at.by,gt,Et,Nt,zt,ge=E(et,dt),ie=A(dt,wt,ge),Me,_e,zi=q.gestureScale;if(ie)return!1;if(zi)Et=q.scaleX*zi,Nt=q.scaleY*zi;else{if(gt=it(q,q.originX,q.originY,rt,ut),Me=wt!=="y"?x(gt.x):1,_e=wt!=="x"?x(gt.y):1,q.signX||(q.signX=Me),q.signY||(q.signY=_e),dt.lockScalingFlip&&(q.signX!==Me||q.signY!==_e))return!1;if(zt=dt._getTransformedDimensions(),ge&&!wt){var Ir=Math.abs(gt.x)+Math.abs(gt.y),mi=q.original,va=Math.abs(zt.x*mi.scaleX/dt.scaleX)+Math.abs(zt.y*mi.scaleY/dt.scaleY),ms=Ir/va;Et=mi.scaleX*ms,Nt=mi.scaleY*ms}else Et=Math.abs(gt.x*dt.scaleX/zt.x),Nt=Math.abs(gt.y*dt.scaleY/zt.y);P(q)&&(Et*=2,Nt*=2),q.signX!==Me&&wt!=="y"&&(q.originX=y[q.originX],Et*=-1,q.signX=Me),q.signY!==_e&&wt!=="x"&&(q.originY=y[q.originY],Nt*=-1,q.signY=_e)}var _a=dt.scaleX,ya=dt.scaleY;return wt?(wt==="x"&&dt.set("scaleX",Et),wt==="y"&&dt.set("scaleY",Nt)):(!xt&&dt.set("scaleX",Et),!Ft&&dt.set("scaleY",Nt)),_a!==dt.scaleX||ya!==dt.scaleY}function Y(et,q,rt,ut){return F(et,q,rt,ut)}function R(et,q,rt,ut){return F(et,q,rt,ut,{by:"x"})}function z(et,q,rt,ut){return F(et,q,rt,ut,{by:"y"})}function $(et,q,rt,ut){return et[q.target.canvas.altActionKey]?l.skewHandlerX(et,q,rt,ut):l.scalingY(et,q,rt,ut)}function st(et,q,rt,ut){return et[q.target.canvas.altActionKey]?l.skewHandlerY(et,q,rt,ut):l.scalingX(et,q,rt,ut)}function nt(et,q,rt,ut){var at=q.target,dt=it(q,q.originX,q.originY,rt,ut),xt=at.strokeWidth/(at.strokeUniform?at.scaleX:1),Ft=P(q)?2:1,wt=at.width,gt=Math.abs(dt.x*Ft/at.scaleX)-xt;return at.set("width",Math.max(gt,0)),wt!==gt}function ft(et,q,rt,ut){var at=q.target,dt=rt-q.offsetX,xt=ut-q.offsetY,Ft=!at.get("lockMovementX")&&at.left!==dt,wt=!at.get("lockMovementY")&&at.top!==xt;return Ft&&at.set("left",dt),wt&&at.set("top",xt),(Ft||wt)&&w("moving",W(et,q,rt,ut)),Ft||wt}l.scaleCursorStyleHandler=N,l.skewCursorStyleHandler=k,l.scaleSkewCursorStyleHandler=U,l.rotationWithSnapping=ot("rotating",Q(G)),l.scalingEqually=ot("scaling",Q(Y)),l.scalingX=ot("scaling",Q(R)),l.scalingY=ot("scaling",Q(z)),l.scalingYOrSkewingX=$,l.scalingXOrSkewingY=st,l.changeWidth=ot("resizing",Q(nt)),l.skewHandlerX=H,l.skewHandlerY=Z,l.dragHandler=ft,l.scaleOrSkewActionName=j,l.rotationStyleHandler=X,l.fireEvent=w,l.wrapWithFixedAnchor=Q,l.wrapWithFireEvent=ot,l.getLocalPoint=it,s.controlsUtils=l}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.degreesToRadians,d=s.controlsUtils;function l(c,f,v,p,y){p=p||{};var b=this.sizeX||p.cornerSize||y.cornerSize,x=this.sizeY||p.cornerSize||y.cornerSize,S=typeof p.transparentCorners<"u"?p.transparentCorners:y.transparentCorners,w=S?"stroke":"fill",E=!S&&(p.cornerStrokeColor||y.cornerStrokeColor),P=f,A=v,N;c.save(),c.fillStyle=p.cornerColor||y.cornerColor,c.strokeStyle=p.cornerStrokeColor||y.cornerStrokeColor,b>x?(N=b,c.scale(1,x/b),A=v*b/x):x>b?(N=x,c.scale(b/x,1),P=f*x/b):N=b,c.lineWidth=1,c.beginPath(),c.arc(P,A,N/2,0,2*Math.PI,!1),c[w](),E&&c.stroke(),c.restore()}function u(c,f,v,p,y){p=p||{};var b=this.sizeX||p.cornerSize||y.cornerSize,x=this.sizeY||p.cornerSize||y.cornerSize,S=typeof p.transparentCorners<"u"?p.transparentCorners:y.transparentCorners,w=S?"stroke":"fill",E=!S&&(p.cornerStrokeColor||y.cornerStrokeColor),P=b/2,A=x/2;c.save(),c.fillStyle=p.cornerColor||y.cornerColor,c.strokeStyle=p.cornerStrokeColor||y.cornerStrokeColor,c.lineWidth=1,c.translate(f,v),c.rotate(h(y.angle)),c[w+"Rect"](-P,-A,b,x),E&&c.strokeRect(-P,-A,b,x),c.restore()}d.renderCircleControl=l,d.renderSquareControl=u}(i),function(a){var s=a.fabric||(a.fabric={});function h(d){for(var l in d)this[l]=d[l]}s.Control=h,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(d,l){return l.cursorStyle},getActionName:function(d,l){return l.actionName},getVisibility:function(d,l){var u=d._controlsVisibility;return u&&typeof u[l]<"u"?u[l]:this.visible},setVisibility:function(d){this.visible=d},positionHandler:function(d,l){var u=s.util.transformPoint({x:this.x*d.x+this.offsetX,y:this.y*d.y+this.offsetY},l);return u},calcCornerCoords:function(d,l,u,c,f){var v,p,y,b,x=f?this.touchSizeX:this.sizeX,S=f?this.touchSizeY:this.sizeY;if(x&&S&&x!==S){var w=Math.atan2(S,x),E=Math.sqrt(x*x+S*S)/2,P=w-s.util.degreesToRadians(d),A=Math.PI/2-w-s.util.degreesToRadians(d);v=E*s.util.cos(P),p=E*s.util.sin(P),y=E*s.util.cos(A),b=E*s.util.sin(A)}else{var N=x&&S?x:l;E=N*.7071067812;var P=s.util.degreesToRadians(45-d);v=y=E*s.util.cos(P),p=b=E*s.util.sin(P)}return{tl:{x:u-b,y:c-y},tr:{x:u+v,y:c-p},bl:{x:u-v,y:c+p},br:{x:u+b,y:c+y}}},render:function(d,l,u,c,f){switch(c=c||{},c.cornerStyle||f.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,d,l,u,c,f);break;default:s.controlsUtils.renderSquareControl.call(this,d,l,u,c,f)}}}}(i),function(){function a(u,c){var f=u.getAttribute("style"),v=u.getAttribute("offset")||0,p,y,b,x;if(v=parseFloat(v)/(/%$/.test(v)?100:1),v=v<0?0:v>1?1:v,f){var S=f.split(/\s*;\s*/);for(S[S.length-1]===""&&S.pop(),x=S.length;x--;){var w=S[x].split(/\s*:\s*/),E=w[0].trim(),P=w[1].trim();E==="stop-color"?p=P:E==="stop-opacity"&&(b=P)}}return p||(p=u.getAttribute("stop-color")||"rgb(0,0,0)"),b||(b=u.getAttribute("stop-opacity")),p=new t.Color(p),y=p.getAlpha(),b=isNaN(parseFloat(b))?1:parseFloat(b),b*=y*c,{offset:v,color:p.toRgb(),opacity:b}}function s(u){return{x1:u.getAttribute("x1")||0,y1:u.getAttribute("y1")||0,x2:u.getAttribute("x2")||"100%",y2:u.getAttribute("y2")||0}}function h(u){return{x1:u.getAttribute("fx")||u.getAttribute("cx")||"50%",y1:u.getAttribute("fy")||u.getAttribute("cy")||"50%",r1:0,x2:u.getAttribute("cx")||"50%",y2:u.getAttribute("cy")||"50%",r2:u.getAttribute("r")||"50%"}}var d=t.util.object.clone;t.Gradient=t.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(u){u||(u={}),u.coords||(u.coords={});var c,f=this;Object.keys(u).forEach(function(v){f[v]=u[v]}),this.id?this.id+="_"+t.Object.__uid++:this.id=t.Object.__uid++,c={x1:u.coords.x1||0,y1:u.coords.y1||0,x2:u.coords.x2||0,y2:u.coords.y2||0},this.type==="radial"&&(c.r1=u.coords.r1||0,c.r2=u.coords.r2||0),this.coords=c,this.colorStops=u.colorStops.slice()},addColorStop:function(u){for(var c in u){var f=new t.Color(u[c]);this.colorStops.push({offset:parseFloat(c),color:f.toRgb(),opacity:f.getAlpha()})}return this},toObject:function(u){var c={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return t.util.populateWithProperties(this,c,u),c},toSVG:function(u,y){var f=d(this.coords,!0),v,p,y=y||{},b,x,S=d(this.colorStops,!0),w=f.r1>f.r2,E=this.gradientTransform?this.gradientTransform.concat():t.iMatrix.concat(),P=-this.offsetX,A=-this.offsetY,N=!!y.additionalTransform,k=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(S.sort(function(Q,ot){return Q.offset-ot.offset}),k==="objectBoundingBox"?(P/=u.width,A/=u.height):(P+=u.width/2,A+=u.height/2),u.type==="path"&&this.gradientUnits!=="percentage"&&(P-=u.pathOffset.x,A-=u.pathOffset.y),E[4]-=P,E[5]-=A,x='id="SVGID_'+this.id+'" gradientUnits="'+k+'"',x+=' gradientTransform="'+(N?y.additionalTransform+" ":"")+t.util.matrixToSVG(E)+'" ',this.type==="linear"?b=["<linearGradient ",x,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(b=["<radialGradient ",x,' cx="',w?f.x1:f.x2,'" cy="',w?f.y1:f.y2,'" r="',w?f.r1:f.r2,'" fx="',w?f.x2:f.x1,'" fy="',w?f.y2:f.y1,`">
`]),this.type==="radial"){if(w)for(S=S.concat(),S.reverse(),v=0,p=S.length;v<p;v++)S[v].offset=1-S[v].offset;var U=Math.min(f.r1,f.r2);if(U>0){var j=Math.max(f.r1,f.r2),X=U/j;for(v=0,p=S.length;v<p;v++)S[v].offset+=X*(1-S[v].offset)}}for(v=0,p=S.length;v<p;v++){var W=S[v];b.push("<stop ",'offset="',W.offset*100+"%",'" style="stop-color:',W.color,typeof W.opacity<"u"?";stop-opacity: "+W.opacity:";",`"/>
`)}return b.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),b.join("")},toLive:function(u){var c,f=t.util.object.clone(this.coords),v,p;if(this.type){for(this.type==="linear"?c=u.createLinearGradient(f.x1,f.y1,f.x2,f.y2):this.type==="radial"&&(c=u.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2)),v=0,p=this.colorStops.length;v<p;v++){var y=this.colorStops[v].color,b=this.colorStops[v].opacity,x=this.colorStops[v].offset;typeof b<"u"&&(y=new t.Color(y).setAlpha(b).toRgba()),c.addColorStop(x,y)}return c}}}),t.util.object.extend(t.Gradient,{fromElement:function(u,c,f,v){var p=parseFloat(f)/(/%$/.test(f)?100:1);p=p<0?0:p>1?1:p,isNaN(p)&&(p=1);var y=u.getElementsByTagName("stop"),b,x=u.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",S=u.getAttribute("gradientTransform")||"",w=[],E,P,A=0,N=0,k;for(u.nodeName==="linearGradient"||u.nodeName==="LINEARGRADIENT"?(b="linear",E=s(u)):(b="radial",E=h(u)),P=y.length;P--;)w.push(a(y[P],p));k=t.parseTransformAttribute(S),l(c,E,v,x),x==="pixels"&&(A=-c.left,N=-c.top);var U=new t.Gradient({id:u.getAttribute("id"),type:b,coords:E,colorStops:w,gradientUnits:x,gradientTransform:k,offsetX:A,offsetY:N});return U}});function l(u,c,f,v){var p,y;Object.keys(c).forEach(function(b){p=c[b],p==="Infinity"?y=1:p==="-Infinity"?y=0:(y=parseFloat(c[b],10),typeof p=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(p)&&(y*=.01,v==="pixels"&&((b==="x1"||b==="x2"||b==="r2")&&(y*=f.viewBoxWidth||f.width),(b==="y1"||b==="y2")&&(y*=f.viewBoxHeight||f.height)))),c[b]=y})}}(),function(){var a=t.util.toFixed;t.Pattern=t.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,h){if(s||(s={}),this.id=t.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){h&&h(this);return}else{var d=this;this.source=t.util.createImage(),t.util.loadImage(s.source,function(l,u){d.source=l,h&&h(d,u)},null,this.crossOrigin)}},toObject:function(s){var h=t.Object.NUM_FRACTION_DIGITS,d,l;return typeof this.source.src=="string"?d=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(d=this.source.toDataURL()),l={type:"pattern",source:d,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:a(this.offsetX,h),offsetY:a(this.offsetY,h),patternTransform:this.patternTransform?this.patternTransform.concat():null},t.util.populateWithProperties(this,l,s),l},toSVG:function(s){var h=typeof this.source=="function"?this.source():this.source,d=h.width/s.width,l=h.height/s.height,u=this.offsetX/s.width,c=this.offsetY/s.height,f="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(l=1,c&&(l+=Math.abs(c))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(d=1,u&&(d+=Math.abs(u))),h.src?f=h.src:h.toDataURL&&(f=h.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+u+'" y="'+c+'" width="'+d+'" height="'+l+`">
<image x="0" y="0" width="`+h.width+'" height="'+h.height+'" xlink:href="'+f+`"></image>
</pattern>
`},setOptions:function(s){for(var h in s)this[h]=s[h]},toLive:function(s){var h=this.source;return!h||typeof h.src<"u"&&(!h.complete||h.naturalWidth===0||h.naturalHeight===0)?"":s.createPattern(h,this.repeat)}})}(),function(a){var s=a.fabric||(a.fabric={}),h=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(d){typeof d=="string"&&(d=this._parseShadow(d));for(var l in d)this[l]=d[l];this.id=s.Object.__uid++},_parseShadow:function(d){var l=d.trim(),u=s.Shadow.reOffsetsAndBlur.exec(l)||[],c=l.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:c.trim(),offsetX:parseFloat(u[1],10)||0,offsetY:parseFloat(u[2],10)||0,blur:parseFloat(u[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(d){var l=40,u=40,c=s.Object.NUM_FRACTION_DIGITS,f=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-d.angle)),v=20,p=new s.Color(this.color);return d.width&&d.height&&(l=h((Math.abs(f.x)+this.blur)/d.width,c)*100+v,u=h((Math.abs(f.y)+this.blur)/d.height,c)*100+v),d.flipX&&(f.x*=-1),d.flipY&&(f.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+u+'%" height="'+(100+2*u)+'%" x="-'+l+'%" width="'+(100+2*l)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+h(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+h(f.x,c)+'" dy="'+h(f.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+p.toRgb()+'" flood-opacity="'+p.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var d={},l=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(u){this[u]!==l[u]&&(d[u]=this[u])},this),d}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(i),function(){if(t.StaticCanvas){t.warn("fabric.StaticCanvas is already defined.");return}var a=t.util.object.extend,s=t.util.getElementOffset,h=t.util.removeFromArray,d=t.util.toFixed,l=t.util.transformPoint,u=t.util.invertTransform,c=t.util.getNodeCanvas,f=t.util.createCanvasElement,v=new Error("Could not initialize `canvas` element");t.StaticCanvas=t.util.createClass(t.CommonMethods,{initialize:function(p,y){y||(y={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(p,y)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:t.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(p,y){var b=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(p),this._initOptions(y),this.interactive||this._initRetinaScaling(),y.overlayImage&&this.setOverlayImage(y.overlayImage,b),y.backgroundImage&&this.setBackgroundImage(y.backgroundImage,b),y.backgroundColor&&this.setBackgroundColor(y.backgroundColor,b),y.overlayColor&&this.setOverlayColor(y.overlayColor,b),this.calcOffset()},_isRetinaScaling:function(){return t.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,t.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var p=t.devicePixelRatio;this.__initRetinaScaling(p,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(p,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(p,y,b){y.setAttribute("width",this.width*p),y.setAttribute("height",this.height*p),b.scale(p,p)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(p,y,b){return this.__setBgOverlayImage("overlayImage",p,y,b)},setBackgroundImage:function(p,y,b){return this.__setBgOverlayImage("backgroundImage",p,y,b)},setOverlayColor:function(p,y){return this.__setBgOverlayColor("overlayColor",p,y)},setBackgroundColor:function(p,y){return this.__setBgOverlayColor("backgroundColor",p,y)},__setBgOverlayImage:function(p,y,b,x){return typeof y=="string"?t.util.loadImage(y,function(S,w){if(S){var E=new t.Image(S,x);this[p]=E,E.canvas=this}b&&b(S,w)},this,x&&x.crossOrigin):(x&&y.setOptions(x),this[p]=y,y&&(y.canvas=this),b&&b(y,!1)),this},__setBgOverlayColor:function(p,y,b){return this[p]=y,this._initGradient(y,p),this._initPattern(y,p,b),this},_createCanvasElement:function(){var p=f();if(!p||(p.style||(p.style={}),typeof p.getContext>"u"))throw v;return p},_initOptions:function(p){var y=this.lowerCanvasEl;this._setOptions(p),this.width=this.width||parseInt(y.width,10)||0,this.height=this.height||parseInt(y.height,10)||0,this.lowerCanvasEl.style&&(y.width=this.width,y.height=this.height,y.style.width=this.width+"px",y.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(p){p&&p.getContext?this.lowerCanvasEl=p:this.lowerCanvasEl=t.util.getById(p)||this._createCanvasElement(),t.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(p,y){return this.setDimensions({width:p},y)},setHeight:function(p,y){return this.setDimensions({height:p},y)},setDimensions:function(p,y){var b;y=y||{};for(var x in p)b=p[x],y.cssOnly||(this._setBackstoreDimension(x,p[x]),b+="px",this.hasLostContext=!0),y.backstoreOnly||this._setCssDimension(x,b);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),y.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(p,y){return this.lowerCanvasEl[p]=y,this.upperCanvasEl&&(this.upperCanvasEl[p]=y),this.cacheCanvasEl&&(this.cacheCanvasEl[p]=y),this[p]=y,this},_setCssDimension:function(p,y){return this.lowerCanvasEl.style[p]=y,this.upperCanvasEl&&(this.upperCanvasEl.style[p]=y),this.wrapperEl&&(this.wrapperEl.style[p]=y),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(p){var y=this._activeObject,b=this.backgroundImage,x=this.overlayImage,S,w,E;for(this.viewportTransform=p,w=0,E=this._objects.length;w<E;w++)S=this._objects[w],S.group||S.setCoords(!0);return y&&y.setCoords(),b&&b.setCoords(!0),x&&x.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(p,y){var b=p,x=this.viewportTransform.slice(0);p=l(p,u(this.viewportTransform)),x[0]=y,x[3]=y;var S=l(p,x);return x[4]+=b.x-S.x,x[5]+=b.y-S.y,this.setViewportTransform(x)},setZoom:function(p){return this.zoomToPoint(new t.Point(0,0),p),this},absolutePan:function(p){var y=this.viewportTransform.slice(0);return y[4]=-p.x,y[5]=-p.y,this.setViewportTransform(y)},relativePan:function(p){return this.absolutePan(new t.Point(-p.x-this.viewportTransform[4],-p.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(p){this.stateful&&p.setupState(),p._set("canvas",this),p.setCoords(),this.fire("object:added",{target:p}),p.fire("added")},_onObjectRemoved:function(p){this.fire("object:removed",{target:p}),p.fire("removed"),delete p.canvas},clearContext:function(p){return p.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var p=this.contextContainer;return this.renderCanvas(p,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=t.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var p={},y=this.width,b=this.height,x=u(this.viewportTransform);return p.tl=l({x:0,y:0},x),p.br=l({x:y,y:b},x),p.tr=new t.Point(p.br.x,p.tl.y),p.bl=new t.Point(p.tl.x,p.br.y),this.vptCoords=p,p},cancelRequestedRender:function(){this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(p,y){var b=this.viewportTransform,x=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(p),t.util.setImageSmoothing(p,this.imageSmoothingEnabled),this.fire("before:render",{ctx:p}),this._renderBackground(p),p.save(),p.transform(b[0],b[1],b[2],b[3],b[4],b[5]),this._renderObjects(p,y),p.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(p),x&&(x.canvas=this,x.shouldCache(),x._transformDone=!0,x.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(p)),this._renderOverlay(p),this.controlsAboveOverlay&&this.interactive&&this.drawControls(p),this.fire("after:render",{ctx:p})},drawClipPathOnCanvas:function(p){var y=this.viewportTransform,b=this.clipPath;p.save(),p.transform(y[0],y[1],y[2],y[3],y[4],y[5]),p.globalCompositeOperation="destination-in",b.transform(p),p.scale(1/b.zoomX,1/b.zoomY),p.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY),p.restore()},_renderObjects:function(p,y){var b,x;for(b=0,x=y.length;b<x;++b)y[b]&&y[b].render(p)},_renderBackgroundOrOverlay:function(p,y){var b=this[y+"Color"],x=this[y+"Image"],S=this.viewportTransform,w=this[y+"Vpt"];if(!(!b&&!x)){if(b){p.save(),p.beginPath(),p.moveTo(0,0),p.lineTo(this.width,0),p.lineTo(this.width,this.height),p.lineTo(0,this.height),p.closePath(),p.fillStyle=b.toLive?b.toLive(p,this):b,w&&p.transform(S[0],S[1],S[2],S[3],S[4],S[5]),p.transform(1,0,0,1,b.offsetX||0,b.offsetY||0);var E=b.gradientTransform||b.patternTransform;E&&p.transform(E[0],E[1],E[2],E[3],E[4],E[5]),p.fill(),p.restore()}x&&(p.save(),w&&p.transform(S[0],S[1],S[2],S[3],S[4],S[5]),x.render(p),p.restore())}},_renderBackground:function(p){this._renderBackgroundOrOverlay(p,"background")},_renderOverlay:function(p){this._renderBackgroundOrOverlay(p,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new t.Point(this.width/2,this.height/2)},centerObjectH:function(p){return this._centerObject(p,new t.Point(this.getCenterPoint().x,p.getCenterPoint().y))},centerObjectV:function(p){return this._centerObject(p,new t.Point(p.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(p){var y=this.getCenterPoint();return this._centerObject(p,y)},viewportCenterObject:function(p){var y=this.getVpCenter();return this._centerObject(p,y)},viewportCenterObjectH:function(p){var y=this.getVpCenter();return this._centerObject(p,new t.Point(y.x,p.getCenterPoint().y)),this},viewportCenterObjectV:function(p){var y=this.getVpCenter();return this._centerObject(p,new t.Point(p.getCenterPoint().x,y.y))},getVpCenter:function(){var p=this.getCenterPoint(),y=u(this.viewportTransform);return l(p,y)},_centerObject:function(p,y){return p.setPositionByOrigin(y,"center","center"),p.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(p){return this.toDatalessObject(p)},toObject:function(p){return this._toObjectMethod("toObject",p)},toDatalessObject:function(p){return this._toObjectMethod("toDatalessObject",p)},_toObjectMethod:function(p,y){var b=this.clipPath,x={version:t.version,objects:this._toObjects(p,y)};return b&&!b.excludeFromExport&&(x.clipPath=this._toObject(this.clipPath,p,y)),a(x,this.__serializeBgOverlay(p,y)),t.util.populateWithProperties(this,x,y),x},_toObjects:function(p,y){return this._objects.filter(function(b){return!b.excludeFromExport}).map(function(b){return this._toObject(b,p,y)},this)},_toObject:function(p,y,b){var x;this.includeDefaultValues||(x=p.includeDefaultValues,p.includeDefaultValues=!1);var S=p[y](b);return this.includeDefaultValues||(p.includeDefaultValues=x),S},__serializeBgOverlay:function(p,y){var b={},x=this.backgroundImage,S=this.overlayImage,w=this.backgroundColor,E=this.overlayColor;return w&&w.toObject?w.excludeFromExport||(b.background=w.toObject(y)):w&&(b.background=w),E&&E.toObject?E.excludeFromExport||(b.overlay=E.toObject(y)):E&&(b.overlay=E),x&&!x.excludeFromExport&&(b.backgroundImage=this._toObject(x,p,y)),S&&!S.excludeFromExport&&(b.overlayImage=this._toObject(S,p,y)),b},svgViewportTransformation:!0,toSVG:function(p,y){p||(p={}),p.reviver=y;var b=[];return this._setSVGPreamble(b,p),this._setSVGHeader(b,p),this.clipPath&&b.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(b,"background"),this._setSVGBgOverlayImage(b,"backgroundImage",y),this._setSVGObjects(b,y),this.clipPath&&b.push(`</g>
`),this._setSVGBgOverlayColor(b,"overlay"),this._setSVGBgOverlayImage(b,"overlayImage",y),b.push("</svg>"),b.join("")},_setSVGPreamble:function(p,y){y.suppressPreamble||p.push('<?xml version="1.0" encoding="',y.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(p,y){var b=y.width||this.width,x=y.height||this.height,S,w='viewBox="0 0 '+this.width+" "+this.height+'" ',E=t.Object.NUM_FRACTION_DIGITS;y.viewBox?w='viewBox="'+y.viewBox.x+" "+y.viewBox.y+" "+y.viewBox.width+" "+y.viewBox.height+'" ':this.svgViewportTransformation&&(S=this.viewportTransform,w='viewBox="'+d(-S[4]/S[0],E)+" "+d(-S[5]/S[3],E)+" "+d(this.width/S[0],E)+" "+d(this.height/S[3],E)+'" '),p.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',b,'" ','height="',x,'" ',w,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",t.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(y),`</defs>
`)},createSVGClipPathMarkup:function(p){var y=this.clipPath;return y?(y.clipPathId="CLIPPATH_"+t.Object.__uid++,'<clipPath id="'+y.clipPathId+`" >
`+this.clipPath.toClipPathSVG(p.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var p=this,y=["background","overlay"].map(function(b){var x=p[b+"Color"];if(x&&x.toLive){var S=p[b+"Vpt"],w=p.viewportTransform,E={width:p.width/(S?w[0]:1),height:p.height/(S?w[3]:1)};return x.toSVG(E,{additionalTransform:S?t.util.matrixToSVG(w):""})}});return y.join("")},createSVGFontFacesMarkup:function(){var p="",y={},b,x,S,w,E,P,A,N,k,U=t.fontPaths,j=[];for(this._objects.forEach(function W(Q){j.push(Q),Q._objects&&Q._objects.forEach(W)}),N=0,k=j.length;N<k;N++)if(b=j[N],x=b.fontFamily,!(b.type.indexOf("text")===-1||y[x]||!U[x])&&(y[x]=!0,!!b.styles)){S=b.styles;for(E in S){w=S[E];for(A in w)P=w[A],x=P.fontFamily,!y[x]&&U[x]&&(y[x]=!0)}}for(var X in y)p+=[`		@font-face {
`,"			font-family: '",X,`';
`,"			src: url('",U[X],`');
`,`		}
`].join("");return p&&(p=['	<style type="text/css">',`<![CDATA[
`,p,"]]>",`</style>
`].join("")),p},_setSVGObjects:function(p,y){var b,x,S,w=this._objects;for(x=0,S=w.length;x<S;x++)b=w[x],!b.excludeFromExport&&this._setSVGObject(p,b,y)},_setSVGObject:function(p,y,b){p.push(y.toSVG(b))},_setSVGBgOverlayImage:function(p,y,b){this[y]&&!this[y].excludeFromExport&&this[y].toSVG&&p.push(this[y].toSVG(b))},_setSVGBgOverlayColor:function(p,y){var b=this[y+"Color"],x=this.viewportTransform,S=this.width,w=this.height;if(b)if(b.toLive){var E=b.repeat,P=t.util.invertTransform(x),A=this[y+"Vpt"],N=A?t.util.matrixToSVG(P):"";p.push('<rect transform="'+N+" translate(",S/2,",",w/2,')"',' x="',b.offsetX-S/2,'" y="',b.offsetY-w/2,'" ','width="',E==="repeat-y"||E==="no-repeat"?b.source.width:S,'" height="',E==="repeat-x"||E==="no-repeat"?b.source.height:w,'" fill="url(#SVGID_'+b.id+')"',`></rect>
`)}else p.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',b,'"',`></rect>
`)},sendToBack:function(p){if(!p)return this;var y=this._activeObject,b,x,S;if(p===y&&p.type==="activeSelection")for(S=y._objects,b=S.length;b--;)x=S[b],h(this._objects,x),this._objects.unshift(x);else h(this._objects,p),this._objects.unshift(p);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(p){if(!p)return this;var y=this._activeObject,b,x,S;if(p===y&&p.type==="activeSelection")for(S=y._objects,b=0;b<S.length;b++)x=S[b],h(this._objects,x),this._objects.push(x);else h(this._objects,p),this._objects.push(p);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(p,y){if(!p)return this;var b=this._activeObject,x,S,w,E,P,A=0;if(p===b&&p.type==="activeSelection")for(P=b._objects,x=0;x<P.length;x++)S=P[x],w=this._objects.indexOf(S),w>0+A&&(E=w-1,h(this._objects,S),this._objects.splice(E,0,S)),A++;else w=this._objects.indexOf(p),w!==0&&(E=this._findNewLowerIndex(p,w,y),h(this._objects,p),this._objects.splice(E,0,p));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(p,y,b){var x,S;if(b)for(x=y,S=y-1;S>=0;--S){var w=p.intersectsWithObject(this._objects[S])||p.isContainedWithinObject(this._objects[S])||this._objects[S].isContainedWithinObject(p);if(w){x=S;break}}else x=y-1;return x},bringForward:function(p,y){if(!p)return this;var b=this._activeObject,x,S,w,E,P,A=0;if(p===b&&p.type==="activeSelection")for(P=b._objects,x=P.length;x--;)S=P[x],w=this._objects.indexOf(S),w<this._objects.length-1-A&&(E=w+1,h(this._objects,S),this._objects.splice(E,0,S)),A++;else w=this._objects.indexOf(p),w!==this._objects.length-1&&(E=this._findNewUpperIndex(p,w,y),h(this._objects,p),this._objects.splice(E,0,p));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(p,y,b){var x,S,w;if(b)for(x=y,S=y+1,w=this._objects.length;S<w;++S){var E=p.intersectsWithObject(this._objects[S])||p.isContainedWithinObject(this._objects[S])||this._objects[S].isContainedWithinObject(p);if(E){x=S;break}}else x=y+1;return x},moveTo:function(p,y){return h(this._objects,p),this._objects.splice(y,0,p),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(t.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(p){p.dispose&&p.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),t.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),t.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),a(t.StaticCanvas.prototype,t.Observable),a(t.StaticCanvas.prototype,t.Collection),a(t.StaticCanvas.prototype,t.DataURLExporter),a(t.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(p){var y=f();if(!y||!y.getContext)return null;var b=y.getContext("2d");if(!b)return null;switch(p){case"setLineDash":return typeof b.setLineDash<"u";default:return null}}}),t.StaticCanvas.prototype.toJSON=t.StaticCanvas.prototype.toObject,t.isLikelyNode&&(t.StaticCanvas.prototype.createPNGStream=function(){var p=c(this.lowerCanvasEl);return p&&p.createPNGStream()},t.StaticCanvas.prototype.createJPEGStream=function(p){var y=c(this.lowerCanvasEl);return y&&y.createJPEGStream(p)})}(),t.BaseBrush=t.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(a){a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.miterLimit=this.strokeMiterLimit,a.lineJoin=this.strokeLineJoin,a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var s=this.canvas.viewportTransform;a.save(),a.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var a=this.canvas,s=this.shadow,h=a.contextTop,d=a.getZoom();a&&a._isRetinaScaling()&&(d*=t.devicePixelRatio),h.shadowColor=s.color,h.shadowBlur=s.blur*d,h.shadowOffsetX=s.offsetX*d,h.shadowOffsetY=s.offsetY*d}},needsFullRender:function(){var a=new t.Color(this.color);return a.getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_isOutSideCanvas:function(a){return a.x<0||a.x>this.canvas.getWidth()||a.y<0||a.y>this.canvas.getHeight()}}),function(){t.PencilBrush=t.util.createClass(t.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(a){this.canvas=a,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(a,s,h){var d=s.midPointFrom(h);return a.quadraticCurveTo(s.x,s.y,d.x,d.y),d},onMouseDown:function(a,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(a),this._captureDrawingPath(a),this._render())},onMouseMove:function(a,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a))&&this._captureDrawingPath(a)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var h=this._points,d=h.length,l=this.canvas.contextTop;this._saveAndTransform(l),this.oldEnd&&(l.beginPath(),l.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(l,h[d-2],h[d-1],!0),l.stroke(),l.restore()}},onMouseUp:function(a){return this.canvas._isMainEvent(a.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(a){var s=new t.Point(a.x,a.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(a){return this._points.length>1&&a.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(a),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(a){var s=new t.Point(a.x,a.y);return this._addPoint(s)},_render:function(a){var s,h,d=this._points[0],l=this._points[1];if(a=a||this.canvas.contextTop,this._saveAndTransform(a),a.beginPath(),this._points.length===2&&d.x===l.x&&d.y===l.y){var u=this.width/1e3;d=new t.Point(d.x,d.y),l=new t.Point(l.x,l.y),d.x-=u,l.x+=u}for(a.moveTo(d.x,d.y),s=1,h=this._points.length;s<h;s++)this._drawSegment(a,d,l),d=this._points[s],l=this._points[s+1];a.lineTo(d.x,d.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var s=this.width/1e3;return t.util.getSmoothPathFromPoints(a,s)},_isEmptySVGPath:function(a){var s=t.util.joinPath(a);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(a){var s=new t.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new t.Shadow(this.shadow)),s},decimatePoints:function(a,s){if(a.length<=2)return a;var h=this.canvas.getZoom(),d=Math.pow(s/h,2),l,u=a.length-1,c=a[0],f=[c],v;for(l=1;l<u-1;l++)v=Math.pow(c.x-a[l].x,2)+Math.pow(c.y-a[l].y,2),v>=d&&(c=a[l],f.push(c));return f.push(a[u]),f},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var h=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.requestRenderAll(),h.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:h})}})}(),t.CircleBrush=t.util.createClass(t.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var s=this.addPoint(a),h=this.canvas.contextTop;this._saveAndTransform(h),this.dot(h,s),h.restore()},dot:function(a,s){a.fillStyle=s.fill,a.beginPath(),a.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),a.closePath(),a.fill()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},_render:function(){var a=this.canvas.contextTop,s,h,d=this.points;for(this._saveAndTransform(a),s=0,h=d.length;s<h;s++)this.dot(a,d[s]);a.restore()},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(a),this._render()):this.drawDot(a))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove,s,h;this.canvas.renderOnAddRemove=!1;var d=[];for(s=0,h=this.points.length;s<h;s++){var l=this.points[s],u=new t.Circle({radius:l.radius,left:l.x,top:l.y,originX:"center",originY:"center",fill:l.fill});this.shadow&&(u.shadow=new t.Shadow(this.shadow)),d.push(u)}var c=new t.Group(d);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},addPoint:function(a){var s=new t.Point(a.x,a.y),h=t.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new t.Color(this.color).setAlpha(t.util.getRandomInt(0,100)/100).toRgba();return s.radius=h,s.fill=d,this.points.push(s),s}}),t.SprayBrush=t.util.createClass(t.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.addSprayChunk(a),this.render(this.sprayChunkPoints))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],h=0,d=this.sprayChunks.length;h<d;h++)for(var l=this.sprayChunks[h],u=0,c=l.length;u<c;u++){var f=new t.Rect({width:l[u].width,height:l[u].width,left:l[u].x+1,top:l[u].y+1,originX:"center",originY:"center",fill:this.color});s.push(f)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var v=new t.Group(s);this.shadow&&v.set("shadow",new t.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:v}),this.canvas.add(v),this.canvas.fire("path:created",{path:v}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var s={},h,d,l;for(d=0,l=a.length;d<l;d++)h=a[d].left+""+a[d].top,s[h]||(s[h]=a[d]);var u=[];for(h in s)u.push(s[h]);return u},render:function(a){var s=this.canvas.contextTop,h,d;for(s.fillStyle=this.color,this._saveAndTransform(s),h=0,d=a.length;h<d;h++){var l=a[h];typeof l.opacity<"u"&&(s.globalAlpha=l.opacity),s.fillRect(l.x,l.y,l.width,l.width)}s.restore()},_render:function(){var a=this.canvas.contextTop,s,h;for(a.fillStyle=this.color,this._saveAndTransform(a),s=0,h=this.sprayChunks.length;s<h;s++)this.render(this.sprayChunks[s]);a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var s,h,d,l=this.width/2,u;for(u=0;u<this.density;u++){s=t.util.getRandomInt(a.x-l,a.x+l),h=t.util.getRandomInt(a.y-l,a.y+l),this.dotWidthVariance?d=t.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):d=this.dotWidth;var c=new t.Point(s,h);c.width=d,this.randomOpacity&&(c.opacity=t.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),t.PatternBrush=t.util.createClass(t.PencilBrush,{getPatternSrc:function(){var a=20,s=5,h=t.util.createCanvasElement(),d=h.getContext("2d");return h.width=h.height=a+s,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,Math.PI*2,!1),d.closePath(),d.fill(),h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(a){return a.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(a){this.callSuper("_setBrushStyles",a),a.strokeStyle=this.getPattern(a)},createPath:function(a){var s=this.callSuper("createPath",a),h=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new t.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-h.x,offsetY:-h.y}),s}}),function(){var a=t.util.getPointer,s=t.util.degreesToRadians,h=t.util.isTouchEvent;t.Canvas=t.util.createClass(t.StaticCanvas,{initialize:function(l,u){u||(u={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(l,u),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=t.PencilBrush&&new t.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var l=this.getActiveObjects(),u,c,f;if(l.length>0&&!this.preserveObjectStacking){c=[],f=[];for(var v=0,p=this._objects.length;v<p;v++)u=this._objects[v],l.indexOf(u)===-1?c.push(u):f.push(u);l.length>1&&(this._activeObject._objects=f),c.push.apply(c,f)}else c=this._objects;return c},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var l=this.contextContainer;return this.renderCanvas(l,this._chooseObjectsToRender()),this},renderTopLayer:function(l){l.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(l),this.contextTopDirty=!0),l.restore()},renderTop:function(){var l=this.contextTop;return this.clearContext(l),this.renderTopLayer(l),this.fire("after:render"),this},_normalizePointer:function(l,u){var c=l.calcTransformMatrix(),f=t.util.invertTransform(c),v=this.restorePointerVpt(u);return t.util.transformPoint(v,f)},isTargetTransparent:function(l,u,c){if(l.shouldCache()&&l._cacheCanvas&&l!==this._activeObject){var f=this._normalizePointer(l,{x:u,y:c}),v=Math.max(l.cacheTranslationX+f.x*l.zoomX,0),p=Math.max(l.cacheTranslationY+f.y*l.zoomY,0),S=t.util.isTransparent(l._cacheContext,Math.round(v),Math.round(p),this.targetFindTolerance);return S}var y=this.contextCache,b=l.selectionBackgroundColor,x=this.viewportTransform;l.selectionBackgroundColor="",this.clearContext(y),y.save(),y.transform(x[0],x[1],x[2],x[3],x[4],x[5]),l.render(y),y.restore(),l.selectionBackgroundColor=b;var S=t.util.isTransparent(y,u,c,this.targetFindTolerance);return S},_isSelectionKeyPressed:function(l){var u=!1;return Array.isArray(this.selectionKey)?u=!!this.selectionKey.find(function(c){return l[c]===!0}):u=l[this.selectionKey],u},_shouldClearSelection:function(l,u){var c=this.getActiveObjects(),f=this._activeObject;return!u||u&&f&&c.length>1&&c.indexOf(u)===-1&&f!==u&&!this._isSelectionKeyPressed(l)||u&&!u.evented||u&&!u.selectable&&f&&f!==u},_shouldCenterTransform:function(l,u,c){if(l){var f;return u==="scale"||u==="scaleX"||u==="scaleY"||u==="resizing"?f=this.centeredScaling||l.centeredScaling:u==="rotate"&&(f=this.centeredRotation||l.centeredRotation),f?!c:c}},_getOriginFromCorner:function(l,u){var c={x:l.originX,y:l.originY};return u==="ml"||u==="tl"||u==="bl"?c.x="right":(u==="mr"||u==="tr"||u==="br")&&(c.x="left"),u==="tl"||u==="mt"||u==="tr"?c.y="bottom":(u==="bl"||u==="mb"||u==="br")&&(c.y="top"),c},_getActionFromCorner:function(l,u,c,f){if(!u||!l)return"drag";var v=f.controls[u];return v.getActionName(c,v,f)},_setupCurrentTransform:function(l,u,c){if(u){var f=this.getPointer(l),v=u.__corner,p=u.controls[v],y=c&&v?p.getActionHandler(l,u,p):t.controlsUtils.dragHandler,b=this._getActionFromCorner(c,v,l,u),x=this._getOriginFromCorner(u,v),S=l[this.centeredKey],w={target:u,action:b,actionHandler:y,corner:v,scaleX:u.scaleX,scaleY:u.scaleY,skewX:u.skewX,skewY:u.skewY,offsetX:f.x-u.left,offsetY:f.y-u.top,originX:x.x,originY:x.y,ex:f.x,ey:f.y,lastX:f.x,lastY:f.y,theta:s(u.angle),width:u.width*u.scaleX,shiftKey:l.shiftKey,altKey:S,original:t.util.saveObjectTransform(u)};this._shouldCenterTransform(u,b,S)&&(w.originX="center",w.originY="center"),w.original.originX=x.x,w.original.originY=x.y,this._currentTransform=w,this._beforeTransform(l)}},setCursor:function(l){this.upperCanvasEl.style.cursor=l},_drawSelection:function(l){var u=this._groupSelector,c=new t.Point(u.ex,u.ey),f=t.util.transformPoint(c,this.viewportTransform),v=new t.Point(u.ex+u.left,u.ey+u.top),p=t.util.transformPoint(v,this.viewportTransform),y=Math.min(f.x,p.x),b=Math.min(f.y,p.y),x=Math.max(f.x,p.x),S=Math.max(f.y,p.y),w=this.selectionLineWidth/2;this.selectionColor&&(l.fillStyle=this.selectionColor,l.fillRect(y,b,x-y,S-b)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(l.lineWidth=this.selectionLineWidth,l.strokeStyle=this.selectionBorderColor,y+=w,b+=w,x-=w,S-=w,t.Object.prototype._setLineDash.call(this,l,this.selectionDashArray),l.strokeRect(y,b,x-y,S-b))},findTarget:function(l,u){if(!this.skipTargetFind){var c=!0,f=this.getPointer(l,c),v=this._activeObject,p=this.getActiveObjects(),y,b,x=h(l),S=p.length>1&&!u||p.length===1;if(this.targets=[],S&&v._findTargetCorner(f,x)||p.length>1&&!u&&v===this._searchPossibleTargets([v],f))return v;if(p.length===1&&v===this._searchPossibleTargets([v],f))if(this.preserveObjectStacking)y=v,b=this.targets,this.targets=[];else return v;var w=this._searchPossibleTargets(this._objects,f);return l[this.altSelectionKey]&&w&&y&&w!==y&&(w=y,this.targets=b),w}},_checkTarget:function(l,u,c){if(u&&u.visible&&u.evented&&u.containsPoint(l))if((this.perPixelTargetFind||u.perPixelTargetFind)&&!u.isEditing){var f=this.isTargetTransparent(u,c.x,c.y);if(!f)return!0}else return!0},_searchPossibleTargets:function(l,u){for(var c,f=l.length,v;f--;){var p=l[f],y=p.group?this._normalizePointer(p.group,u):u;if(this._checkTarget(y,p,u)){c=l[f],c.subTargetCheck&&c instanceof t.Group&&(v=this._searchPossibleTargets(c._objects,u),v&&this.targets.push(v));break}}return c},restorePointerVpt:function(l){return t.util.transformPoint(l,t.util.invertTransform(this.viewportTransform))},getPointer:function(l,u){if(this._absolutePointer&&!u)return this._absolutePointer;if(this._pointer&&u)return this._pointer;var c=a(l),f=this.upperCanvasEl,v=f.getBoundingClientRect(),p=v.width||0,y=v.height||0,b;(!p||!y)&&("top"in v&&"bottom"in v&&(y=Math.abs(v.top-v.bottom)),"right"in v&&"left"in v&&(p=Math.abs(v.right-v.left))),this.calcOffset(),c.x=c.x-this._offset.left,c.y=c.y-this._offset.top,u||(c=this.restorePointerVpt(c));var x=this.getRetinaScaling();return x!==1&&(c.x/=x,c.y/=x),p===0||y===0?b={width:1,height:1}:b={width:f.width/p,height:f.height/y},{x:c.x*b.width,y:c.y*b.height}},_createUpperCanvas:function(){var l=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),u=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),t.util.addClass(c,"upper-canvas "+l),this.wrapperEl.appendChild(c),this._copyCanvasStyle(u,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=t.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),t.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),t.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(l){var u=this.width||l.width,c=this.height||l.height;t.util.setStyle(l,{position:"absolute",width:u+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),l.width=u,l.height=c,t.util.makeElementUnselectable(l)},_copyCanvasStyle:function(l,u){u.style.cssText=l.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var l=this._activeObject;return l?l.type==="activeSelection"&&l._objects?l._objects.slice(0):[l]:[]},_onObjectRemoved:function(l){l===this._activeObject&&(this.fire("before:selection:cleared",{target:l}),this._discardActiveObject(),this.fire("selection:cleared",{target:l}),l.fire("deselected")),l===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",l)},_fireSelectionEvents:function(l,u){var c=!1,f=this.getActiveObjects(),v=[],p=[];l.forEach(function(y){f.indexOf(y)===-1&&(c=!0,y.fire("deselected",{e:u,target:y}),p.push(y))}),f.forEach(function(y){l.indexOf(y)===-1&&(c=!0,y.fire("selected",{e:u,target:y}),v.push(y))}),l.length>0&&f.length>0?c&&this.fire("selection:updated",{e:u,selected:v,deselected:p}):f.length>0?this.fire("selection:created",{e:u,selected:v}):l.length>0&&this.fire("selection:cleared",{e:u,deselected:p})},setActiveObject:function(l,u){var c=this.getActiveObjects();return this._setActiveObject(l,u),this._fireSelectionEvents(c,u),this},_setActiveObject:function(l,u){return this._activeObject===l||!this._discardActiveObject(u,l)||l.onSelect({e:u})?!1:(this._activeObject=l,!0)},_discardActiveObject:function(l,u){var c=this._activeObject;if(c){if(c.onDeselect({e:l,object:u}))return!1;this._activeObject=null}return!0},discardActiveObject:function(l){var u=this.getActiveObjects(),c=this.getActiveObject();return u.length&&this.fire("before:selection:cleared",{target:c,e:l}),this._discardActiveObject(l),this._fireSelectionEvents(u,l),this},dispose:function(){var l=this.wrapperEl;return this.removeListeners(),l.removeChild(this.upperCanvasEl),l.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(u){t.util.cleanUpJsdomNode(this[u]),this[u]=void 0}.bind(this)),l.parentNode&&l.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,t.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(l){var u=this._activeObject;u&&u._renderControls(l)},_toObject:function(l,u,c){var f=this._realizeGroupTransformOnObject(l),v=this.callSuper("_toObject",l,u,c);return this._unwindGroupTransformOnObject(l,f),v},_realizeGroupTransformOnObject:function(l){if(l.group&&l.group.type==="activeSelection"&&this._activeObject===l.group){var u=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],c={};return u.forEach(function(f){c[f]=l[f]}),t.util.addTransformToObject(l,this._activeObject.calcOwnMatrix()),c}else return null},_unwindGroupTransformOnObject:function(l,u){u&&l.set(u)},_setSVGObject:function(l,u,c){var f=this._realizeGroupTransformOnObject(u);this.callSuper("_setSVGObject",l,u,c),this._unwindGroupTransformOnObject(u,f)},setViewportTransform:function(l){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),t.StaticCanvas.prototype.setViewportTransform.call(this,l)}});for(var d in t.StaticCanvas)d!=="prototype"&&(t.Canvas[d]=t.StaticCanvas[d])}(),function(){var a=t.util.addListener,s=t.util.removeListener,h=3,d=2,l=1,u={passive:!1};function c(f,v){return f.button&&f.button===v-1}t.util.object.extend(t.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(a,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(f,v){var p=this.upperCanvasEl,y=this._getEventPrefix();f(t.window,"resize",this._onResize),f(p,y+"down",this._onMouseDown),f(p,y+"move",this._onMouseMove,u),f(p,y+"out",this._onMouseOut),f(p,y+"enter",this._onMouseEnter),f(p,"wheel",this._onMouseWheel),f(p,"contextmenu",this._onContextMenu),f(p,"dblclick",this._onDoubleClick),f(p,"dragover",this._onDragOver),f(p,"dragenter",this._onDragEnter),f(p,"dragleave",this._onDragLeave),f(p,"drop",this._onDrop),this.enablePointerEvents||f(p,"touchstart",this._onTouchStart,u),typeof eventjs<"u"&&v in eventjs&&(eventjs[v](p,"gesture",this._onGesture),eventjs[v](p,"drag",this._onDrag),eventjs[v](p,"orientation",this._onOrientationChange),eventjs[v](p,"shake",this._onShake),eventjs[v](p,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var f=this._getEventPrefix();s(t.document,f+"up",this._onMouseUp),s(t.document,"touchend",this._onTouchEnd,u),s(t.document,f+"move",this._onMouseMove,u),s(t.document,"touchmove",this._onMouseMove,u)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(f,v){this.__onTransformGesture&&this.__onTransformGesture(f,v)},_onDrag:function(f,v){this.__onDrag&&this.__onDrag(f,v)},_onMouseWheel:function(f){this.__onMouseWheel(f)},_onMouseOut:function(f){var v=this._hoveredTarget;this.fire("mouse:out",{target:v,e:f}),this._hoveredTarget=null,v&&v.fire("mouseout",{e:f});var p=this;this._hoveredTargets.forEach(function(y){p.fire("mouse:out",{target:v,e:f}),y&&v.fire("mouseout",{e:f})}),this._hoveredTargets=[]},_onMouseEnter:function(f){!this._currentTransform&&!this.findTarget(f)&&(this.fire("mouse:over",{target:null,e:f}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(f,v){this.__onOrientationChange&&this.__onOrientationChange(f,v)},_onShake:function(f,v){this.__onShake&&this.__onShake(f,v)},_onLongPress:function(f,v){this.__onLongPress&&this.__onLongPress(f,v)},_onDragOver:function(f){f.preventDefault();var v=this._simpleEventHandler("dragover",f);this._fireEnterLeaveEvents(v,f)},_onDrop:function(f){return this._simpleEventHandler("drop:before",f),this._simpleEventHandler("drop",f)},_onContextMenu:function(f){return this.stopContextMenu&&(f.stopPropagation(),f.preventDefault()),!1},_onDoubleClick:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"dblclick"),this._resetTransformEventData(f)},getPointerId:function(f){var v=f.changedTouches;return v?v[0]&&v[0].identifier:this.enablePointerEvents?f.pointerId:-1},_isMainEvent:function(f){return f.isPrimary===!0?!0:f.isPrimary===!1?!1:f.type==="touchend"&&f.touches.length===0?!0:f.changedTouches?f.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(f){f.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(f)),this.__onMouseDown(f),this._resetTransformEventData();var v=this.upperCanvasEl,p=this._getEventPrefix();a(t.document,"touchend",this._onTouchEnd,u),a(t.document,"touchmove",this._onMouseMove,u),s(v,p+"down",this._onMouseDown)},_onMouseDown:function(f){this.__onMouseDown(f),this._resetTransformEventData();var v=this.upperCanvasEl,p=this._getEventPrefix();s(v,p+"move",this._onMouseMove,u),a(t.document,p+"up",this._onMouseUp),a(t.document,p+"move",this._onMouseMove,u)},_onTouchEnd:function(f){if(!(f.touches.length>0)){this.__onMouseUp(f),this._resetTransformEventData(),this.mainTouchId=null;var v=this._getEventPrefix();s(t.document,"touchend",this._onTouchEnd,u),s(t.document,"touchmove",this._onMouseMove,u);var p=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){a(p.upperCanvasEl,v+"down",p._onMouseDown),p._willAddMouseDown=0},400)}},_onMouseUp:function(f){this.__onMouseUp(f),this._resetTransformEventData();var v=this.upperCanvasEl,p=this._getEventPrefix();this._isMainEvent(f)&&(s(t.document,p+"up",this._onMouseUp),s(t.document,p+"move",this._onMouseMove,u),a(v,p+"move",this._onMouseMove,u))},_onMouseMove:function(f){!this.allowTouchScrolling&&f.preventDefault&&f.preventDefault(),this.__onMouseMove(f)},_onResize:function(){this.calcOffset()},_shouldRender:function(f){var v=this._activeObject;return!!v!=!!f||v&&f&&v!==f?!0:(v&&v.isEditing,!1)},__onMouseUp:function(f){var v,p=this._currentTransform,y=this._groupSelector,b=!1,x=!y||y.left===0&&y.top===0;if(this._cacheTransformEventData(f),v=this._target,this._handleEvent(f,"up:before"),c(f,h)){this.fireRightClick&&this._handleEvent(f,"up",h,x);return}if(c(f,d)){this.fireMiddleClick&&this._handleEvent(f,"up",d,x),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(f);return}if(this._isMainEvent(f)){if(p&&(this._finalizeCurrentTransform(f),b=p.actionPerformed),!x){var S=v===this._activeObject;this._maybeGroupObjects(f),b||(b=this._shouldRender(v)||!S&&v===this._activeObject)}var w,E;if(v){if(w=v._findTargetCorner(this.getPointer(f,!0),t.util.isTouchEvent(f)),v.selectable&&v!==this._activeObject&&v.activeOn==="up")this.setActiveObject(v,f),b=!0;else{var P=v.controls[w],A=P&&P.getMouseUpHandler(f,v,P);A&&(E=this.getPointer(f),A(f,p,E.x,E.y))}v.isMoving=!1}if(p&&(p.target!==v||p.corner!==w)){var N=p.target&&p.target.controls[p.corner],k=N&&N.getMouseUpHandler(f,v,P);E=E||this.getPointer(f),k&&k(f,p,E.x,E.y)}this._setCursorFromEvent(f,v),this._handleEvent(f,"up",l,x),this._groupSelector=null,this._currentTransform=null,v&&(v.__corner=0),b?this.requestRenderAll():x||this.renderTop()}},_simpleEventHandler:function(f,v){var p=this.findTarget(v),y=this.targets,b={e:v,target:p,subTargets:y};if(this.fire(f,b),p&&p.fire(f,b),!y)return p;for(var x=0;x<y.length;x++)y[x].fire(f,b);return p},_handleEvent:function(f,v,p,y){var b=this._target,x=this.targets||[],S={e:f,target:b,subTargets:x,button:p||l,isClick:y||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};v==="up"&&(S.currentTarget=this.findTarget(f),S.currentSubTargets=this.targets),this.fire("mouse:"+v,S),b&&b.fire("mouse"+v,S);for(var w=0;w<x.length;w++)x[w].fire("mouse"+v,S)},_finalizeCurrentTransform:function(f){var v=this._currentTransform,p=v.target,y={e:f,target:p,transform:v,action:v.action};p._scaling&&(p._scaling=!1),p.setCoords(),(v.actionPerformed||this.stateful&&p.hasStateChanged())&&this._fire("modified",y)},_onMouseDownInDrawingMode:function(f){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(f).requestRenderAll();var v=this.getPointer(f);this.freeDrawingBrush.onMouseDown(v,{e:f,pointer:v}),this._handleEvent(f,"down")},_onMouseMoveInDrawingMode:function(f){if(this._isCurrentlyDrawing){var v=this.getPointer(f);this.freeDrawingBrush.onMouseMove(v,{e:f,pointer:v})}this.setCursor(this.freeDrawingCursor),this._handleEvent(f,"move")},_onMouseUpInDrawingMode:function(f){var v=this.getPointer(f);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:f,pointer:v}),this._handleEvent(f,"up")},__onMouseDown:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"down:before");var v=this._target;if(c(f,h)){this.fireRightClick&&this._handleEvent(f,"down",h);return}if(c(f,d)){this.fireMiddleClick&&this._handleEvent(f,"down",d);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(f);return}if(this._isMainEvent(f)&&!this._currentTransform){var p=this._pointer;this._previousPointer=p;var y=this._shouldRender(v),b=this._shouldGroup(f,v);if(this._shouldClearSelection(f,v)?this.discardActiveObject(f):b&&(this._handleGrouping(f,v),v=this._activeObject),this.selection&&(!v||!v.selectable&&!v.isEditing&&v!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),v){var x=v===this._activeObject;v.selectable&&v.activeOn==="down"&&this.setActiveObject(v,f);var S=v._findTargetCorner(this.getPointer(f,!0),t.util.isTouchEvent(f));if(v.__corner=S,v===this._activeObject&&(S||!b)){this._setupCurrentTransform(f,v,x);var w=v.controls[S],p=this.getPointer(f),E=w&&w.getMouseDownHandler(f,v,w);E&&E(f,this._currentTransform,p.x,p.y)}}this._handleEvent(f,"down"),(y||b)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(f){this._resetTransformEventData(),this._pointer=this.getPointer(f,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(f)||null},_beforeTransform:function(f){var v=this._currentTransform;this.stateful&&v.target.saveState(),this.fire("before:transform",{e:f,transform:v})},__onMouseMove:function(f){this._handleEvent(f,"move:before"),this._cacheTransformEventData(f);var v,p;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(f);return}if(this._isMainEvent(f)){var y=this._groupSelector;y?(p=this._absolutePointer,y.left=p.x-y.ex,y.top=p.y-y.ey,this.renderTop()):this._currentTransform?this._transformObject(f):(v=this.findTarget(f)||null,this._setCursorFromEvent(f,v),this._fireOverOutEvents(v,f)),this._handleEvent(f,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(f,v){var p=this._hoveredTarget,y=this._hoveredTargets,b=this.targets,x=Math.max(y.length,b.length);this.fireSyntheticInOutEvents(f,v,{oldTarget:p,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var S=0;S<x;S++)this.fireSyntheticInOutEvents(b[S],v,{oldTarget:y[S],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=f,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(f,v){var p=this._draggedoverTarget,y=this._hoveredTargets,b=this.targets,x=Math.max(y.length,b.length);this.fireSyntheticInOutEvents(f,v,{oldTarget:p,evtOut:"dragleave",evtIn:"dragenter"});for(var S=0;S<x;S++)this.fireSyntheticInOutEvents(b[S],v,{oldTarget:y[S],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=f},fireSyntheticInOutEvents:function(f,v,p){var y,b,x=p.oldTarget,S,w,E=x!==f,P=p.canvasEvtIn,A=p.canvasEvtOut;E&&(y={e:v,target:f,previousTarget:x},b={e:v,target:x,nextTarget:f}),w=f&&E,S=x&&E,S&&(A&&this.fire(A,b),x.fire(p.evtOut,b)),w&&(P&&this.fire(P,y),f.fire(p.evtIn,y))},__onMouseWheel:function(f){this._cacheTransformEventData(f),this._handleEvent(f,"wheel"),this._resetTransformEventData()},_transformObject:function(f){var v=this.getPointer(f),p=this._currentTransform;p.reset=!1,p.shiftKey=f.shiftKey,p.altKey=f[this.centeredKey],this._performTransformAction(f,p,v),p.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(f,v,p){var y=p.x,b=p.y,x=v.action,S=!1,w=v.actionHandler;w&&(S=w(f,v,y,b)),x==="drag"&&S&&(v.target.isMoving=!0,this.setCursor(v.target.moveCursor||this.moveCursor)),v.actionPerformed=v.actionPerformed||S},_fire:t.controlsUtils.fireEvent,_setCursorFromEvent:function(f,v){if(!v)return this.setCursor(this.defaultCursor),!1;var p=v.hoverCursor||this.hoverCursor,y=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,b=(!y||!y.contains(v))&&v._findTargetCorner(this.getPointer(f,!0));b?this.setCursor(this.getCornerCursor(b,v,f)):(v.subTargetCheck&&this.targets.concat().reverse().map(function(x){p=x.hoverCursor||p}),this.setCursor(p))},getCornerCursor:function(f,v,p){var y=v.controls[f];return y.cursorStyleHandler(p,y,v)}})}(),function(){var a=Math.min,s=Math.max;t.util.object.extend(t.Canvas.prototype,{_shouldGroup:function(h,d){var l=this._activeObject;return l&&this._isSelectionKeyPressed(h)&&d&&d.selectable&&this.selection&&(l!==d||l.type==="activeSelection")&&!d.onSelect({e:h})},_handleGrouping:function(h,d){var l=this._activeObject;l.__corner||d===l&&(d=this.findTarget(h,!0),!d||!d.selectable)||(l&&l.type==="activeSelection"?this._updateActiveSelection(d,h):this._createActiveSelection(d,h))},_updateActiveSelection:function(h,d){var l=this._activeObject,u=l._objects.slice(0);l.contains(h)?(l.removeWithUpdate(h),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat(),l.size()===1&&this._setActiveObject(l.item(0),d)):(l.addWithUpdate(h),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(u,d)},_createActiveSelection:function(h,d){var l=this.getActiveObjects(),u=this._createGroup(h);this._hoveredTarget=u,this._setActiveObject(u,d),this._fireSelectionEvents(l,d)},_createGroup:function(h){var d=this._objects,l=d.indexOf(this._activeObject)<d.indexOf(h),u=l?[this._activeObject,h]:[h,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new t.ActiveSelection(u,{canvas:this})},_groupSelectedObjects:function(h){var d=this._collectObjects(h),l;d.length===1?this.setActiveObject(d[0],h):d.length>1&&(l=new t.ActiveSelection(d.reverse(),{canvas:this}),this.setActiveObject(l,h))},_collectObjects:function(h){for(var d=[],l,u=this._groupSelector.ex,c=this._groupSelector.ey,f=u+this._groupSelector.left,v=c+this._groupSelector.top,p=new t.Point(a(u,f),a(c,v)),y=new t.Point(s(u,f),s(c,v)),b=!this.selectionFullyContained,x=u===f&&c===v,S=this._objects.length;S--&&(l=this._objects[S],!(!(!l||!l.selectable||!l.visible)&&(b&&l.intersectsWithRect(p,y,!0)||l.isContainedWithinRect(p,y,!0)||b&&l.containsPoint(p,null,!0)||b&&l.containsPoint(y,null,!0))&&(d.push(l),x))););return d.length>1&&(d=d.filter(function(w){return!w.onSelect({e:h})})),d},_maybeGroupObjects:function(h){this.selection&&this._groupSelector&&this._groupSelectedObjects(h),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){t.util.object.extend(t.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var s=a.format||"png",h=a.quality||1,d=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),l=this.toCanvasElement(d,a);return t.util.toDataURL(l,s,h)},toCanvasElement:function(a,s){a=a||1,s=s||{};var h=(s.width||this.width)*a,d=(s.height||this.height)*a,l=this.getZoom(),u=this.width,c=this.height,f=l*a,v=this.viewportTransform,p=(v[4]-(s.left||0))*a,y=(v[5]-(s.top||0))*a,b=this.interactive,x=[f,0,0,f,p,y],S=this.enableRetinaScaling,w=t.util.createCanvasElement(),E=this.contextTop;return w.width=h,w.height=d,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=x,this.width=h,this.height=d,this.calcViewportBoundaries(),this.renderCanvas(w.getContext("2d"),this._objects),this.viewportTransform=v,this.width=u,this.height=c,this.calcViewportBoundaries(),this.interactive=b,this.enableRetinaScaling=S,this.contextTop=E,w}})}(),t.util.object.extend(t.StaticCanvas.prototype,{loadFromJSON:function(a,s,h){if(a){var d=typeof a=="string"?JSON.parse(a):t.util.object.clone(a),l=this,u=d.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete d.clipPath,this._enlivenObjects(d.objects,function(f){l.clear(),l._setBgOverlay(d,function(){u?l._enlivenObjects([u],function(v){l.clipPath=v[0],l.__setupCanvas.call(l,d,f,c,s)}):l.__setupCanvas.call(l,d,f,c,s)})},h),this}},__setupCanvas:function(a,s,h,d){var l=this;s.forEach(function(u,c){l.insertAt(u,c)}),this.renderOnAddRemove=h,delete a.objects,delete a.backgroundImage,delete a.overlayImage,delete a.background,delete a.overlay,this._setOptions(a),this.renderAll(),d&&d()},_setBgOverlay:function(a,s){var h={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!a.backgroundImage&&!a.overlayImage&&!a.background&&!a.overlay){s&&s();return}var d=function(){h.backgroundImage&&h.overlayImage&&h.backgroundColor&&h.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",a.backgroundImage,h,d),this.__setBgOverlay("overlayImage",a.overlayImage,h,d),this.__setBgOverlay("backgroundColor",a.background,h,d),this.__setBgOverlay("overlayColor",a.overlay,h,d)},__setBgOverlay:function(a,s,h,d){var l=this;if(!s){h[a]=!0,d&&d();return}a==="backgroundImage"||a==="overlayImage"?t.util.enlivenObjects([s],function(u){l[a]=u[0],h[a]=!0,d&&d()}):this["set"+t.util.string.capitalize(a,!0)](s,function(){h[a]=!0,d&&d()})},_enlivenObjects:function(a,s,h){if(!a||a.length===0){s&&s([]);return}t.util.enlivenObjects(a,function(d){s&&s(d)},null,h)},_toDataURL:function(a,s){this.clone(function(h){s(h.toDataURL(a))})},_toDataURLWithMultiplier:function(a,s,h){this.clone(function(d){h(d.toDataURLWithMultiplier(a,s))})},clone:function(a,s){var h=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(d){d.loadFromJSON(h,function(){a&&a(d)})})},cloneWithoutData:function(a){var s=t.util.createCanvasElement();s.width=this.width,s.height=this.height;var h=new t.Canvas(s);this.backgroundImage?(h.setBackgroundImage(this.backgroundImage.src,function(){h.renderAll(),a&&a(h)}),h.backgroundImageOpacity=this.backgroundImageOpacity,h.backgroundImageStretch=this.backgroundImageStretch):a&&a(h)}}),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.util.object.clone,l=s.util.toFixed,u=s.util.string.capitalize,c=s.util.degreesToRadians,f=!s.isLikelyNode,v=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:f,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(p){p&&this.setOptions(p)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(p){var y=s.perfLimitSizeTotal,b=p.width,x=p.height,S=s.maxCacheSideLimit,w=s.minCacheSideLimit;if(b<=S&&x<=S&&b*x<=y)return b<w&&(p.width=w),x<w&&(p.height=w),p;var E=b/x,P=s.util.limitDimsByArea(E,y),A=s.util.capValue,N=A(w,P.x,S),k=A(w,P.y,S);return b>N&&(p.zoomX/=b/N,p.width=N,p.capped=!0),x>k&&(p.zoomY/=x/k,p.height=k,p.capped=!0),p},_getCacheCanvasDimensions:function(){var p=this.getTotalObjectScaling(),y=this._getTransformedDimensions(0,0),b=y.x*p.scaleX/this.scaleX,x=y.y*p.scaleY/this.scaleY;return{width:b+v,height:x+v,zoomX:p.scaleX,zoomY:p.scaleY,x:b,y:x}},_updateCacheCanvas:function(){var p=this.canvas;if(this.noScaleCache&&p&&p._currentTransform){var y=p._currentTransform.target,b=p._currentTransform.action;if(this===y&&b.slice&&b.slice(0,5)==="scale")return!1}var x=this._cacheCanvas,S=this._limitCacheSize(this._getCacheCanvasDimensions()),w=s.minCacheSideLimit,E=S.width,P=S.height,A,N,k=S.zoomX,U=S.zoomY,j=E!==this.cacheWidth||P!==this.cacheHeight,X=this.zoomX!==k||this.zoomY!==U,W=j||X,Q=0,ot=0,it=!1;if(j){var ct=this._cacheCanvas.width,O=this._cacheCanvas.height,M=E>ct||P>O,L=(E<ct*.9||P<O*.9)&&ct>w&&O>w;it=M||L,M&&!S.capped&&(E>w||P>w)&&(Q=E*.1,ot=P*.1)}return this instanceof s.Text&&this.path&&(W=!0,it=!0,Q+=this.getHeightOfLine(0)*this.zoomX,ot+=this.getHeightOfLine(0)*this.zoomY),W?(it?(x.width=Math.ceil(E+Q),x.height=Math.ceil(P+ot)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,x.width,x.height)),A=S.x/2,N=S.y/2,this.cacheTranslationX=Math.round(x.width/2-A)+A,this.cacheTranslationY=Math.round(x.height/2-N)+N,this.cacheWidth=E,this.cacheHeight=P,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(k,U),this.zoomX=k,this.zoomY=U,!0):!1},setOptions:function(p){this._setOptions(p),this._initGradient(p.fill,"fill"),this._initGradient(p.stroke,"stroke"),this._initPattern(p.fill,"fill"),this._initPattern(p.stroke,"stroke")},transform:function(p){var y=this.group&&!this.group._transformDone||this.group&&this.canvas&&p===this.canvas.contextTop,b=this.calcTransformMatrix(!y);p.transform(b[0],b[1],b[2],b[3],b[4],b[5])},toObject:function(p){var y=s.Object.NUM_FRACTION_DIGITS,b={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:l(this.left,y),top:l(this.top,y),width:l(this.width,y),height:l(this.height,y),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:l(this.strokeWidth,y),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:l(this.strokeMiterLimit,y),scaleX:l(this.scaleX,y),scaleY:l(this.scaleY,y),angle:l(this.angle,y),flipX:this.flipX,flipY:this.flipY,opacity:l(this.opacity,y),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:l(this.skewX,y),skewY:l(this.skewY,y)};return this.clipPath&&!this.clipPath.excludeFromExport&&(b.clipPath=this.clipPath.toObject(p),b.clipPath.inverted=this.clipPath.inverted,b.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,b,p),this.includeDefaultValues||(b=this._removeDefaultValues(b)),b},toDatalessObject:function(p){return this.toObject(p)},_removeDefaultValues:function(p){var y=s.util.getKlass(p.type).prototype,b=y.stateProperties;return b.forEach(function(x){x==="left"||x==="top"||(p[x]===y[x]&&delete p[x],Array.isArray(p[x])&&Array.isArray(y[x])&&p[x].length===0&&y[x].length===0&&delete p[x])}),p},toString:function(){return"#<fabric."+u(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var p=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(p.scaleX),scaleY:Math.abs(p.scaleY)}},getTotalObjectScaling:function(){var p=this.getObjectScaling(),y=p.scaleX,b=p.scaleY;if(this.canvas){var x=this.canvas.getZoom(),S=this.canvas.getRetinaScaling();y*=x*S,b*=x*S}return{scaleX:y,scaleY:b}},getObjectOpacity:function(){var p=this.opacity;return this.group&&(p*=this.group.getObjectOpacity()),p},_set:function(p,y){var b=p==="scaleX"||p==="scaleY",x=this[p]!==y,S=!1;return b&&(y=this._constrainScale(y)),p==="scaleX"&&y<0?(this.flipX=!this.flipX,y*=-1):p==="scaleY"&&y<0?(this.flipY=!this.flipY,y*=-1):p==="shadow"&&y&&!(y instanceof s.Shadow)?y=new s.Shadow(y):p==="dirty"&&this.group&&this.group.set("dirty",y),this[p]=y,x&&(S=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(p)>-1?(this.dirty=!0,S&&this.group.set("dirty",!0)):S&&this.stateProperties.indexOf(p)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(p){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(p.save(),this._setupCompositeOperation(p),this.drawSelectionBackground(p),this.transform(p),this._setOpacity(p),this._setShadow(p,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(p)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(p),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),p.restore())},renderCache:function(p){p=p||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,p.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(p,y){if(p.save(),y.inverted?p.globalCompositeOperation="destination-out":p.globalCompositeOperation="destination-in",y.absolutePositioned){var b=s.util.invertTransform(this.calcTransformMatrix());p.transform(b[0],b[1],b[2],b[3],b[4],b[5])}y.transform(p),p.scale(1/y.zoomX,1/y.zoomY),p.drawImage(y._cacheCanvas,-y.cacheTranslationX,-y.cacheTranslationY),p.restore()},drawObject:function(p,y){var b=this.fill,x=this.stroke;y?(this.fill="black",this.stroke="",this._setClippingProperties(p)):this._renderBackground(p),this._render(p),this._drawClipPath(p,this.clipPath),this.fill=b,this.stroke=x},_drawClipPath:function(p,y){y&&(y.canvas=this.canvas,y.shouldCache(),y._transformDone=!0,y.renderCache({forClipping:!0}),this.drawClipPathOnCache(p,y))},drawCacheOnCanvas:function(p){p.scale(1/this.zoomX,1/this.zoomY),p.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(p){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!p&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!p){var y=this.cacheWidth/this.zoomX,b=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-y/2,-b/2,y,b)}return!0}return!1},_renderBackground:function(p){if(this.backgroundColor){var y=this._getNonTransformedDimensions();p.fillStyle=this.backgroundColor,p.fillRect(-y.x/2,-y.y/2,y.x,y.y),this._removeShadow(p)}},_setOpacity:function(p){this.group&&!this.group._transformDone?p.globalAlpha=this.getObjectOpacity():p.globalAlpha*=this.opacity},_setStrokeStyles:function(p,y){var b=y.stroke;b&&(p.lineWidth=y.strokeWidth,p.lineCap=y.strokeLineCap,p.lineDashOffset=y.strokeDashOffset,p.lineJoin=y.strokeLineJoin,p.miterLimit=y.strokeMiterLimit,b.toLive?b.gradientUnits==="percentage"||b.gradientTransform||b.patternTransform?this._applyPatternForTransformedGradient(p,b):(p.strokeStyle=b.toLive(p,this),this._applyPatternGradientTransform(p,b)):p.strokeStyle=y.stroke)},_setFillStyles:function(p,y){var b=y.fill;b&&(b.toLive?(p.fillStyle=b.toLive(p,this),this._applyPatternGradientTransform(p,y.fill)):p.fillStyle=b)},_setClippingProperties:function(p){p.globalAlpha=1,p.strokeStyle="transparent",p.fillStyle="#000000"},_setLineDash:function(p,y){!y||y.length===0||(1&y.length&&y.push.apply(y,y),p.setLineDash(y))},_renderControls:function(p,y){var b=this.getViewportTransform(),x=this.calcTransformMatrix(),S,w,E;y=y||{},w=typeof y.hasBorders<"u"?y.hasBorders:this.hasBorders,E=typeof y.hasControls<"u"?y.hasControls:this.hasControls,x=s.util.multiplyTransformMatrices(b,x),S=s.util.qrDecompose(x),p.save(),p.translate(S.translateX,S.translateY),p.lineWidth=1*this.borderScaleFactor,this.group||(p.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(S.angle-=180),p.rotate(c(this.group?S.angle:this.angle)),y.forActiveSelection||this.group?w&&this.drawBordersInGroup(p,S,y):w&&this.drawBorders(p,y),E&&this.drawControls(p,y),p.restore()},_setShadow:function(p){if(this.shadow){var y=this.shadow,b=this.canvas,x,S=b&&b.viewportTransform[0]||1,w=b&&b.viewportTransform[3]||1;y.nonScaling?x={scaleX:1,scaleY:1}:x=this.getObjectScaling(),b&&b._isRetinaScaling()&&(S*=s.devicePixelRatio,w*=s.devicePixelRatio),p.shadowColor=y.color,p.shadowBlur=y.blur*s.browserShadowBlurConstant*(S+w)*(x.scaleX+x.scaleY)/4,p.shadowOffsetX=y.offsetX*S*x.scaleX,p.shadowOffsetY=y.offsetY*w*x.scaleY}},_removeShadow:function(p){this.shadow&&(p.shadowColor="",p.shadowBlur=p.shadowOffsetX=p.shadowOffsetY=0)},_applyPatternGradientTransform:function(p,y){if(!y||!y.toLive)return{offsetX:0,offsetY:0};var b=y.gradientTransform||y.patternTransform,x=-this.width/2+y.offsetX||0,S=-this.height/2+y.offsetY||0;return y.gradientUnits==="percentage"?p.transform(this.width,0,0,this.height,x,S):p.transform(1,0,0,1,x,S),b&&p.transform(b[0],b[1],b[2],b[3],b[4],b[5]),{offsetX:x,offsetY:S}},_renderPaintInOrder:function(p){this.paintFirst==="stroke"?(this._renderStroke(p),this._renderFill(p)):(this._renderFill(p),this._renderStroke(p))},_render:function(){},_renderFill:function(p){this.fill&&(p.save(),this._setFillStyles(p,this),this.fillRule==="evenodd"?p.fill("evenodd"):p.fill(),p.restore())},_renderStroke:function(p){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(p),p.save(),this.strokeUniform&&this.group){var y=this.getObjectScaling();p.scale(1/y.scaleX,1/y.scaleY)}else this.strokeUniform&&p.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(p,this.strokeDashArray),this._setStrokeStyles(p,this),p.stroke(),p.restore()}},_applyPatternForTransformedGradient:function(p,y){var b=this._limitCacheSize(this._getCacheCanvasDimensions()),x=s.util.createCanvasElement(),S,w=this.canvas.getRetinaScaling(),E=b.x/this.scaleX/w,P=b.y/this.scaleY/w;x.width=E,x.height=P,S=x.getContext("2d"),S.beginPath(),S.moveTo(0,0),S.lineTo(E,0),S.lineTo(E,P),S.lineTo(0,P),S.closePath(),S.translate(E/2,P/2),S.scale(b.zoomX/this.scaleX/w,b.zoomY/this.scaleY/w),this._applyPatternGradientTransform(S,y),S.fillStyle=y.toLive(p),S.fill(),p.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),p.scale(w*this.scaleX/b.zoomX,w*this.scaleY/b.zoomY),p.strokeStyle=S.createPattern(x,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var p=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",p.scaleX),this.set("scaleY",p.scaleY),this.angle=p.angle,this.skewX=p.skewX,this.skewY=0}},_removeTransformMatrix:function(p){var y=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),y=s.util.transformPoint(y,this.transformMatrix)),this.transformMatrix=null,p&&(this.scaleX*=p.scaleX,this.scaleY*=p.scaleY,this.cropX=p.cropX,this.cropY=p.cropY,y.x+=p.offsetLeft,y.y+=p.offsetTop,this.width=p.width,this.height=p.height),this.setPositionByOrigin(y,"center","center")},clone:function(p,y){var b=this.toObject(y);this.constructor.fromObject?this.constructor.fromObject(b,p):s.Object._fromObject("Object",b,p)},cloneAsImage:function(p,y){var b=this.toCanvasElement(y);return p&&p(new s.Image(b)),this},toCanvasElement:function(p){p||(p={});var y=s.util,b=y.saveObjectTransform(this),x=this.group,S=this.shadow,w=Math.abs,E=(p.multiplier||1)*(p.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,p.withoutTransform&&y.resetObjectTransform(this),p.withoutShadow&&(this.shadow=null);var P=s.util.createCanvasElement(),A=this.getBoundingRect(!0,!0),N=this.shadow,k,U={x:0,y:0},j,X,W;N&&(j=N.blur,N.nonScaling?k={scaleX:1,scaleY:1}:k=this.getObjectScaling(),U.x=2*Math.round(w(N.offsetX)+j)*w(k.scaleX),U.y=2*Math.round(w(N.offsetY)+j)*w(k.scaleY)),X=A.width+U.x,W=A.height+U.y,P.width=Math.ceil(X),P.height=Math.ceil(W);var Q=new s.StaticCanvas(P,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});p.format==="jpeg"&&(Q.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(Q.width/2,Q.height/2),"center","center");var ot=this.canvas;Q.add(this);var it=Q.toCanvasElement(E||1,p);return this.shadow=S,this.set("canvas",ot),x&&(this.group=x),this.set(b).setCoords(),Q._objects=[],Q.dispose(),Q=null,it},toDataURL:function(p){return p||(p={}),s.util.toDataURL(this.toCanvasElement(p),p.format||"png",p.quality||1)},isType:function(p){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===p},complexity:function(){return 1},toJSON:function(p){return this.toObject(p)},rotate:function(p){var y=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return y&&this._setOriginToCenter(),this.set("angle",p),y&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(p,y){y=y||this.canvas.getPointer(p);var b=new s.Point(y.x,y.y),x=this._getLeftTopCoords();return this.angle&&(b=s.util.rotatePoint(b,x,c(-this.angle))),{x:b.x-x.x,y:b.y-x.y}},_setupCompositeOperation:function(p){this.globalCompositeOperation&&(p.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),h(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(p,y,b,x){var S=s[p];y=d(y,!0),s.util.enlivenPatterns([y.fill,y.stroke],function(w){typeof w[0]<"u"&&(y.fill=w[0]),typeof w[1]<"u"&&(y.stroke=w[1]),s.util.enlivenObjectEnlivables(y,y,function(){var E=x?new S(y[x],y):new S(y);b&&b(E)})})},s.Object.__uid=0)}(i),function(){var a=t.util.degreesToRadians,s={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};t.util.object.extend(t.Object.prototype,{translateToGivenOrigin:function(d,l,u,c,f){var v=d.x,p=d.y,y,b,x;return typeof l=="string"?l=s[l]:l-=.5,typeof c=="string"?c=s[c]:c-=.5,y=c-l,typeof u=="string"?u=h[u]:u-=.5,typeof f=="string"?f=h[f]:f-=.5,b=f-u,(y||b)&&(x=this._getTransformedDimensions(),v=d.x+y*x.x,p=d.y+b*x.y),new t.Point(v,p)},translateToCenterPoint:function(d,l,u){var c=this.translateToGivenOrigin(d,l,u,"center","center");return this.angle?t.util.rotatePoint(c,d,a(this.angle)):c},translateToOriginPoint:function(d,l,u){var c=this.translateToGivenOrigin(d,"center","center",l,u);return this.angle?t.util.rotatePoint(c,d,a(this.angle)):c},getCenterPoint:function(){var d=new t.Point(this.left,this.top);return this.translateToCenterPoint(d,this.originX,this.originY)},getPointByOrigin:function(d,l){var u=this.getCenterPoint();return this.translateToOriginPoint(u,d,l)},toLocalPoint:function(d,l,u){var c=this.getCenterPoint(),f,v;return typeof l<"u"&&typeof u<"u"?f=this.translateToGivenOrigin(c,"center","center",l,u):f=new t.Point(this.left,this.top),v=new t.Point(d.x,d.y),this.angle&&(v=t.util.rotatePoint(v,c,-a(this.angle))),v.subtractEquals(f)},setPositionByOrigin:function(d,l,u){var c=this.translateToCenterPoint(d,l,u),f=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",f.x),this.set("top",f.y)},adjustPosition:function(d){var l=a(this.angle),u=this.getScaledWidth(),c=t.util.cos(l)*u,f=t.util.sin(l)*u,v,p;typeof this.originX=="string"?v=s[this.originX]:v=this.originX-.5,typeof d=="string"?p=s[d]:p=d-.5,this.left+=c*(p-v),this.top+=f*(p-v),this.setCoords(),this.originX=d},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var d=this.getCenterPoint();this.originX="center",this.originY="center",this.left=d.x,this.top=d.y},_resetOrigin:function(){var d=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=d.x,this.top=d.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function a(u){return[new t.Point(u.tl.x,u.tl.y),new t.Point(u.tr.x,u.tr.y),new t.Point(u.br.x,u.br.y),new t.Point(u.bl.x,u.bl.y)]}var s=t.util,h=s.degreesToRadians,d=s.multiplyTransformMatrices,l=s.transformPoint;s.object.extend(t.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(u,c){return c?u?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),u?this.aCoords:this.lineCoords)},getCoords:function(u,c){return a(this._getCoords(u,c))},intersectsWithRect:function(u,c,f,v){var p=this.getCoords(f,v),y=t.Intersection.intersectPolygonRectangle(p,u,c);return y.status==="Intersection"},intersectsWithObject:function(u,c,f){var v=t.Intersection.intersectPolygonPolygon(this.getCoords(c,f),u.getCoords(c,f));return v.status==="Intersection"||u.isContainedWithinObject(this,c,f)||this.isContainedWithinObject(u,c,f)},isContainedWithinObject:function(u,c,f){for(var v=this.getCoords(c,f),p=c?u.aCoords:u.lineCoords,y=0,b=u._getImageLines(p);y<4;y++)if(!u.containsPoint(v[y],b))return!1;return!0},isContainedWithinRect:function(u,c,f,v){var p=this.getBoundingRect(f,v);return p.left>=u.x&&p.left+p.width<=c.x&&p.top>=u.y&&p.top+p.height<=c.y},containsPoint:function(u,y,f,v){var p=this._getCoords(f,v),y=y||this._getImageLines(p),b=this._findCrossPoints(u,y);return b!==0&&b%2===1},isOnScreen:function(u){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br,v=this.getCoords(!0,u);return v.some(function(p){return p.x<=f.x&&p.x>=c.x&&p.y<=f.y&&p.y>=c.y})||this.intersectsWithRect(c,f,!0,u)?!0:this._containsCenterOfCanvas(c,f,u)},_containsCenterOfCanvas:function(u,c,f){var v={x:(u.x+c.x)/2,y:(u.y+c.y)/2};return!!this.containsPoint(v,null,!0,f)},isPartiallyOnScreen:function(u){if(!this.canvas)return!1;var c=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br;if(this.intersectsWithRect(c,f,!0,u))return!0;var v=this.getCoords(!0,u).every(function(p){return(p.x>=f.x||p.x<=c.x)&&(p.y>=f.y||p.y<=c.y)});return v&&this._containsCenterOfCanvas(c,f,u)},_getImageLines:function(u){var c={topline:{o:u.tl,d:u.tr},rightline:{o:u.tr,d:u.br},bottomline:{o:u.br,d:u.bl},leftline:{o:u.bl,d:u.tl}};return c},_findCrossPoints:function(u,c){var f,v,p,y,b,x=0,S;for(var w in c)if(S=c[w],!(S.o.y<u.y&&S.d.y<u.y)&&!(S.o.y>=u.y&&S.d.y>=u.y)&&(S.o.x===S.d.x&&S.o.x>=u.x?b=S.o.x:(f=0,v=(S.d.y-S.o.y)/(S.d.x-S.o.x),p=u.y-f*u.x,y=S.o.y-v*S.o.x,b=-(p-y)/(f-v)),b>=u.x&&(x+=1),x===2))break;return x},getBoundingRect:function(u,c){var f=this.getCoords(u,c);return s.makeBoundingBoxFromPoints(f)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(u){return Math.abs(u)<this.minScaleLimit?u<0?-this.minScaleLimit:this.minScaleLimit:u===0?1e-4:u},scale:function(u){return this._set("scaleX",u),this._set("scaleY",u),this.setCoords()},scaleToWidth:function(u,c){var f=this.getBoundingRect(c).width/this.getScaledWidth();return this.scale(u/this.width/f)},scaleToHeight:function(u,c){var f=this.getBoundingRect(c).height/this.getScaledHeight();return this.scale(u/this.height/f)},calcLineCoords:function(){var u=this.getViewportTransform(),c=this.padding,f=h(this.angle),v=s.cos(f),p=s.sin(f),y=v*c,b=p*c,x=y+b,S=y-b,w=this.calcACoords(),E={tl:l(w.tl,u),tr:l(w.tr,u),bl:l(w.bl,u),br:l(w.br,u)};return c&&(E.tl.x-=S,E.tl.y-=x,E.tr.x+=x,E.tr.y-=S,E.bl.x-=x,E.bl.y+=S,E.br.x+=S,E.br.y+=x),E},calcOCoords:function(){var u=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),f=this.getViewportTransform(),v=d(f,c),p=d(v,u),p=d(p,[1/f[0],0,0,1/f[3],0,0]),y=this._calculateCurrentDimensions(),b={};return this.forEachControl(function(x,S,w){b[S]=x.positionHandler(y,p,w)}),b},calcACoords:function(){var u=this._calcRotateMatrix(),c=this._calcTranslateMatrix(),f=d(c,u),v=this._getTransformedDimensions(),p=v.x/2,y=v.y/2;return{tl:l({x:-p,y:-y},f),tr:l({x:p,y:-y},f),bl:l({x:-p,y},f),br:l({x:p,y},f)}},setCoords:function(u){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),u?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var u=this.getCenterPoint();return[1,0,0,1,u.x,u.y]},transformMatrixKey:function(u){var c="_",f="";return!u&&this.group&&(f=this.group.transformMatrixKey(u)+c),f+this.top+c+this.left+c+this.scaleX+c+this.scaleY+c+this.skewX+c+this.skewY+c+this.angle+c+this.originX+c+this.originY+c+this.width+c+this.height+c+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(u){var c=this.calcOwnMatrix();if(u||!this.group)return c;var f=this.transformMatrixKey(u),v=this.matrixCache||(this.matrixCache={});return v.key===f?v.value:(this.group&&(c=d(this.group.calcTransformMatrix(!1),c)),v.key=f,v.value=c,c)},calcOwnMatrix:function(){var u=this.transformMatrixKey(!0),c=this.ownMatrixCache||(this.ownMatrixCache={});if(c.key===u)return c.value;var f=this._calcTranslateMatrix(),v={angle:this.angle,translateX:f[4],translateY:f[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return c.key=u,c.value=s.composeMatrix(v),c.value},_getNonTransformedDimensions:function(){var u=this.strokeWidth,c=this.width+u,f=this.height+u;return{x:c,y:f}},_getTransformedDimensions:function(u,c){typeof u>"u"&&(u=this.skewX),typeof c>"u"&&(c=this.skewY);var f,v,p,y=u===0&&c===0;if(this.strokeUniform?(v=this.width,p=this.height):(f=this._getNonTransformedDimensions(),v=f.x,p=f.y),y)return this._finalizeDimensions(v*this.scaleX,p*this.scaleY);var b=s.sizeAfterTransform(v,p,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:u,skewY:c});return this._finalizeDimensions(b.x,b.y)},_finalizeDimensions:function(u,c){return this.strokeUniform?{x:u+this.strokeWidth,y:c+this.strokeWidth}:{x:u,y:c}},_calculateCurrentDimensions:function(){var u=this.getViewportTransform(),c=this._getTransformedDimensions(),f=l(c,u,!0);return f.scalarAdd(2*this.padding)}})}(),t.util.object.extend(t.Object.prototype,{sendToBack:function(){return this.group?t.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?t.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?t.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas&&this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?t.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas&&this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group&&this.group.type!=="activeSelection"?t.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas&&this.canvas.moveTo(this,a),this}}),function(){function a(h,d){if(d){if(d.toLive)return h+": url(#SVGID_"+d.id+"); ";var l=new t.Color(d),u=h+": "+l.toRgb()+"; ",c=l.getAlpha();return c!==1&&(u+=h+"-opacity: "+c.toString()+"; "),u}else return h+": none; "}var s=t.util.toFixed;t.util.object.extend(t.Object.prototype,{getSvgStyles:function(h){var d=this.fillRule?this.fillRule:"nonzero",l=this.strokeWidth?this.strokeWidth:"0",u=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",f=this.strokeLineCap?this.strokeLineCap:"butt",v=this.strokeLineJoin?this.strokeLineJoin:"miter",p=this.strokeMiterLimit?this.strokeMiterLimit:"4",y=typeof this.opacity<"u"?this.opacity:"1",b=this.visible?"":" visibility: hidden;",x=h?"":this.getSvgFilter(),S=a("fill",this.fill),w=a("stroke",this.stroke);return[w,"stroke-width: ",l,"; ","stroke-dasharray: ",u,"; ","stroke-linecap: ",f,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",v,"; ","stroke-miterlimit: ",p,"; ",S,"fill-rule: ",d,"; ","opacity: ",y,";",x,b].join("")},getSvgSpanStyles:function(h,d){var l="; ",c=h.fontFamily?"font-family: "+(h.fontFamily.indexOf("'")===-1&&h.fontFamily.indexOf('"')===-1?"'"+h.fontFamily+"'":h.fontFamily)+l:"",u=h.strokeWidth?"stroke-width: "+h.strokeWidth+l:"",c=c,f=h.fontSize?"font-size: "+h.fontSize+"px"+l:"",v=h.fontStyle?"font-style: "+h.fontStyle+l:"",p=h.fontWeight?"font-weight: "+h.fontWeight+l:"",y=h.fill?a("fill",h.fill):"",b=h.stroke?a("stroke",h.stroke):"",x=this.getSvgTextDecoration(h),S=h.deltaY?"baseline-shift: "+-h.deltaY+"; ":"";return x&&(x="text-decoration: "+x+l),[b,u,c,f,v,p,x,y,S,d?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(h){return["overline","underline","line-through"].filter(function(d){return h[d.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(h,d){var l=h?this.calcTransformMatrix():this.calcOwnMatrix(),u='transform="'+t.util.matrixToSVG(l);return u+(d||"")+'" '},_setSVGBg:function(h){if(this.backgroundColor){var d=t.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,d),'" y="',s(-this.height/2,d),'" width="',s(this.width,d),'" height="',s(this.height,d),`"></rect>
`)}},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(h),{reviver:h})},toClipPathSVG:function(h){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(h),{reviver:h})},_createBaseClipPathSVGMarkup:function(h,d){d=d||{};var l=d.reviver,u=d.additionalTransform||"",c=[this.getSvgTransform(!0,u),this.getSvgCommons()].join(""),f=h.indexOf("COMMON_PARTS");return h[f]=c,l?l(h.join("")):h.join("")},_createBaseSVGMarkup:function(h,d){d=d||{};var l=d.noStyle,u=d.reviver,c=l?"":'style="'+this.getSvgStyles()+'" ',f=d.withShadow?'style="'+this.getSvgFilter()+'" ':"",v=this.clipPath,p=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",y=v&&v.absolutePositioned,b=this.stroke,x=this.fill,S=this.shadow,w,E=[],P,A=h.indexOf("COMMON_PARTS"),N=d.additionalTransform;return v&&(v.clipPathId="CLIPPATH_"+t.Object.__uid++,P='<clipPath id="'+v.clipPathId+`" >
`+v.toClipPathSVG(u)+`</clipPath>
`),y&&E.push("<g ",f,this.getSvgCommons(),` >
`),E.push("<g ",this.getSvgTransform(!1),y?"":f+this.getSvgCommons(),` >
`),w=[c,p,l?"":this.addPaintOrder()," ",N?'transform="'+N+'" ':""].join(""),h[A]=w,x&&x.toLive&&E.push(x.toSVG(this)),b&&b.toLive&&E.push(b.toSVG(this)),S&&E.push(S.toSVG(this)),v&&E.push(P),E.push(h.join("")),E.push(`</g>
`),y&&E.push(`</g>
`),u?u(E.join("")):E.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var a=t.util.object.extend,s="stateProperties";function h(l,u,c){var f={},v=!0;c.forEach(function(p){f[p]=l[p]}),a(l[u],f,v)}function d(l,u,c){if(l===u)return!0;if(Array.isArray(l)){if(!Array.isArray(u)||l.length!==u.length)return!1;for(var f=0,v=l.length;f<v;f++)if(!d(l[f],u[f]))return!1;return!0}else if(l&&typeof l=="object"){var p=Object.keys(l),y;if(!u||typeof u!="object"||!c&&p.length!==Object.keys(u).length)return!1;for(var f=0,v=p.length;f<v;f++)if(y=p[f],!(y==="canvas"||y==="group")&&!d(l[y],u[y]))return!1;return!0}}t.util.object.extend(t.Object.prototype,{hasStateChanged:function(l){l=l||s;var u="_"+l;return Object.keys(this[u]).length<this[l].length?!0:!d(this[u],this,!0)},saveState:function(l){var u=l&&l.propertySet||s,c="_"+u;return this[c]?(h(this,c,this[u]),l&&l.stateProperties&&h(this,c,l.stateProperties),this):this.setupState(l)},setupState:function(l){l=l||{};var u=l.propertySet||s;return l.propertySet=u,this["_"+u]={},this.saveState(l),this}})}(),function(){var a=t.util.degreesToRadians;t.util.object.extend(t.Object.prototype,{_findTargetCorner:function(s,h){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var d=s.x,l=s.y,u,c,f=Object.keys(this.oCoords),v=f.length-1,p;for(this.__corner=0;v>=0;v--)if(p=f[v],!!this.isControlVisible(p)&&(c=this._getImageLines(h?this.oCoords[p].touchCorner:this.oCoords[p].corner),u=this._findCrossPoints({x:d,y:l},c),u!==0&&u%2===1))return this.__corner=p,p;return!1},forEachControl:function(s){for(var h in this.controls)s(this.controls[h],h,this)},_setCornerCoords:function(){var s=this.oCoords;for(var h in s){var d=this.controls[h];s[h].corner=d.calcCornerCoords(this.angle,this.cornerSize,s[h].x,s[h].y,!1),s[h].touchCorner=d.calcCornerCoords(this.angle,this.touchCornerSize,s[h].x,s[h].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var h=this.getCenterPoint(),d=this._calculateCurrentDimensions(),l=this.canvas.viewportTransform;return s.translate(h.x,h.y),s.scale(1/l[0],1/l[3]),s.rotate(a(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-d.x/2,-d.y/2,d.x,d.y),s.restore(),this},drawBorders:function(s,h){h=h||{};var d=this._calculateCurrentDimensions(),l=this.borderScaleFactor,u=d.x+l,c=d.y+l,f=typeof h.hasControls<"u"?h.hasControls:this.hasControls,v=!1;return s.save(),s.strokeStyle=h.borderColor||this.borderColor,this._setLineDash(s,h.borderDashArray||this.borderDashArray),s.strokeRect(-u/2,-c/2,u,c),f&&(s.beginPath(),this.forEachControl(function(p,y,b){p.withConnection&&p.getVisibility(b,y)&&(v=!0,s.moveTo(p.x*u,p.y*c),s.lineTo(p.x*u+p.offsetX,p.y*c+p.offsetY))}),v&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,h,d){d=d||{};var l=t.util.sizeAfterTransform(this.width,this.height,h),u=this.strokeWidth,c=this.strokeUniform,f=this.borderScaleFactor,v=l.x+u*(c?this.canvas.getZoom():h.scaleX)+f,p=l.y+u*(c?this.canvas.getZoom():h.scaleY)+f;return s.save(),this._setLineDash(s,d.borderDashArray||this.borderDashArray),s.strokeStyle=d.borderColor||this.borderColor,s.strokeRect(-v/2,-p/2,v,p),s.restore(),this},drawControls:function(s,h){h=h||{},s.save();var d=this.canvas.getRetinaScaling(),l,u;return s.setTransform(d,0,0,d,0,0),s.strokeStyle=s.fillStyle=h.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=h.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,h.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(l=this.group.calcTransformMatrix()),this.forEachControl(function(c,f,v){u=v.oCoords[f],c.getVisibility(v,f)&&(l&&(u=t.util.transformPoint(u,l)),c.render(s,u.x,u.y,h,v))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,h){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=h,this},setControlsVisibility:function(s){s||(s={});for(var h in s)this.setControlVisible(h,s[h]);return this},onDeselect:function(){},onSelect:function(){}})}(),t.util.object.extend(t.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,s){s=s||{};var h=function(){},d=s.onComplete||h,l=s.onChange||h,u=this;return t.util.animate({target:this,startValue:a.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){a.set("left",c),u.requestRenderAll(),l()},onComplete:function(){a.setCoords(),d()}})},fxCenterObjectV:function(a,s){s=s||{};var h=function(){},d=s.onComplete||h,l=s.onChange||h,u=this;return t.util.animate({target:this,startValue:a.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){a.set("top",c),u.requestRenderAll(),l()},onComplete:function(){a.setCoords(),d()}})},fxRemove:function(a,s){s=s||{};var h=function(){},d=s.onComplete||h,l=s.onChange||h,u=this;return t.util.animate({target:this,startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){a.set("opacity",c),u.requestRenderAll(),l()},onComplete:function(){u.remove(a),d()}})}}),t.util.object.extend(t.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var a=[],s,h,d=[];for(s in arguments[0])a.push(s);for(var l=0,u=a.length;l<u;l++)s=a[l],h=l!==u-1,d.push(this._animate(s,arguments[0][s],arguments[1],h));return d}else return this._animate.apply(this,arguments)},_animate:function(a,s,h,d){var l=this,u;s=s.toString(),h?h=t.util.object.clone(h):h={},~a.indexOf(".")&&(u=a.split("."));var c=l.colorProperties.indexOf(a)>-1||u&&l.colorProperties.indexOf(u[1])>-1,f=u?this.get(u[0])[u[1]]:this.get(a);"from"in h||(h.from=f),c||(~s.indexOf("=")?s=f+parseFloat(s.replace("=","")):s=parseFloat(s));var v={target:this,startValue:h.from,endValue:s,byValue:h.by,easing:h.easing,duration:h.duration,abort:h.abort&&function(p,y,b){return h.abort.call(l,p,y,b)},onChange:function(p,y,b){u?l[u[0]][u[1]]=p:l.set(a,p),!d&&h.onChange&&h.onChange(p,y,b)},onComplete:function(p,y,b){d||(l.setCoords(),h.onComplete&&h.onComplete(p,y,b))}};return c?t.util.animateColor(v.startValue,v.endValue,v.duration,v):t.util.animate(v)}}),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.util.object.clone,l={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,f){c||(c=[0,0,0,0]),this.callSuper("initialize",f),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(f)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,f){return this.callSuper("_set",c,f),typeof l[c]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:u({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:u({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var f=this.calcLinePoints();c.moveTo(f.x1,f.y1),c.lineTo(f.x2,f.y2),c.lineWidth=this.strokeWidth;var v=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=v},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return h(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,f=this.y1<=this.y2?-1:1,v=c*this.width*.5,p=f*this.height*.5,y=c*this.width*-.5,b=f*this.height*-.5;return{x1:v,x2:y,y1:p,y2:b}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(c,f,v){v=v||{};var p=s.parseAttributes(c,s.Line.ATTRIBUTE_NAMES),y=[p.x1||0,p.y1||0,p.x2||0,p.y2||0];f(new s.Line(y,h(p,v)))},s.Line.fromObject=function(c,f){function v(y){delete y.points,f&&f(y)}var p=d(c,!0);p.points=[c.x1,c.y1,c.x2,c.y2],s.Object._fromObject("Line",p,v,"points")};function u(c,f){var v=c.origin,p=c.axis1,y=c.axis2,b=c.dimension,x=f.nearest,S=f.center,w=f.farthest;return function(){switch(this.get(v)){case x:return Math.min(this.get(p),this.get(y));case S:return Math.min(this.get(p),this.get(y))+.5*this.get(b);case w:return Math.max(this.get(p),this.get(y))}}}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(l,u){return this.callSuper("_set",l,u),l==="radius"&&this.setRadius(u),this},toObject:function(l){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(l))},_toSVG:function(){var l,u=0,c=0,f=(this.endAngle-this.startAngle)%360;if(f===0)l=["<circle ","COMMON_PARTS",'cx="'+u+'" cy="'+c+'" ','r="',this.radius,`" />
`];else{var v=h(this.startAngle),p=h(this.endAngle),y=this.radius,b=s.util.cos(v)*y,x=s.util.sin(v)*y,S=s.util.cos(p)*y,w=s.util.sin(p)*y,E=f>180?"1":"0";l=['<path d="M '+b+" "+x," A "+y+" "+y," 0 ",+E+" 1"," "+S+" "+w,'" ',"COMMON_PARTS",` />
`]}return l},_render:function(l){l.beginPath(),l.arc(0,0,this.radius,h(this.startAngle),h(this.endAngle),!1),this._renderPaintInOrder(l)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(l){return this.radius=l,this.set("width",l*2).set("height",l*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(l,u){var c=s.parseAttributes(l,s.Circle.ATTRIBUTE_NAMES);if(!d(c))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,u(new s.Circle(c))};function d(l){return"radius"in l&&l.radius>=0}s.Circle.fromObject=function(l,u){s.Object._fromObject("Circle",l,u)}}(i),function(a){var s=a.fabric||(a.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(h){var d=this.width/2,l=this.height/2;h.beginPath(),h.moveTo(-d,l),h.lineTo(0,-l),h.lineTo(d,l),h.closePath(),this._renderPaintInOrder(h)},_toSVG:function(){var h=this.width/2,d=this.height/2,l=[-h+" "+d,"0 "+-d,h+" "+d].join(",");return["<polygon ","COMMON_PARTS",'points="',l,'" />']}}),s.Triangle.fromObject=function(h,d){return s.Object._fromObject("Triangle",h,d)}}(i),function(a){var s=a.fabric||(a.fabric={}),h=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d),this.set("rx",d&&d.rx||0),this.set("ry",d&&d.ry||0)},_set:function(d,l){switch(this.callSuper("_set",d,l),d){case"rx":this.rx=l,this.set("width",l*2);break;case"ry":this.ry=l,this.set("height",l*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(d){d.beginPath(),d.save(),d.transform(1,0,0,this.ry/this.rx,0,0),d.arc(0,0,this.rx,0,h,!1),d.restore(),this._renderPaintInOrder(d)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(d,l){var u=s.parseAttributes(d,s.Ellipse.ATTRIBUTE_NAMES);u.left=(u.left||0)-u.rx,u.top=(u.top||0)-u.ry,l(new s.Ellipse(u))},s.Ellipse.fromObject=function(d,l){s.Object._fromObject("Ellipse",d,l)}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(d){var l=this.rx?Math.min(this.rx,this.width/2):0,u=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,f=this.height,v=-this.width/2,p=-this.height/2,y=l!==0||u!==0,b=1-.5522847498;d.beginPath(),d.moveTo(v+l,p),d.lineTo(v+c-l,p),y&&d.bezierCurveTo(v+c-b*l,p,v+c,p+b*u,v+c,p+u),d.lineTo(v+c,p+f-u),y&&d.bezierCurveTo(v+c,p+f-b*u,v+c-b*l,p+f,v+c-l,p+f),d.lineTo(v+l,p+f),y&&d.bezierCurveTo(v+b*l,p+f,v,p+f-b*u,v,p+f-u),d.lineTo(v,p+u),y&&d.bezierCurveTo(v,p+b*u,v+b*l,p,v+l,p),d.closePath(),this._renderPaintInOrder(d)},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){var d=-this.width/2,l=-this.height/2;return["<rect ","COMMON_PARTS",'x="',d,'" y="',l,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(d,l,u){if(!d)return l(null);u=u||{};var c=s.parseAttributes(d,s.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var f=new s.Rect(h(u?s.util.object.clone(u):{},c));f.visible=f.visible&&f.width>0&&f.height>0,l(f)},s.Rect.fromObject=function(d,l){return s.Object._fromObject("Rect",d,l)}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.util.array.min,l=s.util.array.max,u=s.util.toFixed,c=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(f,v){v=v||{},this.points=f||[],this.callSuper("initialize",v),this._setPositionDimensions(v)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(f){var v=this._calcDimensions(f),p,y=this.exactBoundingBox?this.strokeWidth:0;this.width=v.width-y,this.height=v.height-y,f.fromSVG||(p=this.translateToGivenOrigin({x:v.left-this.strokeWidth/2+y/2,y:v.top-this.strokeWidth/2+y/2},"left","top",this.originX,this.originY)),typeof f.left>"u"&&(this.left=f.fromSVG?v.left:p.x),typeof f.top>"u"&&(this.top=f.fromSVG?v.top:p.y),this.pathOffset={x:v.left+this.width/2+y/2,y:v.top+this.height/2+y/2}},_calcDimensions:function(){var f=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,v=d(f,"x")||0,p=d(f,"y")||0,y=l(f,"x")||0,b=l(f,"y")||0,x=y-v,S=b-p;return{left:v,top:p,width:x,height:S}},toObject:function(f){return h(this.callSuper("toObject",f),{points:this.points.concat()})},_toSVG:function(){for(var f=[],v=this.pathOffset.x,p=this.pathOffset.y,y=s.Object.NUM_FRACTION_DIGITS,b=0,x=this.points.length;b<x;b++)f.push(u(this.points[b].x-v,y),",",u(this.points[b].y-p,y)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',f.join(""),`" />
`]},commonRender:function(f){var v,p=this.points.length,y=this.pathOffset.x,b=this.pathOffset.y;if(!p||isNaN(this.points[p-1].y))return!1;f.beginPath(),f.moveTo(this.points[0].x-y,this.points[0].y-b);for(var x=0;x<p;x++)v=this.points[x],f.lineTo(v.x-y,v.y-b);return!0},_render:function(f){this.commonRender(f)&&this._renderPaintInOrder(f)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(f){return function(v,p,y){if(!v)return p(null);y||(y={});var b=s.parsePointsAttribute(v.getAttribute("points")),x=s.parseAttributes(v,s[f].ATTRIBUTE_NAMES);x.fromSVG=!0,p(new s[f](b,h(x,y)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(f,v){return s.Object._fromObject("Polyline",f,v,"points")}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return h(this.points,this)},_render:function(d){this.commonRender(d)&&(d.closePath(),this._renderPaintInOrder(d))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(d,l){s.Object._fromObject("Polygon",d,l,"points")}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.array.min,d=s.util.array.max,l=s.util.object.extend,u=s.util.object.clone,c=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(f,v){v=u(v||{}),delete v.path,this.callSuper("initialize",v),this._setPath(f||[],v)},_setPath:function(f,v){this.path=s.util.makePathSimpler(Array.isArray(f)?f:s.util.parsePath(f)),s.Polyline.prototype._setPositionDimensions.call(this,v||{})},_renderPathCommands:function(f){var v,p=0,y=0,b=0,x=0,S=0,w=0,E=-this.pathOffset.x,P=-this.pathOffset.y;f.beginPath();for(var A=0,N=this.path.length;A<N;++A)switch(v=this.path[A],v[0]){case"L":b=v[1],x=v[2],f.lineTo(b+E,x+P);break;case"M":b=v[1],x=v[2],p=b,y=x,f.moveTo(b+E,x+P);break;case"C":b=v[5],x=v[6],S=v[3],w=v[4],f.bezierCurveTo(v[1]+E,v[2]+P,S+E,w+P,b+E,x+P);break;case"Q":f.quadraticCurveTo(v[1]+E,v[2]+P,v[3]+E,v[4]+P),b=v[3],x=v[4],S=v[1],w=v[2];break;case"z":case"Z":b=p,x=y,f.closePath();break}},_render:function(f){this._renderPathCommands(f),this._renderPaintInOrder(f)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(f){return l(this.callSuper("toObject",f),{path:this.path.map(function(v){return v.slice()})})},toDatalessObject:function(f){var v=this.toObject(["sourcePath"].concat(f));return v.sourcePath&&delete v.path,v},_toSVG:function(){var f=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',f,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var f=s.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,f)+", "+c(-this.pathOffset.y,f)+")"},toClipPathSVG:function(f){var v=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:v})},toSVG:function(f){var v=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:f,additionalTransform:v})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var f=[],v=[],p,y=0,b=0,x=0,S=0,w,E=0,P=this.path.length;E<P;++E){switch(p=this.path[E],p[0]){case"L":x=p[1],S=p[2],w=[];break;case"M":x=p[1],S=p[2],y=x,b=S,w=[];break;case"C":w=s.util.getBoundsOfCurve(x,S,p[1],p[2],p[3],p[4],p[5],p[6]),x=p[5],S=p[6];break;case"Q":w=s.util.getBoundsOfCurve(x,S,p[1],p[2],p[1],p[2],p[3],p[4]),x=p[3],S=p[4];break;case"z":case"Z":x=y,S=b;break}w.forEach(function(W){f.push(W.x),v.push(W.y)}),f.push(x),v.push(S)}var A=h(f)||0,N=h(v)||0,k=d(f)||0,U=d(v)||0,j=k-A,X=U-N;return{left:A,top:N,width:j,height:X}}}),s.Path.fromObject=function(f,v){if(typeof f.sourcePath=="string"){var p=f.sourcePath;s.loadSVGFromURL(p,function(y){var b=y[0];b.setOptions(f),f.clipPath?s.util.enlivenObjects([f.clipPath],function(x){b.clipPath=x[0],v&&v(b)}):v&&v(b)})}else s.Object._fromObject("Path",f,v,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(f,v,p){var y=s.parseAttributes(f,s.Path.ATTRIBUTE_NAMES);y.fromSVG=!0,v(new s.Path(y.d,l(y,p)))}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.array.min,d=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(l,u,c){u=u||{},this._objects=[],c&&this.callSuper("initialize",u),this._objects=l||[];for(var f=this._objects.length;f--;)this._objects[f].group=this;if(c)this._updateObjectsACoords();else{var v=u&&u.centerPoint;u.originX!==void 0&&(this.originX=u.originX),u.originY!==void 0&&(this.originY=u.originY),v||this._calcBounds(),this._updateObjectsCoords(v),delete u.centerPoint,this.callSuper("initialize",u)}this.setCoords()},_updateObjectsACoords:function(){for(var l=!0,u=this._objects.length;u--;)this._objects[u].setCoords(l)},_updateObjectsCoords:function(u){for(var u=u||this.getCenterPoint(),c=this._objects.length;c--;)this._updateObjectCoords(this._objects[c],u)},_updateObjectCoords:function(l,u){var c=l.left,f=l.top,v=!0;l.set({left:c-u.x,top:f-u.y}),l.group=this,l.setCoords(v)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(l){var u=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),l&&(u&&s.util.removeTransformFromObject(l,this.group.calcTransformMatrix()),this._objects.push(l),l.group=this,l._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,u?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(l){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(l),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(l){this.dirty=!0,l.group=this,l._set("canvas",this.canvas)},_onObjectRemoved:function(l){this.dirty=!0,delete l.group},_set:function(l,u){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(l,u);if(l==="canvas")for(;c--;)this._objects[c]._set(l,u);s.Object.prototype._set.call(this,l,u)},toObject:function(l){var u=this.includeDefaultValues,c=this._objects.filter(function(v){return!v.excludeFromExport}).map(function(v){var p=v.includeDefaultValues;v.includeDefaultValues=u;var y=v.toObject(l);return v.includeDefaultValues=p,y}),f=s.Object.prototype.toObject.call(this,l);return f.objects=c,f},toDatalessObject:function(l){var u,c=this.sourcePath;if(c)u=c;else{var f=this.includeDefaultValues;u=this._objects.map(function(p){var y=p.includeDefaultValues;p.includeDefaultValues=f;var b=p.toDatalessObject(l);return p.includeDefaultValues=y,b})}var v=s.Object.prototype.toDatalessObject.call(this,l);return v.objects=u,v},render:function(l){this._transformDone=!0,this.callSuper("render",l),this._transformDone=!1},shouldCache:function(){var l=s.Object.prototype.shouldCache.call(this);if(l){for(var u=0,c=this._objects.length;u<c;u++)if(this._objects[u].willDrawShadow())return this.ownCaching=!1,!1}return l},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var l=0,u=this._objects.length;l<u;l++)if(this._objects[l].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(l){for(var u=0,c=this._objects.length;u<c;u++)this._objects[u].render(l);this._drawClipPath(l,this.clipPath)},isCacheDirty:function(l){if(this.callSuper("isCacheDirty",l))return!0;if(!this.statefullCache)return!1;for(var u=0,c=this._objects.length;u<c;u++)if(this._objects[u].isCacheDirty(!0)){if(this._cacheCanvas){var f=this.cacheWidth/this.zoomX,v=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-v/2,f,v)}return!0}return!1},_restoreObjectsState:function(){var l=this.calcOwnMatrix();return this._objects.forEach(function(u){s.util.addTransformToObject(u,l),delete u.group,u.setCoords()}),this},destroy:function(){return this._objects.forEach(function(l){l.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(l){l.dispose&&l.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var l=this._objects,u=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var f=new s.ActiveSelection([]);return f.set(c),f.type="activeSelection",u.remove(this),l.forEach(function(v){v.group=f,v.dirty=!0,u.add(v)}),f.canvas=u,f._objects=l,u._activeObject=f,f.setCoords(),f}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var l=!0;return this.forEachObject(function(u){u.setCoords(l)}),this},_calcBounds:function(l){for(var u=[],c=[],f,v,p,y=["tr","br","bl","tl"],b=0,x=this._objects.length,S,w=y.length;b<x;++b){for(f=this._objects[b],p=f.calcACoords(),S=0;S<w;S++)v=y[S],u.push(p[v].x),c.push(p[v].y);f.aCoords=p}this._getBounds(u,c,l)},_getBounds:function(l,u,c){var f=new s.Point(h(l),h(u)),v=new s.Point(d(l),d(u)),p=f.y||0,y=f.x||0,b=v.x-f.x||0,x=v.y-f.y||0;this.width=b,this.height=x,c||this.setPositionByOrigin({x:y,y:p},"left","top")},_toSVG:function(l){for(var u=["<g ","COMMON_PARTS",` >
`],c=0,f=this._objects.length;c<f;c++)u.push("		",this._objects[c].toSVG(l));return u.push(`</g>
`),u},getSvgStyles:function(){var l=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",u=this.visible?"":" visibility: hidden;";return[l,this.getSvgFilter(),u].join("")},toClipPathSVG:function(l){for(var u=[],c=0,f=this._objects.length;c<f;c++)u.push("	",this._objects[c].toClipPathSVG(l));return this._createBaseClipPathSVGMarkup(u,{reviver:l})}}),s.Group.fromObject=function(l,u){var c=l.objects,f=s.util.object.clone(l,!0);if(delete f.objects,typeof c=="string"){s.loadSVGFromURL(c,function(v){var p=s.util.groupSVGElements(v,l,c),y=f.clipPath;delete f.clipPath,p.set(f),y?s.util.enlivenObjects([y],function(b){p.clipPath=b[0],u&&u(p)}):u&&u(p)});return}s.util.enlivenObjects(c,function(v){s.util.enlivenObjectEnlivables(l,f,function(){u&&u(new s.Group(v,f,!0))})})})}(i),function(a){var s=a.fabric||(a.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(h,d){d=d||{},this._objects=h||[];for(var l=this._objects.length;l--;)this._objects[l].group=this;d.originX&&(this.originX=d.originX),d.originY&&(this.originY=d.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,d),this.setCoords()},toGroup:function(){var h=this._objects.concat();this._objects=[];var d=s.Object.prototype.toObject.call(this),l=new s.Group([]);if(delete d.type,l.set(d),h.forEach(function(c){c.canvas.remove(c),c.group=l}),l._objects=h,!this.canvas)return l;var u=this.canvas;return u.add(l),u._activeObject=l,l.setCoords(),l},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(h,d,l){h.save(),h.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",h,d),l=l||{},typeof l.hasControls>"u"&&(l.hasControls=!1),l.forActiveSelection=!0;for(var u=0,c=this._objects.length;u<c;u++)this._objects[u]._renderControls(h,l);h.restore()}}),s.ActiveSelection.fromObject=function(h,d){s.util.enlivenObjects(h.objects,function(l){delete h.objects,d&&d(new s.ActiveSelection(l,h,!0))})})}(i),function(a){var s=t.util.object.extend;if(a.fabric||(a.fabric={}),a.fabric.Image){t.warn("fabric.Image is already defined.");return}t.Image=t.util.createClass(t.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:t.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:t.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(h,d){d||(d={}),this.filters=[],this.cacheKey="texture"+t.Object.__uid++,this.callSuper("initialize",d),this._initElement(h,d)},getElement:function(){return this._element||{}},setElement:function(h,d){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=h,this._originalElement=h,this._initConfig(d),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(h){var d=t.filterBackend;d&&d.evictCachesForKey&&d.evictCachesForKey(h)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(h){t.util.cleanUpJsdomNode(this[h]),this[h]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var h=this.getElement();return{width:h.naturalWidth||h.width,height:h.naturalHeight||h.height}},_stroke:function(h){if(!(!this.stroke||this.strokeWidth===0)){var d=this.width/2,l=this.height/2;h.beginPath(),h.moveTo(-d,-l),h.lineTo(d,-l),h.lineTo(d,l),h.lineTo(-d,l),h.lineTo(-d,-l),h.closePath()}},toObject:function(h){var d=[];this.filters.forEach(function(u){u&&d.push(u.toObject())});var l=s(this.callSuper("toObject",["cropX","cropY"].concat(h)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:d});return this.resizeFilter&&(l.resizeFilter=this.resizeFilter.toObject()),l},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var h=[],d=[],l,u=this._element,c=-this.width/2,f=-this.height/2,v="",p="";if(!u)return[];if(this.hasCrop()){var y=t.Object.__uid++;h.push('<clipPath id="imageCrop_'+y+`">
`,'	<rect x="'+c+'" y="'+f+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),v=' clip-path="url(#imageCrop_'+y+')" '}if(this.imageSmoothing||(p='" image-rendering="optimizeSpeed'),d.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',f-this.cropY,'" width="',u.width||u.naturalWidth,'" height="',u.height||u.height,p,'"',v,`></image>
`),this.stroke||this.strokeDashArray){var b=this.fill;this.fill=null,l=["	<rect ",'x="',c,'" y="',f,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=b}return this.paintFirst!=="fill"?h=h.concat(l,d):h=h.concat(d,l),h},getSrc:function(h){var d=h?this._element:this._originalElement;return d?d.toDataURL?d.toDataURL():this.srcFromAttribute?d.getAttribute("src"):d.src:this.src||""},setSrc:function(h,d,l){return t.util.loadImage(h,function(u,c){this.setElement(u,l),this._setWidthHeight(),d&&d(this,c)},this,l&&l.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var h=this.resizeFilter,d=this.minimumScaleTrigger,l=this.getTotalObjectScaling(),u=l.scaleX,c=l.scaleY,f=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!h||u>d&&c>d){this._element=f,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=u,this._lastScaleY=c;return}t.filterBackend||(t.filterBackend=t.initFilterBackend());var v=t.util.createCanvasElement(),p=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,y=f.width,b=f.height;v.width=y,v.height=b,this._element=v,this._lastScaleX=h.scaleX=u,this._lastScaleY=h.scaleY=c,t.filterBackend.applyFilters([h],f,y,b,this._element,p),this._filterScalingX=v.width/this._originalElement.width,this._filterScalingY=v.height/this._originalElement.height},applyFilters:function(h){if(h=h||this.filters||[],h=h.filter(function(f){return f&&!f.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),h.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var d=this._originalElement,l=d.naturalWidth||d.width,u=d.naturalHeight||d.height;if(this._element===this._originalElement){var c=t.util.createCanvasElement();c.width=l,c.height=u,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,l,u),this._lastScaleX=1,this._lastScaleY=1;return t.filterBackend||(t.filterBackend=t.initFilterBackend()),t.filterBackend.applyFilters(h,this._originalElement,l,u,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(h){t.util.setImageSmoothing(h,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(h),this._renderPaintInOrder(h)},drawCacheOnCanvas:function(h){t.util.setImageSmoothing(h,this.imageSmoothing),t.Object.prototype.drawCacheOnCanvas.call(this,h)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(h){var d=this._element;if(d){var l=this._filterScalingX,u=this._filterScalingY,c=this.width,f=this.height,v=Math.min,p=Math.max,y=p(this.cropX,0),b=p(this.cropY,0),x=d.naturalWidth||d.width,S=d.naturalHeight||d.height,w=y*l,E=b*u,P=v(c*l,x-w),A=v(f*u,S-E),N=-c/2,k=-f/2,U=v(c,x/l-y),j=v(f,S/u-b);d&&h.drawImage(d,w,E,P,A,N,k,U,j)}},_needsResize:function(){var h=this.getTotalObjectScaling();return h.scaleX!==this._lastScaleX||h.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(h,d){this.setElement(t.util.getById(h),d),t.util.addClass(this.getElement(),t.Image.CSS_CANVAS)},_initConfig:function(h){h||(h={}),this.setOptions(h),this._setWidthHeight(h)},_initFilters:function(h,d){h&&h.length?t.util.enlivenObjects(h,function(l){d&&d(l)},"fabric.Image.filters"):d&&d()},_setWidthHeight:function(h){h||(h={});var d=this.getElement();this.width=h.width||d.naturalWidth||d.width||0,this.height=h.height||d.naturalHeight||d.height||0},parsePreserveAspectRatioAttribute:function(){var h=t.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),d=this._element.width,l=this._element.height,u=1,c=1,f=0,v=0,p=0,y=0,b,x=this.width,S=this.height,w={width:x,height:S};return h&&(h.alignX!=="none"||h.alignY!=="none")?(h.meetOrSlice==="meet"&&(u=c=t.util.findScaleToFit(this._element,w),b=(x-d*u)/2,h.alignX==="Min"&&(f=-b),h.alignX==="Max"&&(f=b),b=(S-l*c)/2,h.alignY==="Min"&&(v=-b),h.alignY==="Max"&&(v=b)),h.meetOrSlice==="slice"&&(u=c=t.util.findScaleToCover(this._element,w),b=d-x/u,h.alignX==="Mid"&&(p=b/2),h.alignX==="Max"&&(p=b),b=l-S/c,h.alignY==="Mid"&&(y=b/2),h.alignY==="Max"&&(y=b),d=x/u,l=S/c)):(u=x/d,c=S/l),{width:d,height:l,scaleX:u,scaleY:c,offsetLeft:f,offsetTop:v,cropX:p,cropY:y}}}),t.Image.CSS_CANVAS="canvas-img",t.Image.prototype.getSvgSrc=t.Image.prototype.getSrc,t.Image.fromObject=function(h,d){var l=t.util.object.clone(h);t.util.loadImage(l.src,function(u,c){if(c){d&&d(null,!0);return}t.Image.prototype._initFilters.call(l,l.filters,function(f){l.filters=f||[],t.Image.prototype._initFilters.call(l,[l.resizeFilter],function(v){l.resizeFilter=v[0],t.util.enlivenObjectEnlivables(l,l,function(){var p=new t.Image(u,l);d(p,!1)})})})},null,l.crossOrigin)},t.Image.fromURL=function(h,d,l){t.util.loadImage(h,function(u,c){d&&d(new t.Image(u,l),c)},null,l&&l.crossOrigin)},t.Image.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),t.Image.fromElement=function(h,d,l){var u=t.parseAttributes(h,t.Image.ATTRIBUTE_NAMES);t.Image.fromURL(u["xlink:href"],d,s(l?t.util.object.clone(l):{},u))}}(i),t.util.object.extend(t.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;return a>0?Math.round((a-1)/90)*90:Math.round(a/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(a){a=a||{};var s=function(){},h=a.onComplete||s,d=a.onChange||s,l=this;return t.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(u){l.rotate(u),d()},onComplete:function(){l.setCoords(),h()}})}}),t.util.object.extend(t.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function a(h,d){var l="precision "+d+` float;
void main(){}`,u=h.createShader(h.FRAGMENT_SHADER);return h.shaderSource(u,l),h.compileShader(u),!!h.getShaderParameter(u,h.COMPILE_STATUS)}t.isWebglSupported=function(h){if(t.isLikelyNode)return!1;h=h||t.WebglFilterBackend.prototype.tileSize;var d=document.createElement("canvas"),l=d.getContext("webgl")||d.getContext("experimental-webgl"),u=!1;if(l){t.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),u=t.maxTextureSize>=h;for(var c=["highp","mediump","lowp"],f=0;f<3;f++)if(a(l,c[f])){t.webGlPrecision=c[f];break}}return this.isSupported=u,u},t.WebglFilterBackend=s;function s(h){h&&h.tileSize&&(this.tileSize=h.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(h,d){this.dispose(),this.createWebGLCanvas(h,d),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(h,d)},chooseFastestCopyGLTo2DMethod:function(h,d){var l=typeof window.performance<"u",u;try{new ImageData(1,1),u=!0}catch{u=!1}var c=typeof ArrayBuffer<"u",f=typeof Uint8ClampedArray<"u";if(l&&u&&c&&f){var v=t.util.createCanvasElement(),p=new ArrayBuffer(h*d*4);if(t.forceGLPutImageData){this.imageBuffer=p,this.copyGLTo2D=m;return}var y={imageBuffer:p,destinationWidth:h,destinationHeight:d,targetCanvas:v},b,x,S;v.width=h,v.height=d,b=window.performance.now(),o.call(y,this.gl,y),x=window.performance.now()-b,b=window.performance.now(),m.call(y,this.gl,y),S=window.performance.now()-b,x>S?(this.imageBuffer=p,this.copyGLTo2D=m):this.copyGLTo2D=o}},createWebGLCanvas:function(h,d){var l=t.util.createCanvasElement();l.width=h,l.height=d;var u={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=l.getContext("webgl",u);c||(c=l.getContext("experimental-webgl",u)),c&&(c.clearColor(0,0,0,0),this.canvas=l,this.gl=c)},applyFilters:function(h,d,l,u,c,f){var v=this.gl,p;f&&(p=this.getCachedTexture(f,d));var y={originalWidth:d.width||d.originalWidth,originalHeight:d.height||d.originalHeight,sourceWidth:l,sourceHeight:u,destinationWidth:l,destinationHeight:u,context:v,sourceTexture:this.createTexture(v,l,u,!p&&d),targetTexture:this.createTexture(v,l,u),originalTexture:p||this.createTexture(v,l,u,!p&&d),passes:h.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},b=v.createFramebuffer();return v.bindFramebuffer(v.FRAMEBUFFER,b),h.forEach(function(x){x&&x.applyTo(y)}),n(y),this.copyGLTo2D(v,y),v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(y.sourceTexture),v.deleteTexture(y.targetTexture),v.deleteFramebuffer(b),c.getContext("2d").setTransform(1,0,0,1,0,0),y},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(h,d,l,u,c){var f=h.createTexture();return h.bindTexture(h.TEXTURE_2D,f),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,c||h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,c||h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),u?h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,u):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,d,l,0,h.RGBA,h.UNSIGNED_BYTE,null),f},getCachedTexture:function(h,d){if(this.textureCache[h])return this.textureCache[h];var l=this.createTexture(this.gl,d.width,d.height,d);return this.textureCache[h]=l,l},evictCachesForKey:function(h){this.textureCache[h]&&(this.gl.deleteTexture(this.textureCache[h]),delete this.textureCache[h])},copyGLTo2D:o,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var h=this.gl,d={renderer:"",vendor:""};if(!h)return d;var l=h.getExtension("WEBGL_debug_renderer_info");if(l){var u=h.getParameter(l.UNMASKED_RENDERER_WEBGL),c=h.getParameter(l.UNMASKED_VENDOR_WEBGL);u&&(d.renderer=u.toLowerCase()),c&&(d.vendor=c.toLowerCase())}return this.gpuInfo=d,d}}}();function n(a){var s=a.targetCanvas,h=s.width,d=s.height,l=a.destinationWidth,u=a.destinationHeight;(h!==l||d!==u)&&(s.width=l,s.height=u)}function o(a,s){var h=a.canvas,d=s.targetCanvas,l=d.getContext("2d");l.translate(0,d.height),l.scale(1,-1);var u=h.height-d.height;l.drawImage(h,0,u,d.width,d.height,0,0,d.width,d.height)}function m(a,s){var h=s.targetCanvas,d=h.getContext("2d"),l=s.destinationWidth,u=s.destinationHeight,c=l*u*4,f=new Uint8Array(this.imageBuffer,0,c),v=new Uint8ClampedArray(this.imageBuffer,0,c);a.readPixels(0,0,l,u,a.RGBA,a.UNSIGNED_BYTE,f);var p=new ImageData(v,l,u);d.putImageData(p,0,0)}(function(){var a=function(){};t.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(h,d,l,u,c){var f=c.getContext("2d");f.drawImage(d,0,0,l,u);var v=f.getImageData(0,0,l,u),p=f.getImageData(0,0,l,u),y={sourceWidth:l,sourceHeight:u,imageData:v,originalEl:d,originalImageData:p,canvasEl:c,ctx:f,filterBackend:this};return h.forEach(function(b){b.applyTo(y)}),(y.imageData.width!==l||y.imageData.height!==u)&&(c.width=y.imageData.width,c.height=y.imageData.height),f.putImageData(y.imageData,0,0),y}}})(),t.Image=t.Image||{},t.Image.filters=t.Image.filters||{},t.Image.filters.BaseFilter=t.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var s in a)this[s]=a[s]},createProgram:function(a,s,h){s=s||this.fragmentSource,h=h||this.vertexSource,t.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+t.webGlPrecision+" float"));var d=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(d,h),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+a.getShaderInfoLog(d));var l=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(l,s),a.compileShader(l),!a.getShaderParameter(l,a.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+a.getShaderInfoLog(l));var u=a.createProgram();if(a.attachShader(u,d),a.attachShader(u,l),a.linkProgram(u),!a.getProgramParameter(u,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(u));var c=this.getAttributeLocations(a,u),f=this.getUniformLocations(a,u)||{};return f.uStepW=a.getUniformLocation(u,"uStepW"),f.uStepH=a.getUniformLocation(u,"uStepH"),{program:u,attributeLocations:c,uniformLocations:f}},getAttributeLocations:function(a,s){return{aPosition:a.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(a,s,h){var d=s.aPosition,l=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,l),a.enableVertexAttribArray(d),a.vertexAttribPointer(d,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,h,a.STATIC_DRAW)},_setupFrameBuffer:function(a){var s=a.context,h,d;a.passes>1?(h=a.destinationWidth,d=a.destinationHeight,(a.sourceWidth!==h||a.sourceHeight!==d)&&(s.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(s,h,d)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,a.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(a){a.passes--,a.pass++;var s=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=s},isNeutralState:function(){var a=this.mainParameter,s=t.Image.filters[this.type].prototype;if(a)if(Array.isArray(s[a])){for(var h=s[a].length;h--;)if(this[a][h]!==s[a][h])return!1;return!0}else return s[a]===this[a];else return!1},applyTo:function(a){a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var s=a.context,h=this.retrieveShader(a);a.pass===0&&a.originalTexture?s.bindTexture(s.TEXTURE_2D,a.originalTexture):s.bindTexture(s.TEXTURE_2D,a.sourceTexture),s.useProgram(h.program),this.sendAttributeData(s,h.attributeLocations,a.aPosition),s.uniform1f(h.uniformLocations.uStepW,1/a.sourceWidth),s.uniform1f(h.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(s,h.uniformLocations),s.viewport(0,0,a.destinationWidth,a.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,s,h){a.activeTexture(h),a.bindTexture(a.TEXTURE_2D,s),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,s){a.activeTexture(s),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var s=document.createElement("canvas");s.width=a.sourceWidth,s.height=a.sourceHeight,a.helpLayer=s}},toObject:function(){var a={type:this.type},s=this.mainParameter;return s&&(a[s]=this[s]),a},toJSON:function(){return this.toObject()}}),t.Image.filters.BaseFilter.fromObject=function(a,s){var h=new t.Image.filters[a.type](a);return s&&s(h),h},function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.ColorMatrix=d(h.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(l){this.callSuper("initialize",l),this.matrix=this.matrix.slice(0)},applyTo2d:function(l){var u=l.imageData,c=u.data,f=c.length,v=this.matrix,p,y,b,x,S,w=this.colorsOnly;for(S=0;S<f;S+=4)p=c[S],y=c[S+1],b=c[S+2],w?(c[S]=p*v[0]+y*v[1]+b*v[2]+v[4]*255,c[S+1]=p*v[5]+y*v[6]+b*v[7]+v[9]*255,c[S+2]=p*v[10]+y*v[11]+b*v[12]+v[14]*255):(x=c[S+3],c[S]=p*v[0]+y*v[1]+b*v[2]+x*v[3]+v[4]*255,c[S+1]=p*v[5]+y*v[6]+b*v[7]+x*v[8]+v[9]*255,c[S+2]=p*v[10]+y*v[11]+b*v[12]+x*v[13]+v[14]*255,c[S+3]=p*v[15]+y*v[16]+b*v[17]+x*v[18]+v[19]*255)},getUniformLocations:function(l,u){return{uColorMatrix:l.getUniformLocation(u,"uColorMatrix"),uConstants:l.getUniformLocation(u,"uConstants")}},sendUniformData:function(l,u){var c=this.matrix,f=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],v=[c[4],c[9],c[14],c[19]];l.uniformMatrix4fv(u.uColorMatrix,!1,f),l.uniform4fv(u.uConstants,v)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Brightness=d(h.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(l){if(this.brightness!==0){var u=l.imageData,c=u.data,f,v=c.length,p=Math.round(this.brightness*255);for(f=0;f<v;f+=4)c[f]=c[f]+p,c[f+1]=c[f+1]+p,c[f+2]=c[f+2]+p}},getUniformLocations:function(l,u){return{uBrightness:l.getUniformLocation(u,"uBrightness")}},sendUniformData:function(l,u){l.uniform1f(u.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.Image.filters,l=s.util.createClass;d.Convolute=l(d.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(u){var c=Math.sqrt(this.matrix.length),f=this.type+"_"+c+"_"+(this.opaque?1:0),v=this.fragmentSource[f];return u.programCache.hasOwnProperty(f)||(u.programCache[f]=this.createProgram(u.context,v)),u.programCache[f]},applyTo2d:function(u){var c=u.imageData,f=c.data,v=this.matrix,p=Math.round(Math.sqrt(v.length)),y=Math.floor(p/2),b=c.width,x=c.height,S=u.ctx.createImageData(b,x),w=S.data,E=this.opaque?1:0,P,A,N,k,U,j,X,W,Q,ot,it,ct,O;for(it=0;it<x;it++)for(ot=0;ot<b;ot++){for(U=(it*b+ot)*4,P=0,A=0,N=0,k=0,O=0;O<p;O++)for(ct=0;ct<p;ct++)X=it+O-y,j=ot+ct-y,!(X<0||X>=x||j<0||j>=b)&&(W=(X*b+j)*4,Q=v[O*p+ct],P+=f[W]*Q,A+=f[W+1]*Q,N+=f[W+2]*Q,E||(k+=f[W+3]*Q));w[U]=P,w[U+1]=A,w[U+2]=N,E?w[U+3]=f[U+3]:w[U+3]=k}u.imageData=S},getUniformLocations:function(u,c){return{uMatrix:u.getUniformLocation(c,"uMatrix"),uOpaque:u.getUniformLocation(c,"uOpaque"),uHalfSize:u.getUniformLocation(c,"uHalfSize"),uSize:u.getUniformLocation(c,"uSize")}},sendUniformData:function(u,c){u.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return h(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Grayscale=d(h.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(l){var u=l.imageData,c=u.data,f,v=c.length,p,y=this.mode;for(f=0;f<v;f+=4)y==="average"?p=(c[f]+c[f+1]+c[f+2])/3:y==="lightness"?p=(Math.min(c[f],c[f+1],c[f+2])+Math.max(c[f],c[f+1],c[f+2]))/2:y==="luminosity"&&(p=.21*c[f]+.72*c[f+1]+.07*c[f+2]),c[f]=p,c[f+1]=p,c[f+2]=p},retrieveShader:function(l){var u=this.type+"_"+this.mode;if(!l.programCache.hasOwnProperty(u)){var c=this.fragmentSource[this.mode];l.programCache[u]=this.createProgram(l.context,c)}return l.programCache[u]},getUniformLocations:function(l,u){return{uMode:l.getUniformLocation(u,"uMode")}},sendUniformData:function(l,u){var c=1;l.uniform1i(u.uMode,c)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Invert=d(h.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(l){var u=l.imageData,c=u.data,f,v=c.length;for(f=0;f<v;f+=4)c[f]=255-c[f],c[f+1]=255-c[f+1],c[f+2]=255-c[f+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(l,u){return{uInvert:l.getUniformLocation(u,"uInvert")}},sendUniformData:function(l,u){l.uniform1i(u.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.Image.filters,l=s.util.createClass;d.Noise=l(d.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(u){if(this.noise!==0){var c=u.imageData,f=c.data,v,p=f.length,y=this.noise,b;for(v=0,p=f.length;v<p;v+=4)b=(.5-Math.random())*y,f[v]+=b,f[v+1]+=b,f[v+2]+=b}},getUniformLocations:function(u,c){return{uNoise:u.getUniformLocation(c,"uNoise"),uSeed:u.getUniformLocation(c,"uSeed")}},sendUniformData:function(u,c){u.uniform1f(c.uNoise,this.noise/255),u.uniform1f(c.uSeed,Math.random())},toObject:function(){return h(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Pixelate=d(h.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(l){var u=l.imageData,c=u.data,f=u.height,v=u.width,p,y,b,x,S,w,E,P,A,N,k;for(y=0;y<f;y+=this.blocksize)for(b=0;b<v;b+=this.blocksize)for(p=y*4*v+b*4,x=c[p],S=c[p+1],w=c[p+2],E=c[p+3],N=Math.min(y+this.blocksize,f),k=Math.min(b+this.blocksize,v),P=y;P<N;P++)for(A=b;A<k;A++)p=P*4*v+A*4,c[p]=x,c[p+1]=S,c[p+2]=w,c[p+3]=E},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(l,u){return{uBlocksize:l.getUniformLocation(u,"uBlocksize"),uStepW:l.getUniformLocation(u,"uStepW"),uStepH:l.getUniformLocation(u,"uStepH")}},sendUniformData:function(l,u){l.uniform1f(u.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.extend,d=s.Image.filters,l=s.util.createClass;d.RemoveColor=l(d.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(u){var c=u.imageData,f=c.data,v,p=this.distance*255,y,b,x,S=new s.Color(this.color).getSource(),w=[S[0]-p,S[1]-p,S[2]-p],E=[S[0]+p,S[1]+p,S[2]+p];for(v=0;v<f.length;v+=4)y=f[v],b=f[v+1],x=f[v+2],y>w[0]&&b>w[1]&&x>w[2]&&y<E[0]&&b<E[1]&&x<E[2]&&(f[v+3]=0)},getUniformLocations:function(u,c){return{uLow:u.getUniformLocation(c,"uLow"),uHigh:u.getUniformLocation(c,"uHigh")}},sendUniformData:function(u,c){var f=new s.Color(this.color).getSource(),v=parseFloat(this.distance),p=[0+f[0]/255-v,0+f[1]/255-v,0+f[2]/255-v,1],y=[f[0]/255+v,f[1]/255+v,f[2]/255+v,1];u.uniform4fv(c.uLow,p),u.uniform4fv(c.uHigh,y)},toObject:function(){return h(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass,l={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var u in l)h[u]=d(h.ColorMatrix,{type:u,matrix:l[u],mainParameter:!1,colorsOnly:!0}),s.Image.filters[u].fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric,h=s.Image.filters,d=s.util.createClass;h.BlendColor=d(h.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(l){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[l]+`}
}`},retrieveShader:function(l){var u=this.type+"_"+this.mode,c;return l.programCache.hasOwnProperty(u)||(c=this.buildSource(this.mode),l.programCache[u]=this.createProgram(l.context,c)),l.programCache[u]},applyTo2d:function(l){var u=l.imageData,c=u.data,f=c.length,v,p,y,b,x,S,w,E=1-this.alpha;w=new s.Color(this.color).getSource(),v=w[0]*this.alpha,p=w[1]*this.alpha,y=w[2]*this.alpha;for(var P=0;P<f;P+=4)switch(b=c[P],x=c[P+1],S=c[P+2],this.mode){case"multiply":c[P]=b*v/255,c[P+1]=x*p/255,c[P+2]=S*y/255;break;case"screen":c[P]=255-(255-b)*(255-v)/255,c[P+1]=255-(255-x)*(255-p)/255,c[P+2]=255-(255-S)*(255-y)/255;break;case"add":c[P]=b+v,c[P+1]=x+p,c[P+2]=S+y;break;case"diff":case"difference":c[P]=Math.abs(b-v),c[P+1]=Math.abs(x-p),c[P+2]=Math.abs(S-y);break;case"subtract":c[P]=b-v,c[P+1]=x-p,c[P+2]=S-y;break;case"darken":c[P]=Math.min(b,v),c[P+1]=Math.min(x,p),c[P+2]=Math.min(S,y);break;case"lighten":c[P]=Math.max(b,v),c[P+1]=Math.max(x,p),c[P+2]=Math.max(S,y);break;case"overlay":c[P]=v<128?2*b*v/255:255-2*(255-b)*(255-v)/255,c[P+1]=p<128?2*x*p/255:255-2*(255-x)*(255-p)/255,c[P+2]=y<128?2*S*y/255:255-2*(255-S)*(255-y)/255;break;case"exclusion":c[P]=v+b-2*v*b/255,c[P+1]=p+x-2*p*x/255,c[P+2]=y+S-2*y*S/255;break;case"tint":c[P]=v+b*E,c[P+1]=p+x*E,c[P+2]=y+S*E}},getUniformLocations:function(l,u){return{uColor:l.getUniformLocation(u,"uColor")}},sendUniformData:function(l,u){var c=new s.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,l.uniform4fv(u.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric,h=s.Image.filters,d=s.util.createClass;h.BlendImage=d(h.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(l){var u=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return l.programCache.hasOwnProperty(u)||(l.programCache[u]=this.createProgram(l.context,c)),l.programCache[u]},applyToWebGL:function(l){var u=l.context,c=this.createTexture(l.filterBackend,this.image);this.bindAdditionalTexture(u,c,u.TEXTURE1),this.callSuper("applyToWebGL",l),this.unbindAdditionalTexture(u,u.TEXTURE1)},createTexture:function(l,u){return l.getCachedTexture(u.cacheKey,u._element)},calculateMatrix:function(){var l=this.image,u=l._element.width,c=l._element.height;return[1/l.scaleX,0,0,0,1/l.scaleY,0,-l.left/u,-l.top/c,1]},applyTo2d:function(l){var u=l.imageData,c=l.filterBackend.resources,f=u.data,v=f.length,p=u.width,y=u.height,b,x,S,w,E,P,A,N,k,U,j=this.image,X;c.blendImage||(c.blendImage=s.util.createCanvasElement()),k=c.blendImage,U=k.getContext("2d"),k.width!==p||k.height!==y?(k.width=p,k.height=y):U.clearRect(0,0,p,y),U.setTransform(j.scaleX,0,0,j.scaleY,j.left,j.top),U.drawImage(j._element,0,0,p,y),X=U.getImageData(0,0,p,y).data;for(var W=0;W<v;W+=4)switch(E=f[W],P=f[W+1],A=f[W+2],N=f[W+3],b=X[W],x=X[W+1],S=X[W+2],w=X[W+3],this.mode){case"multiply":f[W]=E*b/255,f[W+1]=P*x/255,f[W+2]=A*S/255,f[W+3]=N*w/255;break;case"mask":f[W+3]=w;break}},getUniformLocations:function(l,u){return{uTransformMatrix:l.getUniformLocation(u,"uTransformMatrix"),uImage:l.getUniformLocation(u,"uImage")}},sendUniformData:function(l,u){var c=this.calculateMatrix();l.uniform1i(u.uImage,1),l.uniformMatrix3fv(u.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(l,u){s.Image.fromObject(l.image,function(c){var f=s.util.object.clone(l);f.image=c,u(new s.Image.filters.BlendImage(f))})}}(i),function(a){var s=a.fabric||(a.fabric={}),h=Math.pow,d=Math.floor,l=Math.sqrt,u=Math.abs,c=Math.round,f=Math.sin,v=Math.ceil,p=s.Image.filters,y=s.util.createClass;p.Resize=y(p.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(b,x){return{uDelta:b.getUniformLocation(x,"uDelta"),uTaps:b.getUniformLocation(x,"uTaps")}},sendUniformData:function(b,x){b.uniform2fv(x.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),b.uniform1fv(x.uTaps,this.taps)},retrieveShader:function(b){var x=this.getFilterWindow(),S=this.type+"_"+x;if(!b.programCache.hasOwnProperty(S)){var w=this.generateShader(x);b.programCache[S]=this.createProgram(b.context,w)}return b.programCache[S]},getFilterWindow:function(){var b=this.tempScale;return Math.ceil(this.lanczosLobes/b)},getTaps:function(){for(var b=this.lanczosCreate(this.lanczosLobes),x=this.tempScale,S=this.getFilterWindow(),w=new Array(S),E=1;E<=S;E++)w[E-1]=b(E*x);return w},generateShader:function(w){for(var x=new Array(w),S=this.fragmentSourceTOP,w,E=1;E<=w;E++)x[E-1]=E+".0 * uDelta";return S+="uniform float uTaps["+w+`];
`,S+=`void main() {
`,S+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,S+=`  float sum = 1.0;
`,x.forEach(function(P,A){S+="  color += texture2D(uTexture, vTexCoord + "+P+") * uTaps["+A+`];
`,S+="  color += texture2D(uTexture, vTexCoord - "+P+") * uTaps["+A+`];
`,S+="  sum += 2.0 * uTaps["+A+`];
`}),S+=`  gl_FragColor = color / sum;
`,S+="}",S},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(b){b.webgl?(b.passes++,this.width=b.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=b.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),b.destinationWidth=this.dW,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceWidth=b.destinationWidth,this.height=b.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),b.destinationHeight=this.dH,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceHeight=b.destinationHeight):this.applyTo2d(b)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(b){return function(x){if(x>=b||x<=-b)return 0;if(x<11920929e-14&&x>-11920929e-14)return 1;x*=Math.PI;var S=x/b;return f(x)/x*f(S)/S}},applyTo2d:function(b){var x=b.imageData,S=this.scaleX,w=this.scaleY;this.rcpScaleX=1/S,this.rcpScaleY=1/w;var E=x.width,P=x.height,A=c(E*S),N=c(P*w),k;this.resizeType==="sliceHack"?k=this.sliceByTwo(b,E,P,A,N):this.resizeType==="hermite"?k=this.hermiteFastResize(b,E,P,A,N):this.resizeType==="bilinear"?k=this.bilinearFiltering(b,E,P,A,N):this.resizeType==="lanczos"&&(k=this.lanczosResize(b,E,P,A,N)),b.imageData=k},sliceByTwo:function(b,x,S,w,E){var P=b.imageData,A=.5,N=!1,k=!1,U=x*A,j=S*A,X=s.filterBackend.resources,W,Q,ot=0,it=0,ct=x,O=0;for(X.sliceByTwo||(X.sliceByTwo=document.createElement("canvas")),W=X.sliceByTwo,(W.width<x*1.5||W.height<S)&&(W.width=x*1.5,W.height=S),Q=W.getContext("2d"),Q.clearRect(0,0,x*1.5,S),Q.putImageData(P,0,0),w=d(w),E=d(E);!N||!k;)x=U,S=j,w<d(U*A)?U=d(U*A):(U=w,N=!0),E<d(j*A)?j=d(j*A):(j=E,k=!0),Q.drawImage(W,ot,it,x,S,ct,O,U,j),ot=ct,it=O,O+=j;return Q.getImageData(ot,it,w,E)},lanczosResize:function(b,x,S,w,E){function P(L){var H,Z,G,F,Y,R,z,$,st,nt,ft;for(O.x=(L+.5)*j,M.x=d(O.x),H=0;H<E;H++){for(O.y=(H+.5)*X,M.y=d(O.y),Y=0,R=0,z=0,$=0,st=0,Z=M.x-ot;Z<=M.x+ot;Z++)if(!(Z<0||Z>=x)){nt=d(1e3*u(Z-O.x)),ct[nt]||(ct[nt]={});for(var et=M.y-it;et<=M.y+it;et++)et<0||et>=S||(ft=d(1e3*u(et-O.y)),ct[nt][ft]||(ct[nt][ft]=U(l(h(nt*W,2)+h(ft*Q,2))/1e3)),G=ct[nt][ft],G>0&&(F=(et*x+Z)*4,Y+=G,R+=G*A[F],z+=G*A[F+1],$+=G*A[F+2],st+=G*A[F+3]))}F=(H*w+L)*4,k[F]=R/Y,k[F+1]=z/Y,k[F+2]=$/Y,k[F+3]=st/Y}return++L<w?P(L):N}var A=b.imageData.data,N=b.ctx.createImageData(w,E),k=N.data,U=this.lanczosCreate(this.lanczosLobes),j=this.rcpScaleX,X=this.rcpScaleY,W=2/this.rcpScaleX,Q=2/this.rcpScaleY,ot=v(j*this.lanczosLobes/2),it=v(X*this.lanczosLobes/2),ct={},O={},M={};return P(0)},bilinearFiltering:function(b,x,S,w,E){var P,A,N,k,U,j,X,W,Q,ot,it,ct,O=0,M,L=this.rcpScaleX,H=this.rcpScaleY,Z=4*(x-1),G=b.imageData,F=G.data,Y=b.ctx.createImageData(w,E),R=Y.data;for(X=0;X<E;X++)for(W=0;W<w;W++)for(U=d(L*W),j=d(H*X),Q=L*W-U,ot=H*X-j,M=4*(j*x+U),it=0;it<4;it++)P=F[M+it],A=F[M+4+it],N=F[M+Z+it],k=F[M+Z+4+it],ct=P*(1-Q)*(1-ot)+A*Q*(1-ot)+N*ot*(1-Q)+k*Q*ot,R[O++]=ct;return Y},hermiteFastResize:function(b,x,S,w,E){for(var P=this.rcpScaleX,A=this.rcpScaleY,N=v(P/2),k=v(A/2),U=b.imageData,j=U.data,X=b.ctx.createImageData(w,E),W=X.data,Q=0;Q<E;Q++)for(var ot=0;ot<w;ot++){for(var it=(ot+Q*w)*4,ct=0,O=0,M=0,L=0,H=0,Z=0,G=0,F=(Q+.5)*A,Y=d(Q*A);Y<(Q+1)*A;Y++)for(var R=u(F-(Y+.5))/k,z=(ot+.5)*P,$=R*R,st=d(ot*P);st<(ot+1)*P;st++){var nt=u(z-(st+.5))/N,ft=l($+nt*nt);ft>1&&ft<-1||(ct=2*ft*ft*ft-3*ft*ft+1,ct>0&&(nt=4*(st+Y*x),G+=ct*j[nt+3],M+=ct,j[nt+3]<255&&(ct=ct*j[nt+3]/250),L+=ct*j[nt],H+=ct*j[nt+1],Z+=ct*j[nt+2],O+=ct))}W[it]=L/O,W[it+1]=H/O,W[it+2]=Z/O,W[it+3]=G/M}return X},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Contrast=d(h.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(l){if(this.contrast!==0){var u=l.imageData,c,v,f=u.data,v=f.length,p=Math.floor(this.contrast*255),y=259*(p+255)/(255*(259-p));for(c=0;c<v;c+=4)f[c]=y*(f[c]-128)+128,f[c+1]=y*(f[c+1]-128)+128,f[c+2]=y*(f[c+2]-128)+128}},getUniformLocations:function(l,u){return{uContrast:l.getUniformLocation(u,"uContrast")}},sendUniformData:function(l,u){l.uniform1f(u.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Saturation=d(h.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(l){if(this.saturation!==0){var u=l.imageData,c=u.data,f=c.length,v=-this.saturation,p,y;for(p=0;p<f;p+=4)y=Math.max(c[p],c[p+1],c[p+2]),c[p]+=y!==c[p]?(y-c[p])*v:0,c[p+1]+=y!==c[p+1]?(y-c[p+1])*v:0,c[p+2]+=y!==c[p+2]?(y-c[p+2])*v:0}},getUniformLocations:function(l,u){return{uSaturation:l.getUniformLocation(u,"uSaturation")}},sendUniformData:function(l,u){l.uniform1f(u.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Vibrance=d(h.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(l){if(this.vibrance!==0){var u=l.imageData,c=u.data,f=c.length,v=-this.vibrance,p,y,b,x;for(p=0;p<f;p+=4)y=Math.max(c[p],c[p+1],c[p+2]),b=(c[p]+c[p+1]+c[p+2])/3,x=Math.abs(y-b)*2/255*v,c[p]+=y!==c[p]?(y-c[p])*x:0,c[p+1]+=y!==c[p+1]?(y-c[p+1])*x:0,c[p+2]+=y!==c[p+2]?(y-c[p+2])*x:0}},getUniformLocations:function(l,u){return{uVibrance:l.getUniformLocation(u,"uVibrance")}},sendUniformData:function(l,u){l.uniform1f(u.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Blur=d(h.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(l){l.webgl?(this.aspectRatio=l.sourceWidth/l.sourceHeight,l.passes++,this._setupFrameBuffer(l),this.horizontal=!0,this.applyToWebGL(l),this._swapTextures(l),this._setupFrameBuffer(l),this.horizontal=!1,this.applyToWebGL(l),this._swapTextures(l)):this.applyTo2d(l)},applyTo2d:function(l){l.imageData=this.simpleBlur(l)},simpleBlur:function(l){var u=l.filterBackend.resources,c,f,v=l.imageData.width,p=l.imageData.height;u.blurLayer1||(u.blurLayer1=s.util.createCanvasElement(),u.blurLayer2=s.util.createCanvasElement()),c=u.blurLayer1,f=u.blurLayer2,(c.width!==v||c.height!==p)&&(f.width=c.width=v,f.height=c.height=p);var y=c.getContext("2d"),b=f.getContext("2d"),x=15,S,w,E,P,A=this.blur*.06*.5;for(y.putImageData(l.imageData,0,0),b.clearRect(0,0,v,p),P=-x;P<=x;P++)S=(Math.random()-.5)/4,w=P/x,E=A*w*v+S,b.globalAlpha=1-Math.abs(w),b.drawImage(c,E,S),y.drawImage(f,0,0),b.globalAlpha=1,b.clearRect(0,0,f.width,f.height);for(P=-x;P<=x;P++)S=(Math.random()-.5)/4,w=P/x,E=A*w*p+S,b.globalAlpha=1-Math.abs(w),b.drawImage(c,S,E),y.drawImage(f,0,0),b.globalAlpha=1,b.clearRect(0,0,f.width,f.height);l.ctx.drawImage(c,0,0);var N=l.ctx.getImageData(0,0,c.width,c.height);return y.globalAlpha=1,y.clearRect(0,0,c.width,c.height),N},getUniformLocations:function(l,u){return{delta:l.getUniformLocation(u,"uDelta")}},sendUniformData:function(l,u){var c=this.chooseRightDelta();l.uniform2fv(u.delta,c)},chooseRightDelta:function(){var l=1,u=[0,0],c;return this.horizontal?this.aspectRatio>1&&(l=1/this.aspectRatio):this.aspectRatio<1&&(l=this.aspectRatio),c=l*this.blur*.12,this.horizontal?u[0]=c:u[1]=c,u}}),h.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Gamma=d(h.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(l){this.gamma=[1,1,1],h.BaseFilter.prototype.initialize.call(this,l)},applyTo2d:function(l){var u=l.imageData,c=u.data,f=this.gamma,v=c.length,p=1/f[0],y=1/f[1],b=1/f[2],x;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),x=0,v=256;x<v;x++)this.rVals[x]=Math.pow(x/255,p)*255,this.gVals[x]=Math.pow(x/255,y)*255,this.bVals[x]=Math.pow(x/255,b)*255;for(x=0,v=c.length;x<v;x+=4)c[x]=this.rVals[c[x]],c[x+1]=this.gVals[c[x+1]],c[x+2]=this.bVals[c[x+2]]},getUniformLocations:function(l,u){return{uGamma:l.getUniformLocation(u,"uGamma")}},sendUniformData:function(l,u){l.uniform3fv(u.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.Composed=d(h.BaseFilter,{type:"Composed",subFilters:[],initialize:function(l){this.callSuper("initialize",l),this.subFilters=this.subFilters.slice(0)},applyTo:function(l){l.passes+=this.subFilters.length-1,this.subFilters.forEach(function(u){u.applyTo(l)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(l){return l.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(l){return!l.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(l,u){var c=l.subFilters||[],f=c.map(function(p){return new s.Image.filters[p.type](p)}),v=new s.Image.filters.Composed({subFilters:f});return u&&u(v),v}}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.Image.filters,d=s.util.createClass;h.HueRotation=d(h.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var l=this.rotation*Math.PI,u=s.util.cos(l),c=s.util.sin(l),f=1/3,v=Math.sqrt(f)*c,p=1-u;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=u+p/3,this.matrix[1]=f*p-v,this.matrix[2]=f*p+v,this.matrix[5]=f*p+v,this.matrix[6]=u+f*p,this.matrix[7]=f*p-v,this.matrix[10]=f*p-v,this.matrix[11]=f*p+v,this.matrix[12]=u+f*p},isNeutralState:function(l){return this.calculateMatrix(),h.BaseFilter.prototype.isNeutralState.call(this,l)},applyTo:function(l){this.calculateMatrix(),h.BaseFilter.prototype.applyTo.call(this,l)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(i),function(a){var s=a.fabric||(a.fabric={}),h=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var d="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(d),cacheProperties:s.Object.prototype.cacheProperties.concat(d),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(l,u){this.styles=u?u.styles||{}:{},this.text=l,this.__skipDimension=!0,this.callSuper("initialize",u),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var l=this.path;l&&(l.segmentsInfo=s.util.getPathSegmentsInfo(l.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var l=this._splitTextIntoLines(this.text);return this.textLines=l.lines,this._textLines=l.graphemeLines,this._unwrappedTextLines=l._unwrappedLines,this._text=l.graphemeText,l},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var l,u,c,f,v,p,y,b=0,x=this._textLines.length;b<x;b++)if(!(this.textAlign!=="justify"&&(b===x-1||this.isEndOfWrapping(b)))&&(f=0,v=this._textLines[b],u=this.getLineWidth(b),u<this.width&&(y=this.textLines[b].match(this._reSpacesAndTabs)))){c=y.length,l=(this.width-u)/c;for(var S=0,w=v.length;S<=w;S++)p=this.__charBounds[b][S],this._reSpaceAndTab.test(v[S])?(p.width+=l,p.kernedWidth+=l,p.left+=f,f+=l):p.left+=f}},isEndOfWrapping:function(l){return l===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var l=this.callSuper("_getCacheCanvasDimensions"),u=this.fontSize;return l.width+=u*l.zoomX,l.height+=u*l.zoomY,l},_render:function(l){var u=this.path;u&&!u.isNotVisible()&&u._render(l),this._setTextStyles(l),this._renderTextLinesBackground(l),this._renderTextDecoration(l,"underline"),this._renderText(l),this._renderTextDecoration(l,"overline"),this._renderTextDecoration(l,"linethrough")},_renderText:function(l){this.paintFirst==="stroke"?(this._renderTextStroke(l),this._renderTextFill(l)):(this._renderTextFill(l),this._renderTextStroke(l))},_setTextStyles:function(l,u,c){if(l.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":l.textBaseline="middle";break;case"ascender":l.textBaseline="top";break;case"descender":l.textBaseline="bottom";break}l.font=this._getFontDeclaration(u,c)},calcTextWidth:function(){for(var l=this.getLineWidth(0),u=1,c=this._textLines.length;u<c;u++){var f=this.getLineWidth(u);f>l&&(l=f)}return l},_renderTextLine:function(l,u,c,f,v,p){this._renderChars(l,u,c,f,v,p)},_renderTextLinesBackground:function(l){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var u,c,f=l.fillStyle,v,p,y=this._getLeftOffset(),b=this._getTopOffset(),x=0,S=0,w,E,P=this.path,A,N=0,k=this._textLines.length;N<k;N++){if(u=this.getHeightOfLine(N),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",N)){b+=u;continue}v=this._textLines[N],c=this._getLineLeftOffset(N),S=0,x=0,p=this.getValueOfPropertyAt(N,0,"textBackgroundColor");for(var U=0,j=v.length;U<j;U++)w=this.__charBounds[N][U],E=this.getValueOfPropertyAt(N,U,"textBackgroundColor"),P?(l.save(),l.translate(w.renderLeft,w.renderTop),l.rotate(w.angle),l.fillStyle=E,E&&l.fillRect(-w.width/2,-u/this.lineHeight*(1-this._fontSizeFraction),w.width,u/this.lineHeight),l.restore()):E!==p?(A=y+c+x,this.direction==="rtl"&&(A=this.width-A-S),l.fillStyle=p,p&&l.fillRect(A,b,S,u/this.lineHeight),x=w.left,S=w.width,p=E):S+=w.kernedWidth;E&&!P&&(A=y+c+x,this.direction==="rtl"&&(A=this.width-A-S),l.fillStyle=E,l.fillRect(A,b,S,u/this.lineHeight)),b+=u}l.fillStyle=f,this._removeShadow(l)}},getFontCache:function(l){var u=l.fontFamily.toLowerCase();s.charWidthsCache[u]||(s.charWidthsCache[u]={});var c=s.charWidthsCache[u],f=l.fontStyle.toLowerCase()+"_"+(l.fontWeight+"").toLowerCase();return c[f]||(c[f]={}),c[f]},_measureChar:function(l,u,c,f){var v=this.getFontCache(u),p=this._getFontDeclaration(u),y=this._getFontDeclaration(f),b=c+l,x=p===y,S,w,E,P=u.fontSize/this.CACHE_FONT_SIZE,A;if(c&&v[c]!==void 0&&(E=v[c]),v[l]!==void 0&&(A=S=v[l]),x&&v[b]!==void 0&&(w=v[b],A=w-E),S===void 0||E===void 0||w===void 0){var N=this.getMeasuringContext();this._setTextStyles(N,u,!0)}return S===void 0&&(A=S=N.measureText(l).width,v[l]=S),E===void 0&&x&&c&&(E=N.measureText(c).width,v[c]=E),x&&w===void 0&&(w=N.measureText(b).width,v[b]=w,A=w-E),{width:S*P,kernedWidth:A*P}},getHeightOfChar:function(l,u){return this.getValueOfPropertyAt(l,u,"fontSize")},measureLine:function(l){var u=this._measureLine(l);return this.charSpacing!==0&&(u.width-=this._getWidthOfCharSpacing()),u.width<0&&(u.width=0),u},_measureLine:function(l){var u=0,c,f,v=this._textLines[l],p,y,b=0,x=new Array(v.length),S=0,w,E,P=this.path,A=this.pathSide==="right";for(this.__charBounds[l]=x,c=0;c<v.length;c++)f=v[c],y=this._getGraphemeBox(f,l,c,p),x[c]=y,u+=y.kernedWidth,p=f;if(x[c]={left:y?y.left+y.width:0,width:0,kernedWidth:0,height:this.fontSize},P){switch(E=P.segmentsInfo[P.segmentsInfo.length-1].length,w=s.util.getPointOnPath(P.path,0,P.segmentsInfo),w.x+=P.pathOffset.x,w.y+=P.pathOffset.y,this.textAlign){case"left":S=A?E-u:0;break;case"center":S=(E-u)/2;break;case"right":S=A?0:E-u;break}for(S+=this.pathStartOffset*(A?-1:1),c=A?v.length-1:0;A?c>=0:c<v.length;A?c--:c++)y=x[c],S>E?S%=E:S<0&&(S+=E),this._setGraphemeOnPath(S,y,w),S+=y.kernedWidth}return{width:u,numOfSpaces:b}},_setGraphemeOnPath:function(l,u,c){var f=l+u.kernedWidth/2,v=this.path,p=s.util.getPointOnPath(v.path,f,v.segmentsInfo);u.renderLeft=p.x-c.x,u.renderTop=p.y-c.y,u.angle=p.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(l,u,c,f,v){var p=this.getCompleteStyleDeclaration(u,c),y=f?this.getCompleteStyleDeclaration(u,c-1):{},b=this._measureChar(l,p,f,y),x=b.kernedWidth,S=b.width,w;this.charSpacing!==0&&(w=this._getWidthOfCharSpacing(),S+=w,x+=w);var E={width:S,left:0,height:p.fontSize,kernedWidth:x,deltaY:p.deltaY};if(c>0&&!v){var P=this.__charBounds[u][c-1];E.left=P.left+P.width+b.kernedWidth-b.width}return E},getHeightOfLine:function(l){if(this.__lineHeights[l])return this.__lineHeights[l];for(var u=this._textLines[l],c=this.getHeightOfChar(l,0),f=1,v=u.length;f<v;f++)c=Math.max(this.getHeightOfChar(l,f),c);return this.__lineHeights[l]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var l,u=0,c=0,f=this._textLines.length;c<f;c++)l=this.getHeightOfLine(c),u+=c===f-1?l/this.lineHeight:l;return u},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(l,u){l.save();for(var c=0,f=this._getLeftOffset(),v=this._getTopOffset(),p=0,y=this._textLines.length;p<y;p++){var b=this.getHeightOfLine(p),x=b/this.lineHeight,S=this._getLineLeftOffset(p);this._renderTextLine(u,l,this._textLines[p],f+S,v+c+x,p),c+=b}l.restore()},_renderTextFill:function(l){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(l,"fillText")},_renderTextStroke:function(l){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(l),l.save(),this._setLineDash(l,this.strokeDashArray),l.beginPath(),this._renderTextCommon(l,"strokeText"),l.closePath(),l.restore())},_renderChars:function(l,u,c,f,v,p){var y=this.getHeightOfLine(p),b=this.textAlign.indexOf("justify")!==-1,x,S,w="",E,P=0,A,N=this.path,k=!b&&this.charSpacing===0&&this.isEmptyStyles(p)&&!N,U=this.direction==="ltr",j=this.direction==="ltr"?1:-1,X,W=u.canvas.getAttribute("dir");if(u.save(),W!==this.direction&&(u.canvas.setAttribute("dir",U?"ltr":"rtl"),u.direction=U?"ltr":"rtl",u.textAlign=U?"left":"right"),v-=y*this._fontSizeFraction/this.lineHeight,k){this._renderChar(l,u,p,0,c.join(""),f,v,y),u.restore();return}for(var Q=0,ot=c.length-1;Q<=ot;Q++)A=Q===ot||this.charSpacing||N,w+=c[Q],E=this.__charBounds[p][Q],P===0?(f+=j*(E.kernedWidth-E.width),P+=E.width):P+=E.kernedWidth,b&&!A&&this._reSpaceAndTab.test(c[Q])&&(A=!0),A||(x=x||this.getCompleteStyleDeclaration(p,Q),S=this.getCompleteStyleDeclaration(p,Q+1),A=s.util.hasStyleChanged(x,S,!1)),A&&(N?(u.save(),u.translate(E.renderLeft,E.renderTop),u.rotate(E.angle),this._renderChar(l,u,p,Q,w,-P/2,0,y),u.restore()):(X=f,this._renderChar(l,u,p,Q,w,X,v,y)),w="",x=S,f+=j*P,P=0);u.restore()},_applyPatternGradientTransformText:function(l){var u=s.util.createCanvasElement(),c,f=this.width+this.strokeWidth,v=this.height+this.strokeWidth;return u.width=f,u.height=v,c=u.getContext("2d"),c.beginPath(),c.moveTo(0,0),c.lineTo(f,0),c.lineTo(f,v),c.lineTo(0,v),c.closePath(),c.translate(f/2,v/2),c.fillStyle=l.toLive(c),this._applyPatternGradientTransform(c,l),c.fill(),c.createPattern(u,"no-repeat")},handleFiller:function(l,u,c){var f,v;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(f=-this.width/2,v=-this.height/2,l.translate(f,v),l[u]=this._applyPatternGradientTransformText(c),{offsetX:f,offsetY:v}):(l[u]=c.toLive(l,this),this._applyPatternGradientTransform(l,c)):(l[u]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(l,u){return l.lineWidth=u.strokeWidth,l.lineCap=this.strokeLineCap,l.lineDashOffset=this.strokeDashOffset,l.lineJoin=this.strokeLineJoin,l.miterLimit=this.strokeMiterLimit,this.handleFiller(l,"strokeStyle",u.stroke)},_setFillStyles:function(l,u){return this.handleFiller(l,"fillStyle",u.fill)},_renderChar:function(l,u,c,f,v,p,y){var b=this._getStyleDeclaration(c,f),x=this.getCompleteStyleDeclaration(c,f),S=l==="fillText"&&x.fill,w=l==="strokeText"&&x.stroke&&x.strokeWidth,E,P;!w&&!S||(u.save(),S&&(E=this._setFillStyles(u,x)),w&&(P=this._setStrokeStyles(u,x)),u.font=this._getFontDeclaration(x),b&&b.textBackgroundColor&&this._removeShadow(u),b&&b.deltaY&&(y+=b.deltaY),S&&u.fillText(v,p-E.offsetX,y-E.offsetY),w&&u.strokeText(v,p-P.offsetX,y-P.offsetY),u.restore())},setSuperscript:function(l,u){return this._setScript(l,u,this.superscript)},setSubscript:function(l,u){return this._setScript(l,u,this.subscript)},_setScript:function(l,u,c){var f=this.get2DCursorLocation(l,!0),v=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"fontSize"),p=this.getValueOfPropertyAt(f.lineIndex,f.charIndex,"deltaY"),y={fontSize:v*c.size,deltaY:p+v*c.baseline};return this.setSelectionStyles(y,l,u),this},_getLineLeftOffset:function(l){var u=this.getLineWidth(l),c=this.width-u,f=this.textAlign,v=this.direction,y,p=0,y=this.isEndOfWrapping(l);return f==="justify"||f==="justify-center"&&!y||f==="justify-right"&&!y||f==="justify-left"&&!y?0:(f==="center"&&(p=c/2),f==="right"&&(p=c),f==="justify-center"&&(p=c/2),f==="justify-right"&&(p=c),v==="rtl"&&(p-=c),p)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var l=this._forceClearCache;return l||(l=this.hasStateChanged("_dimensionAffectingProps")),l&&(this.dirty=!0,this._forceClearCache=!1),l},getLineWidth:function(l){if(this.__lineWidths[l]!==void 0)return this.__lineWidths[l];var u=this.measureLine(l),c=u.width;return this.__lineWidths[l]=c,c},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(l,u,c){var f=this._getStyleDeclaration(l,u);return f&&typeof f[c]<"u"?f[c]:this[c]},_renderTextDecoration:function(l,u){if(!(!this[u]&&!this.styleHas(u))){for(var c,f,v,p,y,b,x,S,w=this._getLeftOffset(),E=this._getTopOffset(),P,A,N,k,U,j,X,W,Q=this.path,ot=this._getWidthOfCharSpacing(),it=this.offsets[u],ct=0,O=this._textLines.length;ct<O;ct++){if(c=this.getHeightOfLine(ct),!this[u]&&!this.styleHas(u,ct)){E+=c;continue}x=this._textLines[ct],j=c/this.lineHeight,p=this._getLineLeftOffset(ct),A=0,N=0,S=this.getValueOfPropertyAt(ct,0,u),W=this.getValueOfPropertyAt(ct,0,"fill"),P=E+j*(1-this._fontSizeFraction),f=this.getHeightOfChar(ct,0),y=this.getValueOfPropertyAt(ct,0,"deltaY");for(var M=0,L=x.length;M<L;M++)if(k=this.__charBounds[ct][M],U=this.getValueOfPropertyAt(ct,M,u),X=this.getValueOfPropertyAt(ct,M,"fill"),v=this.getHeightOfChar(ct,M),b=this.getValueOfPropertyAt(ct,M,"deltaY"),Q&&U&&X)l.save(),l.fillStyle=W,l.translate(k.renderLeft,k.renderTop),l.rotate(k.angle),l.fillRect(-k.kernedWidth/2,it*v+b,k.kernedWidth,this.fontSize/15),l.restore();else if((U!==S||X!==W||v!==f||b!==y)&&N>0){var H=w+p+A;this.direction==="rtl"&&(H=this.width-H-N),S&&W&&(l.fillStyle=W,l.fillRect(H,P+it*f+y,N,this.fontSize/15)),A=k.left,N=k.width,S=U,W=X,f=v,y=b}else N+=k.kernedWidth;var H=w+p+A;this.direction==="rtl"&&(H=this.width-H-N),l.fillStyle=X,U&&X&&l.fillRect(H,P+it*f+y,N-ot,this.fontSize/15),E+=c}this._removeShadow(l)}},_getFontDeclaration:function(l,u){var c=l||this,f=this.fontFamily,v=s.Text.genericFonts.indexOf(f.toLowerCase())>-1,p=f===void 0||f.indexOf("'")>-1||f.indexOf(",")>-1||f.indexOf('"')>-1||v?c.fontFamily:'"'+c.fontFamily+'"';return[s.isLikelyNode?c.fontWeight:c.fontStyle,s.isLikelyNode?c.fontStyle:c.fontWeight,u?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",p].join(" ")},render:function(l){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",l)))},_splitTextIntoLines:function(l){for(var u=l.split(this._reNewline),c=new Array(u.length),f=[`
`],v=[],p=0;p<u.length;p++)c[p]=s.util.string.graphemeSplit(u[p]),v=v.concat(c[p],f);return v.pop(),{_unwrappedLines:c,lines:u,graphemeText:v,graphemeLines:c}},toObject:function(l){var u=d.concat(l),c=this.callSuper("toObject",u);return c.styles=s.util.stylesToArray(this.styles,this.text),c.path&&(c.path=this.path.toObject()),c},set:function(l,u){this.callSuper("set",l,u);var c=!1,f=!1;if(typeof l=="object")for(var v in l)v==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(v)!==-1,f=f||v==="path";else c=this._dimensionAffectingProps.indexOf(l)!==-1,f=l==="path";return f&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(l,u,c){if(!l)return u(null);var f=s.parseAttributes(l,s.Text.ATTRIBUTE_NAMES),v=f.textAnchor||"left";if(c=s.util.object.extend(c?h(c):{},f),c.top=c.top||0,c.left=c.left||0,f.textDecoration){var p=f.textDecoration;p.indexOf("underline")!==-1&&(c.underline=!0),p.indexOf("overline")!==-1&&(c.overline=!0),p.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in f&&(c.left+=f.dx),"dy"in f&&(c.top+=f.dy),"fontSize"in c||(c.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var y="";"textContent"in l?y=l.textContent:"firstChild"in l&&l.firstChild!==null&&"data"in l.firstChild&&l.firstChild.data!==null&&(y=l.firstChild.data),y=y.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var b=c.strokeWidth;c.strokeWidth=0;var x=new s.Text(y,c),S=x.getScaledHeight()/x.height,w=(x.height+x.strokeWidth)*x.lineHeight-x.height,E=w*S,P=x.getScaledHeight()+E,A=0;v==="center"&&(A=x.getScaledWidth()/2),v==="right"&&(A=x.getScaledWidth()),x.set({left:x.left-A,top:x.top-(P-x.fontSize*(.07+x._fontSizeFraction))/x.lineHeight,strokeWidth:typeof b<"u"?b:1}),u(x)},s.Text.fromObject=function(l,u){var c=h(l),f=l.path;return delete c.path,s.Object._fromObject("Text",c,function(v){v.styles=s.util.stylesFromArray(l.styles,l.text),f?s.Object._fromObject("Path",f,function(p){v.set("path",p),u(v)},"path"):u(v)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(i),function(){t.util.object.extend(t.Text.prototype,{isEmptyStyles:function(a){if(!this.styles||typeof a<"u"&&!this.styles[a])return!0;var s=typeof a>"u"?this.styles:{line:this.styles[a]};for(var h in s)for(var d in s[h])for(var l in s[h][d])return!1;return!0},styleHas:function(a,s){if(!this.styles||!a||a===""||typeof s<"u"&&!this.styles[s])return!1;var h=typeof s>"u"?this.styles:{0:this.styles[s]};for(var d in h)for(var l in h[d])if(typeof h[d][l][a]<"u")return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||a==="")return!1;var s=this.styles,h=0,d,l,u=!0,c=0,f;for(var v in s){d=0;for(var p in s[v]){var f=s[v][p],y=f.hasOwnProperty(a);h++,y?(l?f[a]!==l&&(u=!1):l=f[a],f[a]===this[a]&&delete f[a]):u=!1,Object.keys(f).length!==0?d++:delete s[v][p]}d===0&&delete s[v]}for(var b=0;b<this._textLines.length;b++)c+=this._textLines[b].length;u&&h===c&&(this[a]=l,this.removeStyle(a))},removeStyle:function(a){if(!(!this.styles||!a||a==="")){var s=this.styles,h,d,l;for(d in s){h=s[d];for(l in h)delete h[l][a],Object.keys(h[l]).length===0&&delete h[l];Object.keys(h).length===0&&delete s[d]}}},_extendStyles:function(a,s){var h=this.get2DCursorLocation(a);this._getLineStyle(h.lineIndex)||this._setLineStyle(h.lineIndex),this._getStyleDeclaration(h.lineIndex,h.charIndex)||this._setStyleDeclaration(h.lineIndex,h.charIndex,{}),t.util.object.extend(this._getStyleDeclaration(h.lineIndex,h.charIndex),s)},get2DCursorLocation:function(a,s){typeof a>"u"&&(a=this.selectionStart);for(var h=s?this._unwrappedTextLines:this._textLines,d=h.length,l=0;l<d;l++){if(a<=h[l].length)return{lineIndex:l,charIndex:a};a-=h[l].length+this.missingNewlineOffset(l)}return{lineIndex:l-1,charIndex:h[l-1].length<a?h[l-1].length:a}},getSelectionStyles:function(a,s,h){typeof a>"u"&&(a=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||a);for(var d=[],l=a;l<s;l++)d.push(this.getStyleAtPosition(l,h));return d},getStyleAtPosition:function(a,s){var h=this.get2DCursorLocation(a),d=s?this.getCompleteStyleDeclaration(h.lineIndex,h.charIndex):this._getStyleDeclaration(h.lineIndex,h.charIndex);return d||{}},setSelectionStyles:function(a,s,h){typeof s>"u"&&(s=this.selectionStart||0),typeof h>"u"&&(h=this.selectionEnd||s);for(var d=s;d<h;d++)this._extendStyles(d,a);return this._forceClearCache=!0,this},_getStyleDeclaration:function(a,s){var h=this.styles&&this.styles[a];return h?h[s]:null},getCompleteStyleDeclaration:function(a,s){for(var h=this._getStyleDeclaration(a,s)||{},d={},l,u=0;u<this._styleProperties.length;u++)l=this._styleProperties[u],d[l]=typeof h[l]>"u"?this[l]:h[l];return d},_setStyleDeclaration:function(a,s,h){this.styles[a][s]=h},_deleteStyleDeclaration:function(a,s){delete this.styles[a][s]},_getLineStyle:function(a){return!!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}})}(),function(){function a(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}t.IText=t.util.createClass(t.Text,t.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,h){this.callSuper("initialize",s,h),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,h){this[s]!==h&&(this._fireSelectionChanged(),this[s]=h),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var h=this.canvas.contextTop,d=this.canvas.viewportTransform;h.save(),h.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this.transform(h),this._clearTextArea(h),s||h.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),h=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,h):this.renderSelection(s,h),h.restore()}},_clearTextArea:function(s){var h=this.width+4,d=this.height+4;s.clearRect(-h/2,-d/2,h,d)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var h=this._getLeftOffset(),d=this._getTopOffset(),l=this._getCursorBoundariesOffsets(s);return{left:h,top:d,leftOffset:l.left,topOffset:l.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var h,d,l,u=0,c=0,f,v=this.get2DCursorLocation(s);l=v.charIndex,d=v.lineIndex;for(var p=0;p<d;p++)u+=this.getHeightOfLine(p);h=this._getLineLeftOffset(d);var y=this.__charBounds[d][l];return y&&(c=y.left),this.charSpacing!==0&&l===this._textLines[d].length&&(c-=this._getWidthOfCharSpacing()),f={top:u,left:h+(c>0?c:0)},this.direction==="rtl"&&(f.left*=-1),this.cursorOffsetCache=f,this.cursorOffsetCache},renderCursor:function(s,h){var d=this.get2DCursorLocation(),l=d.lineIndex,u=d.charIndex>0?d.charIndex-1:0,c=this.getValueOfPropertyAt(l,u,"fontSize"),f=this.scaleX*this.canvas.getZoom(),v=this.cursorWidth/f,p=s.topOffset,y=this.getValueOfPropertyAt(l,u,"deltaY");p+=(1-this._fontSizeFraction)*this.getHeightOfLine(l)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,h),h.fillStyle=this.cursorColor||this.getValueOfPropertyAt(l,u,"fill"),h.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,h.fillRect(s.left+s.leftOffset-v/2,p+s.top+y,v,c)},renderSelection:function(s,h){for(var d=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,l=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,u=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(d),f=this.get2DCursorLocation(l),v=c.lineIndex,p=f.lineIndex,y=c.charIndex<0?0:c.charIndex,b=f.charIndex<0?0:f.charIndex,x=v;x<=p;x++){var S=this._getLineLeftOffset(x)||0,w=this.getHeightOfLine(x),E=0,P=0,A=0;if(x===v&&(P=this.__charBounds[v][y].left),x>=v&&x<p)A=u&&!this.isEndOfWrapping(x)?this.width:this.getLineWidth(x)||5;else if(x===p)if(b===0)A=this.__charBounds[p][b].left;else{var N=this._getWidthOfCharSpacing();A=this.__charBounds[p][b-1].left+this.__charBounds[p][b-1].width-N}E=w,(this.lineHeight<1||x===p&&this.lineHeight>1)&&(w/=this.lineHeight);var k=s.left+S+P,U=A-P,j=w,X=0;this.inCompositionMode?(h.fillStyle=this.compositionColor||"black",j=1,X=w):h.fillStyle=this.selectionColor,this.direction==="rtl"&&(k=this.width-k-U),h.fillRect(k,s.top+s.topOffset+X,U,j),s.topOffset+=E}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),h=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:h}}}),t.IText.fromObject=function(s,h){var d=t.util.stylesFromArray(s.styles,s.text),l=Object.assign({},s,{styles:d});if(a(l),l.styles)for(var u in l.styles)for(var c in l.styles[u])a(l.styles[u][c]);t.Object._fromObject("IText",l,h,"text")}}(),function(){var a=t.util.object.clone;t.util.object.extend(t.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var h=s.canvas;h&&(h._hasITextHandlers||(h._hasITextHandlers=!0,s._initCanvasHandlers(h)),h._iTextInstances=h._iTextInstances||[],h._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var h=s.canvas;h&&(h._iTextInstances=h._iTextInstances||[],t.util.removeFromArray(h._iTextInstances,s),h._iTextInstances.length===0&&(h._hasITextHandlers=!1,s._removeCanvasHandlers(h)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(h){h.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,h,d,l){var u;return u={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",h,{duration:d,onComplete:function(){u.isAborted||s[l]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return u.isAborted}}),u},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var h=this,d=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){h._tick()},d)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,h=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&h&&h.clearContext(h.contextTop||h.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var h=0,d=s-1;if(this._reSpace.test(this._text[d]))for(;this._reSpace.test(this._text[d]);)h++,d--;for(;/\S/.test(this._text[d])&&d>-1;)h++,d--;return s-h},findWordBoundaryRight:function(s){var h=0,d=s;if(this._reSpace.test(this._text[d]))for(;this._reSpace.test(this._text[d]);)h++,d++;for(;/\S/.test(this._text[d])&&d<this._text.length;)h++,d++;return s+h},findLineBoundaryLeft:function(s){for(var h=0,d=s-1;!/\n/.test(this._text[d])&&d>-1;)h++,d--;return s-h},findLineBoundaryRight:function(s){for(var h=0,d=s;!/\n/.test(this._text[d])&&d<this._text.length;)h++,d++;return s+h},searchWordBoundary:function(s,h){for(var d=this._text,l=this._reSpace.test(d[s])?s-1:s,u=d[l],c=t.reNonWord;!c.test(u)&&l>0&&l<d.length;)l+=h,u=d[l];return c.test(u)&&(l+=h===1?0:1),l},selectWord:function(s){s=s||this.selectionStart;var h=this.searchWordBoundary(s,-1),d=this.searchWordBoundary(s,1);this.selectionStart=h,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var h=this.findLineBoundaryLeft(s),d=this.findLineBoundaryRight(s);return this.selectionStart=h,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(h){h.selected=!1,h.isEditing&&h.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var h=this.getSelectionStartFromPointer(s.e),d=this.selectionStart,l=this.selectionEnd;(h!==this.__selectionStartOnMouseDown||d===l)&&(d===h||l===h)||(h>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=h):(this.selectionStart=h,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==d||this.selectionEnd!==l)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,h,d){var l=d.slice(0,s),u=t.util.string.graphemeSplit(l).length;if(s===h)return{selectionStart:u,selectionEnd:u};var c=d.slice(s,h),f=t.util.string.graphemeSplit(c).length;return{selectionStart:u,selectionEnd:u+f}},fromGraphemeToStringSelection:function(s,h,d){var l=d.slice(0,s),u=l.join("").length;if(s===h)return{selectionStart:u,selectionEnd:u};var c=d.slice(s,h),f=c.join("").length;return{selectionStart:u,selectionEnd:u+f}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,h=this._getCursorBoundaries(s),d=this.get2DCursorLocation(s),l=d.lineIndex,u=d.charIndex,c=this.getValueOfPropertyAt(l,u,"fontSize")*this.lineHeight,f=h.leftOffset,v=this.calcTransformMatrix(),p={x:h.left+f,y:h.top+h.topOffset+c},y=this.canvas.getRetinaScaling(),b=this.canvas.upperCanvasEl,x=b.width/y,S=b.height/y,w=x-c,E=S-c,P=b.clientWidth/x,A=b.clientHeight/S;return p=t.util.transformPoint(p,v),p=t.util.transformPoint(p,this.canvas.viewportTransform),p.x*=P,p.y*=A,p.x<0&&(p.x=0),p.x>w&&(p.x=w),p.y<0&&(p.y=0),p.y>E&&(p.y=E),p.x+=this.canvas._offset.left,p.y+=this.canvas._offset.top,{left:p.x+"px",top:p.y+"px",fontSize:c+"px",charHeight:c}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,h=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,h&&(h.blur&&h.blur(),h.parentNode&&h.parentNode.removeChild(h)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,h){var d=this.get2DCursorLocation(s,!0),l=this.get2DCursorLocation(h,!0),u=d.lineIndex,c=d.charIndex,f=l.lineIndex,v=l.charIndex,p,y;if(u!==f){if(this.styles[u])for(p=c;p<this._unwrappedTextLines[u].length;p++)delete this.styles[u][p];if(this.styles[f])for(p=v;p<this._unwrappedTextLines[f].length;p++)y=this.styles[f][p],y&&(this.styles[u]||(this.styles[u]={}),this.styles[u][c+p-v]=y);for(p=u+1;p<=f;p++)delete this.styles[p];this.shiftLineStyles(f,u-f)}else if(this.styles[u]){y=this.styles[u];var b=v-c,x,S;for(p=c;p<v;p++)delete y[p];for(S in this.styles[u])x=parseInt(S,10),x>=v&&(y[x-b]=y[S],delete y[S])}},shiftLineStyles:function(s,h){var d=a(this.styles);for(var l in this.styles){var u=parseInt(l,10);u>s&&(this.styles[u+h]=d[u],d[u-h]||delete this.styles[u])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,h,d,l){var u,c={},f=!1,v=this._unwrappedTextLines[s].length===h;d||(d=1),this.shiftLineStyles(s,d),this.styles[s]&&(u=this.styles[s][h===0?h:h-1]);for(var p in this.styles[s]){var y=parseInt(p,10);y>=h&&(f=!0,c[y-h]=this.styles[s][p],v&&h===0||delete this.styles[s][p])}var b=!1;for(f&&!v&&(this.styles[s+d]=c,b=!0),b&&d--;d>0;)l&&l[d-1]?this.styles[s+d]={0:a(l[d-1])}:u?this.styles[s+d]={0:a(u)}:delete this.styles[s+d],d--;this._forceClearCache=!0},insertCharStyleObject:function(s,h,d,l){this.styles||(this.styles={});var u=this.styles[s],c=u?a(u):{};d||(d=1);for(var f in c){var v=parseInt(f,10);v>=h&&(u[v+d]=c[v],c[v-d]||delete u[v])}if(this._forceClearCache=!0,l){for(;d--;)Object.keys(l[d]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][h+d]=a(l[d]));return}if(u)for(var p=u[h?h-1:1];p&&d--;)this.styles[s][h+d]=a(p)},insertNewStyleBlock:function(s,h,d){for(var l=this.get2DCursorLocation(h,!0),u=[0],c=0,f=0;f<s.length;f++)s[f]===`
`?(c++,u[c]=0):u[c]++;u[0]>0&&(this.insertCharStyleObject(l.lineIndex,l.charIndex,u[0],d),d=d&&d.slice(u[0]+1)),c&&this.insertNewlineStyleObject(l.lineIndex,l.charIndex+u[0],c);for(var f=1;f<c;f++)u[f]>0?this.insertCharStyleObject(l.lineIndex+f,0,u[f],d):d&&this.styles[l.lineIndex+f]&&d[0]&&(this.styles[l.lineIndex+f][0]=d[0]),d=d&&d.slice(u[f]+1);u[f]>0&&this.insertCharStyleObject(l.lineIndex+f,0,u[f],d)},setSelectionStartEndWithShift:function(s,h,d){d<=s?(h===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=d):d>s&&d<h?this._selectionDirection==="right"?this.selectionEnd=d:this.selectionStart=d:(h===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=h),this.selectionEnd=d)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),t.util.object.extend(t.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(this.canvas){this.__newClickTime=+new Date;var s=a.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(a){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(a.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){if(this.__isMousedown=!1,!(!this.editable||this.group||a.transform&&a.transform.actionPerformed||a.e.button&&a.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(a){var s=this.getSelectionStartFromPointer(a),h=this.selectionStart,d=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(h,d,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var s=this.getLocalPointer(a),h=0,d=0,l=0,u=0,c=0,f,v,p=0,y=this._textLines.length;p<y&&l<=s.y;p++)l+=this.getHeightOfLine(p)*this.scaleY,c=p,p>0&&(u+=this._textLines[p-1].length+this.missingNewlineOffset(p-1));f=this._getLineLeftOffset(c),d=f*this.scaleX,v=this._textLines[c],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+d);for(var b=0,x=v.length;b<x&&(h=d,d+=this.__charBounds[c][b].kernedWidth*this.scaleX,d<=s.x);b++)u++;return this._getNewSelectionStartFromOffset(s,h,d,u,x)},_getNewSelectionStartFromOffset:function(a,s,h,d,l){var u=a.x-s,c=h-a.x,f=c>u||c<0?0:1,v=d+f;return this.flipX&&(v=l-v),v>this._text.length&&(v=this._text.length),v}}),t.util.object.extend(t.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=t.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+a.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):t.document.body.appendChild(this.hiddenTextarea),t.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),t.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),t.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),t.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),t.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),t.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(t.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(a.keyCode in s)this[s[a.keyCode]](a);else if(a.keyCode in this.ctrlKeysMapDown&&(a.ctrlKey||a.metaKey))this[this.ctrlKeysMapDown[a.keyCode]](a);else return;a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey))this[this.ctrlKeysMapUp[a.keyCode]](a);else return;a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(a){var s=this.fromPaste;if(this.fromPaste=!1,a&&a.stopPropagation(),!!this.isEditing){var h=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,d=this._text.length,l=h.length,u,c,f=l-d,v=this.selectionStart,p=this.selectionEnd,y=v!==p,b,x,S;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var w=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),E=v>w.selectionStart;y?(u=this._text.slice(v,p),f+=p-v):l<d&&(E?u=this._text.slice(p+f,p):u=this._text.slice(v,v-f)),c=h.slice(w.selectionEnd-f,w.selectionEnd),u&&u.length&&(c.length&&(b=this.getSelectionStyles(v,v+1,!1),b=c.map(function(){return b[0]})),y?(x=v,S=p):E?(x=p-u.length,S=p):(x=p,S=p+u.length),this.removeStyleFromTo(x,S)),c.length&&(s&&c.join("")===t.copiedText&&!t.disableStyleCopyPaste&&(b=t.copiedTextStyle),this.insertNewStyleBlock(c,v,b)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart,this.compositionEnd=a.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(t.copiedText=this.getSelectedText(),t.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(a){return a&&a.clipboardData||t.window.clipboardData},_getWidthBeforeCursor:function(a,s){var h=this._getLineLeftOffset(a),d;return s>0&&(d=this.__charBounds[a][s-1],h+=d.left+d.width),h},getDownCursorOffset:function(a,s){var h=this._getSelectionForOffset(a,s),d=this.get2DCursorLocation(h),l=d.lineIndex;if(l===this._textLines.length-1||a.metaKey||a.keyCode===34)return this._text.length-h;var u=d.charIndex,c=this._getWidthBeforeCursor(l,u),f=this._getIndexOnLine(l+1,c),v=this._textLines[l].slice(u);return v.length+f+1+this.missingNewlineOffset(l)},_getSelectionForOffset:function(a,s){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,s){var h=this._getSelectionForOffset(a,s),d=this.get2DCursorLocation(h),l=d.lineIndex;if(l===0||a.metaKey||a.keyCode===33)return-h;var u=d.charIndex,c=this._getWidthBeforeCursor(l,u),f=this._getIndexOnLine(l-1,c),v=this._textLines[l].slice(0,u),p=this.missingNewlineOffset(l-1);return-this._textLines[l-1].length+f-v.length+(1-p)},_getIndexOnLine:function(a,s){for(var h=this._textLines[a],d=this._getLineLeftOffset(a),l=d,u=0,c,f,v=0,p=h.length;v<p;v++)if(c=this.__charBounds[a][v].width,l+=c,l>s){f=!0;var y=l-c,b=l,x=Math.abs(y-s),S=Math.abs(b-s);u=S<x?v:v-1;break}return f||(u=h.length-1),u},moveCursorDown:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,s){var h="get"+a+"CursorOffset",d=this[h](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(d):this.moveCursorWithoutShift(d),d!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var s=this._selectionDirection==="left"?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),a!==0},moveCursorWithoutShift:function(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),a!==0},moveCursorLeft:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",a)},_move:function(a,s,h){var d;if(a.altKey)d=this["findWordBoundary"+h](this[s]);else if(a.metaKey||a.keyCode===35||a.keyCode===36)d=this["findLineBoundary"+h](this[s]);else return this[s]+=h==="Left"?-1:1,!0;if(typeof d<"u"&&this[s]!==d)return this[s]=d,!0},_moveLeft:function(a,s){return this._move(a,s,"Left")},_moveRight:function(a,s){return this._move(a,s,"Right")},moveCursorLeftWithoutShift:function(a){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(a,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(a,"selectionStart")},moveCursorRight:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,s){var h="moveCursor"+a+"With";this._currentCursorOpacity=1,s.shiftKey?h+="Shift":h+="outShift",this[h](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(a,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(a,"selectionEnd")},moveCursorRightWithoutShift:function(a){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(a,s){typeof s>"u"&&(s=a+1),this.removeStyleFromTo(a,s),this._text.splice(a,s-a),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(a,s,h,d){typeof d>"u"&&(d=h),d>h&&this.removeStyleFromTo(h,d);var l=t.util.string.graphemeSplit(a);this.insertNewStyleBlock(l,h,s),this._text=[].concat(this._text.slice(0,h),l,this._text.slice(d)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var a=t.util.toFixed,s=/  +/g;t.util.object.extend(t.Text.prototype,{_toSVG:function(){var h=this._getSVGLeftTopOffsets(),d=this._getSVGTextAndBg(h.textTop,h.textLeft);return this._wrapSVGTextAndBg(d)},toSVG:function(h){return this._createBaseSVGMarkup(this._toSVG(),{reviver:h,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(h){var d=!0,l=this.getSvgTextDecoration(this);return[h.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",l?'text-decoration="'+l+'" ':"",'style="',this.getSvgStyles(d),'"',this.addPaintOrder()," >",h.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(h,d){var l=[],u=[],c=h,f;this._setSVGBg(u);for(var v=0,p=this._textLines.length;v<p;v++)f=this._getLineLeftOffset(v),(this.textBackgroundColor||this.styleHas("textBackgroundColor",v))&&this._setSVGTextLineBg(u,v,d+f,c),this._setSVGTextLineText(l,v,d+f,c),c+=this.getHeightOfLine(v);return{textSpans:l,textBgRects:u}},_createTextCharSpan:function(h,d,l,u){var c=h!==h.trim()||h.match(s),f=this.getSvgSpanStyles(d,c),v=f?'style="'+f+'"':"",p=d.deltaY,y="",b=t.Object.NUM_FRACTION_DIGITS;return p&&(y=' dy="'+a(p,b)+'" '),['<tspan x="',a(l,b),'" y="',a(u,b),'" ',y,v,">",t.util.string.escapeXml(h),"</tspan>"].join("")},_setSVGTextLineText:function(h,d,l,u){var c=this.getHeightOfLine(d),f=this.textAlign.indexOf("justify")!==-1,v,p,y="",b,x,S=0,w=this._textLines[d],E;u+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var P=0,A=w.length-1;P<=A;P++)E=P===A||this.charSpacing,y+=w[P],b=this.__charBounds[d][P],S===0?(l+=b.kernedWidth-b.width,S+=b.width):S+=b.kernedWidth,f&&!E&&this._reSpaceAndTab.test(w[P])&&(E=!0),E||(v=v||this.getCompleteStyleDeclaration(d,P),p=this.getCompleteStyleDeclaration(d,P+1),E=t.util.hasStyleChanged(v,p,!0)),E&&(x=this._getStyleDeclaration(d,P)||{},h.push(this._createTextCharSpan(y,x,l,u)),y="",v=p,l+=S,S=0)},_pushTextBgRect:function(h,d,l,u,c,f){var v=t.Object.NUM_FRACTION_DIGITS;h.push("		<rect ",this._getFillAttributes(d),' x="',a(l,v),'" y="',a(u,v),'" width="',a(c,v),'" height="',a(f,v),`"></rect>
`)},_setSVGTextLineBg:function(h,d,l,u){for(var c=this._textLines[d],f=this.getHeightOfLine(d)/this.lineHeight,v=0,p=0,y,b,x=this.getValueOfPropertyAt(d,0,"textBackgroundColor"),S=0,w=c.length;S<w;S++)y=this.__charBounds[d][S],b=this.getValueOfPropertyAt(d,S,"textBackgroundColor"),b!==x?(x&&this._pushTextBgRect(h,x,l+p,u,v,f),p=y.left,v=y.width,x=b):v+=y.kernedWidth;b&&this._pushTextBgRect(h,b,l+p,u,v,f)},_getFillAttributes:function(h){var d=h&&typeof h=="string"?new t.Color(h):"";return!d||!d.getSource()||d.getAlpha()===1?'fill="'+h+'"':'opacity="'+d.getAlpha()+'" fill="'+d.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(h){for(var d=0,l=0,u=0;u<h;u++)d+=this.getHeightOfLine(u);return l=this.getHeightOfLine(u),{lineTop:d,offset:(this._fontSizeMult-this._fontSizeFraction)*l/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(h){var d=t.Object.prototype.getSvgStyles.call(this,h);return d+" white-space: pre;"}})}(),function(a){var s=a.fabric||(a.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(h){for(var d=0,l=0,u=0,c={},f=0;f<h.graphemeLines.length;f++)h.graphemeText[u]===`
`&&f>0?(l=0,u++,d++):!this.splitByGrapheme&&this._reSpaceAndTab.test(h.graphemeText[u])&&f>0&&(l++,u++),c[f]={line:d,offset:l},u+=h.graphemeLines[f].length,l+=h.graphemeLines[f].length;return c},styleHas:function(h,d){if(this._styleMap&&!this.isWrapping){var l=this._styleMap[d];l&&(d=l.line)}return s.Text.prototype.styleHas.call(this,h,d)},isEmptyStyles:function(h){if(!this.styles)return!0;var d=0,l=h+1,u,c,f=!1,v=this._styleMap[h],p=this._styleMap[h+1];v&&(h=v.line,d=v.offset),p&&(l=p.line,f=l===h,u=p.offset),c=typeof h>"u"?this.styles:{line:this.styles[h]};for(var y in c)for(var b in c[y])if(b>=d&&(!f||b<u))for(var x in c[y][b])return!1;return!0},_getStyleDeclaration:function(h,d){if(this._styleMap&&!this.isWrapping){var l=this._styleMap[h];if(!l)return null;h=l.line,d=l.offset+d}return this.callSuper("_getStyleDeclaration",h,d)},_setStyleDeclaration:function(h,d,l){var u=this._styleMap[h];h=u.line,d=u.offset+d,this.styles[h][d]=l},_deleteStyleDeclaration:function(h,d){var l=this._styleMap[h];h=l.line,d=l.offset+d,delete this.styles[h][d]},_getLineStyle:function(h){var d=this._styleMap[h];return!!this.styles[d.line]},_setLineStyle:function(h){var d=this._styleMap[h];this.styles[d.line]={}},_wrapText:function(h,d){var l=[],u;for(this.isWrapping=!0,u=0;u<h.length;u++)l=l.concat(this._wrapLine(h[u],u,d));return this.isWrapping=!1,l},_measureWord:function(h,d,l){var u=0,c,f=!0;l=l||0;for(var v=0,p=h.length;v<p;v++){var y=this._getGraphemeBox(h[v],d,v+l,c,f);u+=y.kernedWidth,c=h[v]}return u},_wrapLine:function(h,d,l,k){var c=0,f=this.splitByGrapheme,v=[],p=[],y=f?s.util.string.graphemeSplit(h):h.split(this._wordJoiners),b="",x=0,S=f?"":" ",w=0,E=0,P=0,A=!0,N=this._getWidthOfCharSpacing(),k=k||0;y.length===0&&y.push([]),l-=k;for(var U=0;U<y.length;U++)b=f?y[U]:s.util.string.graphemeSplit(y[U]),w=this._measureWord(b,d,x),x+=b.length,c+=E+w-N,c>l&&!A?(v.push(p),p=[],c=w,A=!0):c+=N,!A&&!f&&p.push(S),p=p.concat(b),E=f?0:this._measureWord([S],d,x),x++,A=!1,w>P&&(P=w);return U&&v.push(p),P+k>this.dynamicMinWidth&&(this.dynamicMinWidth=P-N+k),v},isEndOfWrapping:function(h){return!this._styleMap[h+1]||this._styleMap[h+1].line!==this._styleMap[h].line},missingNewlineOffset:function(h){return this.splitByGrapheme?this.isEndOfWrapping(h)?1:0:1},_splitTextIntoLines:function(h){for(var d=s.Text.prototype._splitTextIntoLines.call(this,h),l=this._wrapText(d.lines,this.width),u=new Array(l.length),c=0;c<l.length;c++)u[c]=l[c].join("");return d.lines=u,d.graphemeLines=l,d},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var h={};for(var d in this._styleMap)this._textLines[d]&&(h[this._styleMap[d].line]=1);for(var d in this.styles)h[d]||delete this.styles[d]},toObject:function(h){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(h))}}),s.Textbox.fromObject=function(h,d){var l=s.util.stylesFromArray(h.styles,h.text),u=Object.assign({},h,{styles:l});return s.Object._fromObject("Textbox",u,d,"text")}}(i),function(){var a=t.controlsUtils,s=a.scaleSkewCursorStyleHandler,h=a.scaleCursorStyleHandler,d=a.scalingEqually,l=a.scalingYOrSkewingX,u=a.scalingXOrSkewingY,c=a.scaleOrSkewActionName,f=t.Object.prototype.controls;if(f.ml=new t.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:u,getActionName:c}),f.mr=new t.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:u,getActionName:c}),f.mb=new t.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:l,getActionName:c}),f.mt=new t.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:l,getActionName:c}),f.tl=new t.Control({x:-.5,y:-.5,cursorStyleHandler:h,actionHandler:d}),f.tr=new t.Control({x:.5,y:-.5,cursorStyleHandler:h,actionHandler:d}),f.bl=new t.Control({x:-.5,y:.5,cursorStyleHandler:h,actionHandler:d}),f.br=new t.Control({x:.5,y:.5,cursorStyleHandler:h,actionHandler:d}),f.mtr=new t.Control({x:0,y:-.5,actionHandler:a.rotationWithSnapping,cursorStyleHandler:a.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),t.Textbox){var v=t.Textbox.prototype.controls={};v.mtr=f.mtr,v.tr=f.tr,v.br=f.br,v.tl=f.tl,v.bl=f.bl,v.mt=f.mt,v.mb=f.mb,v.mr=new t.Control({x:.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),v.ml=new t.Control({x:-.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(Wi);class n3{constructor(t){ht(this,"containerEl");ht(this,"canvas");const e=document.createElement("canvas");e.height=me,e.width=be,this.containerEl=e,this.canvas=new Wi.fabric.StaticCanvas(e),this.canvas.loadFromJSON(t,()=>{})}draw(t){this.canvas.getObjects("text").forEach(r=>{r.set("text",t.toString())}),this.canvas.renderAll()}getElement(){return this.containerEl}}const s3=1e3;class Oi{constructor(t){ht(this,"data");ht(this,"listeners");ht(this,"intervalId");ht(this,"interval");this.data=0,this.listeners=[],this.interval=t??s3,this.intervalId=null}addListener(t){this.listeners.push(t)}start(){this.intervalId=setInterval(()=>{const t=Math.floor(Math.random()*100)+1;this.data=t,this.onChange()},this.interval)}stop(){this.intervalId&&window.clearInterval(this.intervalId)}updateInterval(t){t===0?this.stop():(this.stop(),this.interval=t,this.start())}onChange(){for(let t=0;t<this.listeners.length;t++)this.listeners[t].onDataChange(this.data)}}class a3{constructor(){ht(this,"canvas");this.canvas=new Wi.fabric.Canvas("canvasEditorWorkspace",{width:be,height:me}),this.addMenuButtons()}onAddElement(t,e){console.log("onAddElement",t,e),alert("need to specify onAddElement")}addMenuButtons(){const t=document.getElementById("addRectButton");t.onclick=()=>{const o=new Wi.fabric.Rect({top:0,left:0,width:25,height:25,fill:"red"});this.canvas.add(o)};const e=document.getElementById("addText");e.onclick=()=>{const o=new Wi.fabric.Text("28",{top:0,left:0,fontSize:18});this.canvas.add(o)};const r=document.getElementById("removeElement");r.onclick=()=>{var m;const o=this.canvas.getActiveObject();o&&((m=this.canvas)==null||m.remove(o))};const n=document.getElementById("addCanvasFabricComponents");n.onclick=()=>{const o=this.canvas.toObject(),m=document.getElementById("CanvasFabricComponentsCount"),a=Number(m.value);console.log("add Component, serializedCanvas=>",o,a),this.onAddElement(o,a)}}}const xe=i=>{const t=document.getElementById(i);return Number(t.value)},Se=(i,t)=>{document.getElementById(i).addEventListener("click",t)},L0=3e3,k0=0,B0=15;class xn{constructor(t="transform"){ht(this,"value");ht(this,"inputEl");ht(this,"key");this.value=100,this.key=t,this.inputEl=document.getElementById(`zoom-${this.key}`),this.initButtonBindings(),this.updateValue(this.value)}onChange(t){console.warn("Need to subscribe to this event to use it",t)}initButtonBindings(){Se(`zoomIn-${this.key}`,()=>{this.updateValue(this.value+B0)}),Se(`zoomOut-${this.key}`,()=>{this.updateValue(this.value-B0)}),this.inputEl.addEventListener("change",()=>{this.updateValue(Number(this.inputEl.value))})}updateValue(t){if(t>L0){console.warn(`Stop zooming: new value ${t} > MAX value: ${L0}`);return}else if(t<k0){console.warn(`Stop zooming: new value ${t} < MIN value: ${k0}`);return}this.value=t,this.inputEl.value=t.toString(),this.onChange&&this.onChange(this.value/100)}}let o3=class{constructor(t){ht(this,"appElement");ht(this,"dataSource");ht(this,"view");this.appElement=t,this.view=new D0(qe,Ze),this.dataSource=new Oi;const e=new xn;e.onChange=r=>{this.view.zoomTransform(r)},this.initButtonBindings()}initButtonBindings(){Se("addSvgInHtmlComponents",()=>{const e=xe("svgElementsInHtmlCount"),r=xe("svgComponentsInHtmlCount");this.addSvgInHtmlComponents(r,e)});const t=new a3;t.onAddElement=(e,r)=>{this.addCanvasFabricComponents(e,r)},Se("addCanvasComponents",()=>{const e=xe("canvasComponentsCount");this.addCanvasComponents(e)}),Se("addHtmlComponents",()=>{const e=xe("htmlElementsCount"),r=xe("htmlComponentsCount");this.addHtmlComponents(r,e)}),Se("setDataSourceSettings",()=>{const e=xe("updateInterval");this.dataSource.updateInterval(e*1e3)}),Se("startMoveTest",()=>{const e=xe("movedComponentsCount");this.moveTest(e)}),Se("startMoveTest2",()=>{const e=xe("movedComponentsCount");this.view.moveTest2(e)})}start(){this.view=new D0(qe,Ze),this.appElement.appendChild(this.view.start()),this.dataSource.start()}addComponents(t,e,r){switch(t){case"HTML":this.addHtmlComponents(e,r);break;case"SVG":this.addSvgInHtmlComponents(e,r);break;case"Canvas":this.addCanvasComponents(e);break;default:throw new Error(`HTML app: unknown component type:${t}`)}}addHtmlComponents(t,e){for(let r=0;r<t;r++){const n=new t3(e),o=new zr(n);o.addSource(this.dataSource),this.view.addComponent(o)}this.view.start()}addCanvasFabricComponents(t,e){for(let r=0;r<e;r++){const n=new n3(t),o=new zr(n);o.addSource(this.dataSource),this.view.addComponent(o)}this.view.start()}addCanvasComponents(t){for(let e=0;e<t;e++){const r=new e3,n=new zr(r);n.addSource(this.dataSource),this.view.addComponent(n)}this.view.start()}addSvgInHtmlComponents(t,e){for(let r=0;r<t;r++){const n=new i_(e),o=new zr(n);o.addSource(this.dataSource),this.view.addComponent(o)}this.view.start()}moveTest(t=0){this.view.moveTest(t)}stopDataSource(){this.dataSource.updateInterval(0)}};const h3="http://www.w3.org/2000/svg";class N0{constructor(t,e){ht(this,"height");ht(this,"width");ht(this,"containerEl");ht(this,"components");ht(this,"movedComponents");ht(this,"positionManager");this.components=[],this.height=t,this.width=e,this.movedComponents=[],this.positionManager=new ha({viewWidth:this.width,viewHeight:this.height}),this.containerEl=document.createElementNS(h3,"svg"),this.containerEl.setAttribute("height",this.height.toString()),this.containerEl.setAttribute("width",this.width.toString()),this.containerEl.style.border="1px solid red"}addComponent(t){this.components.push(t)}start(){this.containerEl.innerHTML="";for(let t=0;t<this.components.length;t++){const e=this.components[t].getUIElement();this.containerEl.appendChild(e)}return this.updateComponentsCount(),this.containerEl}updateComponentsCount(){const t=document.getElementById("componentCount");t.innerText=this.components.length.toString()}moveTest(t=0){this.movedComponents=this.components,t!==0&&(this.movedComponents=this.components.slice(0,t)),this.movedComponents.forEach(e=>{const n=e.getUIElement().getAttribute("transform"),o=/translate\((.*?),(.*?)\)/.exec(n),m=o?parseFloat(o[1]):0,a=o?parseFloat(o[2]):0;this.positionManager.addPosition(m,a)}),this.moveElements()}moveElements(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t),n=this.movedComponents[t].getUIElement(),o="translate("+e+", "+r+")";n.setAttribute("transform",o)}requestAnimationFrame(()=>this.moveElements())}zoomTransform(t){this.containerEl.style.transform=`scale(${t})`}zoomViewBox(t){const e=this.height/t,r=this.width/t;this.containerEl.setAttribute("viewBox",`0 0 ${e} ${r}`)}}let l3=class{constructor(t){ht(this,"appElement");ht(this,"dataSource");ht(this,"view");this.appElement=t,this.view=new N0(qe,Ze),this.dataSource=new Oi;const e=new xn("transform");e.onChange=n=>{this.view.zoomTransform(n)};const r=new xn("viewBox");r.onChange=n=>{this.view.zoomViewBox(n)},this.initButtonBindings()}initButtonBindings(){Se("addSvgComponentsInSvg",()=>{const t=xe("svgElementsInSvgCount"),e=xe("svgComponentsInSvgCount");this.addSvgComponentsInSvg(e,t)}),Se("setDataSourceSettings",()=>{const t=xe("updateInterval");this.dataSource.updateInterval(t*1e3)}),Se("startMoveTest",()=>{const t=xe("movedComponentsCount");this.moveTest(t)})}start(){this.view=new N0(qe,Ze),this.dataSource=new Oi,this.appElement.appendChild(this.view.start()),this.dataSource.start()}addComponents(t,e,r){switch(t){case"SVG":this.addSvgComponentsInSvg(e,r);break;default:throw new Error(`SVG App: unknown component type:${t}`)}}addSvgComponentsInSvg(t,e){for(let r=0;r<t;r++){const n=new i_(e,"g"),o=new zr(n);o.addSource(this.dataSource),this.view.addComponent(o)}this.view.start()}moveTest(t=0){this.view.moveTest(t)}stopDataSource(){this.dataSource.updateInterval(0)}};class U0{constructor(t,e){ht(this,"height");ht(this,"width");ht(this,"containerEl");ht(this,"context");ht(this,"components");ht(this,"movedComponents");ht(this,"positionManager");this.components=[],this.width=e,this.height=t,this.movedComponents=[],this.positionManager=new ha({viewWidth:this.width,viewHeight:this.height}),this.containerEl=document.createElement("canvas"),this.containerEl.width=this.width,this.containerEl.height=this.height,this.containerEl.style.border="1px solid red",this.context=this.containerEl.getContext("2d")}getContext(){return this.context}addComponent(t){this.components.push(t)}start(){return this.context.clearRect(0,0,this.width,this.height),this.components.forEach(t=>{t.draw(0)}),this.updateComponentsCount(),this.containerEl}updateComponentsCount(){const t=document.getElementById("componentCount");t.innerText=this.components.length.toString()}moveTest(t=0){this.movedComponents=this.components,t!==0&&(this.movedComponents=this.components.slice(0,t)),this.movedComponents.forEach(e=>{const r=e.getUIElement();this.positionManager.addPosition(r.x,r.y)}),this.moveElements()}moveElements(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t);this.movedComponents[t].getUIElement().move(e,r)}requestAnimationFrame(()=>this.moveElements())}zoomTransform(t){this.containerEl.style.transform=`scale(${t})`}}const G0=[{getFigure:(i,t,e,r,n,o)=>{i.fillStyle=t,i.fillRect(e,r,n,o)}},{getFigure:(i,t,e,r,n,o)=>{const m=n/2,a=o/2;i.fillStyle=t,i.beginPath(),i.moveTo(e+m,r+a),i.lineTo(e+m+20,r+a),i.lineTo(e+m,r+a+20),i.fill()}},{getFigure:(i,t,e,r,n,o)=>{const m=n/2,a=o/2;i.beginPath(),i.arc(e+m,r+a,m,0,Math.PI*2,!0),i.stroke()}}];class c3{constructor(t){ht(this,"context");ht(this,"x");ht(this,"y");ht(this,"dataSourceNumber");ht(this,"backgroundColor");ht(this,"randomX");ht(this,"randomY");ht(this,"figure");this.context=t,this.dataSourceNumber=0,this.backgroundColor=Xe(),this.x=Ht.random(Ze-be),this.y=Ht.random(qe-me),this.randomX=Ht.random(be),this.randomY=Ht.random(me),this.figure=Ht.random(G0.length-1)}draw(t){this.dataSourceNumber=t,this.context.clearRect(this.x,this.y,be,me),G0[this.figure].getFigure(this.context,this.backgroundColor,this.x,this.y,this.randomX,this.randomY),this.context.fillStyle="black",this.context.font="18px Arial",this.context.fillText(t.toString(),this.x+5,this.y+20)}move(t,e){this.context.clearRect(this.x,this.y,be,me),this.x=t,this.y=e,this.draw(this.dataSourceNumber)}getElement(){return this}}class u3{constructor(t){ht(this,"appElement");ht(this,"dataSource");ht(this,"view");this.appElement=t,this.view=new U0(qe,Ze),this.dataSource=new Oi;const e=new xn;e.onChange=r=>{this.view.zoomTransform(r)},this.initButtonBindings()}initButtonBindings(){Se("addRawCanvasInCanvasView",()=>{const t=xe("rawCanvasComponentsCount");this.addRawCanvasComponents(t)}),Se("setDataSourceSettings",()=>{const t=xe("updateInterval");this.dataSource.updateInterval(t*1e3)}),Se("startMoveTest",()=>{const t=xe("movedComponentsCount");this.moveTest(t)})}start(){this.view=new U0(qe,Ze),this.dataSource=new Oi,this.appElement.appendChild(this.view.start()),this.dataSource.start()}addComponents(t,e,r){switch(t){case"Canvas":this.addRawCanvasComponents(e);break;default:throw new Error(`Canvas App: unknown component type:${t}`)}}addRawCanvasComponents(t){for(let e=0;e<t;e++){const r=new c3(this.view.getContext()),n=new zr(r);n.addSource(this.dataSource),this.view.addComponent(n)}this.view.start()}moveTest(t=0){this.view.moveTest(t)}stopDataSource(){this.dataSource.updateInterval(0)}}class f3{constructor(t,e,r){ht(this,"height");ht(this,"width");ht(this,"containerEl");ht(this,"canvas");ht(this,"components");ht(this,"movedComponents");ht(this,"positionManager");this.components=[],this.width=e,this.height=t,this.movedComponents=[],this.positionManager=new ha({viewWidth:this.width,viewHeight:this.height}),this.containerEl=document.createElement("canvas"),this.containerEl.width=this.width,this.containerEl.height=this.height,this.containerEl.style.border="1px solid red",r.appendChild(this.containerEl),this.canvas=new Wi.fabric.Canvas(this.containerEl,{width:Ze,height:qe})}getCanvas(){return this.canvas}addComponent(t){this.components.push(t)}start(){return this.components.forEach(t=>{t.draw(0)}),this.updateComponentsCount(),this.containerEl}updateComponentsCount(){const t=document.getElementById("componentCount");t.innerText=this.components.length.toString()}moveTest(t=0){this.movedComponents=this.components,t!==0&&(this.movedComponents=this.components.slice(0,t)),this.movedComponents.forEach(e=>{const r=e.getUIElement();this.positionManager.addPosition(r.x,r.y)}),this.moveElements()}moveElements(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t);this.movedComponents[t].getUIElement().move(e,r)}this.canvas.renderAll(),requestAnimationFrame(()=>this.moveElements())}zoomTransform(t){this.containerEl.style.transform=`scale(${t})`}zoomCanvasFabric(t){this.canvas.zoomToPoint({x:this.width/2,y:this.height/2},t)}}const oi=[{getFigure:(i,t)=>new Wi.fabric.Rect({left:i,top:t,fill:Xe(),width:Ht.random(10,be),height:Ht.random(10,me)})},{getFigure:(i,t)=>new Wi.fabric.Circle({left:i,top:t,fill:Xe(),radius:Ht.random(me/2)})},{getFigure:(i,t)=>new Wi.fabric.Triangle({left:i,top:t,fill:Xe(),width:Ht.random(10,be),height:Ht.random(10,me)})},{getFigure:(i,t)=>new Wi.fabric.Line([i,t,i+Ht.random(me),t+Ht.random(be)],{stroke:Xe(),strokeWidth:Ht.random(1,10)})}];class d3{constructor(t){ht(this,"canvas");ht(this,"figure");ht(this,"text");ht(this,"group");ht(this,"x");ht(this,"y");this.canvas=t,this.x=Ht.random(Ze-be),this.y=Ht.random(qe-me);const e=Ht.random(oi.length-1);this.text=new Wi.fabric.Text("...",{left:this.x+20,top:this.y+20}),this.figure=oi[e].getFigure(this.x,this.y);const r=oi[Ht.random(oi.length-1)].getFigure(this.x+10,this.y+10),n=oi[Ht.random(oi.length-1)].getFigure(this.x+30,this.y+30),o=oi[Ht.random(oi.length-1)].getFigure(this.x+30,this.y+20),m=oi[Ht.random(oi.length-1)].getFigure(this.x,this.y+30),a=oi[Ht.random(oi.length-1)].getFigure(this.x+10,this.y+20),s=oi[Ht.random(oi.length-1)].getFigure(this.x,this.y+15),h=oi[Ht.random(oi.length-1)].getFigure(this.x+15,this.y);this.group=new Wi.fabric.Group([this.figure,r,n,o,m,a,s,h,this.text],{left:this.x,top:this.y}),this.canvas.add(this.group)}draw(t){this.text.set({text:t.toString()})}getElement(){return this}move(t,e){this.group.set({left:t,top:e})}}class g3{constructor(t){ht(this,"appElement");ht(this,"dataSource");ht(this,"view");this.appElement=t,this.appElement.style.position="relative",this.appElement.style.width=Ze+"px",this.appElement.style.height=qe+"px",this.view=void 0,this.dataSource=new Oi;const e=new xn;e.onChange=n=>{var o;(o=this.view)==null||o.zoomTransform(n)};const r=new xn("canvasFabric");r.onChange=n=>{var o;(o=this.view)==null||o.zoomCanvasFabric(n)},this.initButtonBindings()}initButtonBindings(){Se("addCanvasFabricInFabricView",()=>{const t=xe("fabricComponentsCount");this.addFabricComponents(t)}),Se("setDataSourceSettings",()=>{const t=xe("updateInterval");this.dataSource.updateInterval(t*1e3)}),Se("startMoveTest",()=>{const t=xe("movedComponentsCount");this.moveTest(t)})}start(){this.view=new f3(qe,Ze,this.appElement),this.dataSource=new Oi,this.dataSource.start()}addComponents(t,e,r){switch(t){case"CanvasFabric":this.addFabricComponents(e);break;default:throw new Error(`Canvas Fabric App: unknown component type:${t}`)}}addFabricComponents(t){var e,r;if(this.view){for(let n=0;n<t;n++){const o=new d3(this.view.getCanvas()),m=new zr(o);(e=this.view)==null||e.addComponent(m)}(r=this.view)==null||r.start()}}moveTest(t=0){var e;(e=this.view)==null||e.moveTest(t)}stopDataSource(){this.dataSource.updateInterval(0)}}var ss=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(ss||{}),r_=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(r_||{}),Of=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(Of||{}),Bt=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(Bt||{}),Sr=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(Sr||{}),yt=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(yt||{}),Ys=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(Ys||{}),Rt=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(Rt||{}),Rf=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(Rf||{}),jr=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(jr||{}),yn=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(yn||{}),Tr=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Tr||{}),cr=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(cr||{}),_r=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(_r||{}),Ed=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(Ed||{}),Xi=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(Xi||{}),Ge=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(Ge||{}),Be=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(Be||{}),Cr=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(Cr||{});const p3={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},St={ADAPTER:p3,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var ku=/iPhone/i,H0=/iPod/i,W0=/iPad/i,X0=/\biOS-universal(?:.+)Mac\b/i,Bu=/\bAndroid(?:.+)Mobile\b/i,V0=/Android/i,Rs=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,hh=/Silk/i,Ur=/Windows Phone/i,z0=/\bWindows(?:.+)ARM\b/i,j0=/BlackBerry/i,Y0=/BB10/i,$0=/Opera Mini/i,K0=/\b(CriOS|Chrome)(?:.+)Mobile/i,q0=/Mobile(?:.+)Firefox\b/i,Z0=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function m3(i){return function(t){return t.test(i)}}function J0(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=m3(e),o={apple:{phone:n(ku)&&!n(Ur),ipod:n(H0),tablet:!n(ku)&&(n(W0)||Z0(t))&&!n(Ur),universal:n(X0),device:(n(ku)||n(H0)||n(W0)||n(X0)||Z0(t))&&!n(Ur)},amazon:{phone:n(Rs),tablet:!n(Rs)&&n(hh),device:n(Rs)||n(hh)},android:{phone:!n(Ur)&&n(Rs)||!n(Ur)&&n(Bu),tablet:!n(Ur)&&!n(Rs)&&!n(Bu)&&(n(hh)||n(V0)),device:!n(Ur)&&(n(Rs)||n(hh)||n(Bu)||n(V0))||n(/\bokhttp\b/i)},windows:{phone:n(Ur),tablet:n(z0),device:n(Ur)||n(z0)},other:{blackberry:n(j0),blackberry10:n(Y0),opera:n($0),firefox:n(q0),chrome:n(K0),device:n(j0)||n(Y0)||n($0)||n(q0)||n(K0)},any:!1,phone:!1,tablet:!1};return o.any=o.apple.device||o.android.device||o.windows.device||o.other.device,o.phone=o.apple.phone||o.android.phone||o.windows.phone,o.tablet=o.apple.tablet||o.android.tablet||o.windows.tablet,o}const v3=J0.default??J0,Yr=v3(globalThis.navigator);St.RETINA_PREFIX=/@([0-9\.]+)x/;St.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var n_={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(s,h,d){this.fn=s,this.context=h,this.once=d||!1}function o(s,h,d,l,u){if(typeof d!="function")throw new TypeError("The listener must be a function");var c=new n(d,l||s,u),f=e?e+h:h;return s._events[f]?s._events[f].fn?s._events[f]=[s._events[f],c]:s._events[f].push(c):(s._events[f]=c,s._eventsCount++),s}function m(s,h){--s._eventsCount===0?s._events=new r:delete s._events[h]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],d,l;if(this._eventsCount===0)return h;for(l in d=this._events)t.call(d,l)&&h.push(e?l.slice(1):l);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(d)):h},a.prototype.listeners=function(h){var d=e?e+h:h,l=this._events[d];if(!l)return[];if(l.fn)return[l.fn];for(var u=0,c=l.length,f=new Array(c);u<c;u++)f[u]=l[u].fn;return f},a.prototype.listenerCount=function(h){var d=e?e+h:h,l=this._events[d];return l?l.fn?1:l.length:0},a.prototype.emit=function(h,d,l,u,c,f){var v=e?e+h:h;if(!this._events[v])return!1;var p=this._events[v],y=arguments.length,b,x;if(p.fn){switch(p.once&&this.removeListener(h,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,d),!0;case 3:return p.fn.call(p.context,d,l),!0;case 4:return p.fn.call(p.context,d,l,u),!0;case 5:return p.fn.call(p.context,d,l,u,c),!0;case 6:return p.fn.call(p.context,d,l,u,c,f),!0}for(x=1,b=new Array(y-1);x<y;x++)b[x-1]=arguments[x];p.fn.apply(p.context,b)}else{var S=p.length,w;for(x=0;x<S;x++)switch(p[x].once&&this.removeListener(h,p[x].fn,void 0,!0),y){case 1:p[x].fn.call(p[x].context);break;case 2:p[x].fn.call(p[x].context,d);break;case 3:p[x].fn.call(p[x].context,d,l);break;case 4:p[x].fn.call(p[x].context,d,l,u);break;default:if(!b)for(w=1,b=new Array(y-1);w<y;w++)b[w-1]=arguments[w];p[x].fn.apply(p[x].context,b)}}return!0},a.prototype.on=function(h,d,l){return o(this,h,d,l,!1)},a.prototype.once=function(h,d,l){return o(this,h,d,l,!0)},a.prototype.removeListener=function(h,d,l,u){var c=e?e+h:h;if(!this._events[c])return this;if(!d)return m(this,c),this;var f=this._events[c];if(f.fn)f.fn===d&&(!u||f.once)&&(!l||f.context===l)&&m(this,c);else{for(var v=0,p=[],y=f.length;v<y;v++)(f[v].fn!==d||u&&!f[v].once||l&&f[v].context!==l)&&p.push(f[v]);p.length?this._events[c]=p.length===1?p[0]:p:m(this,c)}return this},a.prototype.removeAllListeners=function(h){var d;return h?(d=e?e+h:h,this._events[d]&&m(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(n_);var _3=n_.exports;const ho=Td(_3);var Ad={exports:{}};Ad.exports=ml;Ad.exports.default=ml;function ml(i,t,e){e=e||2;var r=t&&t.length,n=r?t[0]*e:i.length,o=s_(i,0,n,e,!0),m=[];if(!o||o.next===o.prev)return m;var a,s,h,d,l,u,c;if(r&&(o=C3(i,t,o,e)),i.length>80*e){a=h=i[0],s=d=i[1];for(var f=e;f<n;f+=e)l=i[f],u=i[f+1],l<a&&(a=l),u<s&&(s=u),l>h&&(h=l),u>d&&(d=u);c=Math.max(h-a,d-s),c=c!==0?32767/c:0}return to(o,m,e,a,s,c,0),m}function s_(i,t,e,r,n){var o,m;if(n===Lf(i,t,e,r)>0)for(o=t;o<e;o+=r)m=Q0(o,i[o],i[o+1],m);else for(o=e-r;o>=t;o-=r)m=Q0(o,i[o],i[o+1],m);return m&&vl(m,m.next)&&(io(m),m=m.next),m}function es(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(vl(e,e.next)||Ae(e.prev,e,e.next)===0)){if(io(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function to(i,t,e,r,n,o,m){if(i){!m&&o&&P3(i,r,n,o);for(var a=i,s,h;i.prev!==i.next;){if(s=i.prev,h=i.next,o?x3(i,r,n,o):y3(i)){t.push(s.i/e|0),t.push(i.i/e|0),t.push(h.i/e|0),io(i),i=h.next,a=h.next;continue}if(i=h,i===a){m?m===1?(i=b3(es(i),t,e),to(i,t,e,r,n,o,2)):m===2&&S3(i,t,e,r,n,o):to(es(i),t,e,r,n,o,1);break}}}}function y3(i){var t=i.prev,e=i,r=i.next;if(Ae(t,e,r)>=0)return!1;for(var n=t.x,o=e.x,m=r.x,a=t.y,s=e.y,h=r.y,d=n<o?n<m?n:m:o<m?o:m,l=a<s?a<h?a:h:s<h?s:h,u=n>o?n>m?n:m:o>m?o:m,c=a>s?a>h?a:h:s>h?s:h,f=r.next;f!==t;){if(f.x>=d&&f.x<=u&&f.y>=l&&f.y<=c&&zs(n,a,o,s,m,h,f.x,f.y)&&Ae(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function x3(i,t,e,r){var n=i.prev,o=i,m=i.next;if(Ae(n,o,m)>=0)return!1;for(var a=n.x,s=o.x,h=m.x,d=n.y,l=o.y,u=m.y,c=a<s?a<h?a:h:s<h?s:h,f=d<l?d<u?d:u:l<u?l:u,v=a>s?a>h?a:h:s>h?s:h,p=d>l?d>u?d:u:l>u?l:u,y=Df(c,f,t,e,r),b=Df(v,p,t,e,r),x=i.prevZ,S=i.nextZ;x&&x.z>=y&&S&&S.z<=b;){if(x.x>=c&&x.x<=v&&x.y>=f&&x.y<=p&&x!==n&&x!==m&&zs(a,d,s,l,h,u,x.x,x.y)&&Ae(x.prev,x,x.next)>=0||(x=x.prevZ,S.x>=c&&S.x<=v&&S.y>=f&&S.y<=p&&S!==n&&S!==m&&zs(a,d,s,l,h,u,S.x,S.y)&&Ae(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;x&&x.z>=y;){if(x.x>=c&&x.x<=v&&x.y>=f&&x.y<=p&&x!==n&&x!==m&&zs(a,d,s,l,h,u,x.x,x.y)&&Ae(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;S&&S.z<=b;){if(S.x>=c&&S.x<=v&&S.y>=f&&S.y<=p&&S!==n&&S!==m&&zs(a,d,s,l,h,u,S.x,S.y)&&Ae(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function b3(i,t,e){var r=i;do{var n=r.prev,o=r.next.next;!vl(n,o)&&a_(n,r,r.next,o)&&eo(n,o)&&eo(o,n)&&(t.push(n.i/e|0),t.push(r.i/e|0),t.push(o.i/e|0),io(r),io(r.next),r=i=o),r=r.next}while(r!==i);return es(r)}function S3(i,t,e,r,n,o){var m=i;do{for(var a=m.next.next;a!==m.prev;){if(m.i!==a.i&&O3(m,a)){var s=o_(m,a);m=es(m,m.next),s=es(s,s.next),to(m,t,e,r,n,o,0),to(s,t,e,r,n,o,0);return}a=a.next}m=m.next}while(m!==i)}function C3(i,t,e,r){var n=[],o,m,a,s,h;for(o=0,m=t.length;o<m;o++)a=t[o]*r,s=o<m-1?t[o+1]*r:i.length,h=s_(i,a,s,r,!1),h===h.next&&(h.steiner=!0),n.push(M3(h));for(n.sort(w3),o=0;o<n.length;o++)e=T3(n[o],e);return e}function w3(i,t){return i.x-t.x}function T3(i,t){var e=E3(i,t);if(!e)return t;var r=o_(e,i);return es(r,r.next),es(e,e.next)}function E3(i,t){var e=t,r=i.x,n=i.y,o=-1/0,m;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var a=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(a<=r&&a>o&&(o=a,m=e.x<e.next.x?e:e.next,a===r))return m}e=e.next}while(e!==t);if(!m)return null;var s=m,h=m.x,d=m.y,l=1/0,u;e=m;do r>=e.x&&e.x>=h&&r!==e.x&&zs(n<d?r:o,n,h,d,n<d?o:r,n,e.x,e.y)&&(u=Math.abs(n-e.y)/(r-e.x),eo(e,i)&&(u<l||u===l&&(e.x>m.x||e.x===m.x&&A3(m,e)))&&(m=e,l=u)),e=e.next;while(e!==s);return m}function A3(i,t){return Ae(i.prev,i,t.prev)<0&&Ae(t.next,i,i.next)<0}function P3(i,t,e,r){var n=i;do n.z===0&&(n.z=Df(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,I3(n)}function I3(i){var t,e,r,n,o,m,a,s,h=1;do{for(e=i,i=null,o=null,m=0;e;){for(m++,r=e,a=0,t=0;t<h&&(a++,r=r.nextZ,!!r);t++);for(s=h;a>0||s>0&&r;)a!==0&&(s===0||!r||e.z<=r.z)?(n=e,e=e.nextZ,a--):(n=r,r=r.nextZ,s--),o?o.nextZ=n:i=n,n.prevZ=o,o=n;e=r}o.nextZ=null,h*=2}while(m>1);return i}function Df(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function M3(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function zs(i,t,e,r,n,o,m,a){return(n-m)*(t-a)>=(i-m)*(o-a)&&(i-m)*(r-a)>=(e-m)*(t-a)&&(e-m)*(o-a)>=(n-m)*(r-a)}function O3(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!R3(i,t)&&(eo(i,t)&&eo(t,i)&&D3(i,t)&&(Ae(i.prev,i,t.prev)||Ae(i,t.prev,t))||vl(i,t)&&Ae(i.prev,i,i.next)>0&&Ae(t.prev,t,t.next)>0)}function Ae(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function vl(i,t){return i.x===t.x&&i.y===t.y}function a_(i,t,e,r){var n=ch(Ae(i,t,e)),o=ch(Ae(i,t,r)),m=ch(Ae(e,r,i)),a=ch(Ae(e,r,t));return!!(n!==o&&m!==a||n===0&&lh(i,e,t)||o===0&&lh(i,r,t)||m===0&&lh(e,i,r)||a===0&&lh(e,t,r))}function lh(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function ch(i){return i>0?1:i<0?-1:0}function R3(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&a_(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function eo(i,t){return Ae(i.prev,i,i.next)<0?Ae(i,t,i.next)>=0&&Ae(i,i.prev,t)>=0:Ae(i,t,i.prev)<0||Ae(i,i.next,t)<0}function D3(i,t){var e=i,r=!1,n=(i.x+t.x)/2,o=(i.y+t.y)/2;do e.y>o!=e.next.y>o&&e.next.y!==e.y&&n<(e.next.x-e.x)*(o-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function o_(i,t){var e=new Ff(i.i,i.x,i.y),r=new Ff(t.i,t.x,t.y),n=i.next,o=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,o.next=r,r.prev=o,r}function Q0(i,t,e,r){var n=new Ff(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function io(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ff(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ml.deviation=function(i,t,e,r){var n=t&&t.length,o=n?t[0]*e:i.length,m=Math.abs(Lf(i,0,o,e));if(n)for(var a=0,s=t.length;a<s;a++){var h=t[a]*e,d=a<s-1?t[a+1]*e:i.length;m-=Math.abs(Lf(i,h,d,e))}var l=0;for(a=0;a<r.length;a+=3){var u=r[a]*e,c=r[a+1]*e,f=r[a+2]*e;l+=Math.abs((i[u]-i[f])*(i[c+1]-i[u+1])-(i[u]-i[c])*(i[f+1]-i[u+1]))}return m===0&&l===0?0:Math.abs((l-m)/m)};function Lf(i,t,e,r){for(var n=0,o=t,m=e-r;o<e;o+=r)n+=(i[m]-i[o])*(i[o+1]+i[m+1]),m=o;return n}ml.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,n=0;n<i.length;n++){for(var o=0;o<i[n].length;o++)for(var m=0;m<t;m++)e.vertices.push(i[n][o][m]);n>0&&(r+=i[n-1].length,e.holes.push(r))}return e};var F3=Ad.exports;const L3=Td(F3);var qh={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */qh.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,o=typeof xr=="object"&&xr;(o.global===o||o.window===o||o.self===o)&&(e=o);var m,a=2147483647,s=36,h=1,d=26,l=38,u=700,c=72,f=128,v="-",p=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=s-h,w=Math.floor,E=String.fromCharCode,P;function A(M){throw new RangeError(x[M])}function N(M,L){for(var H=M.length,Z=[];H--;)Z[H]=L(M[H]);return Z}function k(M,L){var H=M.split("@"),Z="";H.length>1&&(Z=H[0]+"@",M=H[1]),M=M.replace(b,".");var G=M.split("."),F=N(G,L).join(".");return Z+F}function U(M){for(var L=[],H=0,Z=M.length,G,F;H<Z;)G=M.charCodeAt(H++),G>=55296&&G<=56319&&H<Z?(F=M.charCodeAt(H++),(F&64512)==56320?L.push(((G&1023)<<10)+(F&1023)+65536):(L.push(G),H--)):L.push(G);return L}function j(M){return N(M,function(L){var H="";return L>65535&&(L-=65536,H+=E(L>>>10&1023|55296),L=56320|L&1023),H+=E(L),H}).join("")}function X(M){return M-48<10?M-22:M-65<26?M-65:M-97<26?M-97:s}function W(M,L){return M+22+75*(M<26)-((L!=0)<<5)}function Q(M,L,H){var Z=0;for(M=H?w(M/u):M>>1,M+=w(M/L);M>S*d>>1;Z+=s)M=w(M/S);return w(Z+(S+1)*M/(M+l))}function ot(M){var L=[],H=M.length,Z,G=0,F=f,Y=c,R,z,$,st,nt,ft,et,q,rt;for(R=M.lastIndexOf(v),R<0&&(R=0),z=0;z<R;++z)M.charCodeAt(z)>=128&&A("not-basic"),L.push(M.charCodeAt(z));for($=R>0?R+1:0;$<H;){for(st=G,nt=1,ft=s;$>=H&&A("invalid-input"),et=X(M.charCodeAt($++)),(et>=s||et>w((a-G)/nt))&&A("overflow"),G+=et*nt,q=ft<=Y?h:ft>=Y+d?d:ft-Y,!(et<q);ft+=s)rt=s-q,nt>w(a/rt)&&A("overflow"),nt*=rt;Z=L.length+1,Y=Q(G-st,Z,st==0),w(G/Z)>a-F&&A("overflow"),F+=w(G/Z),G%=Z,L.splice(G++,0,F)}return j(L)}function it(M){var L,H,Z,G,F,Y,R,z,$,st,nt,ft=[],et,q,rt,ut;for(M=U(M),et=M.length,L=f,H=0,F=c,Y=0;Y<et;++Y)nt=M[Y],nt<128&&ft.push(E(nt));for(Z=G=ft.length,G&&ft.push(v);Z<et;){for(R=a,Y=0;Y<et;++Y)nt=M[Y],nt>=L&&nt<R&&(R=nt);for(q=Z+1,R-L>w((a-H)/q)&&A("overflow"),H+=(R-L)*q,L=R,Y=0;Y<et;++Y)if(nt=M[Y],nt<L&&++H>a&&A("overflow"),nt==L){for(z=H,$=s;st=$<=F?h:$>=F+d?d:$-F,!(z<st);$+=s)ut=z-st,rt=s-st,ft.push(E(W(st+ut%rt,0))),z=w(ut/rt);ft.push(E(W(z,0))),F=Q(H,q,Z==G),H=0,++Z}++H,++L}return ft.join("")}function ct(M){return k(M,function(L){return p.test(L)?ot(L.slice(4).toLowerCase()):L})}function O(M){return k(M,function(L){return y.test(L)?"xn--"+it(L):L})}if(m={version:"1.4.1",ucs2:{decode:U,encode:j},decode:ot,encode:it,toASCII:O,toUnicode:ct},r&&n)if(i.exports==r)n.exports=m;else for(P in m)m.hasOwnProperty(P)&&(r[P]=m[P]);else e.punycode=m})(xr)})(qh,qh.exports);var k3=qh.exports,B3=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(e in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var m=Object.getOwnPropertyDescriptor(t,e);if(m.value!==n||m.enumerable!==!0)return!1}return!0},tm=typeof Symbol<"u"&&Symbol,N3=B3,U3=function(){return typeof tm!="function"||typeof Symbol!="function"||typeof tm("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:N3()},em={foo:{}},G3=Object,H3=function(){return{__proto__:em}.foo===em.foo&&!({__proto__:null}instanceof G3)},W3="Function.prototype.bind called on incompatible ",Nu=Array.prototype.slice,X3=Object.prototype.toString,V3="[object Function]",z3=function(t){var e=this;if(typeof e!="function"||X3.call(e)!==V3)throw new TypeError(W3+e);for(var r=Nu.call(arguments,1),n,o=function(){if(this instanceof n){var d=e.apply(this,r.concat(Nu.call(arguments)));return Object(d)===d?d:this}else return e.apply(t,r.concat(Nu.call(arguments)))},m=Math.max(0,e.length-r.length),a=[],s=0;s<m;s++)a.push("$"+s);if(n=Function("binder","return function ("+a.join(",")+"){ return binder.apply(this,arguments); }")(o),e.prototype){var h=function(){};h.prototype=e.prototype,n.prototype=new h,h.prototype=null}return n},j3=z3,Pd=Function.prototype.bind||j3,Y3=Pd,$3=Y3.call(Function.call,Object.prototype.hasOwnProperty),te,ta=SyntaxError,h_=Function,$s=TypeError,Uu=function(i){try{return h_('"use strict"; return ('+i+").constructor;")()}catch{}},Zn=Object.getOwnPropertyDescriptor;if(Zn)try{Zn({},"")}catch{Zn=null}var Gu=function(){throw new $s},K3=Zn?function(){try{return arguments.callee,Gu}catch{try{return Zn(arguments,"callee").get}catch{return Gu}}}():Gu,Ds=U3(),q3=H3(),$e=Object.getPrototypeOf||(q3?function(i){return i.__proto__}:null),Us={},Z3=typeof Uint8Array>"u"||!$e?te:$e(Uint8Array),Jn={"%AggregateError%":typeof AggregateError>"u"?te:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?te:ArrayBuffer,"%ArrayIteratorPrototype%":Ds&&$e?$e([][Symbol.iterator]()):te,"%AsyncFromSyncIteratorPrototype%":te,"%AsyncFunction%":Us,"%AsyncGenerator%":Us,"%AsyncGeneratorFunction%":Us,"%AsyncIteratorPrototype%":Us,"%Atomics%":typeof Atomics>"u"?te:Atomics,"%BigInt%":typeof BigInt>"u"?te:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?te:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?te:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?te:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?te:Float32Array,"%Float64Array%":typeof Float64Array>"u"?te:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?te:FinalizationRegistry,"%Function%":h_,"%GeneratorFunction%":Us,"%Int8Array%":typeof Int8Array>"u"?te:Int8Array,"%Int16Array%":typeof Int16Array>"u"?te:Int16Array,"%Int32Array%":typeof Int32Array>"u"?te:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ds&&$e?$e($e([][Symbol.iterator]())):te,"%JSON%":typeof JSON=="object"?JSON:te,"%Map%":typeof Map>"u"?te:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ds||!$e?te:$e(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?te:Promise,"%Proxy%":typeof Proxy>"u"?te:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?te:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?te:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ds||!$e?te:$e(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?te:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ds&&$e?$e(""[Symbol.iterator]()):te,"%Symbol%":Ds?Symbol:te,"%SyntaxError%":ta,"%ThrowTypeError%":K3,"%TypedArray%":Z3,"%TypeError%":$s,"%Uint8Array%":typeof Uint8Array>"u"?te:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?te:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?te:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?te:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?te:WeakMap,"%WeakRef%":typeof WeakRef>"u"?te:WeakRef,"%WeakSet%":typeof WeakSet>"u"?te:WeakSet};if($e)try{null.error}catch(i){var J3=$e($e(i));Jn["%Error.prototype%"]=J3}var Q3=function i(t){var e;if(t==="%AsyncFunction%")e=Uu("async function () {}");else if(t==="%GeneratorFunction%")e=Uu("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Uu("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=i("%AsyncGenerator%");n&&$e&&(e=$e(n.prototype))}return Jn[t]=e,e},im={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},lo=Pd,Zh=$3,tE=lo.call(Function.call,Array.prototype.concat),eE=lo.call(Function.apply,Array.prototype.splice),rm=lo.call(Function.call,String.prototype.replace),Jh=lo.call(Function.call,String.prototype.slice),iE=lo.call(Function.call,RegExp.prototype.exec),rE=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,nE=/\\(\\)?/g,sE=function(t){var e=Jh(t,0,1),r=Jh(t,-1);if(e==="%"&&r!=="%")throw new ta("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new ta("invalid intrinsic syntax, expected opening `%`");var n=[];return rm(t,rE,function(o,m,a,s){n[n.length]=a?rm(s,nE,"$1"):m||o}),n},aE=function(t,e){var r=t,n;if(Zh(im,r)&&(n=im[r],r="%"+n[0]+"%"),Zh(Jn,r)){var o=Jn[r];if(o===Us&&(o=Q3(r)),typeof o>"u"&&!e)throw new $s("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:o}}throw new ta("intrinsic "+t+" does not exist!")},Id=function(t,e){if(typeof t!="string"||t.length===0)throw new $s("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new $s('"allowMissing" argument must be a boolean');if(iE(/^%?[^%]*%?$/,t)===null)throw new ta("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=sE(t),n=r.length>0?r[0]:"",o=aE("%"+n+"%",e),m=o.name,a=o.value,s=!1,h=o.alias;h&&(n=h[0],eE(r,tE([0,1],h)));for(var d=1,l=!0;d<r.length;d+=1){var u=r[d],c=Jh(u,0,1),f=Jh(u,-1);if((c==='"'||c==="'"||c==="`"||f==='"'||f==="'"||f==="`")&&c!==f)throw new ta("property names with quotes must have matching quotes");if((u==="constructor"||!l)&&(s=!0),n+="."+u,m="%"+n+"%",Zh(Jn,m))a=Jn[m];else if(a!=null){if(!(u in a)){if(!e)throw new $s("base intrinsic for "+t+" exists, but the property is not available.");return}if(Zn&&d+1>=r.length){var v=Zn(a,u);l=!!v,l&&"get"in v&&!("originalValue"in v.get)?a=v.get:a=a[u]}else l=Zh(a,u),a=a[u];l&&!s&&(Jn[m]=a)}}return a},l_={exports:{}};(function(i){var t=Pd,e=Id,r=e("%Function.prototype.apply%"),n=e("%Function.prototype.call%"),o=e("%Reflect.apply%",!0)||t.call(n,r),m=e("%Object.getOwnPropertyDescriptor%",!0),a=e("%Object.defineProperty%",!0),s=e("%Math.max%");if(a)try{a({},"a",{value:1})}catch{a=null}i.exports=function(l){var u=o(t,n,arguments);if(m&&a){var c=m(u,"length");c.configurable&&a(u,"length",{value:1+s(0,l.length-(arguments.length-1))})}return u};var h=function(){return o(t,r,arguments)};a?a(i.exports,"apply",{value:h}):i.exports.apply=h})(l_);var oE=l_.exports,c_=Id,u_=oE,hE=u_(c_("String.prototype.indexOf")),lE=function(t,e){var r=c_(t,!!e);return typeof r=="function"&&hE(t,".prototype.")>-1?u_(r):r},Md=typeof Map=="function"&&Map.prototype,Hu=Object.getOwnPropertyDescriptor&&Md?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Qh=Md&&Hu&&typeof Hu.get=="function"?Hu.get:null,nm=Md&&Map.prototype.forEach,Od=typeof Set=="function"&&Set.prototype,Wu=Object.getOwnPropertyDescriptor&&Od?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,tl=Od&&Wu&&typeof Wu.get=="function"?Wu.get:null,sm=Od&&Set.prototype.forEach,cE=typeof WeakMap=="function"&&WeakMap.prototype,Ka=cE?WeakMap.prototype.has:null,uE=typeof WeakSet=="function"&&WeakSet.prototype,qa=uE?WeakSet.prototype.has:null,fE=typeof WeakRef=="function"&&WeakRef.prototype,am=fE?WeakRef.prototype.deref:null,dE=Boolean.prototype.valueOf,gE=Object.prototype.toString,pE=Function.prototype.toString,mE=String.prototype.match,Rd=String.prototype.slice,mn=String.prototype.replace,vE=String.prototype.toUpperCase,om=String.prototype.toLowerCase,f_=RegExp.prototype.test,hm=Array.prototype.concat,yr=Array.prototype.join,_E=Array.prototype.slice,lm=Math.floor,kf=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Xu=Object.getOwnPropertySymbols,Bf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,ea=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ui=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===ea||"symbol")?Symbol.toStringTag:null,d_=Object.prototype.propertyIsEnumerable,cm=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function um(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||f_.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-lm(-i):lm(i);if(r!==i){var n=String(r),o=Rd.call(t,n.length+1);return mn.call(n,e,"$&_")+"."+mn.call(mn.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return mn.call(t,e,"$&_")}var Nf=Uh,fm=Nf.custom,dm=p_(fm)?fm:null,yE=function i(t,e,r,n){var o=e||{};if(gn(o,"quoteStyle")&&o.quoteStyle!=="single"&&o.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(gn(o,"maxStringLength")&&(typeof o.maxStringLength=="number"?o.maxStringLength<0&&o.maxStringLength!==1/0:o.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=gn(o,"customInspect")?o.customInspect:!0;if(typeof m!="boolean"&&m!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(gn(o,"indent")&&o.indent!==null&&o.indent!=="	"&&!(parseInt(o.indent,10)===o.indent&&o.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(gn(o,"numericSeparator")&&typeof o.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=o.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return v_(t,o);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var s=String(t);return a?um(t,s):s}if(typeof t=="bigint"){var h=String(t)+"n";return a?um(t,h):h}var d=typeof o.depth>"u"?5:o.depth;if(typeof r>"u"&&(r=0),r>=d&&d>0&&typeof t=="object")return Uf(t)?"[Array]":"[Object]";var l=BE(o,r);if(typeof n>"u")n=[];else if(m_(n,t)>=0)return"[Circular]";function u(X,W,Q){if(W&&(n=_E.call(n),n.push(W)),Q){var ot={depth:o.depth};return gn(o,"quoteStyle")&&(ot.quoteStyle=o.quoteStyle),i(X,ot,r+1,n)}return i(X,o,r+1,n)}if(typeof t=="function"&&!gm(t)){var c=PE(t),f=uh(t,u);return"[Function"+(c?": "+c:" (anonymous)")+"]"+(f.length>0?" { "+yr.call(f,", ")+" }":"")}if(p_(t)){var v=ea?mn.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Bf.call(t);return typeof t=="object"&&!ea?La(v):v}if(FE(t)){for(var p="<"+om.call(String(t.nodeName)),y=t.attributes||[],b=0;b<y.length;b++)p+=" "+y[b].name+"="+g_(xE(y[b].value),"double",o);return p+=">",t.childNodes&&t.childNodes.length&&(p+="..."),p+="</"+om.call(String(t.nodeName))+">",p}if(Uf(t)){if(t.length===0)return"[]";var x=uh(t,u);return l&&!kE(x)?"["+Gf(x,l)+"]":"[ "+yr.call(x,", ")+" ]"}if(SE(t)){var S=uh(t,u);return!("cause"in Error.prototype)&&"cause"in t&&!d_.call(t,"cause")?"{ ["+String(t)+"] "+yr.call(hm.call("[cause]: "+u(t.cause),S),", ")+" }":S.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+yr.call(S,", ")+" }"}if(typeof t=="object"&&m){if(dm&&typeof t[dm]=="function"&&Nf)return Nf(t,{depth:d-r});if(m!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(IE(t)){var w=[];return nm&&nm.call(t,function(X,W){w.push(u(W,t,!0)+" => "+u(X,t))}),pm("Map",Qh.call(t),w,l)}if(RE(t)){var E=[];return sm&&sm.call(t,function(X){E.push(u(X,t))}),pm("Set",tl.call(t),E,l)}if(ME(t))return Vu("WeakMap");if(DE(t))return Vu("WeakSet");if(OE(t))return Vu("WeakRef");if(wE(t))return La(u(Number(t)));if(EE(t))return La(u(kf.call(t)));if(TE(t))return La(dE.call(t));if(CE(t))return La(u(String(t)));if(!bE(t)&&!gm(t)){var P=uh(t,u),A=cm?cm(t)===Object.prototype:t instanceof Object||t.constructor===Object,N=t instanceof Object?"":"null prototype",k=!A&&ui&&Object(t)===t&&ui in t?Rd.call(Tn(t),8,-1):N?"Object":"",U=A||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",j=U+(k||N?"["+yr.call(hm.call([],k||[],N||[]),": ")+"] ":"");return P.length===0?j+"{}":l?j+"{"+Gf(P,l)+"}":j+"{ "+yr.call(P,", ")+" }"}return String(t)};function g_(i,t,e){var r=(e.quoteStyle||t)==="double"?'"':"'";return r+i+r}function xE(i){return mn.call(String(i),/"/g,"&quot;")}function Uf(i){return Tn(i)==="[object Array]"&&(!ui||!(typeof i=="object"&&ui in i))}function bE(i){return Tn(i)==="[object Date]"&&(!ui||!(typeof i=="object"&&ui in i))}function gm(i){return Tn(i)==="[object RegExp]"&&(!ui||!(typeof i=="object"&&ui in i))}function SE(i){return Tn(i)==="[object Error]"&&(!ui||!(typeof i=="object"&&ui in i))}function CE(i){return Tn(i)==="[object String]"&&(!ui||!(typeof i=="object"&&ui in i))}function wE(i){return Tn(i)==="[object Number]"&&(!ui||!(typeof i=="object"&&ui in i))}function TE(i){return Tn(i)==="[object Boolean]"&&(!ui||!(typeof i=="object"&&ui in i))}function p_(i){if(ea)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!Bf)return!1;try{return Bf.call(i),!0}catch{}return!1}function EE(i){if(!i||typeof i!="object"||!kf)return!1;try{return kf.call(i),!0}catch{}return!1}var AE=Object.prototype.hasOwnProperty||function(i){return i in this};function gn(i,t){return AE.call(i,t)}function Tn(i){return gE.call(i)}function PE(i){if(i.name)return i.name;var t=mE.call(pE.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function m_(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function IE(i){if(!Qh||!i||typeof i!="object")return!1;try{Qh.call(i);try{tl.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function ME(i){if(!Ka||!i||typeof i!="object")return!1;try{Ka.call(i,Ka);try{qa.call(i,qa)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function OE(i){if(!am||!i||typeof i!="object")return!1;try{return am.call(i),!0}catch{}return!1}function RE(i){if(!tl||!i||typeof i!="object")return!1;try{tl.call(i);try{Qh.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function DE(i){if(!qa||!i||typeof i!="object")return!1;try{qa.call(i,qa);try{Ka.call(i,Ka)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function FE(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function v_(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return v_(Rd.call(i,0,t.maxStringLength),t)+r}var n=mn.call(mn.call(i,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,LE);return g_(n,"single",t)}function LE(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+vE.call(t.toString(16))}function La(i){return"Object("+i+")"}function Vu(i){return i+" { ? }"}function pm(i,t,e,r){var n=r?Gf(e,r):yr.call(e,", ");return i+" ("+t+") {"+n+"}"}function kE(i){for(var t=0;t<i.length;t++)if(m_(i[t],`
`)>=0)return!1;return!0}function BE(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=yr.call(Array(i.indent+1)," ");else return null;return{base:e,prev:yr.call(Array(t+1),e)}}function Gf(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+yr.call(i,","+e)+`
`+t.prev}function uh(i,t){var e=Uf(i),r=[];if(e){r.length=i.length;for(var n=0;n<i.length;n++)r[n]=gn(i,n)?t(i[n],i):""}var o=typeof Xu=="function"?Xu(i):[],m;if(ea){m={};for(var a=0;a<o.length;a++)m["$"+o[a]]=o[a]}for(var s in i)gn(i,s)&&(e&&String(Number(s))===s&&s<i.length||ea&&m["$"+s]instanceof Symbol||(f_.call(/[^\w$]/,s)?r.push(t(s,i)+": "+t(i[s],i)):r.push(s+": "+t(i[s],i))));if(typeof Xu=="function")for(var h=0;h<o.length;h++)d_.call(i,o[h])&&r.push("["+t(o[h])+"]: "+t(i[o[h]],i));return r}var Dd=Id,la=lE,NE=yE,UE=Dd("%TypeError%"),fh=Dd("%WeakMap%",!0),dh=Dd("%Map%",!0),GE=la("WeakMap.prototype.get",!0),HE=la("WeakMap.prototype.set",!0),WE=la("WeakMap.prototype.has",!0),XE=la("Map.prototype.get",!0),VE=la("Map.prototype.set",!0),zE=la("Map.prototype.has",!0),Fd=function(i,t){for(var e=i,r;(r=e.next)!==null;e=r)if(r.key===t)return e.next=r.next,r.next=i.next,i.next=r,r},jE=function(i,t){var e=Fd(i,t);return e&&e.value},YE=function(i,t,e){var r=Fd(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},$E=function(i,t){return!!Fd(i,t)},KE=function(){var t,e,r,n={assert:function(o){if(!n.has(o))throw new UE("Side channel does not contain "+NE(o))},get:function(o){if(fh&&o&&(typeof o=="object"||typeof o=="function")){if(t)return GE(t,o)}else if(dh){if(e)return XE(e,o)}else if(r)return jE(r,o)},has:function(o){if(fh&&o&&(typeof o=="object"||typeof o=="function")){if(t)return WE(t,o)}else if(dh){if(e)return zE(e,o)}else if(r)return $E(r,o);return!1},set:function(o,m){fh&&o&&(typeof o=="object"||typeof o=="function")?(t||(t=new fh),HE(t,o,m)):dh?(e||(e=new dh),VE(e,o,m)):(r||(r={key:{},next:null}),YE(r,o,m))}};return n},qE=String.prototype.replace,ZE=/%20/g,zu={RFC1738:"RFC1738",RFC3986:"RFC3986"},Ld={default:zu.RFC3986,formatters:{RFC1738:function(i){return qE.call(i,ZE,"+")},RFC3986:function(i){return String(i)}},RFC1738:zu.RFC1738,RFC3986:zu.RFC3986},JE=Ld,ju=Object.prototype.hasOwnProperty,Kn=Array.isArray,pr=function(){for(var i=[],t=0;t<256;++t)i.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return i}(),QE=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(Kn(r)){for(var n=[],o=0;o<r.length;++o)typeof r[o]<"u"&&n.push(r[o]);e.obj[e.prop]=n}}},__=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)typeof t[n]<"u"&&(r[n]=t[n]);return r},t5=function i(t,e,r){if(!e)return t;if(typeof e!="object"){if(Kn(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!ju.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return Kn(t)&&!Kn(e)&&(n=__(t,r)),Kn(t)&&Kn(e)?(e.forEach(function(o,m){if(ju.call(t,m)){var a=t[m];a&&typeof a=="object"&&o&&typeof o=="object"?t[m]=i(a,o,r):t.push(o)}else t[m]=o}),t):Object.keys(e).reduce(function(o,m){var a=e[m];return ju.call(o,m)?o[m]=i(o[m],a,r):o[m]=a,o},n)},e5=function(t,e){return Object.keys(e).reduce(function(r,n){return r[n]=e[n],r},t)},i5=function(i,t,e){var r=i.replace(/\+/g," ");if(e==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},r5=function(t,e,r,n,o){if(t.length===0)return t;var m=t;if(typeof t=="symbol"?m=Symbol.prototype.toString.call(t):typeof t!="string"&&(m=String(t)),r==="iso-8859-1")return escape(m).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});for(var a="",s=0;s<m.length;++s){var h=m.charCodeAt(s);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||o===JE.RFC1738&&(h===40||h===41)){a+=m.charAt(s);continue}if(h<128){a=a+pr[h];continue}if(h<2048){a=a+(pr[192|h>>6]+pr[128|h&63]);continue}if(h<55296||h>=57344){a=a+(pr[224|h>>12]+pr[128|h>>6&63]+pr[128|h&63]);continue}s+=1,h=65536+((h&1023)<<10|m.charCodeAt(s)&1023),a+=pr[240|h>>18]+pr[128|h>>12&63]+pr[128|h>>6&63]+pr[128|h&63]}return a},n5=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var o=e[n],m=o.obj[o.prop],a=Object.keys(m),s=0;s<a.length;++s){var h=a[s],d=m[h];typeof d=="object"&&d!==null&&r.indexOf(d)===-1&&(e.push({obj:m,prop:h}),r.push(d))}return QE(e),t},s5=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},a5=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},o5=function(t,e){return[].concat(t,e)},h5=function(t,e){if(Kn(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},y_={arrayToObject:__,assign:e5,combine:o5,compact:n5,decode:i5,encode:r5,isBuffer:a5,isRegExp:s5,maybeMap:h5,merge:t5},x_=KE,Gh=y_,Za=Ld,l5=Object.prototype.hasOwnProperty,mm={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Vr=Array.isArray,c5=Array.prototype.push,b_=function(i,t){c5.apply(i,Vr(t)?t:[t])},u5=Date.prototype.toISOString,vm=Za.default,hi={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:Gh.encode,encodeValuesOnly:!1,format:vm,formatter:Za.formatters[vm],indices:!1,serializeDate:function(t){return u5.call(t)},skipNulls:!1,strictNullHandling:!1},f5=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Yu={},d5=function i(t,e,r,n,o,m,a,s,h,d,l,u,c,f,v,p){for(var y=t,b=p,x=0,S=!1;(b=b.get(Yu))!==void 0&&!S;){var w=b.get(t);if(x+=1,typeof w<"u"){if(w===x)throw new RangeError("Cyclic object value");S=!0}typeof b.get(Yu)>"u"&&(x=0)}if(typeof s=="function"?y=s(e,y):y instanceof Date?y=l(y):r==="comma"&&Vr(y)&&(y=Gh.maybeMap(y,function(ot){return ot instanceof Date?l(ot):ot})),y===null){if(o)return a&&!f?a(e,hi.encoder,v,"key",u):e;y=""}if(f5(y)||Gh.isBuffer(y)){if(a){var E=f?e:a(e,hi.encoder,v,"key",u);return[c(E)+"="+c(a(y,hi.encoder,v,"value",u))]}return[c(e)+"="+c(String(y))]}var P=[];if(typeof y>"u")return P;var A;if(r==="comma"&&Vr(y))f&&a&&(y=Gh.maybeMap(y,a)),A=[{value:y.length>0?y.join(",")||null:void 0}];else if(Vr(s))A=s;else{var N=Object.keys(y);A=h?N.sort(h):N}for(var k=n&&Vr(y)&&y.length===1?e+"[]":e,U=0;U<A.length;++U){var j=A[U],X=typeof j=="object"&&typeof j.value<"u"?j.value:y[j];if(!(m&&X===null)){var W=Vr(y)?typeof r=="function"?r(k,j):k:k+(d?"."+j:"["+j+"]");p.set(t,x);var Q=x_();Q.set(Yu,p),b_(P,i(X,W,r,n,o,m,r==="comma"&&f&&Vr(y)?null:a,s,h,d,l,u,c,f,v,Q))}}return P},g5=function(t){if(!t)return hi;if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||hi.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=Za.default;if(typeof t.format<"u"){if(!l5.call(Za.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=Za.formatters[r],o=hi.filter;return(typeof t.filter=="function"||Vr(t.filter))&&(o=t.filter),{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:hi.addQueryPrefix,allowDots:typeof t.allowDots>"u"?hi.allowDots:!!t.allowDots,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:hi.charsetSentinel,delimiter:typeof t.delimiter>"u"?hi.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:hi.encode,encoder:typeof t.encoder=="function"?t.encoder:hi.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:hi.encodeValuesOnly,filter:o,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:hi.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:hi.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:hi.strictNullHandling}},p5=function(i,t){var e=i,r=g5(t),n,o;typeof r.filter=="function"?(o=r.filter,e=o("",e)):Vr(r.filter)&&(o=r.filter,n=o);var m=[];if(typeof e!="object"||e===null)return"";var a;t&&t.arrayFormat in mm?a=t.arrayFormat:t&&"indices"in t?a=t.indices?"indices":"repeat":a="indices";var s=mm[a];if(t&&"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=s==="comma"&&t&&t.commaRoundTrip;n||(n=Object.keys(e)),r.sort&&n.sort(r.sort);for(var d=x_(),l=0;l<n.length;++l){var u=n[l];r.skipNulls&&e[u]===null||b_(m,d5(e[u],u,s,h,r.strictNullHandling,r.skipNulls,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,d))}var c=m.join(r.delimiter),f=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),c.length>0?f+c:""},ia=y_,Hf=Object.prototype.hasOwnProperty,m5=Array.isArray,Ye={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ia.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},v5=function(i){return i.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},S_=function(i,t){return i&&typeof i=="string"&&t.comma&&i.indexOf(",")>-1?i.split(","):i},_5="utf8=%26%2310003%3B",y5="utf8=%E2%9C%93",x5=function(t,e){var r={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,o=e.parameterLimit===1/0?void 0:e.parameterLimit,m=n.split(e.delimiter,o),a=-1,s,h=e.charset;if(e.charsetSentinel)for(s=0;s<m.length;++s)m[s].indexOf("utf8=")===0&&(m[s]===y5?h="utf-8":m[s]===_5&&(h="iso-8859-1"),a=s,s=m.length);for(s=0;s<m.length;++s)if(s!==a){var d=m[s],l=d.indexOf("]="),u=l===-1?d.indexOf("="):l+1,c,f;u===-1?(c=e.decoder(d,Ye.decoder,h,"key"),f=e.strictNullHandling?null:""):(c=e.decoder(d.slice(0,u),Ye.decoder,h,"key"),f=ia.maybeMap(S_(d.slice(u+1),e),function(v){return e.decoder(v,Ye.decoder,h,"value")})),f&&e.interpretNumericEntities&&h==="iso-8859-1"&&(f=v5(f)),d.indexOf("[]=")>-1&&(f=m5(f)?[f]:f),Hf.call(r,c)?r[c]=ia.combine(r[c],f):r[c]=f}return r},b5=function(i,t,e,r){for(var n=r?t:S_(t,e),o=i.length-1;o>=0;--o){var m,a=i[o];if(a==="[]"&&e.parseArrays)m=[].concat(n);else{m=e.plainObjects?Object.create(null):{};var s=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,h=parseInt(s,10);!e.parseArrays&&s===""?m={0:n}:!isNaN(h)&&a!==s&&String(h)===s&&h>=0&&e.parseArrays&&h<=e.arrayLimit?(m=[],m[h]=n):s!=="__proto__"&&(m[s]=n)}n=m}return n},S5=function(t,e,r,n){if(t){var o=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,m=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,s=r.depth>0&&m.exec(o),h=s?o.slice(0,s.index):o,d=[];if(h){if(!r.plainObjects&&Hf.call(Object.prototype,h)&&!r.allowPrototypes)return;d.push(h)}for(var l=0;r.depth>0&&(s=a.exec(o))!==null&&l<r.depth;){if(l+=1,!r.plainObjects&&Hf.call(Object.prototype,s[1].slice(1,-1))&&!r.allowPrototypes)return;d.push(s[1])}return s&&d.push("["+o.slice(s.index)+"]"),b5(d,e,r,n)}},C5=function(t){if(!t)return Ye;if(t.decoder!==null&&t.decoder!==void 0&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?Ye.charset:t.charset;return{allowDots:typeof t.allowDots>"u"?Ye.allowDots:!!t.allowDots,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:Ye.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:Ye.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:Ye.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:Ye.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:Ye.comma,decoder:typeof t.decoder=="function"?t.decoder:Ye.decoder,delimiter:typeof t.delimiter=="string"||ia.isRegExp(t.delimiter)?t.delimiter:Ye.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:Ye.depth,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:Ye.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:Ye.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:Ye.plainObjects,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:Ye.strictNullHandling}},w5=function(i,t){var e=C5(t);if(i===""||i===null||typeof i>"u")return e.plainObjects?Object.create(null):{};for(var r=typeof i=="string"?x5(i,e):i,n=e.plainObjects?Object.create(null):{},o=Object.keys(r),m=0;m<o.length;++m){var a=o[m],s=S5(a,r[a],e,typeof i=="string");n=ia.merge(n,s,e)}return e.allowSparse===!0?n:ia.compact(n)},T5=p5,E5=w5,A5=Ld,P5={formats:A5,parse:E5,stringify:T5},I5=k3;function ar(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var M5=/^([a-z0-9.+-]+:)/i,O5=/:[0-9]*$/,R5=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,D5=["<",">",'"',"`"," ","\r",`
`,"	"],F5=["{","}","|","\\","^","`"].concat(D5),Wf=["'"].concat(F5),_m=["%","/","?",";","#"].concat(Wf),ym=["/","?","#"],L5=255,xm=/^[+a-z0-9A-Z_-]{0,63}$/,k5=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,B5={javascript:!0,"javascript:":!0},Xf={javascript:!0,"javascript:":!0},Ks={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Vf=P5;function _l(i,t,e){if(i&&typeof i=="object"&&i instanceof ar)return i;var r=new ar;return r.parse(i,t,e),r}ar.prototype.parse=function(i,t,e){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),n=r!==-1&&r<i.indexOf("#")?"?":"#",o=i.split(n),m=/\\/g;o[0]=o[0].replace(m,"/"),i=o.join(n);var a=i;if(a=a.trim(),!e&&i.split("#").length===1){var s=R5.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],t?this.query=Vf.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var h=M5.exec(a);if(h){h=h[0];var d=h.toLowerCase();this.protocol=d,a=a.substr(h.length)}if(e||h||a.match(/^\/\/[^@/]+@[^@/]+/)){var l=a.substr(0,2)==="//";l&&!(h&&Xf[h])&&(a=a.substr(2),this.slashes=!0)}if(!Xf[h]&&(l||h&&!Ks[h])){for(var u=-1,c=0;c<ym.length;c++){var f=a.indexOf(ym[c]);f!==-1&&(u===-1||f<u)&&(u=f)}var v,p;u===-1?p=a.lastIndexOf("@"):p=a.lastIndexOf("@",u),p!==-1&&(v=a.slice(0,p),a=a.slice(p+1),this.auth=decodeURIComponent(v)),u=-1;for(var c=0;c<_m.length;c++){var f=a.indexOf(_m[c]);f!==-1&&(u===-1||f<u)&&(u=f)}u===-1&&(u=a.length),this.host=a.slice(0,u),a=a.slice(u),this.parseHost(),this.hostname=this.hostname||"";var y=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!y)for(var b=this.hostname.split(/\./),c=0,x=b.length;c<x;c++){var S=b[c];if(S&&!S.match(xm)){for(var w="",E=0,P=S.length;E<P;E++)S.charCodeAt(E)>127?w+="x":w+=S[E];if(!w.match(xm)){var A=b.slice(0,c),N=b.slice(c+1),k=S.match(k5);k&&(A.push(k[1]),N.unshift(k[2])),N.length&&(a="/"+N.join(".")+a),this.hostname=A.join(".");break}}}this.hostname.length>L5?this.hostname="":this.hostname=this.hostname.toLowerCase(),y||(this.hostname=I5.toASCII(this.hostname));var U=this.port?":"+this.port:"",j=this.hostname||"";this.host=j+U,this.href+=this.host,y&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),a[0]!=="/"&&(a="/"+a))}if(!B5[d])for(var c=0,x=Wf.length;c<x;c++){var X=Wf[c];if(a.indexOf(X)!==-1){var W=encodeURIComponent(X);W===X&&(W=escape(X)),a=a.split(X).join(W)}}var Q=a.indexOf("#");Q!==-1&&(this.hash=a.substr(Q),a=a.slice(0,Q));var ot=a.indexOf("?");if(ot!==-1?(this.search=a.substr(ot),this.query=a.substr(ot+1),t&&(this.query=Vf.parse(this.query)),a=a.slice(0,ot)):t&&(this.search="",this.query={}),a&&(this.pathname=a),Ks[d]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var U=this.pathname||"",it=this.search||"";this.path=U+it}return this.href=this.format(),this};function N5(i){return typeof i=="string"&&(i=_l(i)),i instanceof ar?i.format():ar.prototype.format.call(i)}ar.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",n=!1,o="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(o=Vf.stringify(this.query));var m=this.search||o&&"?"+o||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||Ks[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),m&&m.charAt(0)!=="?"&&(m="?"+m),e=e.replace(/[?#]/g,function(a){return encodeURIComponent(a)}),m=m.replace("#","%23"),t+n+e+m+r};function U5(i,t){return _l(i,!1,!0).resolve(t)}ar.prototype.resolve=function(i){return this.resolveObject(_l(i,!1,!0)).format()};ar.prototype.resolveObject=function(i){if(typeof i=="string"){var t=new ar;t.parse(i,!1,!0),i=t}for(var e=new ar,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];e[o]=this[o]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var m=Object.keys(i),a=0;a<m.length;a++){var s=m[a];s!=="protocol"&&(e[s]=i[s])}return Ks[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!Ks[i.protocol]){for(var h=Object.keys(i),d=0;d<h.length;d++){var l=h[d];e[l]=i[l]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Xf[i.protocol]){for(var x=(i.pathname||"").split("/");x.length&&!(i.host=x.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),x[0]!==""&&x.unshift(""),x.length<2&&x.unshift(""),e.pathname=x.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var u=e.pathname||"",c=e.search||"";e.path=u+c}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var f=e.pathname&&e.pathname.charAt(0)==="/",v=i.host||i.pathname&&i.pathname.charAt(0)==="/",p=v||f||e.host&&i.pathname,y=p,b=e.pathname&&e.pathname.split("/")||[],x=i.pathname&&i.pathname.split("/")||[],S=e.protocol&&!Ks[e.protocol];if(S&&(e.hostname="",e.port=null,e.host&&(b[0]===""?b[0]=e.host:b.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(x[0]===""?x[0]=i.host:x.unshift(i.host)),i.host=null),p=p&&(x[0]===""||b[0]==="")),v)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,b=x;else if(x.length)b||(b=[]),b.pop(),b=b.concat(x),e.search=i.search,e.query=i.query;else if(i.search!=null){if(S){e.host=b.shift(),e.hostname=e.host;var w=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;w&&(e.auth=w.shift(),e.hostname=w.shift(),e.host=e.hostname)}return e.search=i.search,e.query=i.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!b.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var E=b.slice(-1)[0],P=(e.host||i.host||b.length>1)&&(E==="."||E==="..")||E==="",A=0,N=b.length;N>=0;N--)E=b[N],E==="."?b.splice(N,1):E===".."?(b.splice(N,1),A++):A&&(b.splice(N,1),A--);if(!p&&!y)for(;A--;A)b.unshift("..");p&&b[0]!==""&&(!b[0]||b[0].charAt(0)!=="/")&&b.unshift(""),P&&b.join("/").substr(-1)!=="/"&&b.push("");var k=b[0]===""||b[0]&&b[0].charAt(0)==="/";if(S){e.hostname=k?"":b.length?b.shift():"",e.host=e.hostname;var w=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;w&&(e.auth=w.shift(),e.hostname=w.shift(),e.host=e.hostname)}return p=p||e.host&&b.length,p&&!k&&b.unshift(""),b.length>0?e.pathname=b.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};ar.prototype.parseHost=function(){var i=this.host,t=O5.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};var G5=_l,H5=U5,W5=N5;const X5={parse:G5,format:W5,resolve:H5};function qi(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function ka(i){return i.split("?")[0].split("#")[0]}function V5(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function z5(i,t,e){return i.replace(new RegExp(V5(t),"g"),e)}function j5(i,t){let e="",r=0,n=-1,o=0,m=-1;for(let a=0;a<=i.length;++a){if(a<i.length)m=i.charCodeAt(a);else{if(m===47)break;m=47}if(m===47){if(!(n===a-1||o===1))if(n!==a-1&&o===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const s=e.lastIndexOf("/");if(s!==e.length-1){s===-1?(e="",r=0):(e=e.slice(0,s),r=e.length-1-e.lastIndexOf("/")),n=a,o=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=a,o=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(n+1,a)}`:e=i.slice(n+1,a),r=a-n-1;n=a,o=0}else m===46&&o!==-1?++o:o=-1}return e}const ci={toPosix(i){return z5(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},hasProtocol(i){return/^[^/:]+:\//.test(this.toPosix(i))},getProtocol(i){qi(i),i=this.toPosix(i);let t="";const e=/^file:\/\/\//.exec(i),r=/^[^/:]+:\/\//.exec(i),n=/^[^/:]+:\//.exec(i);if(e||r||n){const o=(e==null?void 0:e[0])||(r==null?void 0:r[0])||(n==null?void 0:n[0]);t=o,i=i.slice(o.length)}return t},toAbsolute(i,t,e){if(this.isDataUrl(i))return i;const r=ka(this.toPosix(t??St.ADAPTER.getBaseUrl())),n=ka(this.toPosix(e??this.rootname(r)));return qi(i),i=this.toPosix(i),i.startsWith("/")?ci.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(i=this.toPosix(i),qi(i),i.length===0)return".";let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=j5(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return qi(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(qi(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.extname(n)?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(qi(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const o=this.getProtocol(i),m=i;i=i.slice(o.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!n){r=a;break}}else n=!1;return r===-1?e?"/":this.isUrl(m)?o+i:o:e&&r===1?"//":o+i.slice(0,r)},rootname(i){qi(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){qi(i),t&&qi(t),i=ka(this.toPosix(i));let e=0,r=-1,n=!0,o;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let m=t.length-1,a=-1;for(o=i.length-1;o>=0;--o){const s=i.charCodeAt(o);if(s===47){if(!n){e=o+1;break}}else a===-1&&(n=!1,a=o+1),m>=0&&(s===t.charCodeAt(m)?--m===-1&&(r=o):(m=-1,r=a))}return e===r?r=a:r===-1&&(r=i.length),i.slice(e,r)}for(o=i.length-1;o>=0;--o)if(i.charCodeAt(o)===47){if(!n){e=o+1;break}}else r===-1&&(n=!1,r=o+1);return r===-1?"":i.slice(e,r)},extname(i){qi(i),i=ka(this.toPosix(i));let t=-1,e=0,r=-1,n=!0,o=0;for(let m=i.length-1;m>=0;--m){const a=i.charCodeAt(m);if(a===47){if(!n){e=m+1;break}continue}r===-1&&(n=!1,r=m+1),a===46?t===-1?t=m:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||r===-1||o===0||o===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){qi(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=ka(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let o=-1,m=0,a=-1,s=!0,h=i.length-1,d=0;for(;h>=n;--h){if(e=i.charCodeAt(h),e===47){if(!s){m=h+1;break}continue}a===-1&&(s=!1,a=h+1),e===46?o===-1?o=h:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||a===-1||d===0||d===1&&o===a-1&&o===m+1?a!==-1&&(m===0&&r?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(m,a)):(m===0&&r?(t.name=i.slice(1,o),t.base=i.slice(1,a)):(t.name=i.slice(m,o),t.base=i.slice(m,a)),t.ext=i.slice(o,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":"},bm={};function ee(i,t,e=3){if(bm[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),bm[t]=!0}let $u;function Y5(){return typeof $u>"u"&&($u=function(){var e;const t={stencil:!0,failIfMajorPerformanceCaveat:St.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!St.ADAPTER.getWebGLRenderingContext())return!1;const r=St.ADAPTER.createCanvas();let n=r.getContext("webgl",t)||r.getContext("experimental-webgl",t);const o=!!((e=n==null?void 0:n.getContextAttributes())!=null&&e.stencil);if(n){const m=n.getExtension("WEBGL_lose_context");m&&m.loseContext()}return n=null,o}catch{return!1}}()),$u}var $5={grad:.9,turn:360,rad:360/(2*Math.PI)},Gr=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Ke=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Vi=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},C_=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Sm=function(i){return{r:Vi(i.r,0,255),g:Vi(i.g,0,255),b:Vi(i.b,0,255),a:Vi(i.a)}},Ku=function(i){return{r:Ke(i.r),g:Ke(i.g),b:Ke(i.b),a:Ke(i.a,3)}},K5=/^#([0-9a-f]{3,8})$/i,gh=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},w_=function(i){var t=i.r,e=i.g,r=i.b,n=i.a,o=Math.max(t,e,r),m=o-Math.min(t,e,r),a=m?o===t?(e-r)/m:o===e?2+(r-t)/m:4+(t-e)/m:0;return{h:60*(a<0?a+6:a),s:o?m/o*100:0,v:o/255*100,a:n}},T_=function(i){var t=i.h,e=i.s,r=i.v,n=i.a;t=t/360*6,e/=100,r/=100;var o=Math.floor(t),m=r*(1-e),a=r*(1-(t-o)*e),s=r*(1-(1-t+o)*e),h=o%6;return{r:255*[r,a,m,m,s,r][h],g:255*[s,r,r,a,m,m][h],b:255*[m,m,s,r,r,a][h],a:n}},Cm=function(i){return{h:C_(i.h),s:Vi(i.s,0,100),l:Vi(i.l,0,100),a:Vi(i.a)}},wm=function(i){return{h:Ke(i.h),s:Ke(i.s),l:Ke(i.l),a:Ke(i.a,3)}},Tm=function(i){return T_((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},Ja=function(i){return{h:(t=w_(i)).h,s:(n=(200-(e=t.s))*(r=t.v)/100)>0&&n<200?e*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,r,n},q5=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Z5=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,J5=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Q5=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,zf={string:[[function(i){var t=K5.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Ke(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Ke(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=J5.exec(i)||Q5.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Sm({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=q5.exec(i)||Z5.exec(i);if(!t)return null;var e,r,n=Cm({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*($5[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return Tm(n)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,n=i.a,o=n===void 0?1:n;return Gr(t)&&Gr(e)&&Gr(r)?Sm({r:Number(t),g:Number(e),b:Number(r),a:Number(o)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,n=i.a,o=n===void 0?1:n;if(!Gr(t)||!Gr(e)||!Gr(r))return null;var m=Cm({h:Number(t),s:Number(e),l:Number(r),a:Number(o)});return Tm(m)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,n=i.a,o=n===void 0?1:n;if(!Gr(t)||!Gr(e)||!Gr(r))return null;var m=function(a){return{h:C_(a.h),s:Vi(a.s,0,100),v:Vi(a.v,0,100),a:Vi(a.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(o)});return T_(m)},"hsv"]]},Em=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},t4=function(i){return typeof i=="string"?Em(i.trim(),zf.string):typeof i=="object"&&i!==null?Em(i,zf.object):[null,void 0]},qu=function(i,t){var e=Ja(i);return{h:e.h,s:Vi(e.s+100*t,0,100),l:e.l,a:e.a}},Zu=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Am=function(i,t){var e=Ja(i);return{h:e.h,s:e.s,l:Vi(e.l+100*t,0,100),a:e.a}},jf=function(){function i(t){this.parsed=t4(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Ke(Zu(this.rgba),2)},i.prototype.isDark=function(){return Zu(this.rgba)<.5},i.prototype.isLight=function(){return Zu(this.rgba)>=.5},i.prototype.toHex=function(){return t=Ku(this.rgba),e=t.r,r=t.g,n=t.b,m=(o=t.a)<1?gh(Ke(255*o)):"","#"+gh(e)+gh(r)+gh(n)+m;var t,e,r,n,o,m},i.prototype.toRgb=function(){return Ku(this.rgba)},i.prototype.toRgbString=function(){return t=Ku(this.rgba),e=t.r,r=t.g,n=t.b,(o=t.a)<1?"rgba("+e+", "+r+", "+n+", "+o+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,o},i.prototype.toHsl=function(){return wm(Ja(this.rgba))},i.prototype.toHslString=function(){return t=wm(Ja(this.rgba)),e=t.h,r=t.s,n=t.l,(o=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+o+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,o},i.prototype.toHsv=function(){return t=w_(this.rgba),{h:Ke(t.h),s:Ke(t.s),v:Ke(t.v),a:Ke(t.a,3)};var t},i.prototype.invert=function(){return mr({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),mr(qu(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),mr(qu(this.rgba,-t))},i.prototype.grayscale=function(){return mr(qu(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),mr(Am(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),mr(Am(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?mr({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Ke(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Ja(this.rgba);return typeof t=="number"?mr({h:t,s:e.s,l:e.l,a:e.a}):Ke(e.h)},i.prototype.isEqual=function(t){return this.toHex()===mr(t).toHex()},i}(),mr=function(i){return i instanceof jf?i:new jf(i)},Pm=[],e4=function(i){i.forEach(function(t){Pm.indexOf(t)<0&&(t(jf,zf),Pm.push(t))})};function i4(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in e)r[e[n]]=n;var o={};i.prototype.toName=function(m){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,s,h=r[this.toHex()];if(h)return h;if(m!=null&&m.closest){var d=this.toRgb(),l=1/0,u="black";if(!o.length)for(var c in e)o[c]=new i(e[c]).toRgb();for(var f in e){var v=(a=d,s=o[f],Math.pow(a.r-s.r,2)+Math.pow(a.g-s.g,2)+Math.pow(a.b-s.b,2));v<l&&(l=v,u=f)}return u}},t.string.push([function(m){var a=m.toLowerCase(),s=a==="transparent"?"#0000":e[a];return s?new i(s).toRgb():null},"name"])}e4([i4]);const qs=class{constructor(i=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=i}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(i){return this.value=i,this}set value(i){if(i instanceof qs)this._value=this.cloneSource(i._value),this._int=i._int,this._components.set(i._components);else{if(i===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,i))&&(this.normalize(i),this._value=this.cloneSource(i))}}get value(){return this._value}cloneSource(i){return typeof i=="string"||typeof i=="number"||i instanceof Number||i===null?i:Array.isArray(i)||ArrayBuffer.isView(i)?i.slice(0):typeof i=="object"&&i!==null?{...i}:i}isSourceEqual(i,t){const e=typeof i;if(e!==typeof t)return!1;if(e==="number"||e==="string"||i instanceof Number)return i===t;if(Array.isArray(i)&&Array.isArray(t)||ArrayBuffer.isView(i)&&ArrayBuffer.isView(t))return i.length!==t.length?!1:i.every((n,o)=>n===t[o]);if(i!==null&&t!==null){const n=Object.keys(i),o=Object.keys(t);return n.length!==o.length?!1:n.every(m=>i[m]===t[m])}return i===t}toRgba(){const[i,t,e,r]=this._components;return{r:i,g:t,b:e,a:r}}toRgb(){const[i,t,e]=this._components;return{r:i,g:t,b:e}}toRgbaString(){const[i,t,e]=this.toUint8RgbArray();return`rgba(${i},${t},${e},${this.alpha})`}toUint8RgbArray(i){const[t,e,r]=this._components;return i=i??[],i[0]=Math.round(t*255),i[1]=Math.round(e*255),i[2]=Math.round(r*255),i}toRgbArray(i){i=i??[];const[t,e,r]=this._components;return i[0]=t,i[1]=e,i[2]=r,i}toNumber(){return this._int}toLittleEndianNumber(){const i=this._int;return(i>>16)+(i&65280)+((i&255)<<16)}multiply(i){const[t,e,r,n]=qs.temp.setValue(i)._components;return this._components[0]*=t,this._components[1]*=e,this._components[2]*=r,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(i,t=!0){return t&&(this._components[0]*=i,this._components[1]*=i,this._components[2]*=i),this._components[3]=i,this.refreshInt(),this._value=null,this}toPremultiplied(i,t=!0){if(i===1)return(255<<24)+this._int;if(i===0)return t?0:this._int;let e=this._int>>16&255,r=this._int>>8&255,n=this._int&255;return t&&(e=e*i+.5|0,r=r*i+.5|0,n=n*i+.5|0),(i*255<<24)+(e<<16)+(r<<8)+n}toHex(){const i=this._int.toString(16);return`#${"000000".substring(0,6-i.length)+i}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(i){return this._components[3]=this._clamp(i),this}round(i){const[t,e,r]=this._components;return this._components[0]=Math.round(t*i)/i,this._components[1]=Math.round(e*i)/i,this._components[2]=Math.round(r*i)/i,this.refreshInt(),this._value=null,this}toArray(i){i=i??[];const[t,e,r,n]=this._components;return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}normalize(i){let t,e,r,n;if((typeof i=="number"||i instanceof Number)&&i>=0&&i<=16777215){const o=i;t=(o>>16&255)/255,e=(o>>8&255)/255,r=(o&255)/255,n=1}else if((Array.isArray(i)||i instanceof Float32Array)&&i.length>=3&&i.length<=4)i=this._clamp(i),[t,e,r,n=1]=i;else if((i instanceof Uint8Array||i instanceof Uint8ClampedArray)&&i.length>=3&&i.length<=4)i=this._clamp(i,0,255),[t,e,r,n=255]=i,t/=255,e/=255,r/=255,n/=255;else if(typeof i=="string"||typeof i=="object"){if(typeof i=="string"){const m=qs.HEX_PATTERN.exec(i);m&&(i=`#${m[2]}`)}const o=mr(i);o.isValid()&&({r:t,g:e,b:r,a:n}=o.rgba,t/=255,e/=255,r/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=e,this._components[2]=r,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${i}`)}refreshInt(){this._clamp(this._components);const[i,t,e]=this._components;this._int=(i*255<<16)+(t*255<<8)+(e*255|0)}_clamp(i,t=0,e=1){return typeof i=="number"?Math.min(Math.max(i,t),e):(i.forEach((r,n)=>{i[n]=Math.min(Math.max(r,t),e)}),i)}};let ue=qs;ue.shared=new qs;ue.temp=new qs;ue.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;function r4(i){return ee("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),ue.shared.setValue(i).toHex()}function n4(i){return ee("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),ue.shared.setValue(i).toNumber()}function s4(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[Bt.NORMAL_NPM]=Bt.NORMAL,i[Bt.ADD_NPM]=Bt.ADD,i[Bt.SCREEN_NPM]=Bt.SCREEN,t[Bt.NORMAL]=Bt.NORMAL_NPM,t[Bt.ADD]=Bt.ADD_NPM,t[Bt.SCREEN]=Bt.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const E_=s4();function A_(i,t){return E_[t?1:0][i]}function a4(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function P_(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}function el(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Im(i){return!(i&i-1)&&!!i}function Mm(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Zs(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const o=r-e;for(n=t;n<o;++n)i[n]=i[n+e];i.length=o}function vn(i){return i===0?0:i<0?-1:1}let o4=0;function is(){return++o4}const I_=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let Yf=I_;Yf.EMPTY=new I_(0,0,0,0);const Om={},vr=Object.create(null),fn=Object.create(null);class h4{constructor(t,e,r){this._canvas=St.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||St.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Rm(i,t,e){for(let r=0,n=4*e*t;r<t;++r,n+=4)if(i[n+3]!==0)return!1;return!0}function Dm(i,t,e,r,n){const o=4*t;for(let m=r,a=r*o+4*e;m<=n;++m,a+=o)if(i[a+3]!==0)return!1;return!0}function l4(i){const{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const o=r.getImageData(0,0,t,e).data;let m=0,a=0,s=t-1,h=e-1;for(;a<e&&Rm(o,t,a);)++a;if(a===e)return Yf.EMPTY;for(;Rm(o,t,h);)--h;for(;Dm(o,t,m,a,h);)++m;for(;Dm(o,t,s,a,h);)--s;return++s,++h,new Yf(m,a,s,h)}function c4(i){const t=l4(i),{width:e,height:r}=t;let n=null;if(!t.isEmpty()){const o=i.getContext("2d");if(o===null)throw new TypeError("Failed to get canvas 2D context");n=o.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:n}}let ph;function u4(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location,ph||(ph=document.createElement("a")),ph.href=i;const e=X5.parse(ph.href),r=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!r||e.protocol!==t.protocol?"anonymous":""}function bn(i,t=1){var r;const e=(r=St.RETINA_PREFIX)==null?void 0:r.exec(i);return e?parseFloat(e[1]):t}var Ct=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(Ct||{});const $f=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Fm=(i,t)=>$f(i).priority??t,Ot={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map($f).forEach(t=>{t.type.forEach(e=>{var r,n;return(n=(r=this._removeHandlers)[e])==null?void 0:n.call(r,t)})}),this},add(...i){return i.map($f).forEach(t=>{t.type.forEach(e=>{const r=this._addHandlers,n=this._queue;r[e]?r[e](t):(n[e]=n[e]||[],n[e].push(t))})}),this},handle(i,t,e){const r=this._addHandlers,n=this._removeHandlers;if(r[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,n[i]=e;const o=this._queue;return o[i]&&(o[i].forEach(m=>t(m)),delete o[i]),this},handleByMap(i,t){return this.handle(i,e=>{t[e.name]=e.ref},e=>{delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((n,o)=>Fm(o,e)-Fm(n,e)))},r=>{const n=t.indexOf(r.ref);n!==-1&&t.splice(n,1)})}};class Kf{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const f4=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function d4(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function g4(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=f4.replace(/%forloop%/gi,d4(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const Ju=0,Qu=1,tf=2,ef=3,rf=4,nf=5;class Zr{constructor(){this.data=0,this.blendMode=Bt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<Ju)}set blend(t){!!(this.data&1<<Ju)!==t&&(this.data^=1<<Ju)}get offsets(){return!!(this.data&1<<Qu)}set offsets(t){!!(this.data&1<<Qu)!==t&&(this.data^=1<<Qu)}get culling(){return!!(this.data&1<<tf)}set culling(t){!!(this.data&1<<tf)!==t&&(this.data^=1<<tf)}get depthTest(){return!!(this.data&1<<ef)}set depthTest(t){!!(this.data&1<<ef)!==t&&(this.data^=1<<ef)}get depthMask(){return!!(this.data&1<<nf)}set depthMask(t){!!(this.data&1<<nf)!==t&&(this.data^=1<<nf)}get clockwiseFrontFace(){return!!(this.data&1<<rf)}set clockwiseFrontFace(t){!!(this.data&1<<rf)!==t&&(this.data^=1<<rf)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==Bt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Zr;return t.depthTest=!1,t.blend=!0,t}}const qf=[];function M_(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=qf.length-1;r>=0;--r){const n=qf[r];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class or{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,o,m,a,s){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:d}=this;this._aliasCount++;for(let l=0,u=d.length;l<u;l++)d[l][h](t,e,r,n,o,m,a,s);return d===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(or.prototype,{dispatch:{value:or.prototype.emit},run:{value:or.prototype.emit}});class ro{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new or("setRealSize"),this.onUpdate=new or("update"),this.onError=new or("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class co extends ro{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===cr.UNPACK);const o=e.realWidth,m=e.realHeight;return r.width===o&&r.height===m?n.texSubImage2D(e.target,0,0,0,o,m,e.format,r.type,this.data):(r.width=o,r.height=m,n.texImage2D(e.target,0,r.internalFormat,o,m,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const p4={scaleMode:jr.NEAREST,format:yt.RGBA,alphaMode:cr.NPM},Gs=class extends ho{constructor(i=null,t=null){super(),t=Object.assign({},Gs.defaultOptions,t);const{alphaMode:e,mipmap:r,anisotropicLevel:n,scaleMode:o,width:m,height:a,wrapMode:s,format:h,type:d,target:l,resolution:u,resourceOptions:c}=t;i&&!(i instanceof ro)&&(i=M_(i,c),i.internal=!0),this.resolution=u||St.RESOLUTION,this.width=Math.round((m||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=n,this._wrapMode=s,this._scaleMode=o,this.format=h,this.type=d,this.target=l,this.alphaMode=e,this.uid=is(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=m>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(i)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(i){this._mipmap!==i&&(this._mipmap=i,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(i){this._scaleMode!==i&&(this._scaleMode=i,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(i){this._wrapMode!==i&&(this._wrapMode=i,this.dirtyStyleId++)}setStyle(i,t){let e;return i!==void 0&&i!==this.scaleMode&&(this.scaleMode=i,e=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,e=!0),e&&this.dirtyStyleId++,this}setSize(i,t,e){return e=e||this.resolution,this.setRealSize(i*e,t*e,e)}setRealSize(i,t,e){return this.resolution=e||this.resolution,this.width=Math.round(i)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Im(this.realWidth)&&Im(this.realHeight)}setResolution(i){const t=this.resolution;return t===i?this:(this.resolution=i,this.valid&&(this.width=Math.round(this.width*t)/i,this.height=Math.round(this.height*t)/i,this.emit("update",this)),this._refreshPOT(),this)}setResource(i){if(this.resource===i)return this;if(this.resource)throw new Error("Resource can be set only once");return i.bind(this),this.resource=i,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(i){this.emit("error",this,i)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete fn[this.cacheId],delete vr[this.cacheId],this.cacheId=null),this.dispose(),Gs.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(i,t,e=St.STRICT_TEXTURE_CACHE){const r=typeof i=="string";let n=null;if(r)n=i;else{if(!i._pixiId){const m=(t==null?void 0:t.pixiIdPrefix)||"pixiid";i._pixiId=`${m}_${is()}`}n=i._pixiId}let o=fn[n];if(r&&e&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new Gs(i,t),o.cacheId=n,Gs.addToCache(o,n)),o}static fromBuffer(i,t,e,r){i=i||new Float32Array(t*e*4);const n=new co(i,{width:t,height:e}),o=i instanceof Float32Array?Rt.FLOAT:Rt.UNSIGNED_BYTE;return new Gs(n,Object.assign({},p4,{type:o},r))}static addToCache(i,t){t&&(i.textureCacheIds.includes(t)||i.textureCacheIds.push(t),fn[t]&&fn[t]!==i&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),fn[t]=i)}static removeFromCache(i){if(typeof i=="string"){const t=fn[i];if(t){const e=t.textureCacheIds.indexOf(i);return e>-1&&t.textureCacheIds.splice(e,1),delete fn[i],t}}else if(i!=null&&i.textureCacheIds){for(let t=0;t<i.textureCacheIds.length;++t)delete fn[i.textureCacheIds[t]];return i.textureCacheIds.length=0,i}return null}};let Gt=Gs;Gt.defaultOptions={mipmap:Tr.POW2,anisotropicLevel:0,scaleMode:jr.LINEAR,wrapMode:yn.CLAMP,alphaMode:cr.UNPACK,target:Ys.TEXTURE_2D,format:yt.RGBA,type:Rt.UNSIGNED_BYTE};Gt._globalBatch=0;class Zf{constructor(){this.texArray=null,this.blend=0,this.type=Sr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let m4=0,We=class O_{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=m4++,this.disposeRunner=new or("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?Cr.ELEMENT_ARRAY_BUFFER:Cr.ARRAY_BUFFER}get index(){return this.type===Cr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new O_(t)}};class il{constructor(t,e=0,r=!1,n=Rt.FLOAT,o,m,a,s=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=o,this.start=m,this.instance=a,this.divisor=s}destroy(){this.buffer=null}static from(t,e,r,n,o){return new il(t,e,r,n,o)}}const v4={Float32Array,Uint32Array,Int32Array,Uint8Array};function _4(i,t){let e=0,r=0;const n={};for(let s=0;s<i.length;s++)r+=t[s],e+=i[s].length;const o=new ArrayBuffer(e*4);let m=null,a=0;for(let s=0;s<i.length;s++){const h=t[s],d=i[s],l=P_(d);n[l]||(n[l]=new v4[l](o)),m=n[l];for(let u=0;u<d.length;u++){const c=(u/h|0)*r+a,f=u%h;m[c+f]=d[u]}a+=h}return new Float32Array(o)}const Lm={5126:4,5123:2,5121:1};let y4=0;const x4={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Sn{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=y4++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new or("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,o,m,a,s=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof We||(e instanceof Array&&(e=new Float32Array(e)),e=new We(e));const h=t.split("|");if(h.length>1){for(let l=0;l<h.length;l++)this.addAttribute(h[l],e,r,n,o);return this}let d=this.buffers.indexOf(e);return d===-1&&(this.buffers.push(e),d=this.buffers.length-1),this.attributes[t]=new il(d,r,n,o,m,a,s),this.instanced=this.instanced||s,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof We||(t instanceof Array&&(t=new Uint16Array(t)),t=new We(t)),t.type=Cr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new We;let n;for(n in this.attributes){const o=this.attributes[n],m=this.buffers[o.buffer];t.push(m.data),e.push(o.size*Lm[o.type]/4),o.buffer=0}for(r.data=_4(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Sn;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new We(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new il(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=Cr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Sn,r=[],n=[],o=[];let m;for(let a=0;a<t.length;a++){m=t[a];for(let s=0;s<m.buffers.length;s++)n[s]=n[s]||0,n[s]+=m.buffers[s].data.length,o[s]=0}for(let a=0;a<m.buffers.length;a++)r[a]=new x4[P_(m.buffers[a].data)](n[a]),e.buffers[a]=new We(r[a]);for(let a=0;a<t.length;a++){m=t[a];for(let s=0;s<m.buffers.length;s++)r[s].set(m.buffers[s].data,o[s]),o[s]+=m.buffers[s].data.length}if(e.attributes=m.attributes,m.indexBuffer){e.indexBuffer=e.buffers[m.buffers.indexOf(m.indexBuffer)],e.indexBuffer.type=Cr.ELEMENT_ARRAY_BUFFER;let a=0,s=0,h=0,d=0;for(let l=0;l<m.buffers.length;l++)if(m.buffers[l]!==m.indexBuffer){d=l;break}for(const l in m.attributes){const u=m.attributes[l];(u.buffer|0)===d&&(s+=u.size*Lm[u.type]/4)}for(let l=0;l<t.length;l++){const u=t[l].indexBuffer.data;for(let c=0;c<u.length;c++)e.indexBuffer.data[c+h]+=a;a+=t[l].buffers[d].data.length/s,h+=u.length}}return e}}class R_ extends Sn{constructor(t=!1){super(),this._buffer=new We(null,t,!1),this._indexBuffer=new We(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Rt.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Rt.FLOAT).addAttribute("aColor",this._buffer,4,!0,Rt.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Rt.FLOAT).addIndex(this._indexBuffer)}}const rl=Math.PI*2,b4=180/Math.PI,S4=Math.PI/180;var ii=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(ii||{});class ne{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new ne(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const mh=[new ne,new ne,new ne,new ne];class Kt{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=ii.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Kt(0,0,0,0)}clone(){return new Kt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const A=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=A)return!1;const k=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>k}const r=this.left,n=this.right,o=this.top,m=this.bottom;if(n<=r||m<=o)return!1;const a=mh[0].set(t.left,t.top),s=mh[1].set(t.left,t.bottom),h=mh[2].set(t.right,t.top),d=mh[3].set(t.right,t.bottom);if(h.x<=a.x||s.y<=a.y)return!1;const l=Math.sign(e.a*e.d-e.b*e.c);if(l===0||(e.apply(a,a),e.apply(s,s),e.apply(h,h),e.apply(d,d),Math.max(a.x,s.x,h.x,d.x)<=r||Math.min(a.x,s.x,h.x,d.x)>=n||Math.max(a.y,s.y,h.y,d.y)<=o||Math.min(a.y,s.y,h.y,d.y)>=m))return!1;const u=l*(s.y-a.y),c=l*(a.x-s.x),f=u*r+c*o,v=u*n+c*o,p=u*r+c*m,y=u*n+c*m;if(Math.max(f,v,p,y)<=u*a.x+c*a.y||Math.min(f,v,p,y)>=u*d.x+c*d.y)return!1;const b=l*(a.y-h.y),x=l*(h.x-a.x),S=b*r+x*o,w=b*n+x*o,E=b*r+x*m,P=b*n+x*m;return!(Math.max(S,w,E,P)<=b*a.x+x*a.y||Math.min(S,w,E,P)>=b*d.x+x*d.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),o=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(o-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),o=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=o-n,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}let C4=class D_{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=ii.CIRC}clone(){return new D_(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,o=this.y-e;return n*=n,o*=o,n+o<=r}getBounds(){return new Kt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}},w4=class F_{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=ii.ELIP}clone(){return new F_(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new Kt(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}};class Js{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,o=e.length;n<o;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.type=ii.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new Js(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let o=0,m=n-1;o<n;m=o++){const a=this.points[o*2],s=this.points[o*2+1],h=this.points[m*2],d=this.points[m*2+1];s>e!=d>e&&t<(h-a)*((e-s)/(d-s))+a&&(r=!r)}return r}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}}class kd{constructor(t=0,e=0,r=0,n=0,o=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=o,this.type=ii.RREC}clone(){return new kd(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),o=e-(this.y+r);const m=r*r;if(n*n+o*o<=m||(n=t-(this.x+this.width-r),n*n+o*o<=m)||(o=e-(this.y+this.height-r),n*n+o*o<=m)||(n=t-(this.x+r),n*n+o*o<=m))return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class Ce{constructor(t=1,e=0,r=0,n=1,o=0,m=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=o,this.ty=m}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,o,m){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=o,this.ty=m,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new ne;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new ne;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,o=t.y;return e.x=this.d*r*n+-this.c*r*o+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*o+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,o=this.c,m=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=o*e-this.d*r,this.d=o*r+this.d*e,this.tx=m*e-this.ty*r,this.ty=m*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,o=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*o,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*o,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*o+this.ty,this}setTransform(t,e,r,n,o,m,a,s,h){return this.a=Math.cos(a+h)*o,this.b=Math.sin(a+h)*o,this.c=-Math.sin(a-s)*m,this.d=Math.cos(a-s)*m,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,o=this.d,m=t.pivot,a=-Math.atan2(-n,o),s=Math.atan2(r,e),h=Math.abs(a+s);return h<1e-5||Math.abs(rl-h)<1e-5?(t.rotation=s,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=s),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+o*o),t.position.x=this.tx+(m.x*e+m.y*n),t.position.y=this.ty+(m.x*r+m.y*o),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,o=this.tx,m=t*n-e*r;return this.a=n/m,this.b=-e/m,this.c=-r/m,this.d=t/m,this.tx=(r*this.ty-n*o)/m,this.ty=-(t*this.ty-e*o)/m,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Ce;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new Ce}static get TEMP_MATRIX(){return new Ce}}const zn=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],jn=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Yn=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],$n=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Jf=[],L_=[],vh=Math.sign;function T4(){for(let i=0;i<16;i++){const t=[];Jf.push(t);for(let e=0;e<16;e++){const r=vh(zn[i]*zn[e]+Yn[i]*jn[e]),n=vh(jn[i]*zn[e]+$n[i]*jn[e]),o=vh(zn[i]*Yn[e]+Yn[i]*$n[e]),m=vh(jn[i]*Yn[e]+$n[i]*$n[e]);for(let a=0;a<16;a++)if(zn[a]===r&&jn[a]===n&&Yn[a]===o&&$n[a]===m){t.push(a);break}}}for(let i=0;i<16;i++){const t=new Ce;t.set(zn[i],jn[i],Yn[i],$n[i],0,0),L_.push(t)}}T4();const Ee={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>zn[i],uY:i=>jn[i],vX:i=>Yn[i],vY:i=>$n[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Jf[i][t],sub:(i,t)=>Jf[i][Ee.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?Ee.S:Ee.N:Math.abs(t)*2<=Math.abs(i)?i>0?Ee.E:Ee.W:t>0?i>0?Ee.SE:Ee.SW:i>0?Ee.NE:Ee.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=L_[Ee.inv(t)];n.tx=e,n.ty=r,i.append(n)}};class _n{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new _n(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const k_=class{constructor(){this.worldTransform=new Ce,this.localTransform=new Ce,this.position=new _n(this.onChange,this,0,0),this.scale=new _n(this.onChange,this,1,1),this.pivot=new _n(this.onChange,this,0,0),this.skew=new _n(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};let Bd=k_;Bd.IDENTITY=new k_;var E4=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,A4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function km(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function sf(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function B_(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return sf(2*t);case"bvec3":return sf(3*t);case"bvec4":return sf(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Qs=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],P4={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},I4={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function M4(i,t){var r;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in i.uniforms){const o=t[n];if(!o){(r=i.uniforms[n])!=null&&r.group&&(i.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const m=i.uniforms[n];let a=!1;for(let s=0;s<Qs.length;s++)if(Qs[s].test(o,m)){e.push(Qs[s].code(n,m)),a=!0;break}if(!a){const h=(o.size===1&&!o.isArray?P4:I4)[o.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${h};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const N_={};let Fs=N_;function O4(){if(Fs===N_||Fs!=null&&Fs.isContextLost()){const i=St.ADAPTER.createCanvas();let t;St.PREFER_ENV>=ss.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Fs=t}return Fs}let _h;function R4(){if(!_h){_h=Xi.MEDIUM;const i=O4();i&&i.getShaderPrecisionFormat&&(_h=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?Xi.HIGH:Xi.MEDIUM)}return _h}function Bm(i,t){const e=i.getShaderSource(t).split(`
`).map((h,d)=>`${d}: ${h}`),r=i.getShaderInfoLog(t),n=r.split(`
`),o={},m=n.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!o[h]?(o[h]=!0,!0):!1),a=[""];m.forEach(h=>{e[h-1]=`%c${e[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const s=e.join(`
`);a[0]=s,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function D4(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||Bm(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||Bm(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const F4={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function U_(i){return F4[i]}let yh=null;const Nm={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function G_(i,t){if(!yh){const e=Object.keys(Nm);yh={};for(let r=0;r<e.length;++r){const n=e[r];yh[i[n]]=Nm[n]}}return yh[t]}function Um(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===Xi.HIGH&&e!==Xi.HIGH&&(r=Xi.MEDIUM),`precision ${r} float;
${i}`}else if(e!==Xi.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Ba;function L4(){if(typeof Ba=="boolean")return Ba;try{Ba=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ba=!1}return Ba}let k4=0;const xh={},Hs=class{constructor(i,t,e="pixi-shader",r={}){this.extra={},this.id=k4++,this.vertexSrc=i||Hs.defaultVertexSrc,this.fragmentSrc=t||Hs.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(e=e.replace(/\s+/g,"-"),xh[e]?(xh[e]++,e+=`-${xh[e]}`):xh[e]=1,this.vertexSrc=`#define SHADER_NAME ${e}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${e}
${this.fragmentSrc}`,this.vertexSrc=Um(this.vertexSrc,Hs.defaultVertexPrecision,Xi.HIGH),this.fragmentSrc=Um(this.fragmentSrc,Hs.defaultFragmentPrecision,R4())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return A4}static get defaultFragmentSrc(){return E4}static from(i,t,e){const r=i+t;let n=Om[r];return n||(Om[r]=n=new Hs(i,t,e)),n}};let sr=Hs;sr.defaultVertexPrecision=Xi.HIGH;sr.defaultFragmentPrecision=Yr.apple.device?Xi.HIGH:Xi.MEDIUM;let B4=0;class hr{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=B4++,this.static=!!e,this.ubo=!!r,t instanceof We?(this.buffer=t,this.buffer.type=Cr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new We(new Float32Array(1)),this.buffer.type=Cr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new hr(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new hr(t,e,r)}static uboFrom(t,e){return new hr(t,e??!0,!0)}}class wr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof hr?this.uniformGroup=e:this.uniformGroup=new hr(e):this.uniformGroup=new hr({}),this.disposeRunner=new or("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=sr.from(t,e);return new wr(n,r)}}class N4{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let o=0;o<t;o++)r[o]=o;this.defaultGroupCache[t]=hr.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new sr(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ce,default:this.defaultGroupCache[t]};return new wr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class Qf{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function U4(){return!Yr.apple.device}function G4(i){let t=!0;const e=St.ADAPTER.getNavigator();if(Yr.tablet||Yr.phone){if(Yr.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(Yr.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class yl{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var H4=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,W4=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Ji=class extends yl{constructor(i){super(i),this.setShaderGenerator(),this.geometryClass=R_,this.vertexSize=6,this.state=Zr.for2d(),this.size=Ji.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),i.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??G4(32),this._defaultMaxTextures}static set defaultMaxTextures(i){this._defaultMaxTextures=i}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??U4(),this._canUploadSameBuffer}static set canUploadSameBuffer(i){this._canUploadSameBuffer=i}get MAX_TEXTURES(){return ee("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return W4}static get defaultFragmentTemplate(){return H4}setShaderGenerator({vertex:i=Ji.defaultVertexSrc,fragment:t=Ji.defaultFragmentTemplate}={}){this.shaderGenerator=new N4(i,t)}contextChange(){const i=this.renderer.gl;St.PREFER_ENV===ss.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),Ji.defaultMaxTextures),this.maxTextures=g4(this.maxTextures,i)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:i,_textureArrayPool:t}=Ji,e=this.size/4,r=Math.floor(e/this.maxTextures)+1;for(;i.length<e;)i.push(new Zf);for(;t.length<r;)t.push(new Qf);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(i){i._texture.valid&&(this._vertexCount+i.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=i.vertexData.length/2,this._indexCount+=i.indices.length,this._bufferedTextures[this._bufferSize]=i._texture.baseTexture,this._bufferedElements[this._bufferSize++]=i)}buildTexturesAndDrawCalls(){const{_bufferedTextures:i,maxTextures:t}=this,e=Ji._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let m=++Gt._globalBatch,a=0,s=e[0],h=0;r.copyBoundTextures(n,t);for(let d=0;d<this._bufferSize;++d){const l=i[d];i[d]=null,l._batchEnabled!==m&&(s.count>=t&&(r.boundArray(s,n,m,t),this.buildDrawCalls(s,h,d),h=d,s=e[++a],++m),l._batchEnabled=m,l.touched=o,s.elements[s.count++]=l)}s.count>0&&(r.boundArray(s,n,m,t),this.buildDrawCalls(s,h,this._bufferSize),++a,++m);for(let d=0;d<n.length;d++)n[d]=null;Gt._globalBatch=m}buildDrawCalls(i,t,e){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:o,vertexSize:m}=this,a=Ji._drawCallPool;let s=this._dcIndex,h=this._aIndex,d=this._iIndex,l=a[s];l.start=this._iIndex,l.texArray=i;for(let u=t;u<e;++u){const c=r[u],f=c._texture.baseTexture,v=E_[f.alphaMode?1:0][c.blendMode];r[u]=null,t<u&&l.blend!==v&&(l.size=d-l.start,t=u,l=a[++s],l.texArray=i,l.start=d),this.packInterleavedGeometry(c,n,o,h,d),h+=c.vertexData.length/2*m,d+=c.indices.length,l.blend=v}t<e&&(l.size=d-l.start,++s),this._dcIndex=s,this._aIndex=h,this._iIndex=d}bindAndClearTexArray(i){const t=this.renderer.texture;for(let e=0;e<i.count;e++)t.bind(i.elements[e],i.ids[e]),i.elements[e]=null;i.count=0}updateGeometry(){const{_packedGeometries:i,_attributeBuffer:t,_indexBuffer:e}=this;Ji.canUploadSameBuffer?(i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,i[this._flushId]=new this.geometryClass),i[this._flushId]._buffer.update(t.rawBinaryData),i[this._flushId]._indexBuffer.update(e),this.renderer.geometry.bind(i[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const i=this._dcIndex,{gl:t,state:e}=this.renderer,r=Ji._drawCallPool;let n=null;for(let o=0;o<i;o++){const{texArray:m,type:a,size:s,start:h,blend:d}=r[o];n!==m&&(n=m,this.bindAndClearTexArray(m)),this.state.blendMode=d,e.set(this.state),t.drawElements(a,s,t.UNSIGNED_SHORT,h*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Ji.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let i=0;i<this._packedGeometryPoolSize;i++)this._packedGeometries[i]&&this._packedGeometries[i].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(i){const t=el(Math.ceil(i/8)),e=Mm(t),r=t*8;this._aBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new Kf(r*this.vertexSize*4)),n}getIndexBuffer(i){const t=el(Math.ceil(i/12)),e=Mm(t),r=t*12;this._iBuffers.length<=e&&(this._iBuffers.length=e+1);let n=this._iBuffers[e];return n||(this._iBuffers[e]=n=new Uint16Array(r)),n}packInterleavedGeometry(i,t,e,r,n){const{uint32View:o,float32View:m}=t,a=r/this.vertexSize,s=i.uvs,h=i.indices,d=i.vertexData,l=i._texture.baseTexture._batchLocation,u=Math.min(i.worldAlpha,1),c=ue.shared.setValue(i._tintRGB).toPremultiplied(u,i._texture.baseTexture.alphaMode>0);for(let f=0;f<d.length;f+=2)m[r++]=d[f],m[r++]=d[f+1],m[r++]=s[f],m[r++]=s[f+1],o[r++]=c,m[r++]=l;for(let f=0;f<h.length;f++)e[n++]=a+h[f]}};let rr=Ji;rr.defaultBatchSize=4096;rr.extension={name:"batch",type:Ct.RendererPlugin};rr._drawCallPool=[];rr._textureArrayPool=[];Ot.add(rr);var X4=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,V4=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Va=class extends wr{constructor(i,t,e){const r=sr.from(i||Va.defaultVertexSrc,t||Va.defaultFragmentSrc);super(r,e),this.padding=0,this.resolution=Va.defaultResolution,this.multisample=Va.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Zr}apply(i,t,e,r,n){i.applyFilter(this,t,e,r)}get blendMode(){return this.state.blendMode}set blendMode(i){this.state.blendMode=i}get resolution(){return this._resolution}set resolution(i){this._resolution=i}static get defaultVertexSrc(){return V4}static get defaultFragmentSrc(){return X4}};let ri=Va;ri.defaultResolution=1;ri.defaultMultisample=Be.NONE;class xl{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new ue(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,o=r??e;o!==void 0&&(this.color=o),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}xl.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};xl.extension={type:[Ct.RendererSystem,Ct.CanvasRendererSystem],name:"background"};Ot.add(xl);class H_{constructor(t){this.renderer=t,this.emptyRenderer=new yl(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:o,ids:m,count:a}=t;let s=0;for(let h=0;h<a;h++){const d=o[h],l=d._batchLocation;if(l>=0&&l<n&&e[l]===d){m[h]=l;continue}for(;s<n;){const u=e[s];if(u&&u._batchEnabled===r&&u._batchLocation===s){s++;continue}m[h]=s,d._batchLocation=s,e[s]=d;break}}}destroy(){this.renderer=null}}H_.extension={type:Ct.RendererSystem,name:"batch"};Ot.add(H_);let Gm=0;class bl{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Gm++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Gm++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(St.PREFER_ENV>=ss.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}bl.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};bl.extension={type:Ct.RendererSystem,name:"context"};Ot.add(bl);class z4 extends co{upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===cr.UNPACK);const o=e.realWidth,m=e.realHeight;return r.width===o&&r.height===m?n.texSubImage2D(e.target,0,0,0,o,m,e.format,r.type,this.data):(r.width=o,r.height=m,n.texImage2D(e.target,0,r.internalFormat,o,m,0,e.format,r.type,this.data)),!0}}class td{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new or("disposeFramebuffer"),this.multisample=Be.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Gt(null,{scaleMode:jr.NEAREST,resolution:1,mipmap:Tr.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Gt(new z4(null,{width:this.width,height:this.height}),{scaleMode:jr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Tr.OFF,format:yt.DEPTH_COMPONENT,type:Rt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],o=n.resolution;n.setSize(t/o,e/o)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class W_ extends Gt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],n=arguments[2],o=arguments[3];t={width:e,height:r,scaleMode:n,resolution:o}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=Be.NONE),super(null,t),this.mipmap=Tr.OFF,this.valid=!0,this._clear=new ue([0,0,0,0]),this.framebuffer=new td(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Cn extends ro{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;super(r,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=u4(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,n){const o=t.gl,m=e.realWidth,a=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1&&n.buffered.length===0)return!1;return o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===cr.UNPACK),!this.noSubImage&&e.target===o.TEXTURE_2D&&r.width===m&&r.height===a?o.texSubImage2D(o.TEXTURE_2D,0,0,0,e.format,r.type,n):(r.width=m,r.height=a,o.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class X_ extends Cn{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;Cn.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??St.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const n=this.source;this.url=n.src;const o=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?o():(n.onload=o,n.onerror=m=>{r(m),this.onError.emit(m)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===cr.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let n=!0;const o=e._glTextures;for(const m in o){const a=o[m];if(a!==r&&a.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class V_{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,o=e.height;if(r){const m=t.width/2/n,a=t.height/2/o,s=t.x/n+m,h=t.y/o+a;r=Ee.add(r,Ee.NW),this.x0=s+m*Ee.uX(r),this.y0=h+a*Ee.uY(r),r=Ee.add(r,2),this.x1=s+m*Ee.uX(r),this.y1=h+a*Ee.uY(r),r=Ee.add(r,2),this.x2=s+m*Ee.uX(r),this.y2=h+a*Ee.uY(r),r=Ee.add(r,2),this.x3=s+m*Ee.uX(r),this.y3=h+a*Ee.uY(r)}else this.x0=t.x/n,this.y0=t.y/o,this.x1=(t.x+t.width)/n,this.y1=t.y/o,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/o,this.x3=t.x/n,this.y3=(t.y+t.height)/o;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const Hm=new V_;function bh(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class It extends ho{constructor(t,e,r,n,o,m,a){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new Kt(0,0,1,1)),t instanceof It&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this._uvs=Hm,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(o||0),o===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=m?new ne(m.x,m.y):new ne(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&vr[e.url]&&It.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,It.removeFromCache(this),this.textureCacheIds=null}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new It(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Hm&&(this._uvs=new V_),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=St.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let o=null;if(n)o=t;else if(t instanceof Gt){if(!t.cacheId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${a}-${is()}`,Gt.addToCache(t,t.cacheId)}o=t.cacheId}else{if(!t._pixiId){const a=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${a}_${is()}`}o=t._pixiId}let m=vr[o];if(n&&r&&!m)throw new Error(`The cacheId "${o}" does not exist in TextureCache.`);return!m&&!(t instanceof Gt)?(e.resolution||(e.resolution=bn(t)),m=new It(new Gt(t,e)),m.baseTexture.cacheId=o,Gt.addToCache(m.baseTexture,o),It.addToCache(m,o)):!m&&t instanceof Gt&&(m=new It(t),It.addToCache(m,o)),m}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=It.from(t,Object.assign({resourceOptions:r},e),!1),o=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):o.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,r,n){return new It(Gt.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const o=new Gt(t,Object.assign({scaleMode:Gt.defaultOptions.scaleMode,resolution:bn(e)},n)),{resource:m}=o;m instanceof X_&&(m.url=e);const a=new It(o);return r||(r=e),Gt.addToCache(a.baseTexture,r),It.addToCache(a,r),r!==e&&(Gt.addToCache(a.baseTexture,e),It.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise(s=>{a.baseTexture.once("loaded",()=>s(a))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),vr[e]&&vr[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),vr[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=vr[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete vr[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)vr[t.textureCacheIds[e]]===t&&delete vr[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:o}=t,m=e+n>this.baseTexture.width,a=r+o>this.baseTexture.height;if(m||a){const s=m&&a?"and":"or",h=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,d=`Y: ${r} + ${o} = ${r+o} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${s} ${d}`)}this.valid=n&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return It._EMPTY||(It._EMPTY=new It(new Gt),bh(It._EMPTY),bh(It._EMPTY.baseTexture)),It._EMPTY}static get WHITE(){if(!It._WHITE){const t=St.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),It._WHITE=new It(Gt.from(t)),bh(It._WHITE),bh(It._WHITE.baseTexture)}return It._WHITE}}class as extends It{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,o=Math.round(t*n)/n,m=Math.round(e*n)/n;this.valid=o>0&&m>0,this._frame.width=this.orig.width=o,this._frame.height=this.orig.height=m,r&&this.baseTexture.resize(o,m),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new as(new W_(t))}}class z_{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=Be.NONE){const n=new W_(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new as(n)}getOptimalTexture(t,e,r=1,n=Be.NONE){let o;t=Math.ceil(t*r-1e-6),e=Math.ceil(e*r-1e-6),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=el(t),e=el(e),o=((t&65535)<<16|e&65535)>>>0,n>1&&(o+=n*4294967296)):o=n>1?-n:-1,this.texturePool[o]||(this.texturePool[o]=[]);let m=this.texturePool[o].pop();return m||(m=this.createTexture(t,e,n)),m.filterPoolKey=o,m.setResolution(r),m}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||Be.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}z_.SCREEN_KEY=-1;class j4 extends Sn{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class j_ extends Sn{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new We(this.vertices),this.uvBuffer=new We(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class Y4{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Be.NONE,this.sourceFrame=new Kt,this.destinationFrame=new Kt,this.bindingSourceFrame=new Kt,this.bindingDestinationFrame=new Kt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Sh=[new ne,new ne,new ne,new ne],af=new Ce;class Y_{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new z_,this.statePool=[],this.quad=new j4,this.quadUv=new j_,this.tempRect=new Kt,this.activeState={},this.globalUniforms=new hr({outputFrame:new Kt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,o=this.statePool.pop()||new Y4,m=this.renderer.renderTexture;let a=e[0].resolution,s=e[0].multisample,h=e[0].padding,d=e[0].autoFit,l=e[0].legacy??!0;for(let f=1;f<e.length;f++){const v=e[f];a=Math.min(a,v.resolution),s=Math.min(s,v.multisample),h=this.useMaxPadding?Math.max(h,v.padding):h+v.padding,d=d&&v.autoFit,l=l||(v.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=m.current),n.push(o),o.resolution=a,o.multisample=s,o.legacy=l,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(h);const u=this.tempRect.copyFrom(m.sourceFrame);r.projection.transform&&this.transformAABB(af.copyFrom(r.projection.transform).invert(),u),d?(o.sourceFrame.fit(u),(o.sourceFrame.width<=0||o.sourceFrame.height<=0)&&(o.sourceFrame.width=0,o.sourceFrame.height=0)):o.sourceFrame.intersects(u)||(o.sourceFrame.width=0,o.sourceFrame.height=0),this.roundFrame(o.sourceFrame,m.current?m.current.resolution:r.resolution,m.sourceFrame,m.destinationFrame,r.projection.transform),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,a,s),o.filters=e,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;const c=this.tempRect;c.x=0,c.y=0,c.width=o.sourceFrame.width,c.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,o.bindingSourceFrame.copyFrom(m.sourceFrame),o.bindingDestinationFrame.copyFrom(m.destinationFrame),o.transform=r.projection.transform,r.projection.transform=null,m.bind(o.renderTexture,o.sourceFrame,c),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const o=n.inputSize,m=n.inputPixel,a=n.inputClamp;if(o[0]=e.destinationFrame.width,o[1]=e.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],m[0]=Math.round(o[0]*e.resolution),m[1]=Math.round(o[1]*e.resolution),m[2]=1/m[0],m[3]=1/m[1],a[0]=.5*m[2],a[1]=.5*m[3],a[2]=e.sourceFrame.width*o[2]-.5*m[2],a[3]=e.sourceFrame.height*o[3]-.5*m[3],e.legacy){const h=n.filterArea;h[0]=e.destinationFrame.width,h[1]=e.destinationFrame.height,h[2]=e.sourceFrame.x,h[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const s=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,s.renderTexture,_r.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let h=e.renderTexture,d=this.getOptimalFilterTexture(h.width,h.height,e.resolution);d.filterFrame=h.filterFrame;let l=0;for(l=0;l<r.length-1;++l){l===1&&e.multisample>1&&(d=this.getOptimalFilterTexture(h.width,h.height,e.resolution),d.filterFrame=h.filterFrame),r[l].apply(this,h,d,_r.CLEAR,e);const u=h;h=d,d=u}r[l].apply(this,h,s.renderTexture,_r.BLEND,e),l>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(d)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=_r.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t!=null&&t.filterFrame){const m=this.tempRect;m.x=0,m.y=0,m.width=t.filterFrame.width,m.height=t.filterFrame.height,r.bind(t,t.filterFrame,m)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const o=n.stateId&1||this.forceClear;(e===_r.CLEAR||e===_r.BLIT&&o)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const o=this.renderer;o.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,o.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(Sr.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(Sr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:o}=e._texture,m=t.set(n.width,0,0,n.height,r.x,r.y),a=e.worldTransform.copyTo(Ce.TEMP_MATRIX);return a.invert(),m.prepend(a),m.scale(1/o.width,1/o.height),m.translate(e.anchor.x,e.anchor.y),m}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=Be.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if(typeof t=="number"){const o=t;t=e,e=o}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||Be.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Sh[0],n=Sh[1],o=Sh[2],m=Sh[3];r.set(e.left,e.top),n.set(e.left,e.bottom),o.set(e.right,e.top),m.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(o,o),t.apply(m,m);const a=Math.min(r.x,n.x,o.x,m.x),s=Math.min(r.y,n.y,o.y,m.y),h=Math.max(r.x,n.x,o.x,m.x),d=Math.max(r.y,n.y,o.y,m.y);e.x=a,e.y=s,e.width=h-a,e.height=d-s}roundFrame(t,e,r,n,o){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(o){const{a:m,b:a,c:s,d:h}=o;if((Math.abs(a)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(m)>1e-4||Math.abs(h)>1e-4))return}o=o?af.copyFrom(o):af.identity(),o.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(o,t),t.ceil(e),this.transformAABB(o.invert(),t)}}}Y_.extension={type:Ct.RendererSystem,name:"filter"};Ot.add(Y_);class $4{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Be.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const K4=new Kt;class $_{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new td(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Kt,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;St.PREFER_ENV===ss.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const o=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,o.framebuffer)),o.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,o.mipLevel=r),o.dirtyId!==t.dirtyId&&(o.dirtyId=t.dirtyId,o.dirtyFormat!==t.dirtyFormat?(o.dirtyFormat=t.dirtyFormat,o.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):o.dirtySize!==t.dirtySize&&(o.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let m=0;m<t.colorTextures.length;m++){const a=t.colorTextures[m];this.renderer.texture.unbind(a.parentTextureArray||a)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const m=e.width>>r,a=e.height>>r,s=m/e.width;this.setViewport(e.x*s,e.y*s,m,a)}else{const m=t.width>>r,a=t.height>>r;this.setViewport(0,0,m,a)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const o=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(o.width!==r||o.height!==n||o.x!==t||o.y!==e)&&(o.x=t,o.y=e,o.width=r,o.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,o=Of.COLOR|Of.DEPTH){const{gl:m}=this;m.clearColor(t,e,r,n),m.clear(o)}initFramebuffer(t){const{gl:e}=this,r=new $4(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];r.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,r.stencil),r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const n=t.colorTextures;let o=n.length;e.drawBuffers||(o=Math.min(o,1));for(let m=0;m<o;m++){const a=n[m],s=a.parentTextureArray||a;this.renderer.texture.bind(s,0),m===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,s._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],o=t.colorTextures;let m=o.length;r.drawBuffers||(m=Math.min(m,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const a=[];for(let s=0;s<m;s++){const h=o[s],d=h.parentTextureArray||h;this.renderer.texture.bind(d,0),s===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,d._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+s,h.target,d._glTextures[this.CONTEXT_UID].texture,e),a.push(r.COLOR_ATTACHMENT0+s))}if(a.length>1&&r.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const h=t.depthTexture;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,e)}(t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)?(n.stencil=n.stencil||r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.DEPTH24_STENCIL8,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil)):n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=Be.NONE;if(t<=1||e===null)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return r===1&&(r=Be.NONE),r}blit(t,e,r){const{current:n,renderer:o,gl:m,CONTEXT_UID:a}=this;if(o.context.webGLVersion!==2||!n)return;const s=n.glFramebuffers[a];if(!s)return;if(!t){if(!s.msaaBuffer)return;const d=n.colorTextures[0];if(!d)return;s.blitFramebuffer||(s.blitFramebuffer=new td(n.width,n.height),s.blitFramebuffer.addColorTexture(0,d)),t=s.blitFramebuffer,t.colorTextures[0]!==d&&(t.colorTextures[0]=d,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=K4,e.width=n.width,e.height=n.height),r||(r=e);const h=e.width===r.width&&e.height===r.height;this.bind(t),m.bindFramebuffer(m.READ_FRAMEBUFFER,s.framebuffer),m.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,m.COLOR_BUFFER_BIT,h?m.NEAREST:m.LINEAR),m.bindFramebuffer(m.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const r=t.width,n=t.height,o=this.gl,m=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,m),e.msaaBuffer?o.renderbufferStorageMultisample(o.RENDERBUFFER,e.multisample,o.DEPTH24_STENCIL8,r,n):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,r,n),e.stencil=m,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,m)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Kt}destroy(){this.renderer=null}}$_.extension={type:Ct.RendererSystem,name:"framebuffer"};Ot.add($_);const of={5126:4,5123:2,5121:1};class K_{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;St.PREFER_ENV===ss.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=n=>r.bindVertexArrayOES(n),t.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(n,o)=>r.vertexAttribDivisorANGLE(n,o),t.drawElementsInstanced=(n,o,m,a,s)=>r.drawElementsInstancedANGLE(n,o,m,a,s),t.drawArraysInstanced=(n,o,m,a)=>r.drawArraysInstancedANGLE(n,o,m,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},o=!0);const m=n[e.program.id]||this.initGeometryVao(t,e,o);this._activeGeometry=t,this._activeVao!==m&&(this._activeVao=m,this.hasVao?r.bindVertexArray(m):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const o in n)if(!r[o])throw new Error(`shader and geometry incompatible, geometry missing the "${o}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,o=["g",t.id];for(const m in r)n[m]&&o.push(m,n[m].location);return o.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,o=this.CONTEXT_UID,m=this.renderer.buffer,a=e.program;a.glPrograms[o]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const s=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let d=h[s];if(d)return h[a.id]=d,d;const l=t.buffers,u=t.attributes,c={},f={};for(const v in l)c[v]=0,f[v]=0;for(const v in u)!u[v].size&&a.attributeData[v]?u[v].size=a.attributeData[v].size:u[v].size||console.warn(`PIXI Geometry attribute '${v}' size cannot be determined (likely the bound shader does not have the attribute)`),c[u[v].buffer]+=u[v].size*of[u[v].type];for(const v in u){const p=u[v],y=p.size;p.stride===void 0&&(c[p.buffer]===y*of[p.type]?p.stride=0:p.stride=c[p.buffer]),p.start===void 0&&(p.start=f[p.buffer],f[p.buffer]+=y*of[p.type])}d=n.createVertexArray(),n.bindVertexArray(d);for(let v=0;v<l.length;v++){const p=l[v];m.bind(p),r&&p._glBuffers[o].refCount++}return this.activateVao(t,a),h[a.id]=d,h[s]=d,n.bindVertexArray(null),m.unbind(Cr.ARRAY_BUFFER),d}disposeGeometry(t,e){var a;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=t.buffers,m=(a=this.renderer)==null?void 0:a.buffer;if(t.disposeRunner.remove(this),!!r){if(m)for(let s=0;s<o.length;s++){const h=o[s]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!e&&m.dispose(o[s],e))}if(!e){for(const s in r)if(s[0]==="g"){const h=r[s];this._activeVao===h&&this.unbind(),n.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,m=t.buffers,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let s=null;for(const h in a){const d=a[h],l=m[d.buffer],u=l._glBuffers[n];if(e.attributeData[h]){s!==u&&(o.bind(l),s=u);const c=e.attributeData[h].location;if(r.enableVertexAttribArray(c),r.vertexAttribPointer(c,d.size,d.type||r.FLOAT,d.normalized,d.stride,d.start),d.instance)if(this.hasInstance)r.vertexAttribDivisor(c,d.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,n){const{gl:o}=this,m=this._activeGeometry;if(m.indexBuffer){const a=m.indexBuffer.data.BYTES_PER_ELEMENT,s=a===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?m.instanced?o.drawElementsInstanced(t,e||m.indexBuffer.data.length,s,(r||0)*a,n||1):o.drawElements(t,e||m.indexBuffer.data.length,s,(r||0)*a):console.warn("unsupported index buffer type: uint32")}else m.instanced?o.drawArraysInstanced(t,r,e||m.getSize(),n||1):o.drawArrays(t,r,e||m.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}K_.extension={type:Ct.RendererSystem,name:"geometry"};Ot.add(K_);const Wm=new Ce;class q_{constructor(t,e){this._texture=t,this.mapCoord=new Ce,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const o=t[n],m=t[n+1];e[n]=o*r.a+m*r.c+r.tx,e[n+1]=o*r.b+m*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,o=e.trim;o&&(Wm.set(n.width/o.width,0,0,n.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(Wm));const m=e.baseTexture,a=this.uClampFrame,s=this.clampMargin/m.resolution,h=this.clampOffset;return a[0]=(e._frame.x+s+h)/m.width,a[1]=(e._frame.y+s+h)/m.height,a[2]=(e._frame.x+e._frame.width-s+h)/m.width,a[3]=(e._frame.y+e._frame.height-s+h)/m.height,this.uClampOffset[0]=h/m.realWidth,this.uClampOffset[1]=h/m.realHeight,this.isSimple=e._frame.width===m.width&&e._frame.height===m.height&&e.rotate===0,!0}}var q4=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Z4=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class J4 extends ri{constructor(t,e,r){let n=null;typeof t!="string"&&e===void 0&&r===void 0&&(n=t,t=void 0,e=void 0,r=void 0),super(t||Z4,e||q4,r),this.maskSprite=n,this.maskMatrix=new Ce}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const o=this._maskSprite,m=o._texture;m.valid&&(m.uvMatrix||(m.uvMatrix=new q_(m,0)),m.uvMatrix.update(),this.uniforms.npmAlpha=m.baseTexture.alphaMode?0:1,this.uniforms.mask=m,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(m.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=m.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class Q4{constructor(t=null){this.type=Ge.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ri.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Ge.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Z_{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const o=this.maskDataPool.pop()||new Q4;o.pooled=!0,o.maskObject=e,r=o}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==Ge.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case Ge.SCISSOR:this.renderer.scissor.push(r);break;case Ge.STENCIL:this.renderer.stencil.push(r);break;case Ge.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case Ge.COLOR:this.pushColorMask(r);break}r.type===Ge.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case Ge.SCISSOR:this.renderer.scissor.pop(e);break;case Ge.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case Ge.SPRITE:this.popSpriteMask(e);break;case Ge.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===Ge.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=Ge.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=Ge.SCISSOR:t.type=Ge.STENCIL:t.type=Ge.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new J4]));const o=this.renderer,m=o.renderTexture;let a,s;if(m.current){const d=m.current;a=t.resolution||d.resolution,s=t.multisample??d.multisample}else a=t.resolution||o.resolution,s=t.multisample??o.multisample;n[0].resolution=a,n[0].multisample=s,n[0].maskSprite=e;const h=r.filterArea;r.filterArea=e.getBounds(!0),o.filter.push(r,n),r.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}Z_.extension={type:Ct.RendererSystem,name:"mask"};Ot.add(Z_);class J_{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Xm=new Ce,Vm=[],Hh=class extends J_{constructor(i){super(i),this.glConst=St.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const i=this.maskStack[this.maskStack.length-1];return i?i._scissorCounter:0}calcScissorRect(i){if(i._scissorRectLocal)return;const t=i._scissorRect,{maskObject:e}=i,{renderer:r}=this,n=r.renderTexture,o=e.getBounds(!0,Vm.pop()??new Kt);this.roundFrameToPixels(o,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),t&&o.fit(t),i._scissorRectLocal=o}static isMatrixRotated(i){if(!i)return!1;const{a:t,b:e,c:r,d:n}=i;return(Math.abs(e)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(i){const{maskObject:t}=i;if(!t.isFastRect||!t.isFastRect()||Hh.isMatrixRotated(t.worldTransform)||Hh.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(i);const e=i._scissorRectLocal;return e.width>0&&e.height>0}roundFrameToPixels(i,t,e,r,n){Hh.isMatrixRotated(n)||(n=n?Xm.copyFrom(n):Xm.identity(),n.translate(-e.x,-e.y).scale(r.width/e.width,r.height/e.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,i),i.fit(r),i.x=Math.round(i.x*t),i.y=Math.round(i.y*t),i.width=Math.round(i.width*t),i.height=Math.round(i.height*t))}push(i){i._scissorRectLocal||this.calcScissorRect(i);const{gl:t}=this.renderer;i._scissorRect||t.enable(t.SCISSOR_TEST),i._scissorCounter++,i._scissorRect=i._scissorRectLocal,this._useCurrent()}pop(i){const{gl:t}=this.renderer;i&&Vm.push(i._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const i=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=i.y:t=this.renderer.height-i.height-i.y,this.renderer.gl.scissor(i.x,t,i.width,i.height)}};let Q_=Hh;Q_.extension={type:Ct.RendererSystem,name:"scissor"};Ot.add(Q_);class t1 extends J_{constructor(t){super(t),this.glConst=St.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const o=t._colorMask;o!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,o!==0&&(t._colorMask=o,r.colorMask((o&1)!==0,(o&2)!==0,(o&4)!==0,(o&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(r._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}t1.extension={type:Ct.RendererSystem,name:"stencil"};Ot.add(t1);class e1{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return ee("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return ee("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return ee("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}e1.extension={type:[Ct.RendererSystem,Ct.CanvasRendererSystem],name:"_plugin"};Ot.add(e1);class i1{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Ce,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const o=this.projectionMatrix,m=n?-1:1;o.identity(),o.a=1/e.width*2,o.d=m*(1/e.height*2),o.tx=-1-e.x*o.a,o.ty=-m-e.y*o.d}setTransform(t){}destroy(){this.renderer=null}}i1.extension={type:Ct.RendererSystem,name:"projection"};Ot.add(i1);const tA=new Bd;class r1{constructor(t){this.renderer=t,this._tempMatrix=new Ce}generateTexture(t,e){const{region:r,...n}=e||{},o=r||t.getLocalBounds(null,!0);o.width===0&&(o.width=1),o.height===0&&(o.height=1);const m=as.create({width:o.width,height:o.height,...n});this._tempMatrix.tx=-o.x,this._tempMatrix.ty=-o.y;const a=t.transform;return t.transform=tA,this.renderer.render(t,{renderTexture:m,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,m}destroy(){}}r1.extension={type:[Ct.RendererSystem,Ct.CanvasRendererSystem],name:"textureGenerator"};Ot.add(r1);const Gn=new Kt,Na=new Kt;class n1{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Kt,this.destinationFrame=new Kt,this.viewportFrame=new Kt}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;this.current=t;let o,m,a;t?(o=t.baseTexture,a=o.resolution,e||(Gn.width=t.frame.width,Gn.height=t.frame.height,e=Gn),r||(Na.x=t.frame.x,Na.y=t.frame.y,Na.width=e.width,Na.height=e.height,r=Na),m=o.framebuffer):(a=n.resolution,e||(Gn.width=n._view.screen.width,Gn.height=n._view.screen.height,e=Gn),r||(r=Gn,r.width=e.width,r.height=e.height));const s=this.viewportFrame;s.x=r.x*a,s.y=r.y*a,s.width=r.width*a,s.height=r.height*a,t||(s.y=n.view.height-(s.y+s.height)),s.ceil(),this.renderer.framebuffer.bind(m,s),this.renderer.projection.update(r,e,a,!m),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=ue.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const o=this.destinationFrame,m=this.current?this.current.baseTexture:this.renderer._view.screen,a=o.width!==m.width||o.height!==m.height;if(a){let{x:s,y:h,width:d,height:l}=this.viewportFrame;s=Math.round(s),h=Math.round(h),d=Math.round(d),l=Math.round(l),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(s,h,d,l)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}n1.extension={type:Ct.RendererSystem,name:"renderTexture"};Ot.add(n1);class eA{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function iA(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const o=t.getActiveAttrib(i,n);if(o.name.startsWith("gl_"))continue;const m=G_(t,o.type),a={type:m,name:o.name,size:U_(m),location:t.getAttribLocation(i,o.name)};e[o.name]=a}return e}function rA(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const o=t.getActiveUniform(i,n),m=o.name.replace(/\[.*?\]$/,""),a=!!o.name.match(/\[.*?\]$/),s=G_(t,o.type);e[m]={name:m,index:n,type:s,size:o.size,isArray:a,value:B_(s,o.size)}}return e}function nA(i,t){var s;const e=km(i,i.VERTEX_SHADER,t.vertexSrc),r=km(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,r);const o=(s=t.extra)==null?void 0:s.transformFeedbackVaryings;if(o&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,o.names,o.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||D4(i,n,e,r),t.attributeData=iA(n,i),t.uniformData=rA(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const h=Object.keys(t.attributeData);h.sort((d,l)=>d>l?1:-1);for(let d=0;d<h.length;d++)t.attributeData[h[d]].location=d,i.bindAttribLocation(n,d,h[d]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(r);const m={};for(const h in t.uniformData){const d=t.uniformData[h];m[h]={location:i.getUniformLocation(n,h),value:B_(d.type,d.size)}}return new eA(n,m)}function sA(i,t,e,r,n){e.buffer.update(n)}const aA={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},s1={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function oA(i){const t=i.map(o=>({data:o,offset:0,dataLen:0,dirty:0}));let e=0,r=0,n=0;for(let o=0;o<t.length;o++){const m=t[o];if(e=s1[m.data.type],m.data.size>1&&(e=Math.max(e,16)*m.data.size),m.dataLen=e,r%e!==0&&r<16){const a=r%e%16;r+=a,n+=a}r+e>16?(n=Math.ceil(n/16)*16,m.offset=n,n+=e,r=e):(m.offset=n,r+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function hA(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,n)=>r.index-n.index),e}function lA(i,t){if(!i.autoManage)return{size:0,syncFunc:sA};const e=hA(i.uniforms,t),{uboElements:r,size:n}=oA(e),o=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let m=0;m<r.length;m++){const a=r[m],s=i.uniforms[a.data.name],h=a.data.name;let d=!1;for(let l=0;l<Qs.length;l++){const u=Qs[l];if(u.codeUbo&&u.test(a.data,s)){o.push(`offset = ${a.offset/4};`,Qs[l].codeUbo(a.data.name,s)),d=!0;break}}if(!d)if(a.data.size>1){const l=U_(a.data.type),u=Math.max(s1[a.data.type]/16,1),c=l/u,f=(4-c%4)%4;o.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*u}; i++)
                {
                    for(var j = 0; j < ${c}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${f};
                }

                `)}else{const l=aA[a.data.type];o.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${l};
                `)}}return o.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",o.join(`
`))}}let cA=0;const Ch={textureCount:0,uboCount:0};class a1{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=cA++}systemCheck(){if(!L4())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Ch.textureCount=0,Ch.uboCount=0,this.syncUniformGroup(t.uniformGroup,Ch)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=M4(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Ch,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const o=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,o,this.shader.uniformBindCount),this.shader.uniformBindCount++;const m=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[m];if(a||(a=this._uboCache[m]=lA(t,this.shader.program.uniformData)),t.autoManage){const s=new Float32Array(a.size/4);t.buffer.update(s)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,o=[`${r}-`];for(const m in n)o.push(m),e[m]&&o.push(e[m].type);return o.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=nA(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}a1.extension={type:Ct.RendererSystem,name:"shader"};Ot.add(a1);class Sl{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.2.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Sl.defaultOptions={hello:!1};Sl.extension={type:[Ct.RendererSystem,Ct.CanvasRendererSystem],name:"startup"};Ot.add(Sl);function uA(i,t=[]){return t[Bt.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.ADD]=[i.ONE,i.ONE],t[Bt.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.NONE]=[0,0],t[Bt.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[Bt.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[Bt.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[Bt.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[Bt.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[Bt.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[Bt.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[Bt.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[Bt.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[Bt.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[Bt.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const fA=0,dA=1,gA=2,pA=3,mA=4,vA=5,ed=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=Bt.NONE,this._blendEq=!1,this.map=[],this.map[fA]=this.setBlend,this.map[dA]=this.setOffset,this.map[gA]=this.setCullFace,this.map[pA]=this.setDepthTest,this.map[mA]=this.setFrontFace,this.map[vA]=this.setDepthMask,this.checks=[],this.defaultState=new Zr,this.defaultState.blend=!0}contextChange(i){this.gl=i,this.blendModes=uA(i),this.set(this.defaultState),this.reset()}set(i){if(i=i||this.defaultState,this.stateId!==i.data){let t=this.stateId^i.data,e=0;for(;t;)t&1&&this.map[e].call(this,!!(i.data&1<<e)),t=t>>1,e++;this.stateId=i.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,i)}forceState(i){i=i||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(i.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,i);this.stateId=i.data}setBlend(i){this.updateCheck(ed.checkBlendMode,i),this.gl[i?"enable":"disable"](this.gl.BLEND)}setOffset(i){this.updateCheck(ed.checkPolygonOffset,i),this.gl[i?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(i){this.gl[i?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(i){this.gl.depthMask(i)}setCullFace(i){this.gl[i?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(i){this.gl.frontFace(this.gl[i?"CW":"CCW"])}setBlendMode(i){if(i===this.blendMode)return;this.blendMode=i;const t=this.blendModes[i],e=this.gl;t.length===2?e.blendFunc(t[0],t[1]):e.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,e.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD))}setPolygonOffset(i,t){this.gl.polygonOffset(i,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(i,t){const e=this.checks.indexOf(i);t&&e===-1?this.checks.push(i):!t&&e!==-1&&this.checks.splice(e,1)}static checkBlendMode(i,t){i.setBlendMode(t.blendMode)}static checkPolygonOffset(i,t){i.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};let o1=ed;o1.extension={type:Ct.RendererSystem,name:"state"};Ot.add(o1);class _A extends ho{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),r=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new or(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(n=>{const o=r.find(m=>this._systemsHash[m]===n);n[t.name](e[o])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Wh=class{constructor(i){this.renderer=i,this.count=0,this.checkCount=0,this.maxIdle=Wh.defaultMaxIdle,this.checkCountMax=Wh.defaultCheckCountMax,this.mode=Wh.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Ed.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const i=this.renderer.texture,t=i.managedTextures;let e=!1;for(let r=0;r<t.length;r++){const n=t[r];!n.framebuffer&&this.count-n.touched>this.maxIdle&&(i.destroyTexture(n,!0),t[r]=null,e=!0)}if(e){let r=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[r++]=t[n]);t.length=r}}unload(i){const t=this.renderer.texture,e=i._texture;e&&!e.framebuffer&&t.destroyTexture(e);for(let r=i.children.length-1;r>=0;r--)this.unload(i.children[r])}destroy(){this.renderer=null}};let nr=Wh;nr.defaultMode=Ed.AUTO;nr.defaultMaxIdle=60*60;nr.defaultCheckCountMax=60*10;nr.extension={type:Ct.RendererSystem,name:"textureGC"};Ot.add(nr);class hf{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Rt.UNSIGNED_BYTE,this.internalFormat=yt.RGBA,this.samplerType=0}}function yA(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[Rt.UNSIGNED_BYTE]:{[yt.RGBA]:i.RGBA8,[yt.RGB]:i.RGB8,[yt.RG]:i.RG8,[yt.RED]:i.R8,[yt.RGBA_INTEGER]:i.RGBA8UI,[yt.RGB_INTEGER]:i.RGB8UI,[yt.RG_INTEGER]:i.RG8UI,[yt.RED_INTEGER]:i.R8UI,[yt.ALPHA]:i.ALPHA,[yt.LUMINANCE]:i.LUMINANCE,[yt.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Rt.BYTE]:{[yt.RGBA]:i.RGBA8_SNORM,[yt.RGB]:i.RGB8_SNORM,[yt.RG]:i.RG8_SNORM,[yt.RED]:i.R8_SNORM,[yt.RGBA_INTEGER]:i.RGBA8I,[yt.RGB_INTEGER]:i.RGB8I,[yt.RG_INTEGER]:i.RG8I,[yt.RED_INTEGER]:i.R8I},[Rt.UNSIGNED_SHORT]:{[yt.RGBA_INTEGER]:i.RGBA16UI,[yt.RGB_INTEGER]:i.RGB16UI,[yt.RG_INTEGER]:i.RG16UI,[yt.RED_INTEGER]:i.R16UI,[yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[Rt.SHORT]:{[yt.RGBA_INTEGER]:i.RGBA16I,[yt.RGB_INTEGER]:i.RGB16I,[yt.RG_INTEGER]:i.RG16I,[yt.RED_INTEGER]:i.R16I},[Rt.UNSIGNED_INT]:{[yt.RGBA_INTEGER]:i.RGBA32UI,[yt.RGB_INTEGER]:i.RGB32UI,[yt.RG_INTEGER]:i.RG32UI,[yt.RED_INTEGER]:i.R32UI,[yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[Rt.INT]:{[yt.RGBA_INTEGER]:i.RGBA32I,[yt.RGB_INTEGER]:i.RGB32I,[yt.RG_INTEGER]:i.RG32I,[yt.RED_INTEGER]:i.R32I},[Rt.FLOAT]:{[yt.RGBA]:i.RGBA32F,[yt.RGB]:i.RGB32F,[yt.RG]:i.RG32F,[yt.RED]:i.R32F,[yt.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[Rt.HALF_FLOAT]:{[yt.RGBA]:i.RGBA16F,[yt.RGB]:i.RGB16F,[yt.RG]:i.RG16F,[yt.RED]:i.R16F},[Rt.UNSIGNED_SHORT_5_6_5]:{[yt.RGB]:i.RGB565},[Rt.UNSIGNED_SHORT_4_4_4_4]:{[yt.RGBA]:i.RGBA4},[Rt.UNSIGNED_SHORT_5_5_5_1]:{[yt.RGBA]:i.RGB5_A1},[Rt.UNSIGNED_INT_2_10_10_10_REV]:{[yt.RGBA]:i.RGB10_A2,[yt.RGBA_INTEGER]:i.RGB10_A2UI},[Rt.UNSIGNED_INT_10F_11F_11F_REV]:{[yt.RGB]:i.R11F_G11F_B10F},[Rt.UNSIGNED_INT_5_9_9_9_REV]:{[yt.RGB]:i.RGB9_E5},[Rt.UNSIGNED_INT_24_8]:{[yt.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[Rt.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[yt.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[Rt.UNSIGNED_BYTE]:{[yt.RGBA]:i.RGBA,[yt.RGB]:i.RGB,[yt.ALPHA]:i.ALPHA,[yt.LUMINANCE]:i.LUMINANCE,[yt.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Rt.UNSIGNED_SHORT_5_6_5]:{[yt.RGB]:i.RGB},[Rt.UNSIGNED_SHORT_4_4_4_4]:{[yt.RGBA]:i.RGBA},[Rt.UNSIGNED_SHORT_5_5_5_1]:{[yt.RGBA]:i.RGBA}},t}class h1{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Gt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=yA(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new hf(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new hf(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),t!=null&&t.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let o=t-1;o>=0;--o){const m=e[o];m&&m._glTextures[n].samplerType!==Rf.FLOAT&&this.renderer.texture.unbind(m)}}initTexture(t){const e=new hf(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r;e.internalFormat=((r=this.internalFormats[t.type])==null?void 0:r[t.format])??t.format,this.webGLVersion===2&&t.type===Rt.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),(n=t.resource)!=null&&n.upload(r,t,e))e.samplerType!==Rf.FLOAT&&(this.hasIntegerTextures=!0);else{const o=t.realWidth,m=t.realHeight,a=r.gl;(e.width!==o||e.height!==m||e.dirtyId<0)&&(e.width=o,e.height=m,a.texImage2D(t.target,0,e.internalFormat,o,m,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&Zs(this.managedTextures,n,1)}}updateTextureStyle(t){var r;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Tr.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=yn.CLAMP:e.wrapMode=t.wrapMode,(r=t.resource)!=null&&r.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==Tr.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===jr.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===jr.LINEAR){const o=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===jr.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===jr.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}h1.extension={type:Ct.RendererSystem,name:"texture"};Ot.add(h1);class l1{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,o=e.createTransformFeedback();t._glTransformFeedbacks[n]=o,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,o);for(let m=0;m<t.buffers.length;m++){const a=t.buffers[m];a&&(r.buffer.update(a),a._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,m,a._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),o}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const o=this.renderer.buffer;if(o)for(let m=0;m<t.buffers.length;m++){const a=t.buffers[m];if(!a)continue;const s=a._glBuffers[this.CONTEXT_UID];s&&(s.refCount--,s.refCount===0&&!e&&o.dispose(a,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}l1.extension={type:Ct.RendererSystem,name:"transformFeedback"};Ot.add(l1);class Cl{constructor(t){this.renderer=t}init(t){this.screen=new Kt(0,0,t.width,t.height),this.element=t.view||St.ADAPTER.createCanvas(),this.resolution=t.resolution||St.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Cl.defaultOptions={width:800,height:600,resolution:St.RESOLUTION,autoDensity:!1};Cl.extension={type:[Ct.RendererSystem,Ct.CanvasRendererSystem],name:"_view"};Ot.add(Cl);St.PREFER_ENV=ss.WEBGL2;St.STRICT_TEXTURE_CACHE=!1;St.RENDER_OPTIONS={...bl.defaultOptions,...xl.defaultOptions,...Cl.defaultOptions,...Sl.defaultOptions};Object.defineProperties(St,{WRAP_MODE:{get(){return Gt.defaultOptions.wrapMode},set(i){ee("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Gt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return Gt.defaultOptions.scaleMode},set(i){ee("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Gt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return Gt.defaultOptions.mipmap},set(i){ee("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Gt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return Gt.defaultOptions.anisotropicLevel},set(i){ee("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Gt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return ee("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ri.defaultResolution},set(i){ri.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return ee("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ri.defaultMultisample},set(i){ri.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return rr.defaultMaxTextures},set(i){ee("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),rr.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return rr.defaultBatchSize},set(i){ee("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),rr.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return rr.canUploadSameBuffer},set(i){ee("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),rr.canUploadSameBuffer=i}},GC_MODE:{get(){return nr.defaultMode},set(i){ee("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),nr.defaultMode=i}},GC_MAX_IDLE:{get(){return nr.defaultMaxIdle},set(i){ee("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),nr.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return nr.defaultCheckCountMax},set(i){ee("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),nr.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return sr.defaultVertexPrecision},set(i){ee("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),sr.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return sr.defaultFragmentPrecision},set(i){ee("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),sr.defaultFragmentPrecision=i}}});var rs=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(rs||{});class lf{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Pi=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new lf(null,null,1/0),this.deltaMS=1/Pi.targetFPMS,this.elapsedMS=1/Pi.targetFPMS,this._tick=i=>{this._requestId=null,this.started&&(this.update(i),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(i,t,e=rs.NORMAL){return this._addListener(new lf(i,t,e))}addOnce(i,t,e=rs.NORMAL){return this._addListener(new lf(i,t,e,!0))}_addListener(i){let t=this._head.next,e=this._head;if(!t)i.connect(e);else{for(;t;){if(i.priority>t.priority){i.connect(e);break}e=t,t=t.next}i.previous||i.connect(e)}return this._startIfPossible(),this}remove(i,t){let e=this._head.next;for(;e;)e.match(i,t)?e=e.destroy():e=e.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let i=0,t=this._head;for(;t=t.next;)i++;return i}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let i=this._head.next;for(;i;)i=i.destroy(!0);this._head.destroy(),this._head=null}}update(i=performance.now()){let t;if(i>this.lastTime){if(t=this.elapsedMS=i-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=i-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=i-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Pi.targetFPMS;const e=this._head;let r=e.next;for(;r;)r=r.emit(this.deltaTime);e.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=i}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(i){const t=Math.min(this.maxFPS,i),e=Math.min(Math.max(0,t)/1e3,Pi.targetFPMS);this._maxElapsedMS=1/e}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(i){if(i===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,i);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Pi._shared){const i=Pi._shared=new Pi;i.autoStart=!0,i._protected=!0}return Pi._shared}static get system(){if(!Pi._system){const i=Pi._system=new Pi;i.autoStart=!0,i._protected=!0}return Pi._system}};let li=Pi;li.targetFPMS=.06;Object.defineProperties(St,{TARGET_FPMS:{get(){return li.targetFPMS},set(i){ee("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),li.targetFPMS=i}}});class c1{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,rs.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?li.shared:new li,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}c1.extension=Ct.Application;Ot.add(c1);const u1=[];Ot.handleByList(Ct.Renderer,u1);function xA(i){for(const t of u1)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var bA=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,SA=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const CA=bA,f1=SA;class d1{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=Be.HIGH?this.multisample=Be.HIGH:e>=Be.MEDIUM?this.multisample=Be.MEDIUM:e>=Be.LOW?this.multisample=Be.LOW:this.multisample=Be.NONE}destroy(){}}d1.extension={type:Ct.RendererSystem,name:"_multisample"};Ot.add(d1);class wA{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class g1{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const o=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,o.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:o}=this;r=r||0;const m=t._glBuffers[o]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,m.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const o=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,o)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new wA(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}g1.extension={type:Ct.RendererSystem,name:"buffer"};Ot.add(g1);class p1{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,o,m,a;if(e&&(n=e.renderTexture,o=e.clear,m=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=m,!r.context.isLost){if(n||(this.lastObjectRendered=t),!a){const s=t.enableTempParent();t.updateTransform(),t.disableTempParent(s)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(o??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}p1.extension={type:Ct.RendererSystem,name:"objectRenderer"};Ot.add(p1);const id=class extends _A{constructor(i){super(),this.type=r_.WEBGL,i=Object.assign({},St.RENDER_OPTIONS,i),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new hr({projectionMatrix:new Ce},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:id.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in i&&(ee("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),i.premultipliedAlpha=i.useContextAlpha&&i.useContextAlpha!=="notMultiplied",i.backgroundAlpha=i.useContextAlpha===!1?1:i.backgroundAlpha),this._plugin.rendererPlugins=id.__plugins,this.options=i,this.startup.run(this.options)}static test(i){return i!=null&&i.forceCanvas?!1:Y5()}render(i,t){this.objectRenderer.render(i,t)}resize(i,t){this._view.resizeView(i,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(i=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:i}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(i){this._view.resolution=i,this.runners.resolutionChange.emit(i)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return ee("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return ee("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return ee("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return ee("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(i){ee("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=i}get backgroundAlpha(){return ee("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(i){ee("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=i}get powerPreference(){return ee("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(i,t){return this.textureGenerator.generateTexture(i,t)}};let ca=id;ca.extension={type:Ct.Renderer,priority:1};ca.__plugins={};ca.__systems={};Ot.handleByMap(Ct.RendererPlugin,ca.__plugins);Ot.handleByMap(Ct.RendererSystem,ca.__systems);Ot.add(ca);class m1 extends ro{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let o=0;o<t;o++){const m=new Gt;this.items.push(m),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof ro?this.addResourceAt(t[r],r):this.addResourceAt(M_(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const e=this.items.map(r=>r.resource).filter(r=>r).map(r=>r.load());return this._load=Promise.all(e).then(()=>{const{realWidth:r,realHeight:n}=this.items[0];return this.resize(r,n),Promise.resolve(this)}),this._load}}class TA extends m1{constructor(t,e){const{width:r,height:n}=e||{};let o,m;Array.isArray(t)?(o=t,m=t.length):m=t,super(m,{width:r,height:n}),o&&this.initFromArray(o,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=Ys.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:o,items:m}=this,{gl:a}=t;r.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let s=0;s<n;s++){const h=m[s];o[s]<h.dirtyId&&(o[s]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,s,h.resource.width,h.resource.height,1,e.format,r.type,h.resource.source))}return!0}}class EA extends Cn{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const za=class extends m1{constructor(i,t){const{width:e,height:r,autoLoad:n,linkBaseTexture:o}=t||{};if(i&&i.length!==za.SIDES)throw new Error(`Invalid length. Got ${i.length}, expected 6`);super(6,{width:e,height:r});for(let m=0;m<za.SIDES;m++)this.items[m].target=Ys.TEXTURE_CUBE_MAP_POSITIVE_X+m;this.linkBaseTexture=o!==!1,i&&this.initFromArray(i,t),n!==!1&&this.load()}bind(i){super.bind(i),i.target=Ys.TEXTURE_CUBE_MAP}addBaseTextureAt(i,t,e){if(e===void 0&&(e=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||i.parentTextureArray||Object.keys(i._glTextures).length>0)if(i.resource)this.addResourceAt(i.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else i.target=Ys.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.parentTextureArray=this.baseTexture,this.items[t]=i;return i.valid&&!this.valid&&this.resize(i.realWidth,i.realHeight),this.items[t]=i,this}upload(i,t,e){const r=this.itemDirtyIds;for(let n=0;n<za.SIDES;n++){const o=this.items[n];(r[n]<o.dirtyId||e.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(i,o,e),r[n]=o.dirtyId):r[n]<-1&&(i.gl.texImage2D(o.target,0,e.internalFormat,t.realWidth,t.realHeight,0,t.format,e.type,null),r[n]=-1))}return!0}static test(i){return Array.isArray(i)&&i.length===za.SIDES}};let v1=za;v1.SIDES=6;class js extends Cn{constructor(t,e){e=e||{};let r,n;typeof t=="string"?(r=js.EMPTY,n=t):(r=t,n=null),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await St.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const o=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===cr.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=o,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return js._EMPTY=js._EMPTY??St.ADAPTER.createCanvas(0,0),js._EMPTY}}const Xh=class extends Cn{constructor(i,t){t=t||{},super(St.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=i,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(i=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),i(this)},Xh.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const i=new Image;Cn.crossOrigin(i,this.svg,this._crossorigin),i.src=this.svg,i.onerror=t=>{this._resolve&&(i.onerror=null,this.onError.emit(t))},i.onload=()=>{if(!this._resolve)return;const t=i.width,e=i.height;if(!t||!e)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,n=e*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/e*t,n=this._overrideHeight||this._overrideWidth/t*e),r=Math.round(r),n=Math.round(n);const o=this.source;o.width=r,o.height=n,o._pixiId=`canvas_${is()}`,o.getContext("2d").drawImage(i,0,0,t,e,0,0,r,n),this._resolve(),this._resolve=null}}static getSize(i){const t=Xh.SVG_SIZE.exec(i),e={};return t&&(e[t[1]]=Math.round(parseFloat(t[3])),e[t[5]]=Math.round(parseFloat(t[7]))),e}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(i,t){return t==="svg"||typeof i=="string"&&i.startsWith("data:image/svg+xml")||typeof i=="string"&&Xh.SVG_XML.test(i)}};let no=Xh;no.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m;no.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const rd=class extends Cn{constructor(i,t){if(t=t||{},!(i instanceof HTMLVideoElement)){const e=document.createElement("video");e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),typeof i=="string"&&(i=[i]);const r=i[0].src||i[0];Cn.crossOrigin(e,r,t.crossorigin);for(let n=0;n<i.length;++n){const o=document.createElement("source");let{src:m,mime:a}=i[n];m=m||i[n];const s=m.split("?").shift().toLowerCase(),h=s.slice(s.lastIndexOf(".")+1);a=a||rd.MIME_TYPES[h]||`video/${h}`,o.src=m,o.type=a,e.appendChild(o)}i=e}super(i),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),t.autoLoad!==!1&&this.load()}update(i=0){if(!this.destroyed){const t=li.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const i=this.source;return(i.readyState===i.HAVE_ENOUGH_DATA||i.readyState===i.HAVE_FUTURE_DATA)&&i.width&&i.height&&(i.complete=!0),i.addEventListener("play",this._onPlayStart.bind(this)),i.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(i.addEventListener("canplay",this._onCanPlay),i.addEventListener("canplaythrough",this._onCanPlay),i.addEventListener("error",this._onError,!0)),this._load=new Promise(t=>{this.valid?t(this):(this._resolve=t,i.load())}),this._load}_onError(i){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(i)}_isSourcePlaying(){const i=this.source;return!i.paused&&!i.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(li.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(li.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const i=this.source;i.removeEventListener("canplay",this._onCanPlay),i.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this.resize(i.videoWidth,i.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&i.play()}dispose(){this._isConnectedToTicker&&(li.shared.remove(this.update,this),this._isConnectedToTicker=!1);const i=this.source;i&&(i.removeEventListener("error",this._onError,!0),i.pause(),i.src="",i.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(i){i!==this._autoUpdate&&(this._autoUpdate=i,!this._autoUpdate&&this._isConnectedToTicker?(li.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(li.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(i){i!==this._updateFPS&&(this._updateFPS=i)}static test(i,t){return globalThis.HTMLVideoElement&&i instanceof HTMLVideoElement||rd.TYPES.includes(t)}};let Nd=rd;Nd.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];Nd.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};qf.push(js,X_,EA,Nd,no,co,v1,TA);class nl{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?Kt.EMPTY:(t=t||new Kt(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:o,d:m,tx:a,ty:s}=t,h=r*e.x+o*e.y+a,d=n*e.x+m*e.y+s;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,d),this.maxY=Math.max(this.maxY,d)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,o=this.maxY,m=t[0],a=t[1];e=m<e?m:e,r=a<r?a:r,n=m>n?m:n,o=a>o?a:o,m=t[2],a=t[3],e=m<e?m:e,r=a<r?a:r,n=m>n?m:n,o=a>o?a:o,m=t[4],a=t[5],e=m<e?m:e,r=a<r?a:r,n=m>n?m:n,o=a>o?a:o,m=t[6],a=t[7],e=m<e?m:e,r=a<r?a:r,n=m>n?m:n,o=a>o?a:o,this.minX=e,this.minY=r,this.maxX=n,this.maxY=o}addFrame(t,e,r,n,o){this.addFrameMatrix(t.worldTransform,e,r,n,o)}addFrameMatrix(t,e,r,n,o){const m=t.a,a=t.b,s=t.c,h=t.d,d=t.tx,l=t.ty;let u=this.minX,c=this.minY,f=this.maxX,v=this.maxY,p=m*e+s*r+d,y=a*e+h*r+l;u=p<u?p:u,c=y<c?y:c,f=p>f?p:f,v=y>v?y:v,p=m*n+s*r+d,y=a*n+h*r+l,u=p<u?p:u,c=y<c?y:c,f=p>f?p:f,v=y>v?y:v,p=m*e+s*o+d,y=a*e+h*o+l,u=p<u?p:u,c=y<c?y:c,f=p>f?p:f,v=y>v?y:v,p=m*n+s*o+d,y=a*n+h*o+l,u=p<u?p:u,c=y<c?y:c,f=p>f?p:f,v=y>v?y:v,this.minX=u,this.minY=c,this.maxX=f,this.maxY=v}addVertexData(t,e,r){let n=this.minX,o=this.minY,m=this.maxX,a=this.maxY;for(let s=e;s<r;s+=2){const h=t[s],d=t[s+1];n=h<n?h:n,o=d<o?d:o,m=h>m?h:m,a=d>a?d:a}this.minX=n,this.minY=o,this.maxX=m,this.maxY=a}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,o=0,m=o){const a=t.a,s=t.b,h=t.c,d=t.d,l=t.tx,u=t.ty;let c=this.minX,f=this.minY,v=this.maxX,p=this.maxY;for(let y=r;y<n;y+=2){const b=e[y],x=e[y+1],S=a*b+h*x+l,w=d*x+s*b+u;c=Math.min(c,S-o),v=Math.max(v,S+o),f=Math.min(f,w-m),p=Math.max(p,w+m)}this.minX=c,this.minY=f,this.maxX=v,this.maxY=p}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,o=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>o?t.maxY:o}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,o=t.maxX<e.maxX?t.maxX:e.maxX,m=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=o&&n<=m){const a=this.minX,s=this.minY,h=this.maxX,d=this.maxY;this.minX=r<a?r:a,this.minY=n<s?n:s,this.maxX=o>h?o:h,this.maxY=m>d?m:d}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,o=t.maxX<e.x+e.width?t.maxX:e.x+e.width,m=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=o&&n<=m){const a=this.minX,s=this.minY,h=this.maxX,d=this.maxY;this.minX=r<a?r:a,this.minY=n<s?n:s,this.maxX=o>h?o:h,this.maxY=m>d?m:d}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,o,m){t-=o,e-=m,r+=o,n+=m,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class Pe extends ho{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Bd,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new nl,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(Pe.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new Kt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new Kt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new nl);const e=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,o=this._boundsID;this._bounds=this._localBounds;const m=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-o,m}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,o=0,m=0,a=0,s=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=o,this.skew.x=m,this.skew.y=a,this.pivot.x=s,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new AA),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*b4}set angle(t){this.transform.rotation=t*S4}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class AA extends Pe{constructor(){super(...arguments),this.sortDirty=null}}Pe.prototype.displayObjectUpdateTransform=Pe.prototype.updateTransform;const PA=new Ce;function IA(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const nd=class extends Pe{constructor(){super(),this.children=[],this.sortableChildren=nd.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(i){}addChild(...i){if(i.length>1)for(let t=0;t<i.length;t++)this.addChild(i[t]);else{const t=i[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return i[0]}addChildAt(i,t){if(t<0||t>this.children.length)throw new Error(`${i}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return i.parent&&i.parent.removeChild(i),i.parent=this,this.sortDirty=!0,i.transform._parentID=-1,this.children.splice(t,0,i),this._boundsID++,this.onChildrenChange(t),i.emit("added",this),this.emit("childAdded",i,this,t),i}swapChildren(i,t){if(i===t)return;const e=this.getChildIndex(i),r=this.getChildIndex(t);this.children[e]=t,this.children[r]=i,this.onChildrenChange(e<r?e:r)}getChildIndex(i){const t=this.children.indexOf(i);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(i,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const e=this.getChildIndex(i);Zs(this.children,e,1),this.children.splice(t,0,i),this.onChildrenChange(t)}getChildAt(i){if(i<0||i>=this.children.length)throw new Error(`getChildAt: Index (${i}) does not exist.`);return this.children[i]}removeChild(...i){if(i.length>1)for(let t=0;t<i.length;t++)this.removeChild(i[t]);else{const t=i[0],e=this.children.indexOf(t);if(e===-1)return null;t.parent=null,t.transform._parentID=-1,Zs(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e)}return i[0]}removeChildAt(i){const t=this.getChildAt(i);return t.parent=null,t.transform._parentID=-1,Zs(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i),t}removeChildren(i=0,t=this.children.length){const e=i,r=t,n=r-e;let o;if(n>0&&n<=r){o=this.children.splice(e,n);for(let m=0;m<o.length;++m)o[m].parent=null,o[m].transform&&(o[m].transform._parentID=-1);this._boundsID++,this.onChildrenChange(i);for(let m=0;m<o.length;++m)o[m].emit("removed",this),this.emit("childRemoved",o[m],this,m);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let i=!1;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r._lastSortedIndex=t,!i&&r.zIndex!==0&&(i=!0)}i&&this.children.length>1&&this.children.sort(IA),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let i=0,t=this.children.length;i<t;++i){const e=this.children[i];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let i=0;i<this.children.length;i++){const t=this.children[i];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const e=t._mask.isMaskData?t._mask.maskObject:t._mask;e?(e.calculateBounds(),this._bounds.addBoundsMask(t._bounds,e._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(i,t=!1){const e=super.getLocalBounds(i);if(!t)for(let r=0,n=this.children.length;r<n;++r){const o=this.children[r];o.visible&&o.updateTransform()}return e}_calculateBounds(){}_renderWithCulling(i){const t=i.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let e,r;this.cullArea?(e=this.cullArea,r=this.worldTransform):this._render!==nd.prototype._render&&(e=this.getBounds(!0));const n=i.projection.transform;if(n&&(r?(r=PA.copyFrom(r),r.prepend(n)):r=n),e&&t.intersects(e,r))this._render(i);else if(this.cullArea)return;for(let o=0,m=this.children.length;o<m;++o){const a=this.children[o],s=a.cullable;a.cullable=s||!this.cullArea,a.render(i),a.cullable=s}}render(i){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(i);else if(this.cullable)this._renderWithCulling(i);else{this._render(i);for(let e=0,r=this.children.length;e<r;++e)this.children[e].render(i)}}renderAdvanced(i){var n,o,m;const t=this.filters,e=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let a=0;a<t.length;a++)t[a].enabled&&this._enabledFilters.push(t[a])}const r=t&&((n=this._enabledFilters)==null?void 0:n.length)||e&&(!e.isMaskData||e.enabled&&(e.autoDetect||e.type!==Ge.NONE));if(r&&i.batch.flush(),t&&((o=this._enabledFilters)!=null&&o.length)&&i.filter.push(this,this._enabledFilters),e&&i.mask.push(this,this._mask),this.cullable)this._renderWithCulling(i);else{this._render(i);for(let a=0,s=this.children.length;a<s;++a)this.children[a].render(i)}r&&i.batch.flush(),e&&i.mask.pop(this),t&&((m=this._enabledFilters)!=null&&m.length)&&i.filter.pop()}_render(i){}destroy(i){super.destroy(),this.sortDirty=!1;const t=typeof i=="boolean"?i:i==null?void 0:i.children,e=this.removeChildren(0,this.children.length);if(t)for(let r=0;r<e.length;++r)e[r].destroy(i)}get width(){return this.scale.x*this.getLocalBounds().width}set width(i){const t=this.getLocalBounds().width;t!==0?this.scale.x=i/t:this.scale.x=1,this._width=i}get height(){return this.scale.y*this.getLocalBounds().height}set height(i){const t=this.getLocalBounds().height;t!==0?this.scale.y=i/t:this.scale.y=1,this._height=i}};let Ri=nd;Ri.defaultSortableChildren=!1;Ri.prototype.containerUpdateTransform=Ri.prototype.updateTransform;Object.defineProperties(St,{SORTABLE_CHILDREN:{get(){return Ri.defaultSortableChildren},set(i){ee("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Ri.defaultSortableChildren=i}}});const Ua=new ne,MA=new Uint16Array([0,1,2,0,2,3]);let wl=class _1 extends Ri{constructor(t){super(),this._anchor=new _n(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new ue(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=Bt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||It.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=MA,this.pluginName="batch",this.isSprite=!0,this._roundPixels=St.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=vn(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=vn(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,o=e.c,m=e.d,a=e.tx,s=e.ty,h=this.vertexData,d=t.trim,l=t.orig,u=this._anchor;let c=0,f=0,v=0,p=0;if(d?(f=d.x-u._x*l.width,c=f+d.width,p=d.y-u._y*l.height,v=p+d.height):(f=-u._x*l.width,c=f+l.width,p=-u._y*l.height,v=p+l.height),h[0]=r*f+o*p+a,h[1]=m*p+n*f+s,h[2]=r*c+o*p+a,h[3]=m*p+n*c+s,h[4]=r*c+o*v+a,h[5]=m*v+n*c+s,h[6]=r*f+o*v+a,h[7]=m*v+n*f+s,this._roundPixels){const y=St.RESOLUTION;for(let b=0;b<h.length;++b)h[b]=Math.round(h[b]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,o=this.transform.worldTransform,m=o.a,a=o.b,s=o.c,h=o.d,d=o.tx,l=o.ty,u=-n._x*r.width,c=u+r.width,f=-n._y*r.height,v=f+r.height;e[0]=m*u+s*f+d,e[1]=h*f+a*u+l,e[2]=m*c+s*f+d,e[3]=h*f+a*c+l,e[4]=m*c+s*v+d,e[5]=h*v+a*c+l,e[6]=m*u+s*v+d,e[7]=h*v+a*u+l}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new nl),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Kt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Ua);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let o=0;return Ua.x>=n&&Ua.x<n+e&&(o=-r*this.anchor.y,Ua.y>=o&&Ua.y<o+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const r=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!r)}this._texture=null}static from(t,e){const r=t instanceof It?t:It.from(t,e);return new _1(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=vn(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=vn(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||It.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}};const y1=new Ce;Pe.prototype._cacheAsBitmap=!1;Pe.prototype._cacheData=null;Pe.prototype._cacheAsBitmapResolution=null;Pe.prototype._cacheAsBitmapMultisample=null;class OA{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Pe.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new OA),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});Pe.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Pe.prototype._initCachedDisplayObject=function(t){var u,c;if((u=this._cacheData)!=null&&u.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const r=this.getLocalBounds(null,!0).clone();if((c=this.filters)!=null&&c.length){const f=this.filters[0].padding;r.pad(f)}r.ceil(St.RESOLUTION);const n=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),m=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,s=as.create({width:r.width,height:r.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${is()}`;this._cacheData.textureCacheId=h,Gt.addToCache(s.baseTexture,h),It.addToCache(s,h);const d=this.transform.localTransform.copyTo(y1).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:s,clear:!0,transform:d,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(n,o,m),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const l=new wl(s);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(r.x/r.width),l.anchor.y=-(r.y/r.height),l.alpha=e,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=l.containsPoint.bind(l)};Pe.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Pe.prototype._initCachedDisplayObjectCanvas=function(t){var d;if((d=this._cacheData)!=null&&d.sprite)return;const e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const n=t.canvasContext.activeContext,o=t._projTransform;e.ceil(St.RESOLUTION);const m=as.create({width:e.width,height:e.height}),a=`cacheAsBitmap_${is()}`;this._cacheData.textureCacheId=a,Gt.addToCache(m.baseTexture,a),It.addToCache(m,a);const s=y1;this.transform.localTransform.copyTo(s),s.invert(),s.tx-=e.x,s.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:m,clear:!0,transform:s,skipUpdateTransform:!1}),t.canvasContext.activeContext=n,t._projTransform=o,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const h=new wl(m);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-(e.x/e.width),h.anchor.y=-(e.y/e.height),h.alpha=r,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)};Pe.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Pe.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Pe.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Gt.removeFromCache(this._cacheData.textureCacheId),It.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Pe.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};Pe.prototype.name=null;Ri.prototype.getChildByName=function(t,e){for(let r=0,n=this.children.length;r<n;r++)if(this.children[r].name===t)return this.children[r];if(e)for(let r=0,n=this.children.length;r<n;r++){const o=this.children[r];if(!o.getChildByName)continue;const m=o.getChildByName(t,!0);if(m)return m}return null};Pe.prototype.getGlobalPosition=function(t=new ne,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};var RA=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class DA extends ri{constructor(t=1){super(CA,RA,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const FA={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},LA=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function kA(i){const t=FA[i],e=t.length;let r=LA,n="";const o="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let m;for(let a=0;a<i;a++){let s=o.replace("%index%",a.toString());m=a,a>=e&&(m=i-a-1),s=s.replace("%value%",t[m].toString()),n+=s,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}const BA=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function NA(i,t){const e=Math.ceil(i/2);let r=BA,n="",o;t?o="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":o="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let m=0;m<i;m++){let a=o.replace("%index%",m.toString());a=a.replace("%sampleIndex%",`${m-(e-1)}.0`),n+=a,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}class sd extends ri{constructor(t,e=8,r=4,n=ri.defaultResolution,o=5){const m=NA(o,t),a=kA(o);super(m,a),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,n);else{const o=t.getFilterTexture(),m=t.renderer;let a=e,s=o;this.state.blend=!1,t.applyFilter(this,a,s,_r.CLEAR);for(let h=1;h<this.passes-1;h++){t.bindAndClear(a,_r.BLIT),this.uniforms.uSampler=s;const d=s;s=a,a=d,m.shader.bind(this),m.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,s,r,n),t.returnFilterTexture(o)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class UA extends ri{constructor(t=8,e=4,r=ri.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new sd(!0,t,e,r,n),this.blurYFilter=new sd(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const o=Math.abs(this.blurXFilter.strength),m=Math.abs(this.blurYFilter.strength);if(o&&m){const a=t.getFilterTexture();this.blurXFilter.apply(t,e,a,_r.CLEAR),this.blurYFilter.apply(t,a,r,n),t.returnFilterTexture(a)}else m?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var GA=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class ad extends ri{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(f1,GA,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,o]=ue.shared.setValue(t).toArray(),m=[r,0,0,0,0,0,n,0,0,0,0,0,o,0,0,0,0,0,1,0];this._loadMatrix(m,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),o=Math.sqrt,m=1/3,a=o(m),s=r+(1-r)*m,h=m*(1-r)-a*n,d=m*(1-r)+a*n,l=m*(1-r)+a*n,u=r+m*(1-r),c=m*(1-r)-a*n,f=m*(1-r)-a*n,v=m*(1-r)+a*n,p=r+m*(1-r),y=[s,h,d,0,0,l,u,c,0,0,f,v,p,0,0,0,0,0,1,0];this._loadMatrix(y,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),o=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(o,e)}saturate(t=0,e){const r=t*2/3+1,n=(r-1)*-.5,o=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(o,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,n,o){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const m=ue.shared,[a,s,h]=m.setValue(r).toArray(),[d,l,u]=m.setValue(n).toArray(),c=[.3,.59,.11,0,0,a,s,h,t,0,d,l,u,e,0,a-d,s-l,h-u,0,0];this._loadMatrix(c,o)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}ad.prototype.grayscale=ad.prototype.greyscale;var HA=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,WA=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class XA extends ri{constructor(t,e){const r=new Ce;t.renderable=!1,super(WA,HA,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new ne(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const o=this.maskSprite.worldTransform,m=Math.sqrt(o.a*o.a+o.b*o.b),a=Math.sqrt(o.c*o.c+o.d*o.d);m!==0&&a!==0&&(this.uniforms.rotation[0]=o.a/m,this.uniforms.rotation[1]=o.b/m,this.uniforms.rotation[2]=o.c/a,this.uniforms.rotation[3]=o.d/a),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var VA=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,zA=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class jA extends ri{constructor(){super(zA,VA)}}var YA=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class $A extends ri{constructor(t=.5,e=Math.random()){super(f1,YA,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const zm={AlphaFilter:DA,BlurFilter:UA,BlurFilterPass:sd,ColorMatrixFilter:ad,DisplacementFilter:XA,FXAAFilter:jA,NoiseFilter:$A};Object.entries(zm).forEach(([i,t])=>{Object.defineProperty(zm,i,{get(){return ee("7.1.0",`filters.${i} has moved to ${i}`),t}})});class KA{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(li.system.add(this.tickerUpdate,this,rs.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(li.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const pn=new KA;class uo{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=uo.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ne,this.page=new ne,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,o){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class sl extends uo{constructor(){super(...arguments),this.client=new ne,this.movement=new ne,this.offset=new ne,this.global=new ne,this.screen=new ne}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,o,m,a,s,h,d,l,u,c,f,v){throw new Error("Method not implemented.")}}class Qi extends sl{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ra extends sl{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}ra.DOM_DELTA_PIXEL=0;ra.DOM_DELTA_LINE=1;ra.DOM_DELTA_PAGE=2;const qA=2048,ZA=new ne,cf=new ne;class JA{constructor(t){this.dispatch=new ho,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,n)=>r.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){pn.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",o=this[n](this.rootTarget,this.rootTarget.eventMode,ZA.set(t,e),this.hitTestFn,this.hitPruneFn);return o&&o[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,o=r.length-1;n<o;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let o=r.length-1;o>=0;o--)n.forEach(m=>{t.currentTarget=r[o],this.notifyTarget(t,m)})}propagationPath(t){const e=[t];for(let r=0;r<qA&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,o,m=!1){let a=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(pn.pauseUpdate=!1),t.interactiveChildren&&t.children){const d=t.children;for(let l=d.length-1;l>=0;l--){const u=d[l],c=this.hitTestMoveRecursive(u,this._isInteractive(e)?e:u.eventMode,r,n,o,m||o(t,r));if(c){if(c.length>0&&!c[c.length-1].parent)continue;const f=t.isInteractive();(c.length>0||f)&&(f&&this._allInteractiveElements.push(t),c.push(t)),this._hitElements.length===0&&(this._hitElements=c),a=!0}}}const s=this._isInteractive(e),h=t.isInteractive();return h&&h&&this._allInteractiveElements.push(t),m||this._hitElements.length>0?null:a?this._hitElements:s&&!o(t,r)&&n(t,r)?h?[t]:[]:null}hitTestRecursive(t,e,r,n,o){if(this._interactivePrune(t)||o(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(pn.pauseUpdate=!1),t.interactiveChildren&&t.children){const s=t.children;for(let h=s.length-1;h>=0;h--){const d=s[h],l=this.hitTestRecursive(d,this._isInteractive(e)?e:d.eventMode,r,n,o);if(l){if(l.length>0&&!l[l.length-1].parent)continue;const u=t.isInteractive();return(l.length>0||u)&&l.push(t),l}}}const m=this._isInteractive(e),a=t.isInteractive();return m&&n(t,r)?a?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var r;if(t.hitArea&&(t.worldTransform.applyInverse(e,cf),!t.hitArea.contains(cf.x,cf.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((r=n.containsPoint)!=null&&r.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var o,m;e=e??t.type;const r=`on${e}`;(m=(o=t.currentTarget)[r])==null||m.call(o,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Qi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var s,h;if(!(t instanceof Qi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),o=this.findMountedTarget(n.overTargets);if(((s=n.overTargets)==null?void 0:s.length)>0&&o!==e.target){const d=t.type==="mousemove"?"mouseout":"pointerout",l=this.createPointerEvent(t,d,o);if(this.dispatchEvent(l,"pointerout"),r&&this.dispatchEvent(l,"mouseout"),!e.composedPath().includes(o)){const u=this.createPointerEvent(t,"pointerleave",o);for(u.eventPhase=u.AT_TARGET;u.target&&!e.composedPath().includes(u.target);)u.currentTarget=u.target,this.notifyTarget(u),r&&this.notifyTarget(u,"mouseleave"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}if(o!==e.target){const d=t.type==="mousemove"?"mouseover":"pointerover",l=this.clonePointerEvent(e,d);this.dispatchEvent(l,"pointerover"),r&&this.dispatchEvent(l,"mouseover");let u=o==null?void 0:o.parent;for(;u&&u!==this.rootTarget.parent&&u!==e.target;)u=u.parent;if(!u||u===this.rootTarget.parent){const f=this.clonePointerEvent(e,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==o&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),r&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(l)}const m=[],a=this.enableGlobalMoveEvents??!0;this.moveOnAll?m.push("pointermove"):this.dispatchEvent(e,"pointermove"),a&&m.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?m.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),a&&m.push("globaltouchmove")),r&&(this.moveOnAll?m.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),a&&m.push("globalmousemove"),this.cursor=(h=e.target)==null?void 0:h.cursor),m.length>0&&this.all(e,m),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var m;if(!(t instanceof Qi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(m=r.target)==null?void 0:m.cursor);const o=this.clonePointerEvent(r,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(o)}mapPointerOut(t){if(!(t instanceof Qi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),o=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(o),r&&this.dispatchEvent(o,"mouseout");const m=this.createPointerEvent(t,"pointerleave",n);for(m.eventPhase=m.AT_TARGET;m.target&&m.target!==this.rootTarget.parent;)m.currentTarget=m.target,this.notifyTarget(m),r&&this.notifyTarget(m,"mouseleave"),m.target=m.target.parent;e.overTargets=null,this.freeEvent(o),this.freeEvent(m)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Qi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const a=r.button===2;this.dispatchEvent(r,a?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),o=this.findMountedTarget(n.pressTargetsByButton[t.button]);let m=o;if(o&&!r.composedPath().includes(o)){let a=o;for(;a&&!r.composedPath().includes(a);){if(r.currentTarget=a,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const s=r.button===2;this.notifyTarget(r,s?"rightupoutside":"mouseupoutside")}a=a.parent}delete n.pressTargetsByButton[t.button],m=a}if(m){const a=this.clonePointerEvent(r,"click");a.target=m,a.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:a.target,timeStamp:e});const s=n.clicksByButton[t.button];if(s.target===a.target&&e-s.timeStamp<200?++s.clickCount:s.clickCount=1,s.target=a.target,s.timeStamp=e,a.detail=s.clickCount,a.pointerType==="mouse"){const h=a.button===2;this.dispatchEvent(a,h?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Qi)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let o=r;for(;o;)n.currentTarget=o,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),o=o.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof ra)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(Qi);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(ra);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(Qi);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Qi&&e instanceof Qi&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof sl&&e instanceof sl&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,o=r.length;n<o&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const QA=1,tP={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},od=class{constructor(i){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=i,this.rootBoundary=new JA(null),pn.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Qi(null),this.rootWheelEvent=new ra(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...od.defaultEventFeatures},{set:(t,e,r)=>(e==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=r),t[e]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(i){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e,od._defaultEventMode=i.eventMode??"auto",Object.assign(this.features,i.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(i){this.resolution=i}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(i){i=i||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===i)return;this.currentCursor=i;const e=this.cursorStyles[i];if(e)switch(typeof e){case"string":t&&(this.domElement.style.cursor=e);break;case"function":e(i);break;case"object":t&&Object.assign(this.domElement.style,e);break}else t&&typeof i=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,i)&&(this.domElement.style.cursor=i)}get pointer(){return this.rootPointerEvent}onPointerDown(i){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&i.pointerType==="touch"))return;const t=this.normalizeToPointerData(i);this.autoPreventDefault&&t[0].isNormalized&&(i.cancelable||!("cancelable"in i))&&i.preventDefault();for(let e=0,r=t.length;e<r;e++){const n=t[e],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(i){if(!this.features.move||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&i.pointerType==="touch"))return;pn.pointerMoved();const t=this.normalizeToPointerData(i);for(let e=0,r=t.length;e<r;e++){const n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(i){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&i.pointerType==="touch"))return;let t=i.target;i.composedPath&&i.composedPath().length>0&&(t=i.composedPath()[0]);const e=t!==this.domElement?"outside":"",r=this.normalizeToPointerData(i);for(let n=0,o=r.length;n<o;n++){const m=this.bootstrapEvent(this.rootPointerEvent,r[n]);m.type+=e,this.rootBoundary.mapEvent(m)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(i){if(!this.features.click||(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&i.pointerType==="touch"))return;const t=this.normalizeToPointerData(i);for(let e=0,r=t.length;e<r;e++){const n=this.bootstrapEvent(this.rootPointerEvent,t[e]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(i){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(i);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(i){this.removeEvents(),this.domElement=i,pn.domElement=i,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;pn.addTickerListener();const i=this.domElement.style;i&&(globalThis.navigator.msPointerEnabled?(i.msContentZooming="none",i.msTouchAction="none"):this.supportsPointerEvents&&(i.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;pn.removeTickerListener();const i=this.domElement.style;globalThis.navigator.msPointerEnabled?(i.msContentZooming="",i.msTouchAction=""):this.supportsPointerEvents&&(i.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(i,t,e){let r;this.domElement.parentElement?r=this.domElement.getBoundingClientRect():r={x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const n=1/this.resolution;i.x=(t-r.left)*(this.domElement.width/r.width)*n,i.y=(e-r.top)*(this.domElement.height/r.height)*n}normalizeToPointerData(i){const t=[];if(this.supportsTouchEvents&&i instanceof TouchEvent)for(let e=0,r=i.changedTouches.length;e<r;e++){const n=i.changedTouches[e];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=i.touches.length===1&&i.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=i.type,t.push(n)}else if(!globalThis.MouseEvent||i instanceof MouseEvent&&(!this.supportsPointerEvents||!(i instanceof globalThis.PointerEvent))){const e=i;typeof e.isPrimary>"u"&&(e.isPrimary=!0),typeof e.width>"u"&&(e.width=1),typeof e.height>"u"&&(e.height=1),typeof e.tiltX>"u"&&(e.tiltX=0),typeof e.tiltY>"u"&&(e.tiltY=0),typeof e.pointerType>"u"&&(e.pointerType="mouse"),typeof e.pointerId>"u"&&(e.pointerId=QA),typeof e.pressure>"u"&&(e.pressure=.5),typeof e.twist>"u"&&(e.twist=0),typeof e.tangentialPressure>"u"&&(e.tangentialPressure=0),e.isNormalized=!0,t.push(e)}else t.push(i);return t}normalizeWheelEvent(i){const t=this.rootWheelEvent;return this.transferMouseData(t,i),t.deltaX=i.deltaX,t.deltaY=i.deltaY,t.deltaZ=i.deltaZ,t.deltaMode=i.deltaMode,this.mapPositionToPoint(t.screen,i.clientX,i.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=i,t.type=i.type,t}bootstrapEvent(i,t){return i.originalEvent=null,i.nativeEvent=t,i.pointerId=t.pointerId,i.width=t.width,i.height=t.height,i.isPrimary=t.isPrimary,i.pointerType=t.pointerType,i.pressure=t.pressure,i.tangentialPressure=t.tangentialPressure,i.tiltX=t.tiltX,i.tiltY=t.tiltY,i.twist=t.twist,this.transferMouseData(i,t),this.mapPositionToPoint(i.screen,t.clientX,t.clientY),i.global.copyFrom(i.screen),i.offset.copyFrom(i.screen),i.isTrusted=t.isTrusted,i.type==="pointerleave"&&(i.type="pointerout"),i.type.startsWith("mouse")&&(i.type=i.type.replace("mouse","pointer")),i.type.startsWith("touch")&&(i.type=tP[i.type]||i.type),i}transferMouseData(i,t){i.isTrusted=t.isTrusted,i.srcElement=t.srcElement,i.timeStamp=performance.now(),i.type=t.type,i.altKey=t.altKey,i.button=t.button,i.buttons=t.buttons,i.client.x=t.clientX,i.client.y=t.clientY,i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.movement.x=t.movementX,i.movement.y=t.movementY,i.page.x=t.pageX,i.page.y=t.pageY,i.relatedTarget=null,i.shiftKey=t.shiftKey}};let so=od;so.extension={name:"events",type:[Ct.RendererSystem,Ct.CanvasRendererSystem]};so.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};Ot.add(so);function jm(i){return i==="dynamic"||i==="static"}const eP={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??jm(so.defaultEventMode)},set interactive(i){ee("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??so.defaultEventMode},set eventMode(i){this._internalInteractive=jm(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.on(i,t,n)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof uo))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};Pe.mixin(eP);const iP={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Pe.mixin(iP);const rP=9,wh=100,nP=0,sP=0,Ym=2,$m=1,aP=-1e3,oP=-1e3,hP=2;class x1{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Yr.tablet||Yr.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${wh}px`,e.style.height=`${wh}px`,e.style.position="absolute",e.style.top=`${nP}px`,e.style.left=`${sP}px`,e.style.zIndex=Ym.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${$m}px`,t.style.height=`${$m}px`,t.style.position="absolute",t.style.top=`${aP}px`,t.style.left=`${oP}px`,t.style.zIndex=hP.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(Yr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:o}=this.renderer.view.getBoundingClientRect(),{width:m,height:a,resolution:s}=this.renderer,h=n/m*s,d=o/a*s;let l=this.div;l.style.left=`${e}px`,l.style.top=`${r}px`,l.style.width=`${m}px`,l.style.height=`${a}px`;for(let u=0;u<this.children.length;u++){const c=this.children[u];if(c.renderId!==this.renderId)c._accessibleActive=!1,Zs(this.children,u,1),this.div.removeChild(c._accessibleDiv),this.pool.push(c._accessibleDiv),c._accessibleDiv=null,u--;else{l=c._accessibleDiv;let f=c.hitArea;const v=c.worldTransform;c.hitArea?(l.style.left=`${(v.tx+f.x*v.a)*h}px`,l.style.top=`${(v.ty+f.y*v.d)*d}px`,l.style.width=`${f.width*v.a*h}px`,l.style.height=`${f.height*v.d*d}px`):(f=c.getBounds(),this.capHitArea(f),l.style.left=`${f.x*h}px`,l.style.top=`${f.y*d}px`,l.style.width=`${f.width*h}px`,l.style.height=`${f.height*d}px`,l.title!==c.accessibleTitle&&c.accessibleTitle!==null&&(l.title=c.accessibleTitle),l.getAttribute("aria-label")!==c.accessibleHint&&c.accessibleHint!==null&&l.setAttribute("aria-label",c.accessibleHint)),(c.accessibleTitle!==l.title||c.tabIndex!==l.tabIndex)&&(l.title=c.accessibleTitle,l.tabIndex=c.tabIndex,this.debug&&this.updateDebugHTML(l))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${wh}px`,e.style.height=`${wh}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Ym.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,o=Object.assign(new uo(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(m=>n.dispatchEvent(o,m))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===rP&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}x1.extension={name:"accessibility",type:[Ct.RendererPlugin,Ct.CanvasRendererPlugin]};Ot.add(x1);const hd=class{constructor(i){this.stage=new Ri,i=Object.assign({forceCanvas:!1},i),this.renderer=xA(i),hd._plugins.forEach(t=>{t.init.call(this,i)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(i,t){const e=hd._plugins.slice(0);e.reverse(),e.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(i),this.renderer=null}};let Ud=hd;Ud._plugins=[];Ot.handleByList(Ct.Application,Ud._plugins);class b1{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:o}=this._resizeTo;e=n,r=o}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}b1.extension=Ct.Application;Ot.add(b1);const Km={loader:Ct.LoadParser,resolver:Ct.ResolveParser,cache:Ct.CacheParser,detection:Ct.DetectionParser};Ot.handle(Ct.Asset,i=>{const t=i.ref;Object.entries(Km).filter(([e])=>!!t[e]).forEach(([e,r])=>Ot.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Km).filter(e=>!!t[e]).forEach(e=>Ot.remove(t[e]))});class lP{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function fo(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function os(i,t){const e=i.split("?")[0],r=ci.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const $r=(i,t)=>(Array.isArray(i)||(i=[i]),t?i.map(e=>typeof e=="string"?t(e):e):i),ld=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i};function S1(i,t,e,r,n){const o=t[e];for(let m=0;m<o.length;m++){const a=o[m];e<t.length-1?S1(i.replace(r[e],a),t,e+1,r,n):n.push(i.replace(r[e],a))}}function cP(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(o=>{const m=o.substring(1,o.length-1).split(",");n.push(m)}),S1(i,n,0,e,r)}else r.push(i);return r}const al=i=>!Array.isArray(i);class uP{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=$r(t);let n;for(let a=0;a<this.parsers.length;a++){const s=this.parsers[a];if(s.test(e)){n=s.getCacheableAssets(r,e);break}}n||(n={},r.forEach(a=>{n[a]=e}));const o=Object.keys(n),m={cacheKeys:o,keys:r};if(r.forEach(a=>{this._cacheMap.set(a,m)}),o.forEach(a=>{this._cache.has(a)&&this._cache.get(a)!==e&&console.warn("[Cache] already has key:",a),this._cache.set(a,n[a])}),e instanceof It){const a=e;r.forEach(s=>{a.baseTexture!==It.EMPTY.baseTexture&&Gt.addToCache(a.baseTexture,s),It.addToCache(a,s)})}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Ga=new uP;class fP{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var m,a;let n=null,o=null;if(e.loadParser&&(o=this._parserHash[e.loadParser],o||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!o){for(let s=0;s<this.parsers.length;s++){const h=this.parsers[s];if(h.load&&((m=h.test)!=null&&m.call(h,t,e,this))){o=h;break}}if(!o)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await o.load(t,e,this),r.parser=o;for(let s=0;s<this.parsers.length;s++){const h=this.parsers[s];h.parse&&h.parse&&await((a=h.testParse)==null?void 0:a.call(h,n,e,this))&&(n=await h.parse(n,e,this)||n,r.parser=h)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},o=al(t),m=$r(t,h=>({src:h})),a=m.length,s=m.map(async h=>{const d=ci.toAbsolute(h.src);if(!n[h.src])try{this.promiseCache[d]||(this.promiseCache[d]=this._getLoadPromiseAndParser(d,h)),n[h.src]=await this.promiseCache[d].promise,e&&e(++r/a)}catch(l){throw delete this.promiseCache[d],delete n[h.src],new Error(`[Loader.load] Failed to load ${d}.
${l}`)}});return await Promise.all(s),o?n[m[0].src]:n}async unload(t){const r=$r(t,n=>({src:n})).map(async n=>{var a,s;const o=ci.toAbsolute(n.src),m=this.promiseCache[o];if(m){const h=await m.promise;(s=(a=m.parser)==null?void 0:a.unload)==null||s.call(a,h,n,this),delete this.promiseCache[o]}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var Er=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(Er||{});const dP=".json",gP="application/json",pP={extension:{type:Ct.LoadParser,priority:Er.Low},name:"loadJson",test(i){return fo(i,gP)||os(i,dP)},async load(i){return await(await St.ADAPTER.fetch(i)).json()}};Ot.add(pP);const mP=".txt",vP="text/plain",_P={name:"loadTxt",extension:{type:Ct.LoadParser,priority:Er.Low},test(i){return fo(i,vP)||os(i,mP)},async load(i){return await(await St.ADAPTER.fetch(i)).text()}};Ot.add(_P);const yP=["normal","bold","100","200","300","400","500","600","700","800","900"],xP=[".ttf",".otf",".woff",".woff2"],bP=["font/ttf","font/otf","font/woff","font/woff2"],SP=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function CP(i){const t=ci.extname(i),n=ci.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let o=n.length>0;for(const a of n)if(!a.match(SP)){o=!1;break}let m=n.join(" ");return o||(m=`"${m.replace(/[\\"]/g,"\\$&")}"`),m}const wP={extension:{type:Ct.LoadParser,priority:Er.Low},name:"loadWebFont",test(i){return fo(i,bP)||os(i,xP)},async load(i,t){var r,n,o;const e=St.ADAPTER.getFontFaceSet();if(e){const m=[],a=((r=t.data)==null?void 0:r.family)??CP(i),s=((o=(n=t.data)==null?void 0:n.weights)==null?void 0:o.filter(d=>yP.includes(d)))??["normal"],h=t.data??{};for(let d=0;d<s.length;d++){const l=s[d],u=new FontFace(a,`url(${encodeURI(i)})`,{...h,weight:l});await u.load(),e.add(u),m.push(u)}return m.length===1?m[0]:m}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>St.ADAPTER.getFontFaceSet().delete(t))}};Ot.add(wP);let qm=0,uf;const TP="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",EP={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${TP}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},AP={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let ff;class PP{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const e=URL.createObjectURL(new Blob([EP.code],{type:"application/javascript"})),r=new Worker(e);r.addEventListener("message",n=>{r.terminate(),URL.revokeObjectURL(e),t(n.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){uf===void 0&&(uf=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<uf&&(ff||(ff=URL.createObjectURL(new Blob([AP.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(ff),t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((n,o)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:o})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[qm]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:qm++,id:r})}}const Zm=new PP;function Tl(i,t,e){const r=new It(i);return r.baseTexture.on("dispose",()=>{delete t.promiseCache[e]}),r}const IP=[".jpeg",".jpg",".png",".webp",".avif"],MP=["image/jpeg","image/png","image/webp","image/avif"];async function OP(i){const t=await St.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const El={name:"loadTextures",extension:{type:Ct.LoadParser,priority:Er.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return fo(i,MP)||os(i,IP)},async load(i,t,e){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Zm.isImageBitmapSupported()?r=await Zm.loadImageBitmap(i):r=await OP(i):r=await new Promise(o=>{r=new Image,r.crossOrigin=this.config.crossOrigin,r.src=i,r.complete?o(r):r.onload=()=>{o(r)}});const n=new Gt(r,{resolution:bn(i),...t.data});return n.resource.src=i,Tl(n,e,i)},unload(i){i.destroy(!0)}};Ot.add(El);const RP=".svg",DP="image/svg+xml",FP={extension:{type:Ct.LoadParser,priority:Er.High},name:"loadSVG",test(i){return fo(i,DP)||os(i,RP)},async testParse(i){return no.test(i)},async parse(i,t,e){var m;const r=new no(i,(m=t==null?void 0:t.data)==null?void 0:m.resourceOptions);await r.load();const n=new Gt(r,{resolution:bn(i),...t==null?void 0:t.data});return n.resource.src=i,Tl(n,e,i)},async load(i,t){return(await St.ADAPTER.fetch(i)).text()},unload:El.unload};Ot.add(FP);class LP{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(n=>{if(typeof n.name=="string"){const o=this._createBundleAssetId(t,n.name);r.push(o),this.add([n.name,o],n.srcs,n.data)}else{const o=n.name.map(m=>this._createBundleAssetId(t,m));o.forEach(m=>{r.push(m)}),this.add([...n.name,...o],n.srcs)}}):Object.keys(e).forEach(n=>{r.push(this._createBundleAssetId(t,n)),this.add([n,this._createBundleAssetId(t,n)],e[n])}),this._bundles[t]=r}add(t,e,r){const n=$r(t);n.forEach(m=>{this.hasKey(m)&&console.warn(`[Resolver] already has key: ${m} overwriting`)}),Array.isArray(e)||(typeof e=="string"?e=cP(e):e=[e]);const o=e.map(m=>{let a=m;if(typeof m=="string"){let s=!1;for(let h=0;h<this._parsers.length;h++){const d=this._parsers[h];if(d.test(m)){a=d.parse(m),s=!0;break}}s||(a={src:m})}return a.format||(a.format=a.src.split(".").pop()),a.alias||(a.alias=n),(this._basePath||this._rootPath)&&(a.src=ci.toAbsolute(a.src,this._basePath,this._rootPath)),a.src=this._appendDefaultSearchParams(a.src),a.data=a.data??r,a});n.forEach(m=>{this._assetMap[m]=o})}resolveBundle(t){const e=al(t);t=$r(t);const r={};return t.forEach(n=>{const o=this._bundles[n];if(o){const m=this.resolve(o),a={};for(const s in m){const h=m[s];a[this._extractAssetIdFromBundle(n,s)]=h}r[n]=a}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=al(t);t=$r(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let o=this._assetMap[n];const m=this._getPreferredOrder(o),a=o[0];m==null||m.priority.forEach(s=>{m.params[s].forEach(h=>{const d=o.filter(l=>l[s]?l[s]===h:!1);d.length&&(o=d)})}),this._resolverHash[n]=o[0]??a}else{let o=n;(this._basePath||this._rootPath)&&(o=ci.toAbsolute(o,this._basePath,this._rootPath)),o=this._appendDefaultSearchParams(o),this._resolverHash[n]={src:o}}r[n]=this._resolverHash[n]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],n=this._preferredOrder.find(o=>o.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}}class kP{constructor(){this._detections=[],this._initialized=!1,this.resolver=new LP,this.loader=new fP,this.cache=Ga,this._backgroundLoader=new lP(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var o,m,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Asset.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let s=t.manifest;typeof s=="string"&&(s=await this.load(s)),this.resolver.addManifest(s)}const e=((o=t.texturePreference)==null?void 0:o.resolution)??1,r=typeof e=="number"?[e]:e;let n=[];if((m=t.texturePreference)!=null&&m.format){const s=(a=t.texturePreference)==null?void 0:a.format;n=typeof s=="string"?[s]:s;for(const h of this._detections)await h.test()||(n=await h.remove(n))}else for(const s of this._detections)await s.test()&&(n=await s.add(n));this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r){this.resolver.add(t,e,r)}async load(t,e){this._initialized||await this.init();const r=al(t),n=$r(t).map(a=>typeof a!="string"?(this.resolver.add(a.src,a),a.src):(this.resolver.hasKey(a)||this.resolver.add(a,a),a)),o=this.resolver.resolve(n),m=await this._mapLoadToResolve(o,e);return r?m[n[0]]:m}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),o={},m=Object.keys(n);let a=0,s=0;const h=()=>{e==null||e(++a/s)},d=m.map(l=>{const u=n[l];return s+=Object.keys(u).length,this._mapLoadToResolve(u,h).then(c=>{o[l]=c})});return await Promise.all(d),r?o[t[0]]:o}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Ga.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=Ga.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const o=await this.loader.load(r,e);this._backgroundLoader.active=!0;const m={};return r.forEach((a,s)=>{const h=o[a.src],d=[a.src];a.alias&&d.push(...a.alias),m[n[s]]=h,Ga.set(d,h)}),m}async unload(t){this._initialized||await this.init();const e=$r(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=$r(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{Ga.remove(r.src)}),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return El.config.preferWorkers}set preferWorkers(t){ee("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const Th=new kP;Ot.handleByList(Ct.LoadParser,Th.loader.parsers).handleByList(Ct.ResolveParser,Th.resolver.parsers).handleByList(Ct.CacheParser,Th.cache.parsers).handleByList(Ct.DetectionParser,Th.detections);const BP={extension:Ct.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof It),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,o)=>{e[r+(o===0?"":o+1)]=n})}),e}};Ot.add(BP);const NP={extension:{type:Ct.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",t=await St.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};Ot.add(NP);const UP={extension:{type:Ct.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const i="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=",t=await St.ADAPTER.fetch(i).then(e=>e.blob());return createImageBitmap(t).then(()=>!0,()=>!1)},add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};Ot.add(UP);const Jm=["png","jpg","jpeg"],GP={extension:{type:Ct.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Jm],remove:async i=>i.filter(t=>!Jm.includes(t))};Ot.add(GP);const HP={extension:Ct.ResolveParser,test:El.test,parse:i=>{var t;return{resolution:parseFloat(((t=St.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:i.split(".").pop(),src:i}}};Ot.add(HP);var Ii=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i))(Ii||{});const ol={[33776]:.5,[33777]:.5,[33778]:1,[33779]:1,[35916]:.5,[35917]:.5,[35918]:1,[35919]:1,[37488]:.5,[37489]:.5,[37490]:1,[37491]:1,[37492]:.5,[37496]:1,[37493]:.5,[37497]:1,[37494]:.5,[37495]:.5,[35840]:.5,[35842]:.5,[35841]:.25,[35843]:.25,[36196]:.5,[35986]:.5,[35986]:1,[34798]:1,[37808]:1};let Wr,Ws;function Qm(){Ws={s3tc:Wr.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Wr.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:Wr.getExtension("WEBGL_compressed_texture_etc"),etc1:Wr.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:Wr.getExtension("WEBGL_compressed_texture_pvrtc")||Wr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:Wr.getExtension("WEBGL_compressed_texture_atc"),astc:Wr.getExtension("WEBGL_compressed_texture_astc")}}const WP={extension:{type:Ct.DetectionParser,priority:2},test:async()=>{const t=St.ADAPTER.createCanvas().getContext("webgl");return t?(Wr=t,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{Ws||Qm();const t=[];for(const e in Ws)Ws[e]&&t.push(e);return[...t,...i]},remove:async i=>(Ws||Qm(),i.filter(t=>!(t in Ws)))};Ot.add(WP);class XP extends co{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;typeof t=="string"?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new Kf(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Kf(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Qn extends XP{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Qn._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Qn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let m=0,a=this.levels;m<a;m++){const{levelID:s,levelWidth:h,levelHeight:d,levelBuffer:l}=this._levelBuffers[m];n.compressedTexImage2D(n.TEXTURE_2D,s,this.format,h,d,0,l)}return!0}onBlobLoaded(){this._levelBuffers=Qn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,r,n,o,m,a){const s=new Array(r);let h=t.byteOffset,d=m,l=a,u=d+n-1&~(n-1),c=l+o-1&~(o-1),f=u*c*ol[e];for(let v=0;v<r;v++)s[v]={levelID:v,levelWidth:r>1?d:u,levelHeight:r>1?l:c,levelBuffer:new Uint8Array(t.buffer,h,f)},h+=f,d=d>>1||1,l=l>>1||1,u=d+n-1&~(n-1),c=l+o-1&~(o-1),f=u*c*ol[e];return s}}const df=4,Eh=124,VP=32,tv=20,zP=542327876,Ah={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},jP={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},Ph={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},YP=1,$P=2,KP=4,qP=64,ZP=512,JP=131072,QP=827611204,t6=861165636,e6=894720068,i6=808540228,r6=4,n6={[QP]:Ii.COMPRESSED_RGBA_S3TC_DXT1_EXT,[t6]:Ii.COMPRESSED_RGBA_S3TC_DXT3_EXT,[e6]:Ii.COMPRESSED_RGBA_S3TC_DXT5_EXT},s6={[70]:Ii.COMPRESSED_RGBA_S3TC_DXT1_EXT,[71]:Ii.COMPRESSED_RGBA_S3TC_DXT1_EXT,[73]:Ii.COMPRESSED_RGBA_S3TC_DXT3_EXT,[74]:Ii.COMPRESSED_RGBA_S3TC_DXT3_EXT,[76]:Ii.COMPRESSED_RGBA_S3TC_DXT5_EXT,[77]:Ii.COMPRESSED_RGBA_S3TC_DXT5_EXT,[72]:Ii.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,[75]:Ii.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,[78]:Ii.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};function a6(i){const t=new Uint32Array(i);if(t[0]!==zP)throw new Error("Invalid DDS file magic word");const r=new Uint32Array(i,0,Eh/Uint32Array.BYTES_PER_ELEMENT),n=r[Ah.HEIGHT],o=r[Ah.WIDTH],m=r[Ah.MIPMAP_COUNT],a=new Uint32Array(i,Ah.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,VP/Uint32Array.BYTES_PER_ELEMENT),s=a[YP];if(s&KP){const h=a[jP.FOURCC];if(h!==i6){const x=n6[h],S=df+Eh,w=new Uint8Array(i,S);return[new Qn(w,{format:x,width:o,height:n,levels:m})]}const d=df+Eh,l=new Uint32Array(t.buffer,d,tv/Uint32Array.BYTES_PER_ELEMENT),u=l[Ph.DXGI_FORMAT],c=l[Ph.RESOURCE_DIMENSION],f=l[Ph.MISC_FLAG],v=l[Ph.ARRAY_SIZE],p=s6[u];if(p===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(f===r6)throw new Error("DDSParser does not support cubemap textures");if(c===6)throw new Error("DDSParser does not supported 3D texture data");const y=new Array,b=df+Eh+tv;if(v===1)y.push(new Uint8Array(i,b));else{const x=ol[p];let S=0,w=o,E=n;for(let A=0;A<m;A++){const N=Math.max(1,w+3&-4),k=Math.max(1,E+3&-4),U=N*k*x;S+=U,w=w>>>1,E=E>>>1}let P=b;for(let A=0;A<v;A++)y.push(new Uint8Array(i,P,S)),P+=S}return y.map(x=>new Qn(x,{format:p,width:o,height:n,levels:m}))}throw s&qP?new Error("DDSParser does not support uncompressed texture data."):s&ZP?new Error("DDSParser does not supported YUV uncompressed texture data."):s&JP?new Error("DDSParser does not support single-channel (lumninance) texture data!"):s&$P?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const ev=[171,75,84,88,32,49,49,187,13,10,26,10],o6=67305985,Zi={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},cd=64,iv={[Rt.UNSIGNED_BYTE]:1,[Rt.UNSIGNED_SHORT]:2,[Rt.INT]:4,[Rt.UNSIGNED_INT]:4,[Rt.FLOAT]:4,[Rt.HALF_FLOAT]:8},h6={[yt.RGBA]:4,[yt.RGB]:3,[yt.RG]:2,[yt.RED]:1,[yt.LUMINANCE]:1,[yt.LUMINANCE_ALPHA]:2,[yt.ALPHA]:1},l6={[Rt.UNSIGNED_SHORT_4_4_4_4]:2,[Rt.UNSIGNED_SHORT_5_5_5_1]:2,[Rt.UNSIGNED_SHORT_5_6_5]:2};function c6(i,t,e=!1){const r=new DataView(t);if(!u6(i,r))return null;const n=r.getUint32(Zi.ENDIANNESS,!0)===o6,o=r.getUint32(Zi.GL_TYPE,n),m=r.getUint32(Zi.GL_FORMAT,n),a=r.getUint32(Zi.GL_INTERNAL_FORMAT,n),s=r.getUint32(Zi.PIXEL_WIDTH,n),h=r.getUint32(Zi.PIXEL_HEIGHT,n)||1,d=r.getUint32(Zi.PIXEL_DEPTH,n)||1,l=r.getUint32(Zi.NUMBER_OF_ARRAY_ELEMENTS,n)||1,u=r.getUint32(Zi.NUMBER_OF_FACES,n),c=r.getUint32(Zi.NUMBER_OF_MIPMAP_LEVELS,n),f=r.getUint32(Zi.BYTES_OF_KEY_VALUE_DATA,n);if(h===0||d!==1)throw new Error("Only 2D textures are supported");if(u!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(l!==1)throw new Error("WebGL does not support array textures");const v=4,p=4,y=s+3&-4,b=h+3&-4,x=new Array(l);let S=s*h;o===0&&(S=y*b);let w;if(o!==0?iv[o]?w=iv[o]*h6[m]:w=l6[o]:w=ol[a],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const E=e?d6(r,f,n):null;let A=S*w,N=s,k=h,U=y,j=b,X=cd+f;for(let W=0;W<c;W++){const Q=r.getUint32(X,n);let ot=X+4;for(let it=0;it<l;it++){let ct=x[it];ct||(ct=x[it]=new Array(c)),ct[W]={levelID:W,levelWidth:c>1||o!==0?N:U,levelHeight:c>1||o!==0?k:j,levelBuffer:new Uint8Array(t,ot,A)},ot+=A}X+=Q+4,X=X%4!==0?X+4-X%4:X,N=N>>1||1,k=k>>1||1,U=N+v-1&~(v-1),j=k+p-1&~(p-1),A=U*j*w}return o!==0?{uncompressed:x.map(W=>{let Q=W[0].levelBuffer,ot=!1;return o===Rt.FLOAT?Q=new Float32Array(W[0].levelBuffer.buffer,W[0].levelBuffer.byteOffset,W[0].levelBuffer.byteLength/4):o===Rt.UNSIGNED_INT?(ot=!0,Q=new Uint32Array(W[0].levelBuffer.buffer,W[0].levelBuffer.byteOffset,W[0].levelBuffer.byteLength/4)):o===Rt.INT&&(ot=!0,Q=new Int32Array(W[0].levelBuffer.buffer,W[0].levelBuffer.byteOffset,W[0].levelBuffer.byteLength/4)),{resource:new co(Q,{width:W[0].levelWidth,height:W[0].levelHeight}),type:o,format:ot?f6(m):m}}),kvData:E}:{compressed:x.map(W=>new Qn(null,{format:a,width:s,height:h,levels:c,levelBuffers:W})),kvData:E}}function u6(i,t){for(let e=0;e<ev.length;e++)if(t.getUint8(e)!==ev[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function f6(i){switch(i){case yt.RGBA:return yt.RGBA_INTEGER;case yt.RGB:return yt.RGB_INTEGER;case yt.RG:return yt.RG_INTEGER;case yt.RED:return yt.RED_INTEGER;default:return i}}function d6(i,t,e){const r=new Map;let n=0;for(;n<t;){const o=i.getUint32(cd+n,e),m=cd+n+4,a=3-(o+3)%4;if(o===0||o>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let s=0;for(;s<o&&i.getUint8(m+s)!==0;s++);if(s===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(i.buffer,m,s)),d=new DataView(i.buffer,m+s+1,o-s-1);r.set(h,d),n+=4+o+a}return r}const g6={extension:{type:Ct.LoadParser,priority:Er.High},name:"loadDDS",test(i){return os(i,".dds")},async load(i,t,e){const n=await(await St.ADAPTER.fetch(i)).arrayBuffer(),m=a6(n).map(a=>{const s=new Gt(a,{mipmap:Tr.OFF,alphaMode:cr.NO_PREMULTIPLIED_ALPHA,resolution:bn(i),...t.data});return Tl(s,e,i)});return m.length===1?m[0]:m},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};Ot.add(g6);const p6={extension:{type:Ct.LoadParser,priority:Er.High},name:"loadKTX",test(i){return os(i,".ktx")},async load(i,t,e){const n=await(await St.ADAPTER.fetch(i)).arrayBuffer(),{compressed:o,uncompressed:m,kvData:a}=c6(i,n),s=o??m,h={mipmap:Tr.OFF,alphaMode:cr.NO_PREMULTIPLIED_ALPHA,resolution:bn(i),...t.data},d=s.map(l=>{s===m&&Object.assign(h,{type:l.type,format:l.format});const u=new Gt(l,h);return u.ktxKeyValueData=a,Tl(u,e,i)});return d.length===1?d[0]:d},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};Ot.add(p6);const m6={extension:Ct.ResolveParser,test:i=>{const e=i.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:i=>{var r,n;if(i.split("?")[0].split(".").pop()==="ktx"){const o=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(o.some(m=>i.endsWith(m)))return{resolution:parseFloat(((r=St.RETINA_PREFIX.exec(i))==null?void 0:r[1])??"1"),format:o.find(m=>i.endsWith(m)),src:i}}return{resolution:parseFloat(((n=St.RETINA_PREFIX.exec(i))==null?void 0:n[1])??"1"),format:i.split(".").pop(),src:i}}};Ot.add(m6);const v6=new Kt,_6=4,ja=class{constructor(i){this.renderer=i}async image(i,t,e){const r=new Image;return r.src=await this.base64(i,t,e),r}async base64(i,t,e){const r=this.canvas(i);if(r.toBlob!==void 0)return new Promise((n,o)=>{r.toBlob(m=>{if(!m){o(new Error("ICanvas.toBlob failed!"));return}const a=new FileReader;a.onload=()=>n(a.result),a.onerror=o,a.readAsDataURL(m)},t,e)});if(r.toDataURL!==void 0)return r.toDataURL(t,e);if(r.convertToBlob!==void 0){const n=await r.convertToBlob({type:t,quality:e});return new Promise((o,m)=>{const a=new FileReader;a.onload=()=>o(a.result),a.onerror=m,a.readAsDataURL(n)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(i,t){const{pixels:e,width:r,height:n,flipY:o}=this._rawPixels(i,t);o&&ja._flipY(e,r,n),ja._unpremultiplyAlpha(e);const m=new h4(r,n,1),a=new ImageData(new Uint8ClampedArray(e.buffer),r,n);return m.context.putImageData(a,0,0),m.canvas}pixels(i,t){const{pixels:e,width:r,height:n,flipY:o}=this._rawPixels(i,t);return o&&ja._flipY(e,r,n),ja._unpremultiplyAlpha(e),e}_rawPixels(i,t){const e=this.renderer;if(!e)throw new Error("The Extract has already been destroyed");let r,n=!1,o,m=!1;if(i&&(i instanceof as?o=i:(o=e.generateTexture(i,{resolution:e.resolution,multisample:e.multisample}),m=!0)),o){if(r=o.baseTexture.resolution,t=t??o.frame,n=!1,!m){e.renderTexture.bind(o);const l=o.framebuffer.glFramebuffers[e.CONTEXT_UID];l.blitFramebuffer&&e.framebuffer.bind(l.blitFramebuffer)}}else r=e.resolution,t||(t=v6,t.width=e.width/r,t.height=e.height/r),n=!0,e.renderTexture.bind();const a=Math.round(t.width*r),s=Math.round(t.height*r),h=new Uint8Array(_6*a*s),d=e.gl;return d.readPixels(Math.round(t.x*r),Math.round(t.y*r),a,s,d.RGBA,d.UNSIGNED_BYTE,h),m&&(o==null||o.destroy(!0)),{pixels:h,width:a,height:s,flipY:n}}destroy(){this.renderer=null}static _flipY(i,t,e){const r=t<<2,n=e>>1,o=new Uint8Array(r);for(let m=0;m<n;m++){const a=m*r,s=(e-m-1)*r;o.set(i.subarray(a,a+r)),i.copyWithin(a,s,s+r),i.set(o,s)}}static _unpremultiplyAlpha(i){i instanceof Uint8ClampedArray&&(i=new Uint8Array(i.buffer));const t=i.length;for(let e=0;e<t;e+=4){const r=i[e+3];if(r!==0){const n=255.001/r;i[e]=i[e]*n+.5,i[e+1]=i[e+1]*n+.5,i[e+2]=i[e+2]*n+.5}}}};let C1=ja;C1.extension={name:"extract",type:Ct.RendererSystem};Ot.add(C1);const hl={build(i){const t=i.points;let e,r,n,o,m,a;if(i.type===ii.CIRC){const f=i.shape;e=f.x,r=f.y,m=a=f.radius,n=o=0}else if(i.type===ii.ELIP){const f=i.shape;e=f.x,r=f.y,m=f.width,a=f.height,n=o=0}else{const f=i.shape,v=f.width/2,p=f.height/2;e=f.x+v,r=f.y+p,m=a=Math.max(0,Math.min(f.radius,Math.min(v,p))),n=v-m,o=p-a}if(!(m>=0&&a>=0&&n>=0&&o>=0)){t.length=0;return}const s=Math.ceil(2.3*Math.sqrt(m+a)),h=s*8+(n?4:0)+(o?4:0);if(t.length=h,h===0)return;if(s===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=r+o,t[2]=t[4]=e-n,t[5]=t[7]=r-o;return}let d=0,l=s*4+(n?2:0)+2,u=l,c=h;{const f=n+m,v=o,p=e+f,y=e-f,b=r+v;if(t[d++]=p,t[d++]=b,t[--l]=b,t[--l]=y,o){const x=r-v;t[u++]=y,t[u++]=x,t[--c]=x,t[--c]=p}}for(let f=1;f<s;f++){const v=Math.PI/2*(f/s),p=n+Math.cos(v)*m,y=o+Math.sin(v)*a,b=e+p,x=e-p,S=r+y,w=r-y;t[d++]=b,t[d++]=S,t[--l]=S,t[--l]=x,t[u++]=x,t[u++]=w,t[--c]=w,t[--c]=b}{const f=n,v=o+a,p=e+f,y=e-f,b=r+v,x=r-v;t[d++]=p,t[d++]=b,t[--c]=x,t[--c]=p,n&&(t[d++]=y,t[d++]=b,t[--c]=x,t[--c]=y)}},triangulate(i,t){const e=i.points,r=t.points,n=t.indices;if(e.length===0)return;let o=r.length/2;const m=o;let a,s;if(i.type!==ii.RREC){const d=i.shape;a=d.x,s=d.y}else{const d=i.shape;a=d.x+d.width/2,s=d.y+d.height/2}const h=i.matrix;r.push(i.matrix?h.a*a+h.c*s+h.tx:a,i.matrix?h.b*a+h.d*s+h.ty:s),o++,r.push(e[0],e[1]);for(let d=2;d<e.length;d+=2)r.push(e[d],e[d+1]),n.push(o++,m,o);n.push(m+1,m,o)}};function rv(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let n=0,o=i[e-2],m=i[e-1];n<e;n+=2){const a=i[n],s=i[n+1];r+=(a-o)*(s+m),o=a,m=s}if(!t&&r>0||t&&r<=0){const n=e/2;for(let o=n+n%2;o<e;o+=2){const m=e-o-2,a=e-o-1,s=o,h=o+1;[i[m],i[s]]=[i[s],i[m]],[i[a],i[h]]=[i[h],i[a]]}}}const w1={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,n=t.points,o=t.indices;if(e.length>=6){rv(e,!1);const m=[];for(let h=0;h<r.length;h++){const d=r[h];rv(d.points,!0),m.push(e.length/2),e=e.concat(d.points)}const a=L3(e,m,2);if(!a)return;const s=n.length/2;for(let h=0;h<a.length;h+=3)o.push(a[h]+s),o.push(a[h+1]+s),o.push(a[h+2]+s);for(let h=0;h<e.length;h++)n.push(e[h])}}},y6={build(i){const t=i.shape,e=t.x,r=t.y,n=t.width,o=t.height,m=i.points;m.length=0,n>=0&&o>=0&&m.push(e,r,e+n,r,e+n,r+o,e,r+o)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},x6={build(i){hl.build(i)},triangulate(i,t){hl.triangulate(i,t)}};var ir=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(ir||{}),qn=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(qn||{});const na={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class nv{static curveTo(t,e,r,n,o,m){const a=m[m.length-2],h=m[m.length-1]-e,d=a-t,l=n-e,u=r-t,c=Math.abs(h*u-d*l);if(c<1e-8||o===0)return(m[m.length-2]!==t||m[m.length-1]!==e)&&m.push(t,e),null;const f=h*h+d*d,v=l*l+u*u,p=h*l+d*u,y=o*Math.sqrt(f)/c,b=o*Math.sqrt(v)/c,x=y*p/f,S=b*p/v,w=y*u+b*d,E=y*l+b*h,P=d*(b+x),A=h*(b+x),N=u*(y+S),k=l*(y+S),U=Math.atan2(A-E,P-w),j=Math.atan2(k-E,N-w);return{cx:w+t,cy:E+e,radius:o,startAngle:U,endAngle:j,anticlockwise:d*l>u*h}}static arc(t,e,r,n,o,m,a,s,h){const d=a-m,l=na._segmentsCount(Math.abs(d)*o,Math.ceil(Math.abs(d)/rl)*40),u=d/(l*2),c=u*2,f=Math.cos(u),v=Math.sin(u),p=l-1,y=p%1/p;for(let b=0;b<=p;++b){const x=b+y*b,S=u+m+c*x,w=Math.cos(S),E=-Math.sin(S);h.push((f*w+v*E)*o+r,(f*-E+v*w)*o+n)}}}class b6{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Gd{static curveLength(t,e,r,n,o,m,a,s){let d=0,l=0,u=0,c=0,f=0,v=0,p=0,y=0,b=0,x=0,S=0,w=t,E=e;for(let P=1;P<=10;++P)l=P/10,u=l*l,c=u*l,f=1-l,v=f*f,p=v*f,y=p*t+3*v*l*r+3*f*u*o+c*a,b=p*e+3*v*l*n+3*f*u*m+c*s,x=w-y,S=E-b,w=y,E=b,d+=Math.sqrt(x*x+S*S);return d}static curveTo(t,e,r,n,o,m,a){const s=a[a.length-2],h=a[a.length-1];a.length-=2;const d=na._segmentsCount(Gd.curveLength(s,h,t,e,r,n,o,m));let l=0,u=0,c=0,f=0,v=0;a.push(s,h);for(let p=1,y=0;p<=d;++p)y=p/d,l=1-y,u=l*l,c=u*l,f=y*y,v=f*y,a.push(c*s+3*u*y*t+3*l*f*r+v*o,c*h+3*u*y*e+3*l*f*n+v*m)}}function sv(i,t,e,r,n,o,m,a){const s=i-e*n,h=t-r*n,d=i+e*o,l=t+r*o;let u,c;m?(u=r,c=-e):(u=-r,c=e);const f=s+u,v=h+c,p=d+u,y=l+c;return a.push(f,v,p,y),2}function Hn(i,t,e,r,n,o,m,a){const s=e-i,h=r-t;let d=Math.atan2(s,h),l=Math.atan2(n-i,o-t);a&&d<l?d+=Math.PI*2:!a&&d>l&&(l+=Math.PI*2);let u=d;const c=l-d,f=Math.abs(c),v=Math.sqrt(s*s+h*h),p=(15*f*Math.sqrt(v)/Math.PI>>0)+1,y=c/p;if(u+=y,a){m.push(i,t,e,r);for(let b=1,x=u;b<p;b++,x+=y)m.push(i,t,i+Math.sin(x)*v,t+Math.cos(x)*v);m.push(i,t,n,o)}else{m.push(e,r,i,t);for(let b=1,x=u;b<p;b++,x+=y)m.push(i+Math.sin(x)*v,t+Math.cos(x)*v,i,t);m.push(n,o,i,t)}return p*2}function S6(i,t){const e=i.shape;let r=i.points||e.points.slice();const n=t.closePointEps;if(r.length===0)return;const o=i.lineStyle,m=new ne(r[0],r[1]),a=new ne(r[r.length-2],r[r.length-1]),s=e.type!==ii.POLY||e.closeStroke,h=Math.abs(m.x-a.x)<n&&Math.abs(m.y-a.y)<n;if(s){r=r.slice(),h&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const it=(m.x+a.x)*.5,ct=(a.y+m.y)*.5;r.unshift(it,ct),r.push(it,ct)}const d=t.points,l=r.length/2;let u=r.length;const c=d.length/2,f=o.width/2,v=f*f,p=o.miterLimit*o.miterLimit;let y=r[0],b=r[1],x=r[2],S=r[3],w=0,E=0,P=-(b-S),A=y-x,N=0,k=0,U=Math.sqrt(P*P+A*A);P/=U,A/=U,P*=f,A*=f;const j=o.alignment,X=(1-j)*2,W=j*2;s||(o.cap===qn.ROUND?u+=Hn(y-P*(X-W)*.5,b-A*(X-W)*.5,y-P*X,b-A*X,y+P*W,b+A*W,d,!0)+2:o.cap===qn.SQUARE&&(u+=sv(y,b,P,A,X,W,!0,d))),d.push(y-P*X,b-A*X,y+P*W,b+A*W);for(let it=1;it<l-1;++it){y=r[(it-1)*2],b=r[(it-1)*2+1],x=r[it*2],S=r[it*2+1],w=r[(it+1)*2],E=r[(it+1)*2+1],P=-(b-S),A=y-x,U=Math.sqrt(P*P+A*A),P/=U,A/=U,P*=f,A*=f,N=-(S-E),k=x-w,U=Math.sqrt(N*N+k*k),N/=U,k/=U,N*=f,k*=f;const ct=x-y,O=b-S,M=x-w,L=E-S,H=ct*M+O*L,Z=O*M-L*ct,G=Z<0;if(Math.abs(Z)<.001*Math.abs(H)){d.push(x-P*X,S-A*X,x+P*W,S+A*W),H>=0&&(o.join===ir.ROUND?u+=Hn(x,S,x-P*X,S-A*X,x-N*X,S-k*X,d,!1)+4:u+=2,d.push(x-N*W,S-k*W,x+N*X,S+k*X));continue}const F=(-P+y)*(-A+S)-(-P+x)*(-A+b),Y=(-N+w)*(-k+S)-(-N+x)*(-k+E),R=(ct*Y-M*F)/Z,z=(L*F-O*Y)/Z,$=(R-x)*(R-x)+(z-S)*(z-S),st=x+(R-x)*X,nt=S+(z-S)*X,ft=x-(R-x)*W,et=S-(z-S)*W,q=Math.min(ct*ct+O*O,M*M+L*L),rt=G?X:W,ut=q+rt*rt*v,at=$<=ut;let dt=o.join;if(dt===ir.MITER&&$/v>p&&(dt=ir.BEVEL),at)switch(dt){case ir.MITER:{d.push(st,nt,ft,et);break}case ir.BEVEL:{G?d.push(st,nt,x+P*W,S+A*W,st,nt,x+N*W,S+k*W):d.push(x-P*X,S-A*X,ft,et,x-N*X,S-k*X,ft,et),u+=2;break}case ir.ROUND:{G?(d.push(st,nt,x+P*W,S+A*W),u+=Hn(x,S,x+P*W,S+A*W,x+N*W,S+k*W,d,!0)+4,d.push(st,nt,x+N*W,S+k*W)):(d.push(x-P*X,S-A*X,ft,et),u+=Hn(x,S,x-P*X,S-A*X,x-N*X,S-k*X,d,!1)+4,d.push(x-N*X,S-k*X,ft,et));break}}else{switch(d.push(x-P*X,S-A*X,x+P*W,S+A*W),dt){case ir.MITER:{G?d.push(ft,et,ft,et):d.push(st,nt,st,nt),u+=2;break}case ir.ROUND:{G?u+=Hn(x,S,x+P*W,S+A*W,x+N*W,S+k*W,d,!0)+2:u+=Hn(x,S,x-P*X,S-A*X,x-N*X,S-k*X,d,!1)+2;break}}d.push(x-N*X,S-k*X,x+N*W,S+k*W),u+=2}}y=r[(l-2)*2],b=r[(l-2)*2+1],x=r[(l-1)*2],S=r[(l-1)*2+1],P=-(b-S),A=y-x,U=Math.sqrt(P*P+A*A),P/=U,A/=U,P*=f,A*=f,d.push(x-P*X,S-A*X,x+P*W,S+A*W),s||(o.cap===qn.ROUND?u+=Hn(x-P*(X-W)*.5,S-A*(X-W)*.5,x-P*X,S-A*X,x+P*W,S+A*W,d,!1)+2:o.cap===qn.SQUARE&&(u+=sv(x,S,P,A,X,W,!1,d)));const Q=t.indices,ot=na.epsilon*na.epsilon;for(let it=c;it<u+c-2;++it)y=d[it*2],b=d[it*2+1],x=d[(it+1)*2],S=d[(it+1)*2+1],w=d[(it+2)*2],E=d[(it+2)*2+1],!(Math.abs(y*(S-E)+x*(E-b)+w*(b-S))<ot)&&Q.push(it,it+1,it+2)}function C6(i,t){let e=0;const r=i.shape,n=i.points||r.points,o=r.type!==ii.POLY||r.closeStroke;if(n.length===0)return;const m=t.points,a=t.indices,s=n.length/2,h=m.length/2;let d=h;for(m.push(n[0],n[1]),e=1;e<s;e++)m.push(n[e*2],n[e*2+1]),a.push(d,d+1),d++;o&&a.push(d,h)}function av(i,t){i.lineStyle.native?C6(i,t):S6(i,t)}class Hd{static curveLength(t,e,r,n,o,m){const a=t-2*r+o,s=e-2*n+m,h=2*r-2*t,d=2*n-2*e,l=4*(a*a+s*s),u=4*(a*h+s*d),c=h*h+d*d,f=2*Math.sqrt(l+u+c),v=Math.sqrt(l),p=2*l*v,y=2*Math.sqrt(c),b=u/v;return(p*f+v*u*(f-y)+(4*c*l-u*u)*Math.log((2*v+b+f)/(b+y)))/(4*p)}static curveTo(t,e,r,n,o){const m=o[o.length-2],a=o[o.length-1],s=na._segmentsCount(Hd.curveLength(m,a,t,e,r,n));let h=0,d=0;for(let l=1;l<=s;++l){const u=l/s;h=m+(t-m)*u,d=a+(e-a)*u,o.push(h+(t+(r-t)*u-h)*u,d+(e+(n-e)*u-d)*u)}}}const gf={[ii.POLY]:w1,[ii.CIRC]:hl,[ii.ELIP]:hl,[ii.RECT]:y6,[ii.RREC]:x6},ov=[],Ih=[];class ll{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new ll(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ls=new ne,T1=class extends R_{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new nl,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let i=0;i<this.drawCalls.length;i++)this.drawCalls[i].texArray.clear(),Ih.push(this.drawCalls[i]);this.drawCalls.length=0;for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t.reset(),ov.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(i,t=null,e=null,r=null){const n=new ll(i,t,e,r);return this.graphicsData.push(n),this.dirty++,this}drawHole(i,t=null){if(!this.graphicsData.length)return null;const e=new ll(i,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return e.lineStyle=r.lineStyle,r.holes.push(e),this.dirty++,this}destroy(){super.destroy();for(let i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(i){const t=this.graphicsData;for(let e=0;e<t.length;++e){const r=t[e];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(i,Ls):Ls.copyFrom(i),r.shape.contains(Ls.x,Ls.y))){let n=!1;if(r.holes){for(let o=0;o<r.holes.length;o++)if(r.holes[o].shape.contains(Ls.x,Ls.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const i=this.uvs,t=this.graphicsData;let e=null,r=null;this.batches.length>0&&(e=this.batches[this.batches.length-1],r=e.style);for(let a=this.shapeIndex;a<t.length;a++){this.shapeIndex++;const s=t[a],h=s.fillStyle,d=s.lineStyle;gf[s.type].build(s),s.matrix&&this.transformPoints(s.points,s.matrix),(h.visible||d.visible)&&this.processHoles(s.holes);for(let u=0;u<2;u++){const c=u===0?h:d;if(!c.visible)continue;const f=c.texture.baseTexture,v=this.indices.length,p=this.points.length/2;f.wrapMode=yn.REPEAT,u===0?this.processFill(s):this.processLine(s);const y=this.points.length/2-p;y!==0&&(e&&!this._compareStyles(r,c)&&(e.end(v,p),e=null),e||(e=ov.pop()||new b6,e.begin(c,v,p),this.batches.push(e),r=c),this.addUvs(this.points,i,c.texture,p,y,c.matrix))}}const n=this.indices.length,o=this.points.length/2;if(e&&e.end(n,o),this.batches.length===0){this.batchable=!0;return}const m=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&m===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=m?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(i,t){return!(!i||!t||i.texture.baseTexture!==t.texture.baseTexture||i.color+i.alpha!==t.color+t.alpha||!!i.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let i=0,t=this.graphicsData.length;i<t;i++){const e=this.graphicsData[i],r=e.fillStyle,n=e.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const i=this.batches;for(let t=0,e=i.length;t<e;t++){const r=i[t];for(let n=0;n<r.size;n++){const o=r.start+n;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const i=this.batches;for(let t=0;t<i.length;t++)if(i[t].style.native)return!1;return this.points.length<T1.BATCHABLE_SIZE*2}buildDrawCalls(){let i=++Gt._globalBatch;for(let d=0;d<this.drawCalls.length;d++)this.drawCalls[d].texArray.clear(),Ih.push(this.drawCalls[d]);this.drawCalls.length=0;const t=this.colors,e=this.textureIds;let r=Ih.pop();r||(r=new Zf,r.texArray=new Qf),r.texArray.count=0,r.start=0,r.size=0,r.type=Sr.TRIANGLES;let n=0,o=null,m=0,a=!1,s=Sr.TRIANGLES,h=0;this.drawCalls.push(r);for(let d=0;d<this.batches.length;d++){const l=this.batches[d],u=8,c=l.style,f=c.texture.baseTexture;a!==!!c.native&&(a=!!c.native,s=a?Sr.LINES:Sr.TRIANGLES,o=null,n=u,i++),o!==f&&(o=f,f._batchEnabled!==i&&(n===u&&(i++,n=0,r.size>0&&(r=Ih.pop(),r||(r=new Zf,r.texArray=new Qf),this.drawCalls.push(r)),r.start=h,r.size=0,r.texArray.count=0,r.type=s),f.touched=1,f._batchEnabled=i,f._batchLocation=n,f.wrapMode=yn.REPEAT,r.texArray.elements[r.texArray.count++]=f,n++)),r.size+=l.size,h+=l.size,m=f._batchLocation,this.addColors(t,c.color,c.alpha,l.attribSize,l.attribStart),this.addTextureIds(e,m,l.attribSize,l.attribStart)}Gt._globalBatch=i,this.packAttributes()}packAttributes(){const i=this.points,t=this.uvs,e=this.colors,r=this.textureIds,n=new ArrayBuffer(i.length*3*4),o=new Float32Array(n),m=new Uint32Array(n);let a=0;for(let s=0;s<i.length/2;s++)o[a++]=i[s*2],o[a++]=i[s*2+1],o[a++]=t[s*2],o[a++]=t[s*2+1],m[a++]=e[s],o[a++]=r[s];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(i){i.holes.length?w1.triangulate(i,this):gf[i.type].triangulate(i,this)}processLine(i){av(i,this);for(let t=0;t<i.holes.length;t++)av(i.holes[t],this)}processHoles(i){for(let t=0;t<i.length;t++){const e=i[t];gf[e.type].build(e),e.matrix&&this.transformPoints(e.points,e.matrix)}}calculateBounds(){const i=this._bounds;i.clear(),i.addVertexData(this.points,0,this.points.length),i.pad(this.boundsPadding,this.boundsPadding)}transformPoints(i,t){for(let e=0;e<i.length/2;e++){const r=i[e*2],n=i[e*2+1];i[e*2]=t.a*r+t.c*n+t.tx,i[e*2+1]=t.b*r+t.d*n+t.ty}}addColors(i,t,e,r,n=0){const o=ue.shared.setValue(t).toLittleEndianNumber(),m=ue.shared.setValue(o).toPremultiplied(e);i.length=Math.max(i.length,n+r);for(let a=0;a<r;a++)i[n+a]=m}addTextureIds(i,t,e,r=0){i.length=Math.max(i.length,r+e);for(let n=0;n<e;n++)i[r+n]=t}addUvs(i,t,e,r,n,o=null){let m=0;const a=t.length,s=e.frame;for(;m<n;){let d=i[(r+m)*2],l=i[(r+m)*2+1];if(o){const u=o.a*d+o.c*l+o.tx;l=o.b*d+o.d*l+o.ty,d=u}m++,t.push(d/s.width,l/s.height)}const h=e.baseTexture;(s.width<h.width||s.height<h.height)&&this.adjustUvs(t,e,a,n)}adjustUvs(i,t,e,r){const n=t.baseTexture,o=1e-6,m=e+r*2,a=t.frame,s=a.width/n.width,h=a.height/n.height;let d=a.x/a.width,l=a.y/a.height,u=Math.floor(i[e]+o),c=Math.floor(i[e+1]+o);for(let f=e+2;f<m;f+=2)u=Math.min(u,Math.floor(i[f]+o)),c=Math.min(c,Math.floor(i[f+1]+o));d-=u,l-=c;for(let f=e;f<m;f+=2)i[f]=(i[f]+d)*s,i[f+1]=(i[f+1]+l)*h}};let E1=T1;E1.BATCHABLE_SIZE=100;class Al{constructor(){this.color=16777215,this.alpha=1,this.texture=It.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Al;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=It.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Wd extends Al{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=qn.BUTT,this.join=ir.MITER,this.miterLimit=10}clone(){const t=new Wd;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const pf={},Vh=class extends Ri{constructor(i=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Al,this._lineStyle=new Wd,this._matrix=null,this._holeMode=!1,this.state=Zr.for2d(),this._geometry=i||new E1,this._geometry.refCount++,this._transformID=-1,this._tintColor=new ue(16777215),this.blendMode=Bt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Vh(this._geometry)}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(i){this._tintColor.setValue(i)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(i=null,t=0,e,r=.5,n=!1){return typeof i=="number"&&(i={width:i,color:t,alpha:e,alignment:r,native:n}),this.lineTextureStyle(i)}lineTextureStyle(i){const t={width:0,texture:It.WHITE,color:i!=null&&i.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:qn.BUTT,join:ir.MITER,miterLimit:10};i=Object.assign(t,i),this.normalizeColor(i),this.currentPath&&this.startPoly();const e=i.width>0&&i.alpha>0;return e?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._lineStyle,{visible:e},i)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const i=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Js,this.currentPath.closeStroke=!1,this.currentPath.points.push(i[t-2],i[t-1]))}else this.currentPath=new Js,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(i,t){return this.startPoly(),this.currentPath.points[0]=i,this.currentPath.points[1]=t,this}lineTo(i,t){this.currentPath||this.moveTo(0,0);const e=this.currentPath.points,r=e[e.length-2],n=e[e.length-1];return(r!==i||n!==t)&&e.push(i,t),this}_initCurve(i=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[i,t]):this.moveTo(i,t)}quadraticCurveTo(i,t,e,r){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Hd.curveTo(i,t,e,r,n),this}bezierCurveTo(i,t,e,r,n,o){return this._initCurve(),Gd.curveTo(i,t,e,r,n,o,this.currentPath.points),this}arcTo(i,t,e,r,n){this._initCurve(i,t);const o=this.currentPath.points,m=nv.curveTo(i,t,e,r,n,o);if(m){const{cx:a,cy:s,radius:h,startAngle:d,endAngle:l,anticlockwise:u}=m;this.arc(a,s,h,d,l,u)}return this}arc(i,t,e,r,n,o=!1){if(r===n)return this;if(!o&&n<=r?n+=rl:o&&r<=n&&(r+=rl),n-r===0)return this;const a=i+Math.cos(r)*e,s=t+Math.sin(r)*e,h=this._geometry.closePointEps;let d=this.currentPath?this.currentPath.points:null;if(d){const l=Math.abs(d[d.length-2]-a),u=Math.abs(d[d.length-1]-s);l<h&&u<h||d.push(a,s)}else this.moveTo(a,s),d=this.currentPath.points;return nv.arc(a,s,i,t,e,r,n,o,d),this}beginFill(i=0,t){return this.beginTextureFill({texture:It.WHITE,color:i,alpha:t})}normalizeColor(i){const t=ue.shared.setValue(i.color??0);i.color=t.toNumber(),i.alpha??(i.alpha=t.alpha)}beginTextureFill(i){const t={texture:It.WHITE,color:16777215,matrix:null};i=Object.assign(t,i),this.normalizeColor(i),this.currentPath&&this.startPoly();const e=i.alpha>0;return e?(i.matrix&&(i.matrix=i.matrix.clone(),i.matrix.invert()),Object.assign(this._fillStyle,{visible:e},i)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(i,t,e,r){return this.drawShape(new Kt(i,t,e,r))}drawRoundedRect(i,t,e,r,n){return this.drawShape(new kd(i,t,e,r,n))}drawCircle(i,t,e){return this.drawShape(new C4(i,t,e))}drawEllipse(i,t,e,r){return this.drawShape(new w4(i,t,e,r))}drawPolygon(...i){let t,e=!0;const r=i[0];r.points?(e=r.closeStroke,t=r.points):Array.isArray(i[0])?t=i[0]:t=i;const n=new Js(t);return n.closeStroke=e,this.drawShape(n),this}drawShape(i){return this._holeMode?this._geometry.drawHole(i,this._matrix):this._geometry.drawShape(i,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const i=this._geometry.graphicsData;return i.length===1&&i[0].shape.type===ii.RECT&&!i[0].matrix&&!i[0].holes.length&&!(i[0].lineStyle.visible&&i[0].lineStyle.width)}_render(i){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(i)):(i.batch.flush(),this._renderDirect(i))}_populateBatches(){const i=this._geometry,t=this.blendMode,e=i.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=i.batchDirty,this.batches.length=e,this.vertexData=new Float32Array(i.points);for(let r=0;r<e;r++){const n=i.batches[r],o=n.style.color,m=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),a=new Float32Array(i.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),s=new Uint16Array(i.indicesUint16.buffer,n.start*2,n.size),h={vertexData:m,blendMode:t,indices:s,uvs:a,_batchRGB:ue.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=h}}_renderBatched(i){if(this.batches.length){i.batch.setObjectRenderer(i.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,e=this.batches.length;t<e;t++){const r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,i.plugins[this.pluginName].render(r)}}}_renderDirect(i){const t=this._resolveDirectShader(i),e=this._geometry,r=this.worldAlpha,n=t.uniforms,o=e.drawCalls;n.translationMatrix=this.transform.worldTransform,ue.shared.setValue(this._tintColor).premultiply(r).toArray(n.tint),i.shader.bind(t),i.geometry.bind(e,t),i.state.set(this.state);for(let m=0,a=o.length;m<a;m++)this._renderDrawCallDirect(i,e.drawCalls[m])}_renderDrawCallDirect(i,t){const{texArray:e,type:r,size:n,start:o}=t,m=e.count;for(let a=0;a<m;a++)i.texture.bind(e.elements[a],a);i.geometry.draw(r,n,o)}_resolveDirectShader(i){let t=this.shader;const e=this.pluginName;if(!t){if(!pf[e]){const{maxTextures:r}=i.plugins[e],n=new Int32Array(r);for(let a=0;a<r;a++)n[a]=a;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new Ce,default:hr.from({uSamplers:n},!0)},m=i.plugins[e]._shader.program;pf[e]=new wr(m,o)}t=pf[e]}return t}_calculateBounds(){this.finishPoly();const i=this._geometry;if(!i.graphicsData.length)return;const{minX:t,minY:e,maxX:r,maxY:n}=i.bounds;this._bounds.addFrame(this.transform,t,e,r,n)}containsPoint(i){return this.worldTransform.applyInverse(i,Vh._TEMP_POINT),this._geometry.containsPoint(Vh._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let i=0;i<this.batches.length;i++){const t=this.batches[i];t._tintRGB=ue.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const i=this.transform._worldID;if(this._transformID===i)return;this._transformID=i;const t=this.transform.worldTransform,e=t.a,r=t.b,n=t.c,o=t.d,m=t.tx,a=t.ty,s=this._geometry.points,h=this.vertexData;let d=0;for(let l=0;l<s.length;l+=2){const u=s[l],c=s[l+1];h[d++]=e*u+n*c+m,h[d++]=o*c+r*u+a}}closePath(){const i=this.currentPath;return i&&(i.closeStroke=!0,this.finishPoly()),this}setMatrix(i){return this._matrix=i,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(i){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(i)}};let go=Vh;go.curves=na;go._TEMP_POINT=new ne;class w6{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const mf=new ne,hv=new Js,A1=class extends Ri{constructor(i,t,e,r=Sr.TRIANGLES){super(),this.geometry=i,this.shader=t,this.state=e||Zr.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=St.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(i){this._geometry!==i&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=i,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(i){this.shader=i}get material(){return this.shader}set blendMode(i){this.state.blendMode=i}get blendMode(){return this.state.blendMode}set roundPixels(i){this._roundPixels!==i&&(this._transformID=-1),this._roundPixels=i}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(i){this.shader.tint=i}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(i){this.shader.texture=i}_render(i){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===Sr.TRIANGLES&&t.length<A1.BATCHABLE_SIZE*2?this._renderToBatch(i):this._renderDefault(i)}_renderDefault(i){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),i.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),i.shader.bind(t),i.state.set(this.state),i.geometry.bind(this.geometry,t),i.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(i){const t=this.geometry,e=this.shader;e.uvMatrix&&(e.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=e._tintRGB,this._texture=e.texture;const r=this.material.pluginName;i.batch.setObjectRenderer(i.plugins[r]),i.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,o=n.a,m=n.b,a=n.c,s=n.d,h=n.tx,d=n.ty,l=this.vertexData;for(let u=0;u<l.length/2;u++){const c=e[u*2],f=e[u*2+1];l[u*2]=o*c+a*f+h,l[u*2+1]=m*c+s*f+d}if(this._roundPixels){const u=St.RESOLUTION;for(let c=0;c<l.length;++c)l[c]=Math.round(l[c]*u)/u}this.vertexDirty=r}calculateUvs(){const i=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=i.data:(this.batchUvs||(this.batchUvs=new w6(i,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(i){if(!this.getBounds().contains(i.x,i.y))return!1;this.worldTransform.applyInverse(i,mf);const t=this.geometry.getBuffer("aVertexPosition").data,e=hv.points,r=this.geometry.getIndex().data,n=r.length,o=this.drawMode===4?3:1;for(let m=0;m+2<n;m+=o){const a=r[m]*2,s=r[m+1]*2,h=r[m+2]*2;if(e[0]=t[a],e[1]=t[a+1],e[2]=t[s],e[3]=t[s+1],e[4]=t[h],e[5]=t[h+1],hv.contains(mf.x,mf.y))return!0}return!1}destroy(i){super.destroy(i),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let ud=A1;ud.BATCHABLE_SIZE=100;class T6 extends Sn{constructor(t,e,r){super();const n=new We(t),o=new We(e,!0),m=new We(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,Rt.FLOAT).addAttribute("aTextureCoord",o,2,!1,Rt.FLOAT).addIndex(m),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var E6=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,A6=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class lv extends wr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:Ce.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||sr.from(A6,E6),r),this._colorDirty=!1,this.uvMatrix=new q_(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new ue(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;ue.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class cv{constructor(t,e,r){this.geometry=new Sn,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let o=t[n];o={attributeName:o.attributeName,size:o.size,uploadFunction:o.uploadFunction,type:o.type||Rt.FLOAT,offset:o.offset},e[n]?this.dynamicProperties.push(o):this.staticProperties.push(o)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new We(a4(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let m=0;m<this.dynamicProperties.length;++m){const a=this.dynamicProperties[m];a.offset=e,e+=a.size,this.dynamicStride+=a.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new We(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let m=0;m<this.staticProperties.length;++m){const a=this.staticProperties[m];a.offset=n,n+=a.size,this.staticStride+=a.size}const o=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(o),this.staticDataUint32=new Uint32Array(o),this.staticBuffer=new We(this.staticData,!0,!1);for(let m=0;m<this.dynamicProperties.length;++m){const a=this.dynamicProperties[m];t.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===Rt.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let m=0;m<this.staticProperties.length;++m){const a=this.staticProperties[m];t.addAttribute(a.attributeName,this.staticBuffer,0,a.type===Rt.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const o=this.dynamicProperties[n];o.uploadFunction(t,e,r,o.type===Rt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,o.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const o=this.staticProperties[n];o.uploadFunction(t,e,r,o.type===Rt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,o.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var P6=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,I6=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class P1 extends yl{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new Ce,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Rt.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=wr.from(I6,P6,{}),this.state=Zr.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,o=this.renderer;let m=e.length;if(m===0)return;m>r&&!t.autoResize&&(m=r);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const s=e[0]._texture.baseTexture,h=s.alphaMode>0;this.state.blendMode=A_(t.blendMode,h),o.state.set(this.state);const d=o.gl,l=t.worldTransform.copyTo(this.tempMatrix);l.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=l.toArray(!0),this.shader.uniforms.uColor=ue.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=s,this.renderer.shader.bind(this.shader);let u=!1;for(let c=0,f=0;c<m;c+=n,f+=1){let v=m-c;v>n&&(v=n),f>=a.length&&a.push(this._generateOneMoreBuffer(t));const p=a[f];p.uploadDynamic(e,c,v);const y=t._bufferUpdateIDs[f]||0;u=u||p._updateID<y,u&&(p._updateID=t._updateID,p.uploadStatic(e,c,v)),o.geometry.bind(p.geometry),d.drawElements(d.TRIANGLES,v*6,d.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,o=t._properties;for(let m=0;m<r;m+=n)e.push(new cv(this.properties,o,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new cv(this.properties,r,e)}uploadVertices(t,e,r,n,o,m){let a=0,s=0,h=0,d=0;for(let l=0;l<r;++l){const u=t[e+l],c=u._texture,f=u.scale.x,v=u.scale.y,p=c.trim,y=c.orig;p?(s=p.x-u.anchor.x*y.width,a=s+p.width,d=p.y-u.anchor.y*y.height,h=d+p.height):(a=y.width*(1-u.anchor.x),s=y.width*-u.anchor.x,h=y.height*(1-u.anchor.y),d=y.height*-u.anchor.y),n[m]=s*f,n[m+1]=d*v,n[m+o]=a*f,n[m+o+1]=d*v,n[m+o*2]=a*f,n[m+o*2+1]=h*v,n[m+o*3]=s*f,n[m+o*3+1]=h*v,m+=o*4}}uploadPosition(t,e,r,n,o,m){for(let a=0;a<r;a++){const s=t[e+a].position;n[m]=s.x,n[m+1]=s.y,n[m+o]=s.x,n[m+o+1]=s.y,n[m+o*2]=s.x,n[m+o*2+1]=s.y,n[m+o*3]=s.x,n[m+o*3+1]=s.y,m+=o*4}}uploadRotation(t,e,r,n,o,m){for(let a=0;a<r;a++){const s=t[e+a].rotation;n[m]=s,n[m+o]=s,n[m+o*2]=s,n[m+o*3]=s,m+=o*4}}uploadUvs(t,e,r,n,o,m){for(let a=0;a<r;++a){const s=t[e+a]._texture._uvs;s?(n[m]=s.x0,n[m+1]=s.y0,n[m+o]=s.x1,n[m+o+1]=s.y1,n[m+o*2]=s.x2,n[m+o*2+1]=s.y2,n[m+o*3]=s.x3,n[m+o*3+1]=s.y3,m+=o*4):(n[m]=0,n[m+1]=0,n[m+o]=0,n[m+o+1]=0,n[m+o*2]=0,n[m+o*2+1]=0,n[m+o*3]=0,n[m+o*3+1]=0,m+=o*4)}}uploadTint(t,e,r,n,o,m){for(let a=0;a<r;++a){const s=t[e+a],h=ue.shared.setValue(s._tintRGB).toPremultiplied(s.alpha,s.texture.baseTexture.alphaMode>0);n[m]=h,n[m+o]=h,n[m+o*2]=h,n[m+o*3]=h,m+=o*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}P1.extension={name:"particle",type:Ct.RendererPlugin};Ot.add(P1);var Pl=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(Pl||{});const Mh={willReadFrequently:!0},Pt=class{static get experimentalLetterSpacingSupported(){let i=Pt._experimentalLetterSpacingSupported;if(i!==void 0){const t=St.ADAPTER.getCanvasRenderingContext2D().prototype;i=Pt._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return i}constructor(i,t,e,r,n,o,m,a,s){this.text=i,this.style=t,this.width=e,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=m,this.maxLineWidth=a,this.fontProperties=s}static measureText(i,t,e,r=Pt._canvas){e=e??t.wordWrap;const n=t.toFontString(),o=Pt.measureFont(n);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const m=r.getContext("2d",Mh);m.font=n;const s=(e?Pt.wordWrap(i,t,r):i).split(/(?:\r\n|\r|\n)/),h=new Array(s.length);let d=0;for(let f=0;f<s.length;f++){const v=Pt._measureText(s[f],t.letterSpacing,m);h[f]=v,d=Math.max(d,v)}let l=d+t.strokeThickness;t.dropShadow&&(l+=t.dropShadowDistance);const u=t.lineHeight||o.fontSize+t.strokeThickness;let c=Math.max(u,o.fontSize+t.strokeThickness*2)+(s.length-1)*(u+t.leading);return t.dropShadow&&(c+=t.dropShadowDistance),new Pt(i,t,l,c,s,h,u+t.leading,d,o)}static _measureText(i,t,e){let r=!1;Pt.experimentalLetterSpacingSupported&&(Pt.experimentalLetterSpacing?(e.letterSpacing=`${t}px`,e.textLetterSpacing=`${t}px`,r=!0):(e.letterSpacing="0px",e.textLetterSpacing="0px"));let n=e.measureText(i).width;return n>0&&(r?n-=t:n+=(Pt.graphemeSegmenter(i).length-1)*t),n}static wordWrap(i,t,e=Pt._canvas){const r=e.getContext("2d",Mh);let n=0,o="",m="";const a=Object.create(null),{letterSpacing:s,whiteSpace:h}=t,d=Pt.collapseSpaces(h),l=Pt.collapseNewlines(h);let u=!d;const c=t.wordWrapWidth+s,f=Pt.tokenize(i);for(let v=0;v<f.length;v++){let p=f[v];if(Pt.isNewline(p)){if(!l){m+=Pt.addLine(o),u=!d,o="",n=0;continue}p=" "}if(d){const b=Pt.isBreakingSpace(p),x=Pt.isBreakingSpace(o[o.length-1]);if(b&&x)continue}const y=Pt.getFromCache(p,s,a,r);if(y>c)if(o!==""&&(m+=Pt.addLine(o),o="",n=0),Pt.canBreakWords(p,t.breakWords)){const b=Pt.wordWrapSplit(p);for(let x=0;x<b.length;x++){let S=b[x],w=S,E=1;for(;b[x+E];){const A=b[x+E];if(!Pt.canBreakChars(w,A,p,x,t.breakWords))S+=A;else break;w=A,E++}x+=E-1;const P=Pt.getFromCache(S,s,a,r);P+n>c&&(m+=Pt.addLine(o),u=!1,o="",n=0),o+=S,n+=P}}else{o.length>0&&(m+=Pt.addLine(o),o="",n=0);const b=v===f.length-1;m+=Pt.addLine(p,!b),u=!1,o="",n=0}else y+n>c&&(u=!1,m+=Pt.addLine(o),o="",n=0),(o.length>0||!Pt.isBreakingSpace(p)||u)&&(o+=p,n+=y)}return m+=Pt.addLine(o,!1),m}static addLine(i,t=!0){return i=Pt.trimRight(i),i=t?`${i}
`:i,i}static getFromCache(i,t,e,r){let n=e[i];return typeof n!="number"&&(n=Pt._measureText(i,t,r)+t,e[i]=n),n}static collapseSpaces(i){return i==="normal"||i==="pre-line"}static collapseNewlines(i){return i==="normal"}static trimRight(i){if(typeof i!="string")return"";for(let t=i.length-1;t>=0;t--){const e=i[t];if(!Pt.isBreakingSpace(e))break;i=i.slice(0,-1)}return i}static isNewline(i){return typeof i!="string"?!1:Pt._newlines.includes(i.charCodeAt(0))}static isBreakingSpace(i,t){return typeof i!="string"?!1:Pt._breakingSpaces.includes(i.charCodeAt(0))}static tokenize(i){const t=[];let e="";if(typeof i!="string")return t;for(let r=0;r<i.length;r++){const n=i[r],o=i[r+1];if(Pt.isBreakingSpace(n,o)||Pt.isNewline(n)){e!==""&&(t.push(e),e=""),t.push(n);continue}e+=n}return e!==""&&t.push(e),t}static canBreakWords(i,t){return t}static canBreakChars(i,t,e,r,n){return!0}static wordWrapSplit(i){return Pt.graphemeSegmenter(i)}static measureFont(i){if(Pt._fonts[i])return Pt._fonts[i];const t={ascent:0,descent:0,fontSize:0},e=Pt._canvas,r=Pt._context;r.font=i;const n=Pt.METRICS_STRING+Pt.BASELINE_SYMBOL,o=Math.ceil(r.measureText(n).width);let m=Math.ceil(r.measureText(Pt.BASELINE_SYMBOL).width);const a=Math.ceil(Pt.HEIGHT_MULTIPLIER*m);if(m=m*Pt.BASELINE_MULTIPLIER|0,o===0||a===0)return Pt._fonts[i]=t,t;e.width=o,e.height=a,r.fillStyle="#f00",r.fillRect(0,0,o,a),r.font=i,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(n,0,m);const s=r.getImageData(0,0,o,a).data,h=s.length,d=o*4;let l=0,u=0,c=!1;for(l=0;l<m;++l){for(let f=0;f<d;f+=4)if(s[u+f]!==255){c=!0;break}if(!c)u+=d;else break}for(t.ascent=m-l,u=h-d,c=!1,l=a;l>m;--l){for(let f=0;f<d;f+=4)if(s[u+f]!==255){c=!0;break}if(!c)u-=d;else break}return t.descent=l-m,t.fontSize=t.ascent+t.descent,Pt._fonts[i]=t,t}static clearMetrics(i=""){i?delete Pt._fonts[i]:Pt._fonts={}}static get _canvas(){if(!Pt.__canvas){let i;try{const t=new OffscreenCanvas(0,0),e=t.getContext("2d",Mh);if(e!=null&&e.measureText)return Pt.__canvas=t,t;i=St.ADAPTER.createCanvas()}catch{i=St.ADAPTER.createCanvas()}i.width=i.height=10,Pt.__canvas=i}return Pt.__canvas}static get _context(){return Pt.__context||(Pt.__context=Pt._canvas.getContext("2d",Mh)),Pt.__context}};let ei=Pt;ei.METRICS_STRING="|ÉqÅ";ei.BASELINE_SYMBOL="M";ei.BASELINE_MULTIPLIER=1.4;ei.HEIGHT_MULTIPLIER=2;ei.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})();ei.experimentalLetterSpacing=!1;ei._fonts={};ei._newlines=[10,13];ei._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const M6=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Ya=class{constructor(i){this.styleID=0,this.reset(),_f(this,i,i)}clone(){const i={};return _f(i,this,Ya.defaultStyle),new Ya(i)}reset(){_f(this,Ya.defaultStyle,Ya.defaultStyle)}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(i){this._breakWords!==i&&(this._breakWords=i,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(i){this._dropShadow!==i&&(this._dropShadow=i,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(i){this._dropShadowAlpha!==i&&(this._dropShadowAlpha=i,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(i){this._dropShadowAngle!==i&&(this._dropShadowAngle=i,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(i){this._dropShadowBlur!==i&&(this._dropShadowBlur=i,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(i){const t=vf(i);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(i){this._dropShadowDistance!==i&&(this._dropShadowDistance=i,this.styleID++)}get fill(){return this._fill}set fill(i){const t=vf(i);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(i){this._fillGradientType!==i&&(this._fillGradientType=i,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(i){O6(this._fillGradientStops,i)||(this._fillGradientStops=i,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(i){this.fontFamily!==i&&(this._fontFamily=i,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(i){this._fontStyle!==i&&(this._fontStyle=i,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(i){this._fontVariant!==i&&(this._fontVariant=i,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(i){this._fontWeight!==i&&(this._fontWeight=i,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(i){this._lineHeight!==i&&(this._lineHeight=i,this.styleID++)}get leading(){return this._leading}set leading(i){this._leading!==i&&(this._leading=i,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(i){this._lineJoin!==i&&(this._lineJoin=i,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(i){this._miterLimit!==i&&(this._miterLimit=i,this.styleID++)}get padding(){return this._padding}set padding(i){this._padding!==i&&(this._padding=i,this.styleID++)}get stroke(){return this._stroke}set stroke(i){const t=vf(i);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(i){this._strokeThickness!==i&&(this._strokeThickness=i,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(i){this._textBaseline!==i&&(this._textBaseline=i,this.styleID++)}get trim(){return this._trim}set trim(i){this._trim!==i&&(this._trim=i,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(i){this._whiteSpace!==i&&(this._whiteSpace=i,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(i){this._wordWrap!==i&&(this._wordWrap=i,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(i){this._wordWrapWidth!==i&&(this._wordWrapWidth=i,this.styleID++)}toFontString(){const i=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let e=t.length-1;e>=0;e--){let r=t[e].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!M6.includes(r)&&(r=`"${r}"`),t[e]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${i} ${t.join(",")}`}};let qr=Ya;qr.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Pl.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function vf(i){const t=ue.shared;return Array.isArray(i)?i.map(e=>t.setValue(e).toHex()):t.setValue(i).toHex()}function O6(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function _f(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const R6={texture:!0,children:!1,baseTexture:!0},fd=class extends wl{constructor(i,t,e){let r=!1;e||(e=St.ADAPTER.createCanvas(),r=!0),e.width=3,e.height=3;const n=It.from(e);n.orig=new Kt,n.trim=new Kt,super(n),this._ownCanvas=r,this.canvas=e,this.context=e.getContext("2d",{willReadFrequently:!0}),this._resolution=fd.defaultResolution??St.RESOLUTION,this._autoResolution=fd.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=i,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return ei.experimentalLetterSpacing}static set experimentalLetterSpacing(i){ee("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ei.experimentalLetterSpacing=i}updateText(i){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;this._font=this._style.toFontString();const e=this.context,r=ei.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=r.width,o=r.height,m=r.lines,a=r.lineHeight,s=r.lineWidths,h=r.maxLineWidth,d=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),e.scale(this._resolution,this._resolution),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.font=this._font,e.lineWidth=t.strokeThickness,e.textBaseline=t.textBaseline,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit;let l,u;const c=t.dropShadow?2:1;for(let f=0;f<c;++f){const v=t.dropShadow&&f===0,p=v?Math.ceil(Math.max(1,o)+t.padding*2):0,y=p*this._resolution;if(v){e.fillStyle="black",e.strokeStyle="black";const x=t.dropShadowColor,S=t.dropShadowBlur*this._resolution,w=t.dropShadowDistance*this._resolution;e.shadowColor=ue.shared.setValue(x).setAlpha(t.dropShadowAlpha).toRgbaString(),e.shadowBlur=S,e.shadowOffsetX=Math.cos(t.dropShadowAngle)*w,e.shadowOffsetY=Math.sin(t.dropShadowAngle)*w+y}else e.fillStyle=this._generateFillStyle(t,m,r),e.strokeStyle=t.stroke,e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;let b=(a-d.fontSize)/2;a-d.fontSize<0&&(b=0);for(let x=0;x<m.length;x++)l=t.strokeThickness/2,u=t.strokeThickness/2+x*a+d.ascent+b,t.align==="right"?l+=h-s[x]:t.align==="center"&&(l+=(h-s[x])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(m[x],l+t.padding,u+t.padding-p,!0),t.fill&&this.drawLetterSpacing(m[x],l+t.padding,u+t.padding-p)}this.updateTexture()}drawLetterSpacing(i,t,e,r=!1){const o=this._style.letterSpacing;let m=!1;if(ei.experimentalLetterSpacingSupported&&(ei.experimentalLetterSpacing?(this.context.letterSpacing=`${o}px`,this.context.textLetterSpacing=`${o}px`,m=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),o===0||m){r?this.context.strokeText(i,t,e):this.context.fillText(i,t,e);return}let a=t;const s=ei.graphemeSegmenter(i);let h=this.context.measureText(i).width,d=0;for(let l=0;l<s.length;++l){const u=s[l];r?this.context.strokeText(u,a,e):this.context.fillText(u,a,e);let c="";for(let f=l+1;f<s.length;++f)c+=s[f];d=this.context.measureText(c).width,a+=h-d+o,h=d}}updateTexture(){const i=this.canvas;if(this._style.trim){const o=c4(i);o.data&&(i.width=o.width,i.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,e=this._style,r=e.trim?0:e.padding,n=t.baseTexture;t.trim.width=t._frame.width=i.width/this._resolution,t.trim.height=t._frame.height=i.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(i.width,i.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(i,t){return this.updateText(!0),this._textureID===-1&&(i=!1),super.getBounds(i,t)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds.call(this,i)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(i,t,e){const r=i.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let n;const o=i.dropShadow?i.dropShadowDistance:0,m=i.padding||0,a=this.canvas.width/this._resolution-o-m*2,s=this.canvas.height/this._resolution-o-m*2,h=r.slice(),d=i.fillGradientStops.slice();if(!d.length){const l=h.length+1;for(let u=1;u<l;++u)d.push(u/l)}if(h.unshift(r[0]),d.unshift(0),h.push(r[r.length-1]),d.push(1),i.fillGradientType===Pl.LINEAR_VERTICAL){n=this.context.createLinearGradient(a/2,m,a/2,s+m);const l=e.fontProperties.fontSize+i.strokeThickness;for(let u=0;u<t.length;u++){const c=e.lineHeight*(u-1)+l,f=e.lineHeight*u;let v=f;u>0&&c>f&&(v=(f+c)/2);const p=f+l,y=e.lineHeight*(u+1);let b=p;u+1<t.length&&y<p&&(b=(p+y)/2);const x=(b-v)/s;for(let S=0;S<h.length;S++){let w=0;typeof d[S]=="number"?w=d[S]:w=S/h.length;let E=Math.min(1,Math.max(0,v/s+w*x));E=Number(E.toFixed(5)),n.addColorStop(E,h[S])}}}else{n=this.context.createLinearGradient(m,s/2,a+m,s/2);const l=h.length+1;let u=1;for(let c=0;c<h.length;c++){let f;typeof d[c]=="number"?f=d[c]:f=u/l,n.addColorStop(f,h[c]),u++}}return n}destroy(i){typeof i=="boolean"&&(i={children:i}),i=Object.assign({},R6,i),super.destroy(i),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(i){this.updateText(!0);const t=vn(this.scale.x)||1;this.scale.x=t*i/this._texture.orig.width,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(i){this.updateText(!0);const t=vn(this.scale.y)||1;this.scale.y=t*i/this._texture.orig.height,this._height=i}get style(){return this._style}set style(i){i=i||{},i instanceof qr?this._style=i:this._style=new qr(i),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}};let Il=fd;Il.defaultAutoResolution=!0;class D6{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function F6(i,t){var r;let e=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let n=0;n<i._textures.length;n++)if(i._textures[n]instanceof It){const o=i._textures[n].baseTexture;t.includes(o)||(t.push(o),e=!0)}}return e}function L6(i,t){if(i.baseTexture instanceof Gt){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function k6(i,t){if(i._texture&&i._texture instanceof It){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function B6(i,t){return t instanceof Il?(t.updateText(!0),!0):!1}function N6(i,t){if(t instanceof qr){const e=t.toFontString();return ei.measureFont(e),!0}return!1}function U6(i,t){if(i instanceof Il){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function G6(i,t){return i instanceof qr?(t.includes(i)||t.push(i),!0):!1}const I1=class{constructor(i){this.limiter=new D6(I1.uploadsPerFrame),this.renderer=i,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(U6),this.registerFindHook(G6),this.registerFindHook(F6),this.registerFindHook(L6),this.registerFindHook(k6),this.registerUploadHook(B6),this.registerUploadHook(N6)}upload(i){return new Promise(t=>{i&&this.add(i),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,li.system.addOnce(this.tick,this,rs.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const i=this.queue[0];let t=!1;if(i&&!i._destroyed){for(let e=0,r=this.uploadHooks.length;e<r;e++)if(this.uploadHooks[e](this.uploadHookHelper,i)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)li.system.addOnce(this.tick,this,rs.UTILITY);else{this.ticking=!1;const i=this.completes.slice(0);this.completes.length=0;for(let t=0,e=i.length;t<e;t++)i[t]()}}registerFindHook(i){return i&&this.addHooks.push(i),this}registerUploadHook(i){return i&&this.uploadHooks.push(i),this}add(i){for(let t=0,e=this.addHooks.length;t<e&&!this.addHooks[t](i,this.queue);t++);if(i instanceof Ri)for(let t=i.children.length-1;t>=0;t--)this.add(i.children[t]);return this}destroy(){this.ticking&&li.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let cl=I1;cl.uploadsPerFrame=4;Object.defineProperties(St,{UPLOADS_PER_FRAME:{get(){return cl.uploadsPerFrame},set(i){ee("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),cl.uploadsPerFrame=i}}});function M1(i,t){return t instanceof Gt?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function H6(i,t){if(!(t instanceof go))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let n=0;n<r.length;n++){const{texture:o}=r[n].style;o&&M1(i,o.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function W6(i,t){return i instanceof go?(t.push(i),!0):!1}class O1 extends cl{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(W6),this.registerUploadHook(M1),this.registerUploadHook(H6)}}O1.extension={name:"prepare",type:Ct.RendererSystem};Ot.add(O1);var X6=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,V6=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,z6=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,uv=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,j6=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Oh=new Ce;class R1 extends yl{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new j_,this.state=Zr.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=wr.from(uv,j6,e),this.shader=t.context.webGLVersion>1?wr.from(V6,X6,e):wr.from(uv,z6,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const o=t.uvRespectAnchor?t.anchor.x:0,m=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-o,n[1]=n[3]=-m,n[2]=n[4]=1-o,n[5]=n[7]=1-m,r.invalidate();const a=t._texture,s=a.baseTexture,h=s.alphaMode>0,d=t.tileTransform.localTransform,l=t.uvMatrix;let u=s.isPowerOfTwo&&a.frame.width===s.width&&a.frame.height===s.height;u&&(s._glTextures[e.CONTEXT_UID]?u=s.wrapMode!==yn.CLAMP:s.wrapMode===yn.CLAMP&&(s.wrapMode=yn.REPEAT));const c=u?this.simpleShader:this.shader,f=a.width,v=a.height,p=t._width,y=t._height;Oh.set(d.a*f/p,d.b*f/y,d.c*v/p,d.d*v/y,d.tx/p,d.ty/y),Oh.invert(),u?Oh.prepend(l.mapCoord):(c.uniforms.uMapCoord=l.mapCoord.toArray(!0),c.uniforms.uClampFrame=l.uClampFrame,c.uniforms.uClampOffset=l.uClampOffset),c.uniforms.uTransform=Oh.toArray(!0),c.uniforms.uColor=ue.shared.setValue(t.tint).premultiply(t.worldAlpha,h).toArray(c.uniforms.uColor),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.uSampler=a,e.shader.bind(c),e.geometry.bind(r),this.state.blendMode=A_(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}R1.extension={name:"tilingSprite",type:Ct.RendererPlugin};Ot.add(R1);const $a=class{constructor(i,t,e=null){this.linkedSheets=[],this._texture=i instanceof It?i:null,this.baseTexture=i instanceof Gt?i:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;const r=this.baseTexture.resource;this.resolution=this._updateResolution(e||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(i=null){const{scale:t}=this.data.meta;let e=bn(i,null);return e===null&&(e=parseFloat(t??"1")),e!==1&&this.baseTexture.setResolution(e),e}parse(){return new Promise(i=>{this._callback=i,this._batchIndex=0,this._frameKeys.length<=$a.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(i){let t=i;const e=$a.BATCH_SIZE;for(;t-i<e&&t<this._frameKeys.length;){const r=this._frameKeys[t],n=this._frames[r],o=n.frame;if(o){let m=null,a=null;const s=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,h=new Kt(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);n.rotated?m=new Kt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):m=new Kt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(a=new Kt(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new It(this.baseTexture,m,h,a,n.rotated?2:0,n.anchor,n.borders),It.addToCache(this.textures[r],r)}t++}}_processAnimations(){const i=this.data.animations||{};for(const t in i){this.animations[t]=[];for(let e=0;e<i[t].length;e++){const r=i[t][e];this.animations[t].push(this.textures[r])}}}_parseComplete(){const i=this._callback;this._callback=null,this._batchIndex=0,i.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*$a.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*$a.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(i=!1){var t;for(const e in this.textures)this.textures[e].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,i&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let dd=$a;dd.BATCH_SIZE=1e3;const Y6=["jpg","png","jpeg","avif","webp"];function D1(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[n]=t.textures[n]}),!e){const n=ci.dirname(i[0]);t.linkedSheets.forEach((o,m)=>{const a=D1([`${n}/${t.data.meta.related_multi_packs[m]}`],o,!0);Object.assign(r,a)})}return r}const $6={extension:Ct.Asset,cache:{test:i=>i instanceof dd,getCacheableAssets:(i,t)=>D1(i,t,!1)},resolver:{test:i=>{const e=i.split("?")[0].split("."),r=e.pop(),n=e.pop();return r==="json"&&Y6.includes(n)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=St.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:Ct.LoadParser,priority:Er.Normal},async testParse(i,t){return ci.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var h,d;let r=ci.dirname(t.src);r&&r.lastIndexOf("/")!==r.length-1&&(r+="/");let n=r+i.meta.image;n=ld(n,t.src);const m=(await e.load([n]))[n],a=new dd(m.baseTexture,i,t.src);await a.parse();const s=(h=i==null?void 0:i.meta)==null?void 0:h.related_multi_packs;if(Array.isArray(s)){const l=[];for(const c of s){if(typeof c!="string")continue;let f=r+c;(d=t.data)!=null&&d.ignoreMultiPack||(f=ld(f,t.src),l.push(e.load({src:f,data:{ignoreMultiPack:!0}})))}const u=await Promise.all(l);a.linkedSheets=u,u.forEach(c=>{c.linkedSheets=[a].concat(a.linkedSheets.filter(f=>f!==c))})}return a},unload(i){i.destroy(!0)}}};Ot.add($6);class ul{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class zh{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const o in e){const m=e[o].match(/^[a-z]+/gm)[0],a=e[o].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const h in a){const d=a[h].split("="),l=d[0],u=d[1].replace(/"/gm,""),c=parseFloat(u),f=isNaN(c)?u:c;s[l]=f}r[m].push(s)}const n=new ul;return r.info.forEach(o=>n.info.push({face:o.face,size:parseInt(o.size,10)})),r.common.forEach(o=>n.common.push({lineHeight:parseInt(o.lineHeight,10)})),r.page.forEach(o=>n.page.push({id:parseInt(o.id,10),file:o.file})),r.char.forEach(o=>n.char.push({id:parseInt(o.id,10),page:parseInt(o.page,10),x:parseInt(o.x,10),y:parseInt(o.y,10),width:parseInt(o.width,10),height:parseInt(o.height,10),xoffset:parseInt(o.xoffset,10),yoffset:parseInt(o.yoffset,10),xadvance:parseInt(o.xadvance,10)})),r.kerning.forEach(o=>n.kerning.push({first:parseInt(o.first,10),second:parseInt(o.second,10),amount:parseInt(o.amount,10)})),r.distanceField.forEach(o=>n.distanceField.push({distanceRange:parseInt(o.distanceRange,10),fieldType:o.fieldType})),n}}class gd{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new ul,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),o=t.getElementsByTagName("page"),m=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),s=t.getElementsByTagName("distanceField");for(let h=0;h<r.length;h++)e.info.push({face:r[h].getAttribute("face"),size:parseInt(r[h].getAttribute("size"),10)});for(let h=0;h<n.length;h++)e.common.push({lineHeight:parseInt(n[h].getAttribute("lineHeight"),10)});for(let h=0;h<o.length;h++)e.page.push({id:parseInt(o[h].getAttribute("id"),10)||0,file:o[h].getAttribute("file")});for(let h=0;h<m.length;h++){const d=m[h];e.char.push({id:parseInt(d.getAttribute("id"),10),page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xoffset:parseInt(d.getAttribute("xoffset"),10),yoffset:parseInt(d.getAttribute("yoffset"),10),xadvance:parseInt(d.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)e.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<s.length;h++)e.distanceField.push({fieldType:s[h].getAttribute("fieldType"),distanceRange:parseInt(s[h].getAttribute("distanceRange"),10)});return e}}class pd{static test(t){return typeof t=="string"&&t.includes("<font>")?gd.test(St.ADAPTER.parseXML(t)):!1}static parse(t){return gd.parse(St.ADAPTER.parseXML(t))}}const yf=[zh,gd,pd];function K6(i){for(let t=0;t<yf.length;t++)if(yf[t].test(i))return yf[t];return null}function q6(i,t,e,r,n,o){const m=e.fill;if(Array.isArray(m)){if(m.length===1)return m[0]}else return m;let a;const s=e.dropShadow?e.dropShadowDistance:0,h=e.padding||0,d=i.width/r-s-h*2,l=i.height/r-s-h*2,u=m.slice(),c=e.fillGradientStops.slice();if(!c.length){const f=u.length+1;for(let v=1;v<f;++v)c.push(v/f)}if(u.unshift(m[0]),c.unshift(0),u.push(m[m.length-1]),c.push(1),e.fillGradientType===Pl.LINEAR_VERTICAL){a=t.createLinearGradient(d/2,h,d/2,l+h);let f=0;const p=(o.fontProperties.fontSize+e.strokeThickness)/l;for(let y=0;y<n.length;y++){const b=o.lineHeight*y;for(let x=0;x<u.length;x++){let S=0;typeof c[x]=="number"?S=c[x]:S=x/u.length;const w=b/l+S*p;let E=Math.max(f,w);E=Math.min(E,1),a.addColorStop(E,u[x]),f=E}}}else{a=t.createLinearGradient(h,l/2,d+h,l/2);const f=u.length+1;let v=1;for(let p=0;p<u.length;p++){let y;typeof c[p]=="number"?y=c[p]:y=v/f,a.addColorStop(y,u[p]),v++}}return a}function Z6(i,t,e,r,n,o,m){const a=e.text,s=e.fontProperties;t.translate(r,n),t.scale(o,o);const h=m.strokeThickness/2,d=-(m.strokeThickness/2);if(t.font=m.toFontString(),t.lineWidth=m.strokeThickness,t.textBaseline=m.textBaseline,t.lineJoin=m.lineJoin,t.miterLimit=m.miterLimit,t.fillStyle=q6(i,t,m,o,[a],e),t.strokeStyle=m.stroke,m.dropShadow){const l=m.dropShadowColor,u=m.dropShadowBlur*o,c=m.dropShadowDistance*o;t.shadowColor=ue.shared.setValue(l).setAlpha(m.dropShadowAlpha).toRgbaString(),t.shadowBlur=u,t.shadowOffsetX=Math.cos(m.dropShadowAngle)*c,t.shadowOffsetY=Math.sin(m.dropShadowAngle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;m.stroke&&m.strokeThickness&&t.strokeText(a,h,d+e.lineHeight-s.descent),m.fill&&t.fillText(a,h,d+e.lineHeight-s.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function jh(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function F1(i){return Array.from?Array.from(i):i.split("")}function J6(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const o=n[0].charCodeAt(0),m=n[1].charCodeAt(0);if(m<o)throw new Error("[BitmapFont]: Invalid character range.");for(let a=o,s=m;a<=s;a++)t.push(String.fromCharCode(a))}else t.push(...F1(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const tr=class{constructor(i,t,e){var h;const[r]=i.info,[n]=i.common,[o]=i.page,[m]=i.distanceField,a=bn(o.file),s={};this._ownsTextures=e,this.font=r.face,this.size=r.size,this.lineHeight=n.lineHeight/a,this.chars={},this.pageTextures=s;for(let d=0;d<i.page.length;d++){const{id:l,file:u}=i.page[d];s[l]=t instanceof Array?t[d]:t[u],m!=null&&m.fieldType&&m.fieldType!=="none"&&(s[l].baseTexture.alphaMode=cr.NO_PREMULTIPLIED_ALPHA,s[l].baseTexture.mipmap=Tr.OFF)}for(let d=0;d<i.char.length;d++){const{id:l,page:u}=i.char[d];let{x:c,y:f,width:v,height:p,xoffset:y,yoffset:b,xadvance:x}=i.char[d];c/=a,f/=a,v/=a,p/=a,y/=a,b/=a,x/=a;const S=new Kt(c+s[u].frame.x/a,f+s[u].frame.y/a,v,p);this.chars[l]={xOffset:y,yOffset:b,xAdvance:x,kerning:{},texture:new It(s[u].baseTexture,S),page:u}}for(let d=0;d<i.kerning.length;d++){let{first:l,second:u,amount:c}=i.kerning[d];l/=a,u/=a,c/=a,this.chars[u]&&(this.chars[u].kerning[l]=c)}this.distanceFieldRange=m==null?void 0:m.distanceRange,this.distanceFieldType=((h=m==null?void 0:m.fieldType)==null?void 0:h.toLowerCase())??"none"}destroy(){for(const i in this.chars)this.chars[i].texture.destroy(),this.chars[i].texture=null;for(const i in this.pageTextures)this._ownsTextures&&this.pageTextures[i].destroy(!0),this.pageTextures[i]=null;this.chars=null,this.pageTextures=null}static install(i,t,e){let r;if(i instanceof ul)r=i;else{const o=K6(i);if(!o)throw new Error("Unrecognized data format for font.");r=o.parse(i)}t instanceof It&&(t=[t]);const n=new tr(r,t,e);return tr.available[n.font]=n,n}static uninstall(i){const t=tr.available[i];if(!t)throw new Error(`No font found named '${i}'`);t.destroy(),delete tr.available[i]}static from(i,t,e){if(!i)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:n,resolution:o,textureWidth:m,textureHeight:a,...s}=Object.assign({},tr.defaultOptions,e),h=J6(r),d=t instanceof qr?t:new qr(t),l=m,u=new ul;u.info[0]={face:d.fontFamily,size:d.fontSize},u.common[0]={lineHeight:d.fontSize};let c=0,f=0,v,p,y,b=0;const x=[];for(let w=0;w<h.length;w++){v||(v=St.ADAPTER.createCanvas(),v.width=m,v.height=a,p=v.getContext("2d"),y=new Gt(v,{resolution:o,...s}),x.push(new It(y)),u.page.push({id:x.length-1,file:""}));const E=h[w],P=ei.measureText(E,d,!1,v),A=P.width,N=Math.ceil(P.height),k=Math.ceil((d.fontStyle==="italic"?2:1)*A);if(f>=a-N*o){if(f===0)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${E}')`);--w,v=null,p=null,y=null,f=0,c=0,b=0;continue}if(b=Math.max(N+P.fontProperties.descent,b),k*o+c>=l){if(c===0)throw new Error(`[BitmapFont] textureWidth ${m}px is too small (fontFamily: '${d.fontFamily}', fontSize: ${d.fontSize}px, char: '${E}')`);--w,f+=b*o,f=Math.ceil(f),c=0,b=0;continue}Z6(v,p,P,c,f,o,d);const U=jh(P.text);u.char.push({id:U,page:x.length-1,x:c/o,y:f/o,width:k,height:N,xoffset:0,yoffset:0,xadvance:A-(d.dropShadow?d.dropShadowDistance:0)-(d.stroke?d.strokeThickness:0)}),c+=(k+2*n)*o,c=Math.ceil(c)}for(let w=0,E=h.length;w<E;w++){const P=h[w];for(let A=0;A<E;A++){const N=h[A],k=p.measureText(P).width,U=p.measureText(N).width,X=p.measureText(P+N).width-(k+U);X&&u.kerning.push({first:jh(P),second:jh(N),amount:X})}}const S=new tr(u,x,!0);return tr.available[i]!==void 0&&tr.uninstall(i),tr.available[i]=S,S}};let bi=tr;bi.ALPHA=[["a","z"],["A","Z"]," "];bi.NUMERIC=[["0","9"]];bi.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "];bi.ASCII=[[" ","~"]];bi.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:tr.ALPHANUMERIC};bi.available={};var Q6=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,t8=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const fv=[],dv=[],gv=[],L1=class extends Ri{constructor(i,t={}){super();const{align:e,tint:r,maxWidth:n,letterSpacing:o,fontName:m,fontSize:a}=Object.assign({},L1.styleDefaults,t);if(!bi.available[m])throw new Error(`Missing BitmapFont "${m}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=e,this._tintColor=new ue(r),this._font=void 0,this._fontName=m,this._fontSize=a,this.text=i,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new _n(()=>{this.dirty=!0},this,0,0),this._roundPixels=St.ROUND_PIXELS,this.dirty=!0,this._resolution=St.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var k;const i=bi.available[this._fontName],t=this.fontSize,e=t/i.size,r=new ne,n=[],o=[],m=[],a=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",s=F1(a),h=this._maxWidth*i.size/t,d=i.distanceFieldType==="none"?fv:dv;let l=null,u=0,c=0,f=0,v=-1,p=0,y=0,b=0,x=0;for(let U=0;U<s.length;U++){const j=s[U],X=jh(j);if(/(?:\s)/.test(j)&&(v=U,p=u,x++),j==="\r"||j===`
`){o.push(u),m.push(-1),c=Math.max(c,u),++f,++y,r.x=0,r.y+=i.lineHeight,l=null,x=0;continue}const W=i.chars[X];if(!W)continue;l&&W.kerning[l]&&(r.x+=W.kerning[l]);const Q=gv.pop()||{texture:It.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ne};Q.texture=W.texture,Q.line=f,Q.charCode=X,Q.position.x=Math.round(r.x+W.xOffset+this._letterSpacing/2),Q.position.y=Math.round(r.y+W.yOffset),Q.prevSpaces=x,n.push(Q),u=Q.position.x+Math.max(W.xAdvance-W.xOffset,W.texture.orig.width),r.x+=W.xAdvance+this._letterSpacing,b=Math.max(b,W.yOffset+W.texture.height),l=X,v!==-1&&h>0&&r.x>h&&(++y,Zs(n,1+v-y,1+U-v),U=v,v=-1,o.push(p),m.push(n.length>0?n[n.length-1].prevSpaces:0),c=Math.max(c,p),f++,r.x=0,r.y+=i.lineHeight,l=null,x=0)}const S=s[s.length-1];S!=="\r"&&S!==`
`&&(/(?:\s)/.test(S)&&(u=p),o.push(u),c=Math.max(c,u),m.push(-1));const w=[];for(let U=0;U<=f;U++){let j=0;this._align==="right"?j=c-o[U]:this._align==="center"?j=(c-o[U])/2:this._align==="justify"&&(j=m[U]<0?0:(c-o[U])/m[U]),w.push(j)}const E=n.length,P={},A=[],N=this._activePagesMeshData;d.push(...N);for(let U=0;U<E;U++){const j=n[U].texture,X=j.baseTexture.uid;if(!P[X]){let W=d.pop();if(!W){const ot=new T6;let it,ct;i.distanceFieldType==="none"?(it=new lv(It.EMPTY),ct=Bt.NORMAL):(it=new lv(It.EMPTY,{program:sr.from(t8,Q6),uniforms:{uFWidth:0}}),ct=Bt.NORMAL_NPM);const O=new ud(ot,it);O.blendMode=ct,W={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:O,vertices:null,uvs:null,indices:null}}W.index=0,W.indexCount=0,W.vertexCount=0,W.uvsCount=0,W.total=0;const{_textureCache:Q}=this;Q[X]=Q[X]||new It(j.baseTexture),W.mesh.texture=Q[X],W.mesh.tint=this._tintColor.value,A.push(W),P[X]=W}P[X].total++}for(let U=0;U<N.length;U++)A.includes(N[U])||this.removeChild(N[U].mesh);for(let U=0;U<A.length;U++)A[U].mesh.parent!==this&&this.addChild(A[U].mesh);this._activePagesMeshData=A;for(const U in P){const j=P[U],X=j.total;if(!(((k=j.indices)==null?void 0:k.length)>6*X)||j.vertices.length<ud.BATCHABLE_SIZE*2)j.vertices=new Float32Array(4*2*X),j.uvs=new Float32Array(4*2*X),j.indices=new Uint16Array(6*X);else{const W=j.total,Q=j.vertices;for(let ot=W*4*2;ot<Q.length;ot++)Q[ot]=0}j.mesh.size=6*X}for(let U=0;U<E;U++){const j=n[U];let X=j.position.x+w[j.line]*(this._align==="justify"?j.prevSpaces:1);this._roundPixels&&(X=Math.round(X));const W=X*e,Q=j.position.y*e,ot=j.texture,it=P[ot.baseTexture.uid],ct=ot.frame,O=ot._uvs,M=it.index++;it.indices[M*6+0]=0+M*4,it.indices[M*6+1]=1+M*4,it.indices[M*6+2]=2+M*4,it.indices[M*6+3]=0+M*4,it.indices[M*6+4]=2+M*4,it.indices[M*6+5]=3+M*4,it.vertices[M*8+0]=W,it.vertices[M*8+1]=Q,it.vertices[M*8+2]=W+ct.width*e,it.vertices[M*8+3]=Q,it.vertices[M*8+4]=W+ct.width*e,it.vertices[M*8+5]=Q+ct.height*e,it.vertices[M*8+6]=W,it.vertices[M*8+7]=Q+ct.height*e,it.uvs[M*8+0]=O.x0,it.uvs[M*8+1]=O.y0,it.uvs[M*8+2]=O.x1,it.uvs[M*8+3]=O.y1,it.uvs[M*8+4]=O.x2,it.uvs[M*8+5]=O.y2,it.uvs[M*8+6]=O.x3,it.uvs[M*8+7]=O.y3}this._textWidth=c*e,this._textHeight=(r.y+i.lineHeight)*e;for(const U in P){const j=P[U];if(this.anchor.x!==0||this.anchor.y!==0){let ot=0;const it=this._textWidth*this.anchor.x,ct=this._textHeight*this.anchor.y;for(let O=0;O<j.total;O++)j.vertices[ot++]-=it,j.vertices[ot++]-=ct,j.vertices[ot++]-=it,j.vertices[ot++]-=ct,j.vertices[ot++]-=it,j.vertices[ot++]-=ct,j.vertices[ot++]-=it,j.vertices[ot++]-=ct}this._maxLineHeight=b*e;const X=j.mesh.geometry.getBuffer("aVertexPosition"),W=j.mesh.geometry.getBuffer("aTextureCoord"),Q=j.mesh.geometry.getIndex();X.data=j.vertices,W.data=j.uvs,Q.data=j.indices,X.update(),W.update(),Q.update()}for(let U=0;U<n.length;U++)gv.push(n[U]);this._font=i,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:e,size:r}=bi.available[this._fontName];if(e!=="none"){const{a:n,b:o,c:m,d:a}=this.worldTransform,s=Math.sqrt(n*n+o*o),h=Math.sqrt(m*m+a*a),d=(Math.abs(s)+Math.abs(h))/2,l=this.fontSize/r,u=i._view.resolution;for(const c of this._activePagesMeshData)c.mesh.shader.uniforms.uFWidth=d*t*l*u}super._render(i)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const i=bi.available[this._fontName];if(!i)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==i&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(i){if(this.tint!==i){this._tintColor.setValue(i);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=i}}get align(){return this._align}set align(i){this._align!==i&&(this._align=i,this.dirty=!0)}get fontName(){return this._fontName}set fontName(i){if(!bi.available[i])throw new Error(`Missing BitmapFont "${i}"`);this._fontName!==i&&(this._fontName=i,this.dirty=!0)}get fontSize(){return this._fontSize??bi.available[this._fontName].size}set fontSize(i){this._fontSize!==i&&(this._fontSize=i,this.dirty=!0)}get anchor(){return this._anchor}set anchor(i){typeof i=="number"?this._anchor.set(i):this._anchor.copyFrom(i)}get text(){return this._text}set text(i){i=String(i??""),this._text!==i&&(this._text=i,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(i){this._maxWidth!==i&&(this._maxWidth=i,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(i){this._letterSpacing!==i&&(this._letterSpacing=i,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(i){i!==this._roundPixels&&(this._roundPixels=i,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}destroy(i){const{_textureCache:t}=this,r=bi.available[this._fontName].distanceFieldType==="none"?fv:dv;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>t[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=It.EMPTY});for(const n in t)t[n].destroy(),delete t[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(i)}};let e8=L1;e8.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const i8=[".xml",".fnt"],r8={extension:{type:Ct.LoadParser,priority:Er.Normal},name:"loadBitmapFont",test(i){return i8.includes(ci.extname(i).toLowerCase())},async testParse(i){return zh.test(i)||pd.test(i)},async parse(i,t,e){const r=zh.test(i)?zh.parse(i):pd.parse(i),{src:n}=t,{page:o}=r,m=[];for(let h=0;h<o.length;++h){const d=o[h].file;let l=ci.join(ci.dirname(n),d);l=ld(l,n),m.push(l)}const a=await e.load(m),s=m.map(h=>a[h]);return bi.install(r,s,!0)},async load(i,t){return(await St.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};Ot.add(r8);const Xs=class extends qr{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(i){return new Xs(Object.keys(Xs.defaultOptions).reduce((t,e)=>({...t,[e]:i[e]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(i=>{URL.revokeObjectURL(i.src),i.refs--,i.refs===0&&(i.fontFace&&document.fonts.delete(i.fontFace),delete Xs.availableFonts[i.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(i,t={}){const{availableFonts:e}=Xs;if(e[i]){const r=e[i];return this._fonts.push(r),r.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return St.ADAPTER.fetch(i).then(r=>r.blob()).then(async r=>new Promise((n,o)=>{const m=URL.createObjectURL(r),a=new FileReader;a.onload=()=>n([m,a.result]),a.onerror=o,a.readAsDataURL(r)})).then(async([r,n])=>{const o=Object.assign({family:ci.basename(i,ci.extname(i)),weight:"normal",style:"normal",src:r,dataSrc:n,refs:1,originalUrl:i,fontFace:null},t);e[i]=o,this._fonts.push(o),this.styleID++;const m=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style});o.fontFace=m,await m.load(),document.fonts.add(m),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...i){const t=i.filter(e=>!this._overrides.includes(e));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...i){const t=i.filter(e=>this._overrides.includes(e));t.length>0&&(this._overrides=this._overrides.filter(e=>!t.includes(e)),this.styleID++)}toCSS(i){return[`transform: scale(${i})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((i,t)=>`${i}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style}; 
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(i){this._stylesheet!==i&&(this._stylesheet=i,this.styleID++)}normalizeColor(i){return Array.isArray(i)&&(i=n4(i)),typeof i=="number"?r4(i):i}dropShadowToCSS(){let i=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,e=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);i.startsWith("#")&&t<1&&(i+=(t*255|0).toString(16).padStart(2,"0"));const n=`${e}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${i}`:`text-shadow: ${n} ${i}`}reset(){Object.assign(this,Xs.defaultOptions)}onBeforeDraw(){const{fontsDirty:i}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&i?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:i}=St.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(i)}set fillGradientStops(i){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(i){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(i){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(i){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(i){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(i){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(i){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};let Qa=Xs;Qa.availableFonts={};Qa.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};const Vs=class extends wl{constructor(i="",t={}){super(It.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this._loading=!1,this.localStyleID=-1,this.dirty=!1,this.ownsStyle=!1;const e=new Image,r=It.from(e,{scaleMode:St.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new Kt,r.trim=new Kt,this.texture=r;const n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",m=document.createElementNS(n,"svg"),a=document.createElementNS(n,"foreignObject"),s=document.createElementNS(o,"div"),h=document.createElementNS(o,"style");a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",m.appendChild(a),this.maxWidth=Vs.defaultMaxWidth,this.maxHeight=Vs.defaultMaxHeight,this._domElement=s,this._styleElement=h,this._svgRoot=m,this._foreignObject=a,this._foreignObject.appendChild(h),this._foreignObject.appendChild(s),this._image=e,this._loadImage=new Image,this._autoResolution=Vs.defaultAutoResolution,this._resolution=Vs.defaultResolution??St.RESOLUTION,this.text=i,this.style=t}measureText(i){var a,s;const{text:t,style:e,resolution:r}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},i);Object.assign(this._domElement,{innerHTML:t,style:e.toCSS(r)}),this._styleElement.textContent=e.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const o=Math.min(this.maxWidth,Math.ceil(n.width)),m=Math.min(this.maxHeight,Math.ceil(n.height));return this._svgRoot.setAttribute("width",o.toString()),this._svgRoot.setAttribute("height",m.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),e!==this._style&&(Object.assign(this._domElement,{style:(a=this._style)==null?void 0:a.toCSS(r)}),this._styleElement.textContent=(s=this._style)==null?void 0:s.toGlobalCSS()),{width:o+e.padding*2,height:m+e.padding*2}}async updateText(i=!0){const{style:t,_image:e,_loadImage:r}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&i)return;const{width:n,height:o}=this.measureText();e.width=r.width=Math.ceil(Math.max(1,n)),e.height=r.height=Math.ceil(Math.max(1,o)),this._loading||(this._loading=!0,await new Promise(m=>{r.onload=async()=>{await t.onBeforeDraw(),this._loading=!1,e.src=r.src,r.onload=null,r.src="",this.updateTexture(),m()};const a=new XMLSerializer().serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(a)}`}))}get source(){return this._image}updateTexture(){const{style:i,texture:t,_image:e,resolution:r}=this,{padding:n}=i,{baseTexture:o}=t;t.trim.width=t._frame.width=e.width/r,t.trim.height=t._frame.height=e.height/r,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(e.width,e.height,r),this.dirty=!1}_render(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._render(i)}_renderCanvas(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(i)}getLocalBounds(i){return this.updateText(!0),super.getLocalBounds(i)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(i){var e,r,n,o,m;typeof i=="boolean"&&(i={children:i}),i=Object.assign({},Vs.defaultDestroyOptions,i),super.destroy(i);const t=null;this.ownsStyle&&((e=this._style)==null||e.cleanFonts()),this._style=t,(r=this._svgRoot)==null||r.remove(),this._svgRoot=t,(n=this._domElement)==null||n.remove(),this._domElement=t,(o=this._foreignObject)==null||o.remove(),this._foreignObject=t,(m=this._styleElement)==null||m.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(i){this.updateText(!0);const t=vn(this.scale.x)||1;this.scale.x=t*i/this._image.width/this.resolution,this._width=i}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(i){this.updateText(!0);const t=vn(this.scale.y)||1;this.scale.y=t*i/this._image.height/this.resolution,this._height=i}get style(){return this._style}set style(i){this._style!==i&&(i=i||{},i instanceof Qa?(this.ownsStyle=!1,this._style=i):i instanceof qr?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Qa.from(i)):(this.ownsStyle=!0,this._style=new Qa(i)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(i){i=String(i===""||i===null||i===void 0?" ":i),i=this.sanitiseText(i),this._text!==i&&(this._text=i,this.dirty=!0)}get resolution(){return this._resolution}set resolution(i){this._autoResolution=!1,this._resolution!==i&&(this._resolution=i,this.dirty=!0)}sanitiseText(i){return i.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};let Ml=Vs;Ml.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0};Ml.defaultMaxWidth=2024;Ml.defaultMaxHeight=2024;Ml.defaultAutoResolution=!0;class pv{constructor(t,e){ht(this,"height");ht(this,"width");ht(this,"app");ht(this,"components");ht(this,"movedComponents");ht(this,"positionManager");this.components=[],this.width=e,this.height=t,this.movedComponents=[],this.positionManager=new ha({viewWidth:this.width,viewHeight:this.height}),this.app=new Ud({width:this.width,height:this.height}),this.app.view.addEventListener("wheel",r=>{r.deltaY<0?(this.app.stage.scale.x*=1.1,this.app.stage.scale.y*=1.1):(this.app.stage.scale.x/=1.1,this.app.stage.scale.y/=1.1)})}getContext(){return this.app.stage}addComponent(t){this.components.push(t)}start(){return this.components.forEach(t=>{t.draw(0)}),this.updateComponentsCount(),this.app.view}updateComponentsCount(){const t=document.getElementById("componentCount");t.innerText=this.components.length.toString()}moveTest(t=0){this.movedComponents=this.components,t!==0&&(this.movedComponents=this.components.slice(0,t)),this.movedComponents.forEach(e=>{const r=e.getUIElement();this.positionManager.addPosition(r.x,r.y)}),this.app.ticker.add(()=>{this.moveElements()})}moveElements(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t);this.movedComponents[t].getUIElement().move(e,r)}}zoomScale(t){this.app.stage.scale.x=t,this.app.stage.scale.y=t}}const mv=[{getFigure:(i,t,e,r,n)=>{i.lineStyle(2,Xe()),i.beginFill(Xe()),i.drawRect(0,0,r,n),i.x=t,i.y=e,i.endFill()}},{getFigure:(i,t,e,r,n)=>{i.beginFill(Xe()),i.moveTo(0,0),i.lineTo(r,0),i.lineTo(1,n),i.lineTo(0,0),i.endFill(),i.x=t,i.y=e}},{getFigure:(i,t,e,r,n)=>{i.beginFill(Xe()),i.drawCircle(0,0,r/2),i.endFill(),i.x=t,i.y=e}}];class n8{constructor(t){ht(this,"context");ht(this,"x");ht(this,"y");ht(this,"dataSourceNumber");ht(this,"width");ht(this,"height");ht(this,"container");ht(this,"text");this.context=t,this.dataSourceNumber=0,this.x=Ht.random(Ze-be),this.y=Ht.random(qe-me),this.width=Ht.random(2,be),this.height=Ht.random(2,me);const e=new go,r=Ht.random(mv.length-1);mv[r].getFigure(e,0,0,this.width,this.height),this.text=new Il("22",{fontSize:24,fill:"red"}),this.container=new Ri,this.container.addChild(e),this.container.addChild(this.text),this.context.addChild(this.container)}draw(t){this.dataSourceNumber=t,this.container.x=this.x,this.container.y=this.y}move(t,e){this.x=t,this.y=e,this.container.x=t,this.container.y=e}getElement(){return this}}class s8{constructor(t){ht(this,"appElement");ht(this,"dataSource");ht(this,"view");this.appElement=t,this.view=new pv(qe,Ze),this.dataSource=new Oi;const e=new xn;e.onChange=r=>{this.view.zoomScale(r)},this.initButtonBindings()}initButtonBindings(){Se("addPixijsComponents",()=>{const t=xe("pixijsComponentsCount");this.addPixijsComponents(t)}),Se("setDataSourceSettings",()=>{const t=xe("updateInterval");this.dataSource.updateInterval(t*1e3)}),Se("startMoveTest",()=>{const t=xe("movedComponentsCount");this.moveTest(t)})}start(){this.view=new pv(qe,Ze),this.dataSource=new Oi,this.appElement.appendChild(this.view.start()),this.dataSource.start()}addComponents(t,e,r){switch(t){case"pixijs":this.addPixijsComponents(e);break;default:throw new Error(`Pixijs App: unknown component type:${t}`)}}addPixijsComponents(t){for(let e=0;e<t;e++){const r=new n8(this.view.getContext()),n=new zr(r);this.view.addComponent(n)}this.view.start()}moveTest(t=0){this.view.moveTest(t)}stopDataSource(){this.dataSource.updateInterval(0)}}var Xd={exports:{}},Ol={},k1={},qt={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i._registerNode=i.Konva=i.glob=void 0;var t=Math.PI/180;function e(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}i.glob=typeof xr<"u"?xr:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},i.Konva={_global:i.glob,version:"9.2.0",isBrowser:e(),isUnminified:/param/.test(function(n){}.toString()),dblClickWindow:400,getAngle(n){return i.Konva.angleDeg?n*t:n},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return i.Konva.DD.isDragging},isDragReady(){return!!i.Konva.DD.node},releaseCanvasOnDestroy:!0,document:i.glob.document,_injectGlobal(n){i.glob.Konva=n}};const r=n=>{i.Konva[n.prototype.getClassName()]=n};i._registerNode=r,i.Konva._injectGlobal(i.Konva)})(qt);var Ie={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Util=i.Transform=void 0;const t=qt;class e{constructor(S=[1,0,0,1,0,0]){this.dirty=!1,this.m=S&&S.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new e(this.m)}copyInto(S){S.m[0]=this.m[0],S.m[1]=this.m[1],S.m[2]=this.m[2],S.m[3]=this.m[3],S.m[4]=this.m[4],S.m[5]=this.m[5]}point(S){var w=this.m;return{x:w[0]*S.x+w[2]*S.y+w[4],y:w[1]*S.x+w[3]*S.y+w[5]}}translate(S,w){return this.m[4]+=this.m[0]*S+this.m[2]*w,this.m[5]+=this.m[1]*S+this.m[3]*w,this}scale(S,w){return this.m[0]*=S,this.m[1]*=S,this.m[2]*=w,this.m[3]*=w,this}rotate(S){var w=Math.cos(S),E=Math.sin(S),P=this.m[0]*w+this.m[2]*E,A=this.m[1]*w+this.m[3]*E,N=this.m[0]*-E+this.m[2]*w,k=this.m[1]*-E+this.m[3]*w;return this.m[0]=P,this.m[1]=A,this.m[2]=N,this.m[3]=k,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(S,w){var E=this.m[0]+this.m[2]*w,P=this.m[1]+this.m[3]*w,A=this.m[2]+this.m[0]*S,N=this.m[3]+this.m[1]*S;return this.m[0]=E,this.m[1]=P,this.m[2]=A,this.m[3]=N,this}multiply(S){var w=this.m[0]*S.m[0]+this.m[2]*S.m[1],E=this.m[1]*S.m[0]+this.m[3]*S.m[1],P=this.m[0]*S.m[2]+this.m[2]*S.m[3],A=this.m[1]*S.m[2]+this.m[3]*S.m[3],N=this.m[0]*S.m[4]+this.m[2]*S.m[5]+this.m[4],k=this.m[1]*S.m[4]+this.m[3]*S.m[5]+this.m[5];return this.m[0]=w,this.m[1]=E,this.m[2]=P,this.m[3]=A,this.m[4]=N,this.m[5]=k,this}invert(){var S=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),w=this.m[3]*S,E=-this.m[1]*S,P=-this.m[2]*S,A=this.m[0]*S,N=S*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),k=S*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=w,this.m[1]=E,this.m[2]=P,this.m[3]=A,this.m[4]=N,this.m[5]=k,this}getMatrix(){return this.m}decompose(){var S=this.m[0],w=this.m[1],E=this.m[2],P=this.m[3],A=this.m[4],N=this.m[5],k=S*P-w*E;let U={x:A,y:N,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(S!=0||w!=0){var j=Math.sqrt(S*S+w*w);U.rotation=w>0?Math.acos(S/j):-Math.acos(S/j),U.scaleX=j,U.scaleY=k/j,U.skewX=(S*E+w*P)/k,U.skewY=0}else if(E!=0||P!=0){var X=Math.sqrt(E*E+P*P);U.rotation=Math.PI/2-(P>0?Math.acos(-E/X):-Math.acos(E/X)),U.scaleX=k/X,U.scaleY=X,U.skewX=0,U.skewY=(S*E+w*P)/k}return U.rotation=i.Util._getRotation(U.rotation),U}}i.Transform=e;var r="[object Array]",n="[object Number]",o="[object String]",m="[object Boolean]",a=Math.PI/180,s=180/Math.PI,h="#",d="",l="0",u="Konva warning: ",c="Konva error: ",f="rgb(",v={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},p=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,y=[];const b=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(x){setTimeout(x,60)};i.Util={_isElement(x){return!!(x&&x.nodeType==1)},_isFunction(x){return!!(x&&x.constructor&&x.call&&x.apply)},_isPlainObject(x){return!!x&&x.constructor===Object},_isArray(x){return Object.prototype.toString.call(x)===r},_isNumber(x){return Object.prototype.toString.call(x)===n&&!isNaN(x)&&isFinite(x)},_isString(x){return Object.prototype.toString.call(x)===o},_isBoolean(x){return Object.prototype.toString.call(x)===m},isObject(x){return x instanceof Object},isValidSelector(x){if(typeof x!="string")return!1;var S=x[0];return S==="#"||S==="."||S===S.toUpperCase()},_sign(x){return x===0||x>0?1:-1},requestAnimFrame(x){y.push(x),y.length===1&&b(function(){const S=y;y=[],S.forEach(function(w){w()})})},createCanvasElement(){var x=document.createElement("canvas");try{x.style=x.style||{}}catch{}return x},createImageElement(){return document.createElement("img")},_isInDocument(x){for(;x=x.parentNode;)if(x==document)return!0;return!1},_urlToImage(x,S){var w=i.Util.createImageElement();w.onload=function(){S(w)},w.src=x},_rgbToHex(x,S,w){return((1<<24)+(x<<16)+(S<<8)+w).toString(16).slice(1)},_hexToRgb(x){x=x.replace(h,d);var S=parseInt(x,16);return{r:S>>16&255,g:S>>8&255,b:S&255}},getRandomColor(){for(var x=(Math.random()*16777215<<0).toString(16);x.length<6;)x=l+x;return h+x},getRGB(x){var S;return x in v?(S=v[x],{r:S[0],g:S[1],b:S[2]}):x[0]===h?this._hexToRgb(x.substring(1)):x.substr(0,4)===f?(S=p.exec(x.replace(/ /g,"")),{r:parseInt(S[1],10),g:parseInt(S[2],10),b:parseInt(S[3],10)}):{r:0,g:0,b:0}},colorToRGBA(x){return x=x||"black",i.Util._namedColorToRBA(x)||i.Util._hex3ColorToRGBA(x)||i.Util._hex4ColorToRGBA(x)||i.Util._hex6ColorToRGBA(x)||i.Util._hex8ColorToRGBA(x)||i.Util._rgbColorToRGBA(x)||i.Util._rgbaColorToRGBA(x)||i.Util._hslColorToRGBA(x)},_namedColorToRBA(x){var S=v[x.toLowerCase()];return S?{r:S[0],g:S[1],b:S[2],a:1}:null},_rgbColorToRGBA(x){if(x.indexOf("rgb(")===0){x=x.match(/rgb\(([^)]+)\)/)[1];var S=x.split(/ *, */).map(Number);return{r:S[0],g:S[1],b:S[2],a:1}}},_rgbaColorToRGBA(x){if(x.indexOf("rgba(")===0){x=x.match(/rgba\(([^)]+)\)/)[1];var S=x.split(/ *, */).map((w,E)=>w.slice(-1)==="%"?E===3?parseInt(w)/100:parseInt(w)/100*255:Number(w));return{r:S[0],g:S[1],b:S[2],a:S[3]}}},_hex8ColorToRGBA(x){if(x[0]==="#"&&x.length===9)return{r:parseInt(x.slice(1,3),16),g:parseInt(x.slice(3,5),16),b:parseInt(x.slice(5,7),16),a:parseInt(x.slice(7,9),16)/255}},_hex6ColorToRGBA(x){if(x[0]==="#"&&x.length===7)return{r:parseInt(x.slice(1,3),16),g:parseInt(x.slice(3,5),16),b:parseInt(x.slice(5,7),16),a:1}},_hex4ColorToRGBA(x){if(x[0]==="#"&&x.length===5)return{r:parseInt(x[1]+x[1],16),g:parseInt(x[2]+x[2],16),b:parseInt(x[3]+x[3],16),a:parseInt(x[4]+x[4],16)/255}},_hex3ColorToRGBA(x){if(x[0]==="#"&&x.length===4)return{r:parseInt(x[1]+x[1],16),g:parseInt(x[2]+x[2],16),b:parseInt(x[3]+x[3],16),a:1}},_hslColorToRGBA(x){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(x)){const[S,...w]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(x),E=Number(w[0])/360,P=Number(w[1])/100,A=Number(w[2])/100;let N,k,U;if(P===0)return U=A*255,{r:Math.round(U),g:Math.round(U),b:Math.round(U),a:1};A<.5?N=A*(1+P):N=A+P-A*P;const j=2*A-N,X=[0,0,0];for(let W=0;W<3;W++)k=E+1/3*-(W-1),k<0&&k++,k>1&&k--,6*k<1?U=j+(N-j)*6*k:2*k<1?U=N:3*k<2?U=j+(N-j)*(2/3-k)*6:U=j,X[W]=U*255;return{r:Math.round(X[0]),g:Math.round(X[1]),b:Math.round(X[2]),a:1}}},haveIntersection(x,S){return!(S.x>x.x+x.width||S.x+S.width<x.x||S.y>x.y+x.height||S.y+S.height<x.y)},cloneObject(x){var S={};for(var w in x)this._isPlainObject(x[w])?S[w]=this.cloneObject(x[w]):this._isArray(x[w])?S[w]=this.cloneArray(x[w]):S[w]=x[w];return S},cloneArray(x){return x.slice(0)},degToRad(x){return x*a},radToDeg(x){return x*s},_degToRad(x){return i.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),i.Util.degToRad(x)},_radToDeg(x){return i.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),i.Util.radToDeg(x)},_getRotation(x){return t.Konva.angleDeg?i.Util.radToDeg(x):x},_capitalize(x){return x.charAt(0).toUpperCase()+x.slice(1)},throw(x){throw new Error(c+x)},error(x){console.error(c+x)},warn(x){t.Konva.showWarnings&&console.warn(u+x)},each(x,S){for(var w in x)S(w,x[w])},_inRange(x,S,w){return S<=x&&x<w},_getProjectionToSegment(x,S,w,E,P,A){var N,k,U,j=(x-w)*(x-w)+(S-E)*(S-E);if(j==0)N=x,k=S,U=(P-w)*(P-w)+(A-E)*(A-E);else{var X=((P-x)*(w-x)+(A-S)*(E-S))/j;X<0?(N=x,k=S,U=(x-P)*(x-P)+(S-A)*(S-A)):X>1?(N=w,k=E,U=(w-P)*(w-P)+(E-A)*(E-A)):(N=x+X*(w-x),k=S+X*(E-S),U=(N-P)*(N-P)+(k-A)*(k-A))}return[N,k,U]},_getProjectionToLine(x,S,w){var E=i.Util.cloneObject(x),P=Number.MAX_VALUE;return S.forEach(function(A,N){if(!(!w&&N===S.length-1)){var k=S[(N+1)%S.length],U=i.Util._getProjectionToSegment(A.x,A.y,k.x,k.y,x.x,x.y),j=U[0],X=U[1],W=U[2];W<P&&(E.x=j,E.y=X,P=W)}}),E},_prepareArrayForTween(x,S,w){var E,P=[],A=[];if(x.length>S.length){var N=S;S=x,x=N}for(E=0;E<x.length;E+=2)P.push({x:x[E],y:x[E+1]});for(E=0;E<S.length;E+=2)A.push({x:S[E],y:S[E+1]});var k=[];return A.forEach(function(U){var j=i.Util._getProjectionToLine(U,P,w);k.push(j.x),k.push(j.y)}),k},_prepareToStringify(x){var S;x.visitedByCircularReferenceRemoval=!0;for(var w in x)if(x.hasOwnProperty(w)&&x[w]&&typeof x[w]=="object"){if(S=Object.getOwnPropertyDescriptor(x,w),x[w].visitedByCircularReferenceRemoval||i.Util._isElement(x[w]))if(S.configurable)delete x[w];else return null;else if(i.Util._prepareToStringify(x[w])===null)if(S.configurable)delete x[w];else return null}return delete x.visitedByCircularReferenceRemoval,x},_assign(x,S){for(var w in S)x[w]=S[w];return x},_getFirstPointerId(x){return x.touches?x.changedTouches[0].identifier:x.pointerId||999},releaseCanvas(...x){t.Konva.releaseCanvasOnDestroy&&x.forEach(S=>{S.width=0,S.height=0})},drawRoundedRectPath(x,S,w,E){let P=0,A=0,N=0,k=0;typeof E=="number"?P=A=N=k=Math.min(E,S/2,w/2):(P=Math.min(E[0]||0,S/2,w/2),A=Math.min(E[1]||0,S/2,w/2),k=Math.min(E[2]||0,S/2,w/2),N=Math.min(E[3]||0,S/2,w/2)),x.moveTo(P,0),x.lineTo(S-A,0),x.arc(S-A,A,A,Math.PI*3/2,0,!1),x.lineTo(S,w-k),x.arc(S-k,w-k,k,0,Math.PI/2,!1),x.lineTo(N,w),x.arc(N,w-N,N,Math.PI/2,Math.PI,!1),x.lineTo(0,P),x.arc(P,P,P,Math.PI,Math.PI*3/2,!1)}}})(Ie);var we={},$t={},Mt={};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.getComponentValidator=Mt.getBooleanValidator=Mt.getNumberArrayValidator=Mt.getFunctionValidator=Mt.getStringOrGradientValidator=Mt.getStringValidator=Mt.getNumberOrAutoValidator=Mt.getNumberOrArrayOfNumbersValidator=Mt.getNumberValidator=Mt.alphaComponent=Mt.RGBComponent=void 0;const Jr=qt,Re=Ie;function Qr(i){return Re.Util._isString(i)?'"'+i+'"':Object.prototype.toString.call(i)==="[object Number]"||Re.Util._isBoolean(i)?i:Object.prototype.toString.call(i)}function a8(i){return i>255?255:i<0?0:Math.round(i)}Mt.RGBComponent=a8;function o8(i){return i>1?1:i<1e-4?1e-4:i}Mt.alphaComponent=o8;function h8(){if(Jr.Konva.isUnminified)return function(i,t){return Re.Util._isNumber(i)||Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),i}}Mt.getNumberValidator=h8;function l8(i){if(Jr.Konva.isUnminified)return function(t,e){let r=Re.Util._isNumber(t),n=Re.Util._isArray(t)&&t.length==i;return!r&&!n&&Re.Util.warn(Qr(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or Array<number>('+i+")"),t}}Mt.getNumberOrArrayOfNumbersValidator=l8;function c8(){if(Jr.Konva.isUnminified)return function(i,t){var e=Re.Util._isNumber(i),r=i==="auto";return e||r||Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),i}}Mt.getNumberOrAutoValidator=c8;function u8(){if(Jr.Konva.isUnminified)return function(i,t){return Re.Util._isString(i)||Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),i}}Mt.getStringValidator=u8;function f8(){if(Jr.Konva.isUnminified)return function(i,t){const e=Re.Util._isString(i),r=Object.prototype.toString.call(i)==="[object CanvasGradient]"||i&&i.addColorStop;return e||r||Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),i}}Mt.getStringOrGradientValidator=f8;function d8(){if(Jr.Konva.isUnminified)return function(i,t){return Re.Util._isFunction(i)||Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a function.'),i}}Mt.getFunctionValidator=d8;function g8(){if(Jr.Konva.isUnminified)return function(i,t){const e=Int8Array?Object.getPrototypeOf(Int8Array):null;return e&&i instanceof e||(Re.Util._isArray(i)?i.forEach(function(r){Re.Util._isNumber(r)||Re.Util.warn('"'+t+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")}):Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.')),i}}Mt.getNumberArrayValidator=g8;function p8(){if(Jr.Konva.isUnminified)return function(i,t){var e=i===!0||i===!1;return e||Re.Util.warn(Qr(i)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),i}}Mt.getBooleanValidator=p8;function m8(i){if(Jr.Konva.isUnminified)return function(t,e){return t==null||Re.Util.isObject(t)||Re.Util.warn(Qr(t)+' is a not valid value for "'+e+'" attribute. The value should be an object with properties '+i),t}}Mt.getComponentValidator=m8;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Factory=void 0;const t=Ie,e=Mt;var r="get",n="set";i.Factory={addGetterSetter(o,m,a,s,h){i.Factory.addGetter(o,m,a),i.Factory.addSetter(o,m,s,h),i.Factory.addOverloadedGetterSetter(o,m)},addGetter(o,m,a){var s=r+t.Util._capitalize(m);o.prototype[s]=o.prototype[s]||function(){var h=this.attrs[m];return h===void 0?a:h}},addSetter(o,m,a,s){var h=n+t.Util._capitalize(m);o.prototype[h]||i.Factory.overWriteSetter(o,m,a,s)},overWriteSetter(o,m,a,s){var h=n+t.Util._capitalize(m);o.prototype[h]=function(d){return a&&d!==void 0&&d!==null&&(d=a.call(this,d,m)),this._setAttr(m,d),s&&s.call(this),this}},addComponentsGetterSetter(o,m,a,s,h){var d=a.length,l=t.Util._capitalize,u=r+l(m),c=n+l(m),f,v;o.prototype[u]=function(){var y={};for(f=0;f<d;f++)v=a[f],y[v]=this.getAttr(m+l(v));return y};var p=(0,e.getComponentValidator)(a);o.prototype[c]=function(y){var b=this.attrs[m],x;s&&(y=s.call(this,y)),p&&p.call(this,y,m);for(x in y)y.hasOwnProperty(x)&&this._setAttr(m+l(x),y[x]);return y||a.forEach(S=>{this._setAttr(m+l(S),void 0)}),this._fireChangeEvent(m,b,y),h&&h.call(this),this},i.Factory.addOverloadedGetterSetter(o,m)},addOverloadedGetterSetter(o,m){var a=t.Util._capitalize(m),s=n+a,h=r+a;o.prototype[m]=function(){return arguments.length?(this[s](arguments[0]),this):this[h]()}},addDeprecatedGetterSetter(o,m,a,s){t.Util.error("Adding deprecated "+m);var h=r+t.Util._capitalize(m),d=m+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[h]=function(){t.Util.error(d);var l=this.attrs[m];return l===void 0?a:l},i.Factory.addSetter(o,m,s,function(){t.Util.error(d)}),i.Factory.addOverloadedGetterSetter(o,m)},backCompat(o,m){t.Util.each(m,function(a,s){var h=o.prototype[s],d=r+t.Util._capitalize(a),l=n+t.Util._capitalize(a);function u(){h.apply(this,arguments),t.Util.error('"'+a+'" method is deprecated and will be removed soon. Use ""'+s+'" instead.')}o.prototype[a]=u,o.prototype[d]=u,o.prototype[l]=u})},afterSetFilter(){this._filterUpToDate=!1}}})($t);var lr={},Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});Kr.HitContext=Kr.SceneContext=Kr.Context=void 0;const B1=Ie,v8=qt;function _8(i){var t=[],e=i.length,r=B1.Util,n,o;for(n=0;n<e;n++)o=i[n],r._isNumber(o)?o=Math.round(o*1e3)/1e3:r._isString(o)||(o=o+""),t.push(o);return t}var vv=",",y8="(",x8=")",b8="([",S8="])",C8=";",w8="()",T8="=",_v=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],E8=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const A8=100;class Rl{constructor(t){this.canvas=t,v8.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var r=this.traceArr,n=r.length,o="",m,a,s,h;for(m=0;m<n;m++)a=r[m],s=a.method,s?(h=a.args,o+=s,t?o+=w8:B1.Util._isArray(h[0])?o+=b8+h.join(vv)+S8:(e&&(h=h.map(d=>typeof d=="number"?Math.floor(d):d)),o+=y8+h.join(vv)+x8)):(o+=a.property,t||(o+=T8+a.val)),o+=C8;return o}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr,r;e.push(t),r=e.length,r>=A8&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();e!==1&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,r,n,o,m){this._context.arc(t,e,r,n,o,m)}arcTo(t,e,r,n,o){this._context.arcTo(t,e,r,n,o)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,r,n,o,m){this._context.bezierCurveTo(t,e,r,n,o,m)}clearRect(t,e,r,n){this._context.clearRect(t,e,r,n)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){var r=arguments;if(r.length===2)return this._context.createImageData(t,e);if(r.length===1)return this._context.createImageData(t)}createLinearGradient(t,e,r,n){return this._context.createLinearGradient(t,e,r,n)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,r,n,o,m){return this._context.createRadialGradient(t,e,r,n,o,m)}drawImage(t,e,r,n,o,m,a,s,h){var d=arguments,l=this._context;d.length===3?l.drawImage(t,e,r):d.length===5?l.drawImage(t,e,r,n,o):d.length===9&&l.drawImage(t,e,r,n,o,m,a,s,h)}ellipse(t,e,r,n,o,m,a,s){this._context.ellipse(t,e,r,n,o,m,a,s)}isPointInPath(t,e,r,n){return r?this._context.isPointInPath(r,t,e,n):this._context.isPointInPath(t,e,n)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,r,n){this._context.fillRect(t,e,r,n)}strokeRect(t,e,r,n){this._context.strokeRect(t,e,r,n)}fillText(t,e,r,n){n?this._context.fillText(t,e,r,n):this._context.fillText(t,e,r)}measureText(t){return this._context.measureText(t)}getImageData(t,e,r,n){return this._context.getImageData(t,e,r,n)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,r,n){this._context.rect(t,e,r,n)}putImageData(t,e,r){this._context.putImageData(t,e,r)}quadraticCurveTo(t,e,r,n){this._context.quadraticCurveTo(t,e,r,n)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,r,n,o,m){this._context.setTransform(t,e,r,n,o,m)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,r,n){this._context.strokeText(t,e,r,n)}transform(t,e,r,n,o,m){this._context.transform(t,e,r,n,o,m)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t=this,e=_v.length,r=this.setAttr,n,o,m=function(a){var s=t[a],h;t[a]=function(){return o=_8(Array.prototype.slice.call(arguments,0)),h=s.apply(t,arguments),t._trace({method:a,args:o}),h}};for(n=0;n<e;n++)m(_v[n]);t.setAttr=function(){r.apply(t,arguments);var a=arguments[0],s=arguments[1];(a==="shadowOffsetX"||a==="shadowOffsetY"||a==="shadowBlur")&&(s=s/this.canvas.getPixelRatio()),t._trace({property:a,val:s})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;var r=!e||e==="source-over";r||this.setAttr("globalCompositeOperation",e)}}Kr.Context=Rl;E8.forEach(function(i){Object.defineProperty(Rl.prototype,i,{get(){return this._context[i]},set(t){this._context[i]=t}})});class P8 extends Rl{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),r=t.getFillPriority();if(e&&r==="color"){this._fillColor(t);return}const n=t.getFillPatternImage();if(n&&r==="pattern"){this._fillPattern(t);return}const o=t.getFillLinearGradientColorStops();if(o&&r==="linear-gradient"){this._fillLinearGradient(t);return}const m=t.getFillRadialGradientColorStops();if(m&&r==="radial-gradient"){this._fillRadialGradient(t);return}e?this._fillColor(t):n?this._fillPattern(t):o?this._fillLinearGradient(t):m&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),r=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),o=this.createLinearGradient(e.x,e.y,r.x,r.y);if(n){for(var m=0;m<n.length;m+=2)o.addColorStop(n[m],n[m+1]);this.setAttr("strokeStyle",o)}}_stroke(t){var e=t.dash(),r=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!r){this.save();var n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var o=t.getStrokeLinearGradientColorStops();o?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),r||this.restore()}}_applyShadow(t){var e,r,n,o=(e=t.getShadowRGBA())!==null&&e!==void 0?e:"black",m=(r=t.getShadowBlur())!==null&&r!==void 0?r:5,a=(n=t.getShadowOffset())!==null&&n!==void 0?n:{x:0,y:0},s=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),d=s.x*h,l=s.y*h;this.setAttr("shadowColor",o),this.setAttr("shadowBlur",m*Math.min(Math.abs(d),Math.abs(l))),this.setAttr("shadowOffsetX",a.x*d),this.setAttr("shadowOffsetY",a.y*l)}}Kr.SceneContext=P8;class I8 extends Rl{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const o=t.getStrokeScaleEnabled();if(!o){this.save();var e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(t);var r=t.hitStrokeWidth(),n=r==="auto"?t.strokeWidth():r;this.setAttr("lineWidth",n),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),o||this.restore()}}}Kr.HitContext=I8;Object.defineProperty(lr,"__esModule",{value:!0});lr.HitCanvas=lr.SceneCanvas=lr.Canvas=void 0;const fl=Ie,N1=Kr,U1=qt,M8=$t,O8=Mt;var Rh;function R8(){if(Rh)return Rh;var i=fl.Util.createCanvasElement(),t=i.getContext("2d");return Rh=function(){var e=U1.Konva._global.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/r}(),fl.Util.releaseCanvas(i),Rh}class Dl{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=t||{},r=e.pixelRatio||U1.Konva.pixelRatio||R8();this.pixelRatio=r,this._canvas=fl.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio,r=this.getContext()._context;r.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio,r=this.getContext()._context;r.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch{try{return this._canvas.toDataURL()}catch(n){return fl.Util.error("Unable to get data URL. "+n.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}lr.Canvas=Dl;M8.Factory.addGetterSetter(Dl,"pixelRatio",void 0,(0,O8.getNumberValidator)());class D8 extends Dl{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new N1.SceneContext(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}lr.SceneCanvas=D8;class F8 extends Dl{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new N1.HitContext(this),this.setSize(t.width,t.height)}}lr.HitCanvas=F8;var Fl={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.DD=void 0;const t=qt,e=Ie;i.DD={get isDragging(){var r=!1;return i.DD._dragElements.forEach(n=>{n.dragStatus==="dragging"&&(r=!0)}),r},justDragged:!1,get node(){var r;return i.DD._dragElements.forEach(n=>{r=n.node}),r},_dragElements:new Map,_drag(r){const n=[];i.DD._dragElements.forEach((o,m)=>{const{node:a}=o,s=a.getStage();s.setPointersPositions(r),o.pointerId===void 0&&(o.pointerId=e.Util._getFirstPointerId(r));const h=s._changedPointerPositions.find(u=>u.id===o.pointerId);if(h){if(o.dragStatus!=="dragging"){var d=a.dragDistance(),l=Math.max(Math.abs(h.x-o.startPointerPos.x),Math.abs(h.y-o.startPointerPos.y));if(l<d||(a.startDrag({evt:r}),!a.isDragging()))return}a._setDragPosition(r,o),n.push(a)}}),n.forEach(o=>{o.fire("dragmove",{type:"dragmove",target:o,evt:r},!0)})},_endDragBefore(r){const n=[];i.DD._dragElements.forEach(o=>{const{node:m}=o,a=m.getStage();if(r&&a.setPointersPositions(r),!a._changedPointerPositions.find(d=>d.id===o.pointerId))return;(o.dragStatus==="dragging"||o.dragStatus==="stopped")&&(i.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,o.dragStatus="stopped");const h=o.node.getLayer()||o.node instanceof t.Konva.Stage&&o.node;h&&n.indexOf(h)===-1&&n.push(h)}),n.forEach(o=>{o.draw()})},_endDragAfter(r){i.DD._dragElements.forEach((n,o)=>{n.dragStatus==="stopped"&&n.node.fire("dragend",{type:"dragend",target:n.node,evt:r},!0),n.dragStatus!=="dragging"&&i.DD._dragElements.delete(o)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",i.DD._endDragBefore,!0),window.addEventListener("touchend",i.DD._endDragBefore,!0),window.addEventListener("mousemove",i.DD._drag),window.addEventListener("touchmove",i.DD._drag),window.addEventListener("mouseup",i.DD._endDragAfter,!1),window.addEventListener("touchend",i.DD._endDragAfter,!1))})(Fl);Object.defineProperty(we,"__esModule",{value:!0});we.Node=void 0;const Qt=Ie,po=$t,Dh=lr,Wn=qt,Hi=Fl,Le=Mt;var Yh="absoluteOpacity",Fh="allEventListeners",Xr="absoluteTransform",yv="absoluteScale",Xn="canvas",L8="Change",k8="children",B8="konva",md="listening",xv="mouseenter",bv="mouseleave",Sv="set",Cv="Shape",$h=" ",wv="stage",dn="transform",N8="Stage",vd="visible",U8=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join($h);let G8=1,Xt=class _d{constructor(t){this._id=G8++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){(t===dn||t===Xr)&&this._cache.get(t)?this._cache.get(t).dirty=!0:t?this._cache.delete(t):this._cache.clear()}_getCache(t,e){var r=this._cache.get(t),n=t===dn||t===Xr,o=r===void 0||n&&r.dirty===!0;return o&&(r=e.call(this),this._cache.set(t,r)),r}_calculate(t,e,r){if(!this._attachedDepsListeners.get(t)){const n=e.map(o=>o+"Change.konva").join($h);this.on(n,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,r)}_getCanvasCache(){return this._cache.get(Xn)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===Xr&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Xn)){const{scene:t,filter:e,hit:r}=this._cache.get(Xn);Qt.Util.releaseCanvas(t,e,r),this._cache.delete(Xn)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},r={};(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)&&(r=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()}));var n=Math.ceil(e.width||r.width),o=Math.ceil(e.height||r.height),m=e.pixelRatio,a=e.x===void 0?Math.floor(r.x):e.x,s=e.y===void 0?Math.floor(r.y):e.y,h=e.offset||0,d=e.drawBorder||!1,l=e.hitCanvasPixelRatio||1;if(!n||!o){Qt.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}n+=h*2+1,o+=h*2+1,a-=h,s-=h;var u=new Dh.SceneCanvas({pixelRatio:m,width:n,height:o}),c=new Dh.SceneCanvas({pixelRatio:m,width:0,height:0,willReadFrequently:!0}),f=new Dh.HitCanvas({pixelRatio:l,width:n,height:o}),v=u.getContext(),p=f.getContext();return f.isCache=!0,u.isCache=!0,this._cache.delete(Xn),this._filterUpToDate=!1,e.imageSmoothingEnabled===!1&&(u.getContext()._context.imageSmoothingEnabled=!1,c.getContext()._context.imageSmoothingEnabled=!1),v.save(),p.save(),v.translate(-a,-s),p.translate(-a,-s),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Yh),this._clearSelfAndDescendantCache(yv),this.drawScene(u,this),this.drawHit(f,this),this._isUnderCache=!1,v.restore(),p.restore(),d&&(v.save(),v.beginPath(),v.rect(0,0,n,o),v.closePath(),v.setAttr("strokeStyle","red"),v.setAttr("lineWidth",5),v.stroke(),v.restore()),this._cache.set(Xn,{scene:u,filter:c,hit:f,x:a,y:s}),this._requestDraw(),this}isCached(){return this._cache.has(Xn)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var r=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],n,o,m,a,s=this.getAbsoluteTransform(e);return r.forEach(function(h){var d=s.point(h);n===void 0&&(n=m=d.x,o=a=d.y),n=Math.min(n,d.x),o=Math.min(o,d.y),m=Math.max(m,d.x),a=Math.max(a,d.y)}),{x:n,y:o,width:m-n,height:a-o}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var r=this._getCachedSceneCanvas(),n=r.pixelRatio;t.drawImage(r._canvas,0,0,r.width/n,r.height/n),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),r=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(r._canvas,0,0,r.width/r.pixelRatio,r.height/r.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t=this.filters(),e=this._getCanvasCache(),r=e.scene,n=e.filter,o=n.getContext(),m,a,s,h;if(t){if(!this._filterUpToDate){var d=r.pixelRatio;n.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio);try{for(m=t.length,o.clear(),o.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),a=o.getImageData(0,0,n.getWidth(),n.getHeight()),s=0;s<m;s++){if(h=t[s],typeof h!="function"){Qt.Util.error("Filter should be type of function, but got "+typeof h+" instead. Please check correct filters");continue}h.call(this,a),o.putImageData(a,0,0)}}catch(l){Qt.Util.error("Unable to apply filter. "+l.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return n}return r}on(t,e){if(this._cache&&this._cache.delete(Fh),arguments.length===3)return this._delegate.apply(this,arguments);var r=t.split($h),n=r.length,o,m,a,s,h;for(o=0;o<n;o++)m=r[o],a=m.split("."),s=a[0],h=a[1]||"",this.eventListeners[s]||(this.eventListeners[s]=[]),this.eventListeners[s].push({name:h,handler:e});return this}off(t,e){var r=(t||"").split($h),n=r.length,o,m,a,s,h,d;if(this._cache&&this._cache.delete(Fh),!t)for(m in this.eventListeners)this._off(m);for(o=0;o<n;o++)if(a=r[o],s=a.split("."),h=s[0],d=s[1],h)this.eventListeners[h]&&this._off(h,d,e);else for(m in this.eventListeners)this._off(m,d,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(r){e.call(this,r.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,r){var n=this;this.on(t,function(o){for(var m=o.target.findAncestors(e,!0,n),a=0;a<m.length;a++)o=Qt.Util.cloneObject(o),o.currentTarget=m[a],r.call(m[a],o)})}remove(){return this.isDragging()&&this.stopDrag(),Hi.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Xr),this._clearSelfAndDescendantCache(Yh),this._clearSelfAndDescendantCache(yv),this._clearSelfAndDescendantCache(wv),this._clearSelfAndDescendantCache(vd),this._clearSelfAndDescendantCache(md)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+Qt.Util._capitalize(t);return Qt.Util._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{var e,r;if(!t)return this;for(e in t)e!==k8&&(r=Sv+Qt.Util._capitalize(e),Qt.Util._isFunction(this[r])?this[r](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(md,this._isListening)}_isListening(t){if(!this.listening())return!1;const r=this.getParent();return r&&r!==t&&this!==t?r._isListening(t):!0}isVisible(){return this._getCache(vd,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const r=this.getParent();return r&&r!==t&&this!==t?r._isVisible(t):!0}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var r=this.getLayer(),n=!1;Hi.DD._dragElements.forEach(m=>{m.dragStatus==="dragging"&&(m.node.nodeType==="Stage"||m.node.getLayer()===r)&&(n=!0)});var o=!e&&!Wn.Konva.hitOnDragEnabled&&n;return this.isListening()&&this.isVisible()&&!o}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t=this.getDepth(),e=this,r=0,n,o,m,a;function s(h){for(n=[],o=h.length,m=0;m<o;m++)a=h[m],r++,a.nodeType!==Cv&&(n=n.concat(a.getChildren().slice())),a._id===e._id&&(m=o);n.length>0&&n[0].getDepth()<=t&&s(n)}return e.nodeType!==N8&&s(e.getStage().getChildren()),r}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(dn),this._clearSelfAndDescendantCache(Xr)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){if(!this.getStage())return null;var t=this.getStage().getPointerPosition();if(!t)return null;var e=this.getAbsoluteTransform().copy();return e.invert(),e.point(t)}getAbsolutePosition(t){let e=!1,r=this.parent;for(;r;){if(r.isCached()){e=!0;break}r=r.parent}e&&!t&&(t=!0);var n=this.getAbsoluteTransform(t).getMatrix(),o=new Qt.Transform,m=this.offset();return o.m=n.slice(),o.translate(m.x,m.y),o.getTranslation()}setAbsolutePosition(t){var e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y,this._clearCache(dn);var r=this._getAbsoluteTransform().copy();return r.invert(),r.translate(t.x,t.y),t={x:this.attrs.x+r.getTranslation().x,y:this.attrs.y+r.getTranslation().y},this._setTransform(e),this.setPosition({x:t.x,y:t.y}),this._clearCache(dn),this._clearSelfAndDescendantCache(Xr),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,r=t.y,n=this.x(),o=this.y();return e!==void 0&&(n+=e),r!==void 0&&(o+=r),this.setPosition({x:n,y:o}),this}_eachAncestorReverse(t,e){var r=[],n=this.getParent(),o,m;if(!(e&&e._id===this._id)){for(r.unshift(this);n&&(!e||n._id!==e._id);)r.unshift(n),n=n.parent;for(o=r.length,m=0;m<o;m++)t(r[m])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return Qt.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return Qt.Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return Qt.Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return Qt.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(t){if(!this.parent)return Qt.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&Qt.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Yh,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t={},e=this.getAttrs(),r,n,o,m,a;t.attrs={};for(r in e)n=e[r],a=Qt.Util.isObject(n)&&!Qt.Util._isPlainObject(n)&&!Qt.Util._isArray(n),!a&&(o=typeof this[r]=="function"&&this[r],delete e[r],m=o?o.call(this):null,e[r]=n,m!==n&&(t.attrs[r]=n));return t.className=this.getClassName(),Qt.Util._prepareToStringify(t)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,r){var n=[];e&&this._isMatch(t)&&n.push(this);for(var o=this.parent;o;){if(o===r)return n;o._isMatch(t)&&n.push(o),o=o.parent}return n}isAncestorOf(t){return!1}findAncestor(t,e,r){return this.findAncestors(t,e,r)[0]}_isMatch(t){if(!t)return!1;if(typeof t=="function")return t(this);var e=t.replace(/ /g,"").split(","),r=e.length,n,o;for(n=0;n<r;n++)if(o=e[n],Qt.Util.isValidSelector(o)||(Qt.Util.warn('Selector "'+o+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Qt.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),Qt.Util.warn("Konva is awesome, right?")),o.charAt(0)==="#"){if(this.id()===o.slice(1))return!0}else if(o.charAt(0)==="."){if(this.hasName(o.slice(1)))return!0}else if(this.className===o||this.nodeType===o)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(wv,this._getStage)}_getStage(){var t=this.getParent();if(t)return t.getStage()}fire(t,e={},r){return e.target=e.target||this,r?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(Xr,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new Qt.Transform,this._eachAncestorReverse(function(n){var o=n.transformsEnabled();o==="all"?e.multiply(n.getTransform()):o==="position"&&e.translate(n.x()-n.offsetX(),n.y()-n.offsetY())},t),e;e=this._cache.get(Xr)||new Qt.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var r=this.transformsEnabled();if(r==="all")e.multiply(this.getTransform());else if(r==="position"){const n=this.attrs.x||0,o=this.attrs.y||0,m=this.attrs.offsetX||0,a=this.attrs.offsetY||0;e.translate(n-m,o-a)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const n=this.getAbsoluteTransform(t).decompose();return{x:n.scaleX,y:n.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(dn,this._getTransform)}_getTransform(){var t,e,r=this._cache.get(dn)||new Qt.Transform;r.reset();var n=this.x(),o=this.y(),m=Wn.Konva.getAngle(this.rotation()),a=(t=this.attrs.scaleX)!==null&&t!==void 0?t:1,s=(e=this.attrs.scaleY)!==null&&e!==void 0?e:1,h=this.attrs.skewX||0,d=this.attrs.skewY||0,l=this.attrs.offsetX||0,u=this.attrs.offsetY||0;return(n!==0||o!==0)&&r.translate(n,o),m!==0&&r.rotate(m),(h!==0||d!==0)&&r.skew(h,d),(a!==1||s!==1)&&r.scale(a,s),(l!==0||u!==0)&&r.translate(-1*l,-1*u),r.dirty=!1,r}clone(t){var e=Qt.Util.cloneObject(this.attrs),r,n,o,m,a;for(r in t)e[r]=t[r];var s=new this.constructor(e);for(r in this.eventListeners)for(n=this.eventListeners[r],o=n.length,m=0;m<o;m++)a=n[m],a.name.indexOf(B8)<0&&(s.eventListeners[r]||(s.eventListeners[r]=[]),s.eventListeners[r].push(a));return s}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),r=this.getStage(),n=t.x!==void 0?t.x:Math.floor(e.x),o=t.y!==void 0?t.y:Math.floor(e.y),m=t.pixelRatio||1,a=new Dh.SceneCanvas({width:t.width||Math.ceil(e.width)||(r?r.width():0),height:t.height||Math.ceil(e.height)||(r?r.height():0),pixelRatio:m}),s=a.getContext();return t.imageSmoothingEnabled===!1&&(s._context.imageSmoothingEnabled=!1),s.save(),(n||o)&&s.translate(-1*n,-1*o),this.drawScene(a),s.restore(),a}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){t=t||{};var e=t.mimeType||null,r=t.quality||null,n=this._toKonvaCanvas(t).toDataURL(e,r);return t.callback&&t.callback(n),n}toImage(t){return new Promise((e,r)=>{try{const n=t==null?void 0:t.callback;n&&delete t.callback,Qt.Util._urlToImage(this.toDataURL(t),function(o){e(o),n==null||n(o)})}catch(n){r(n)}})}toBlob(t){return new Promise((e,r)=>{try{const n=t==null?void 0:t.callback;n&&delete t.callback,this.toCanvas(t).toBlob(o=>{e(o),n==null||n(o)})}catch(n){r(n)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Wn.Konva.dragDistance}_off(t,e,r){var n=this.eventListeners[t],o,m,a;for(o=0;o<n.length;o++)if(m=n[o].name,a=n[o].handler,(m!=="konva"||e==="konva")&&(!e||m===e)&&(!r||r===a)){if(n.splice(o,1),n.length===0){delete this.eventListeners[t];break}o--}}_fireChangeEvent(t,e,r){this._fire(t+L8,{oldVal:e,newVal:r})}addName(t){if(!this.hasName(t)){var e=this.name(),r=e?e+" "+t:t;this.name(r)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;var r=(e||"").split(/\s/g);return r.indexOf(t)!==-1}removeName(t){var e=(this.name()||"").split(/\s/g),r=e.indexOf(t);return r!==-1&&(e.splice(r,1),this.name(e.join(" "))),this}setAttr(t,e){var r=this[Sv+Qt.Util._capitalize(t)];return Qt.Util._isFunction(r)?r.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(Wn.Konva.autoDrawEnabled){const t=this.getLayer()||this.getStage();t==null||t.batchDraw()}}_setAttr(t,e){var r=this.attrs[t];r===e&&!Qt.Util.isObject(e)||(e==null?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,r,e),this._requestDraw())}_setComponentAttr(t,e,r){var n;r!==void 0&&(n=this.attrs[t],n||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=r,this._fireChangeEvent(t,n,r))}_fireAndBubble(t,e,r){e&&this.nodeType===Cv&&(e.target=this);var n=(t===xv||t===bv)&&(r&&(this===r||this.isAncestorOf&&this.isAncestorOf(r))||this.nodeType==="Stage"&&!r);if(!n){this._fire(t,e);var o=(t===xv||t===bv)&&r&&r.isAncestorOf&&r.isAncestorOf(this)&&!r.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!o&&(r&&r.parent?this._fireAndBubble.call(this.parent,t,e,r):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,r,n;const o=(e=this._cache.get(Fh))!==null&&e!==void 0?e:{};let m=o==null?void 0:o[t];if(m===void 0){m=[];let a=Object.getPrototypeOf(this);for(;a;){const s=(n=(r=a.eventListeners)===null||r===void 0?void 0:r[t])!==null&&n!==void 0?n:[];m.push(...s),a=Object.getPrototypeOf(a)}o[t]=m,this._cache.set(Fh,o)}return m}_fire(t,e){e=e||{},e.currentTarget=this,e.type=t;const r=this._getProtoListeners(t);if(r)for(var n=0;n<r.length;n++)r[n].handler.call(this,e);const o=this.eventListeners[t];if(o)for(var n=0;n<o.length;n++)o[n].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,r=this.getStage(),n=this.getAbsolutePosition(),o=r._getPointerById(e)||r._changedPointerPositions[0]||n;Hi.DD._dragElements.set(this._id,{node:this,startPointerPos:o,offset:{x:o.x-n.x,y:o.y-n.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){Hi.DD._dragElements.has(this._id)||this._createDragElement(t);const r=Hi.DD._dragElements.get(this._id);r.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const r=this.getStage()._getPointerById(e.pointerId);if(r){var n={x:r.x-e.offset.x,y:r.y-e.offset.y},o=this.dragBoundFunc();if(o!==void 0){const m=o.call(this,n,t);m?n=m:Qt.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==n.x||this._lastPos.y!==n.y)&&(this.setAbsolutePosition(n),this._requestDraw()),this._lastPos=n}}stopDrag(t){const e=Hi.DD._dragElements.get(this._id);e&&(e.dragStatus="stopped"),Hi.DD._endDragBefore(t),Hi.DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=Hi.DD._dragElements.get(this._id);return t?t.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){var e=t.evt.button!==void 0,r=!e||Wn.Konva.dragButtons.indexOf(t.evt.button)>=0;if(r&&!this.isDragging()){var n=!1;Hi.DD._dragElements.forEach(o=>{this.isAncestorOf(o.node)&&(n=!0)}),n||this._createDragElement(t)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage();if(!t)return;const e=Hi.DD._dragElements.get(this._id),r=e&&e.dragStatus==="dragging",n=e&&e.dragStatus==="ready";r?this.stopDrag():n&&Hi.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const r={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return Qt.Util.haveIntersection(r,this.getClientRect())}static create(t,e){return Qt.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var r=_d.prototype.getClassName.call(t),n=t.children,o,m,a;e&&(t.attrs.container=e),Wn.Konva[r]||(Qt.Util.warn('Can not find a node with class name "'+r+'". Fallback to "Shape".'),r="Shape");const s=Wn.Konva[r];if(o=new s(t.attrs),n)for(m=n.length,a=0;a<m;a++)o.add(_d._createNode(n[a]));return o}};we.Node=Xt;Xt.prototype.nodeType="Node";Xt.prototype._attrsAffectingSize=[];Xt.prototype.eventListeners={};Xt.prototype.on.call(Xt.prototype,U8,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(dn),this._clearSelfAndDescendantCache(Xr)});Xt.prototype.on.call(Xt.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(vd)});Xt.prototype.on.call(Xt.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(md)});Xt.prototype.on.call(Xt.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Yh)});const de=po.Factory.addGetterSetter;de(Xt,"zIndex");de(Xt,"absolutePosition");de(Xt,"position");de(Xt,"x",0,(0,Le.getNumberValidator)());de(Xt,"y",0,(0,Le.getNumberValidator)());de(Xt,"globalCompositeOperation","source-over",(0,Le.getStringValidator)());de(Xt,"opacity",1,(0,Le.getNumberValidator)());de(Xt,"name","",(0,Le.getStringValidator)());de(Xt,"id","",(0,Le.getStringValidator)());de(Xt,"rotation",0,(0,Le.getNumberValidator)());po.Factory.addComponentsGetterSetter(Xt,"scale",["x","y"]);de(Xt,"scaleX",1,(0,Le.getNumberValidator)());de(Xt,"scaleY",1,(0,Le.getNumberValidator)());po.Factory.addComponentsGetterSetter(Xt,"skew",["x","y"]);de(Xt,"skewX",0,(0,Le.getNumberValidator)());de(Xt,"skewY",0,(0,Le.getNumberValidator)());po.Factory.addComponentsGetterSetter(Xt,"offset",["x","y"]);de(Xt,"offsetX",0,(0,Le.getNumberValidator)());de(Xt,"offsetY",0,(0,Le.getNumberValidator)());de(Xt,"dragDistance",null,(0,Le.getNumberValidator)());de(Xt,"width",0,(0,Le.getNumberValidator)());de(Xt,"height",0,(0,Le.getNumberValidator)());de(Xt,"listening",!0,(0,Le.getBooleanValidator)());de(Xt,"preventDefault",!0,(0,Le.getBooleanValidator)());de(Xt,"filters",null,function(i){return this._filterUpToDate=!1,i});de(Xt,"visible",!0,(0,Le.getBooleanValidator)());de(Xt,"transformsEnabled","all",(0,Le.getStringValidator)());de(Xt,"size");de(Xt,"dragBoundFunc");de(Xt,"draggable",!1,(0,Le.getBooleanValidator)());po.Factory.backCompat(Xt,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});var hs={};Object.defineProperty(hs,"__esModule",{value:!0});hs.Container=void 0;const ua=$t,xf=we,Ll=Mt;class ls extends xf.Node{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var r=[];return e.forEach(function(n){t(n)&&r.push(n)}),r}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const r=t[0];return r.getParent()?(r.moveTo(this),this):(this._validateAdd(r),r.index=this.getChildren().length,r.parent=this,r._clearCaches(),this.getChildren().push(r),this._fire("add",{child:r}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var r=[];return this._descendants(n=>{const o=n._isMatch(t);return o&&r.push(n),!!(o&&e)}),r}_descendants(t){let e=!1;const r=this.getChildren();for(const n of r){if(e=t(n),e)return!0;if(n.hasChildren()&&(e=n._descendants(t),e))return!0}return!1}toObject(){var t=xf.Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=xf.Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(r){e.add(r.clone())}),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach(function(r){r.isVisible()&&r.intersects(t)&&e.push(r)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),!this.isCached()&&((e=this.children)===null||e===void 0||e.forEach(function(r){r._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;(t=this.children)===null||t===void 0||t.forEach(function(e,r){e.index=r}),this._requestDraw()}drawScene(t,e){var r=this.getLayer(),n=t||r&&r.getCanvas(),o=n&&n.getContext(),m=this._getCanvasCache(),a=m&&m.scene,s=n&&n.isCache;if(!this.isVisible()&&!s)return this;if(a){o.save();var h=this.getAbsoluteTransform(e).getMatrix();o.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",n,e);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var r=this.getLayer(),n=t||r&&r.hitCanvas,o=n&&n.getContext(),m=this._getCanvasCache(),a=m&&m.hit;if(a){o.save();var s=this.getAbsoluteTransform(e).getMatrix();o.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._drawCachedHitCanvas(o),o.restore()}else this._drawChildren("drawHit",n,e);return this}_drawChildren(t,e,r){var n,o=e&&e.getContext(),m=this.clipWidth(),a=this.clipHeight(),s=this.clipFunc(),h=m&&a||s;const d=r===this;if(h){o.save();var l=this.getAbsoluteTransform(r),u=l.getMatrix();o.transform(u[0],u[1],u[2],u[3],u[4],u[5]),o.beginPath();let p;if(s)p=s.call(this,o,this);else{var c=this.clipX(),f=this.clipY();o.rect(c,f,m,a)}o.clip.apply(o,p),u=l.copy().invert().getMatrix(),o.transform(u[0],u[1],u[2],u[3],u[4],u[5])}var v=!d&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";v&&(o.save(),o._applyGlobalCompositeOperation(this)),(n=this.children)===null||n===void 0||n.forEach(function(p){p[t](e,r)}),v&&o.restore(),h&&o.restore()}getClientRect(t){var e;t=t||{};var r=t.skipTransform,n=t.relativeTo,o,m,a,s,h={x:1/0,y:1/0,width:0,height:0},d=this;(e=this.children)===null||e===void 0||e.forEach(function(v){if(v.visible()){var p=v.getClientRect({relativeTo:d,skipShadow:t.skipShadow,skipStroke:t.skipStroke});p.width===0&&p.height===0||(o===void 0?(o=p.x,m=p.y,a=p.x+p.width,s=p.y+p.height):(o=Math.min(o,p.x),m=Math.min(m,p.y),a=Math.max(a,p.x+p.width),s=Math.max(s,p.y+p.height)))}});for(var l=this.find("Shape"),u=!1,c=0;c<l.length;c++){var f=l[c];if(f._isVisible(this)){u=!0;break}}return u&&o!==void 0?h={x:o,y:m,width:a-o,height:s-m}:h={x:0,y:0,width:0,height:0},r?h:this._transformedRect(h,n)}}hs.Container=ls;ua.Factory.addComponentsGetterSetter(ls,"clip",["x","y","width","height"]);ua.Factory.addGetterSetter(ls,"clipX",void 0,(0,Ll.getNumberValidator)());ua.Factory.addGetterSetter(ls,"clipY",void 0,(0,Ll.getNumberValidator)());ua.Factory.addGetterSetter(ls,"clipWidth",void 0,(0,Ll.getNumberValidator)());ua.Factory.addGetterSetter(ls,"clipHeight",void 0,(0,Ll.getNumberValidator)());ua.Factory.addGetterSetter(ls,"clipFunc");var G1={},Mi={};Object.defineProperty(Mi,"__esModule",{value:!0});Mi.releaseCapture=Mi.setPointerCapture=Mi.hasPointerCapture=Mi.createEvent=Mi.getCapturedShape=void 0;const H8=qt,ao=new Map,H1=H8.Konva._global.PointerEvent!==void 0;function W8(i){return ao.get(i)}Mi.getCapturedShape=W8;function Vd(i){return{evt:i,pointerId:i.pointerId}}Mi.createEvent=Vd;function X8(i,t){return ao.get(i)===t}Mi.hasPointerCapture=X8;function V8(i,t){W1(i),t.getStage()&&(ao.set(i,t),H1&&t._fire("gotpointercapture",Vd(new PointerEvent("gotpointercapture"))))}Mi.setPointerCapture=V8;function W1(i,t){const e=ao.get(i);if(!e)return;const r=e.getStage();r&&r.content,ao.delete(i),H1&&e._fire("lostpointercapture",Vd(new PointerEvent("lostpointercapture")))}Mi.releaseCapture=W1;(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Stage=i.stages=void 0;const t=Ie,e=$t,r=hs,n=qt,o=lr,m=Fl,a=qt,s=Mi;var h="Stage",d="string",l="px",u="mouseout",c="mouseleave",f="mouseover",v="mouseenter",p="mousemove",y="mousedown",b="mouseup",x="pointermove",S="pointerdown",w="pointerup",E="pointercancel",P="lostpointercapture",A="pointerout",N="pointerleave",k="pointerover",U="pointerenter",j="contextmenu",X="touchstart",W="touchend",Q="touchmove",ot="touchcancel",it="wheel",ct=5,O=[[v,"_pointerenter"],[y,"_pointerdown"],[p,"_pointermove"],[b,"_pointerup"],[c,"_pointerleave"],[X,"_pointerdown"],[Q,"_pointermove"],[W,"_pointerup"],[ot,"_pointercancel"],[f,"_pointerover"],[it,"_wheel"],[j,"_contextmenu"],[S,"_pointerdown"],[x,"_pointermove"],[w,"_pointerup"],[E,"_pointercancel"],[P,"_lostpointercapture"]];const M={mouse:{[A]:u,[N]:c,[k]:f,[U]:v,[x]:p,[S]:y,[w]:b,[E]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[A]:"touchout",[N]:"touchleave",[k]:"touchover",[U]:"touchenter",[x]:Q,[S]:X,[w]:W,[E]:ot,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[A]:A,[N]:N,[k]:k,[U]:U,[x]:x,[S]:S,[w]:w,[E]:E,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},L=Y=>Y.indexOf("pointer")>=0?"pointer":Y.indexOf("touch")>=0?"touch":"mouse",H=Y=>{const R=L(Y);if(R==="pointer")return n.Konva.pointerEventsEnabled&&M.pointer;if(R==="touch")return M.touch;if(R==="mouse")return M.mouse};function Z(Y={}){return(Y.clipFunc||Y.clipWidth||Y.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),Y}const G="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";i.stages=[];class F extends r.Container{constructor(R){super(Z(R)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),i.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{Z(this.attrs)}),this._checkVisibility()}_validateAdd(R){const z=R.getType()==="Layer",$=R.getType()==="FastLayer";z||$||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const R=this.visible()?"":"none";this.content.style.display=R}setContainer(R){if(typeof R===d){if(R.charAt(0)==="."){var z=R.slice(1);R=document.getElementsByClassName(z)[0]}else{var $;R.charAt(0)!=="#"?$=R:$=R.slice(1),R=document.getElementById($)}if(!R)throw"Can not find container in document with id "+$}return this._setAttr("container",R),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),R.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var R=this.children,z=R.length,$;for($=0;$<z;$++)R[$].clear();return this}clone(R){return R||(R={}),R.container=typeof document<"u"&&document.createElement("div"),r.Container.prototype.clone.call(this,R)}destroy(){super.destroy();var R=this.content;R&&t.Util._isInDocument(R)&&this.container().removeChild(R);var z=i.stages.indexOf(this);return z>-1&&i.stages.splice(z,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const R=this._pointerPositions[0]||this._changedPointerPositions[0];return R?{x:R.x,y:R.y}:(t.Util.warn(G),null)}_getPointerById(R){return this._pointerPositions.find(z=>z.id===R)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(R){R=R||{},R.x=R.x||0,R.y=R.y||0,R.width=R.width||this.width(),R.height=R.height||this.height();var z=new o.SceneCanvas({width:R.width,height:R.height,pixelRatio:R.pixelRatio||1}),$=z.getContext()._context,st=this.children;return(R.x||R.y)&&$.translate(-1*R.x,-1*R.y),st.forEach(function(nt){if(nt.isVisible()){var ft=nt._toKonvaCanvas(R);$.drawImage(ft._canvas,R.x,R.y,ft.getWidth()/ft.getPixelRatio(),ft.getHeight()/ft.getPixelRatio())}}),z}getIntersection(R){if(!R)return null;var z=this.children,$=z.length,st=$-1,nt;for(nt=st;nt>=0;nt--){const ft=z[nt].getIntersection(R);if(ft)return ft}return null}_resizeDOM(){var R=this.width(),z=this.height();this.content&&(this.content.style.width=R+l,this.content.style.height=z+l),this.bufferCanvas.setSize(R,z),this.bufferHitCanvas.setSize(R,z),this.children.forEach($=>{$.setSize({width:R,height:z}),$.draw()})}add(R,...z){if(arguments.length>1){for(var $=0;$<arguments.length;$++)this.add(arguments[$]);return this}super.add(R);var st=this.children.length;return st>ct&&t.Util.warn("The stage has "+st+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),R.setSize({width:this.width(),height:this.height()}),R.draw(),n.Konva.isBrowser&&this.content.appendChild(R.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(R){return s.hasPointerCapture(R,this)}setPointerCapture(R){s.setPointerCapture(R,this)}releaseCapture(R){s.releaseCapture(R,this)}getLayers(){return this.children}_bindContentEvents(){n.Konva.isBrowser&&O.forEach(([R,z])=>{this.content.addEventListener(R,$=>{this[z]($)},{passive:!1})})}_pointerenter(R){this.setPointersPositions(R);const z=H(R.type);this._fire(z.pointerenter,{evt:R,target:this,currentTarget:this})}_pointerover(R){this.setPointersPositions(R);const z=H(R.type);this._fire(z.pointerover,{evt:R,target:this,currentTarget:this})}_getTargetShape(R){let z=this[R+"targetShape"];return z&&!z.getStage()&&(z=null),z}_pointerleave(R){const z=H(R.type),$=L(R.type);if(z){this.setPointersPositions(R);var st=this._getTargetShape($),nt=!m.DD.isDragging||n.Konva.hitOnDragEnabled;st&&nt?(st._fireAndBubble(z.pointerout,{evt:R}),st._fireAndBubble(z.pointerleave,{evt:R}),this._fire(z.pointerleave,{evt:R,target:this,currentTarget:this}),this[$+"targetShape"]=null):nt&&(this._fire(z.pointerleave,{evt:R,target:this,currentTarget:this}),this._fire(z.pointerout,{evt:R,target:this,currentTarget:this})),this.pointerPos=void 0,this._pointerPositions=[]}}_pointerdown(R){const z=H(R.type),$=L(R.type);if(z){this.setPointersPositions(R);var st=!1;this._changedPointerPositions.forEach(nt=>{var ft=this.getIntersection(nt);if(m.DD.justDragged=!1,n.Konva["_"+$+"ListenClick"]=!0,!(ft&&ft.isListening()))return;n.Konva.capturePointerEventsEnabled&&ft.setPointerCapture(nt.id),this[$+"ClickStartShape"]=ft,ft._fireAndBubble(z.pointerdown,{evt:R,pointerId:nt.id}),st=!0;const q=R.type.indexOf("touch")>=0;ft.preventDefault()&&R.cancelable&&q&&R.preventDefault()}),st||this._fire(z.pointerdown,{evt:R,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(R){const z=H(R.type),$=L(R.type);if(!z)return;m.DD.isDragging&&m.DD.node.preventDefault()&&R.cancelable&&R.preventDefault(),this.setPointersPositions(R);var st=!m.DD.isDragging||n.Konva.hitOnDragEnabled;if(!st)return;var nt={};let ft=!1;var et=this._getTargetShape($);this._changedPointerPositions.forEach(q=>{const rt=s.getCapturedShape(q.id)||this.getIntersection(q),ut=q.id,at={evt:R,pointerId:ut};var dt=et!==rt;if(dt&&et&&(et._fireAndBubble(z.pointerout,Object.assign({},at),rt),et._fireAndBubble(z.pointerleave,Object.assign({},at),rt)),rt){if(nt[rt._id])return;nt[rt._id]=!0}rt&&rt.isListening()?(ft=!0,dt&&(rt._fireAndBubble(z.pointerover,Object.assign({},at),et),rt._fireAndBubble(z.pointerenter,Object.assign({},at),et),this[$+"targetShape"]=rt),rt._fireAndBubble(z.pointermove,Object.assign({},at))):et&&(this._fire(z.pointerover,{evt:R,target:this,currentTarget:this,pointerId:ut}),this[$+"targetShape"]=null)}),ft||this._fire(z.pointermove,{evt:R,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(R){const z=H(R.type),$=L(R.type);if(!z)return;this.setPointersPositions(R);const st=this[$+"ClickStartShape"],nt=this[$+"ClickEndShape"];var ft={};let et=!1;this._changedPointerPositions.forEach(q=>{const rt=s.getCapturedShape(q.id)||this.getIntersection(q);if(rt){if(rt.releaseCapture(q.id),ft[rt._id])return;ft[rt._id]=!0}const ut=q.id,at={evt:R,pointerId:ut};let dt=!1;n.Konva["_"+$+"InDblClickWindow"]?(dt=!0,clearTimeout(this[$+"DblTimeout"])):m.DD.justDragged||(n.Konva["_"+$+"InDblClickWindow"]=!0,clearTimeout(this[$+"DblTimeout"])),this[$+"DblTimeout"]=setTimeout(function(){n.Konva["_"+$+"InDblClickWindow"]=!1},n.Konva.dblClickWindow),rt&&rt.isListening()?(et=!0,this[$+"ClickEndShape"]=rt,rt._fireAndBubble(z.pointerup,Object.assign({},at)),n.Konva["_"+$+"ListenClick"]&&st&&st===rt&&(rt._fireAndBubble(z.pointerclick,Object.assign({},at)),dt&&nt&&nt===rt&&rt._fireAndBubble(z.pointerdblclick,Object.assign({},at)))):(this[$+"ClickEndShape"]=null,n.Konva["_"+$+"ListenClick"]&&this._fire(z.pointerclick,{evt:R,target:this,currentTarget:this,pointerId:ut}),dt&&this._fire(z.pointerdblclick,{evt:R,target:this,currentTarget:this,pointerId:ut}))}),et||this._fire(z.pointerup,{evt:R,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),n.Konva["_"+$+"ListenClick"]=!1,R.cancelable&&$!=="touch"&&R.preventDefault()}_contextmenu(R){this.setPointersPositions(R);var z=this.getIntersection(this.getPointerPosition());z&&z.isListening()?z._fireAndBubble(j,{evt:R}):this._fire(j,{evt:R,target:this,currentTarget:this})}_wheel(R){this.setPointersPositions(R);var z=this.getIntersection(this.getPointerPosition());z&&z.isListening()?z._fireAndBubble(it,{evt:R}):this._fire(it,{evt:R,target:this,currentTarget:this})}_pointercancel(R){this.setPointersPositions(R);const z=s.getCapturedShape(R.pointerId)||this.getIntersection(this.getPointerPosition());z&&z._fireAndBubble(w,s.createEvent(R)),s.releaseCapture(R.pointerId)}_lostpointercapture(R){s.releaseCapture(R.pointerId)}setPointersPositions(R){var z=this._getContentPosition(),$=null,st=null;R=R||window.event,R.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(R.touches,nt=>{this._pointerPositions.push({id:nt.identifier,x:(nt.clientX-z.left)/z.scaleX,y:(nt.clientY-z.top)/z.scaleY})}),Array.prototype.forEach.call(R.changedTouches||R.touches,nt=>{this._changedPointerPositions.push({id:nt.identifier,x:(nt.clientX-z.left)/z.scaleX,y:(nt.clientY-z.top)/z.scaleY})})):($=(R.clientX-z.left)/z.scaleX,st=(R.clientY-z.top)/z.scaleY,this.pointerPos={x:$,y:st},this._pointerPositions=[{x:$,y:st,id:t.Util._getFirstPointerId(R)}],this._changedPointerPositions=[{x:$,y:st,id:t.Util._getFirstPointerId(R)}])}_setPointerPosition(R){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(R)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var R=this.content.getBoundingClientRect();return{top:R.top,left:R.left,scaleX:R.width/this.content.clientWidth||1,scaleY:R.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!n.Konva.isBrowser){var R=this.container();if(!R)throw"Stage has no container. A container is required.";R.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),R.appendChild(this.content),this._resizeDOM()}}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(R){R.batchDraw()}),this}}i.Stage=F,F.prototype.nodeType=h,(0,a._registerNode)(F),e.Factory.addGetterSetter(F,"container")})(G1);var mo={},Ve={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Shape=i.shapes=void 0;const t=qt,e=Ie,r=$t,n=we,o=Mt,m=qt,a=Mi;var s="hasShadow",h="shadowRGBA",d="patternImage",l="linearGradient",u="radialGradient";let c;function f(){return c||(c=e.Util.createCanvasElement().getContext("2d"),c)}i.shapes={};function v(N){const k=this.attrs.fillRule;k?N.fill(k):N.fill()}function p(N){N.stroke()}function y(N){N.fill()}function b(N){N.stroke()}function x(){this._clearCache(s)}function S(){this._clearCache(h)}function w(){this._clearCache(d)}function E(){this._clearCache(l)}function P(){this._clearCache(u)}class A extends n.Node{constructor(k){super(k);let U;for(;U=e.Util.getRandomColor(),!(U&&!(U in i.shapes)););this.colorKey=U,i.shapes[U]=this}getContext(){return e.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return e.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(s,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(d,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var k=f();const U=k.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(U&&U.setTransform){const j=new e.Transform;j.translate(this.fillPatternX(),this.fillPatternY()),j.rotate(t.Konva.getAngle(this.fillPatternRotation())),j.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),j.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const X=j.getMatrix(),W=typeof DOMMatrix>"u"?{a:X[0],b:X[1],c:X[2],d:X[3],e:X[4],f:X[5]}:new DOMMatrix(X);U.setTransform(W)}return U}}_getLinearGradient(){return this._getCache(l,this.__getLinearGradient)}__getLinearGradient(){var k=this.fillLinearGradientColorStops();if(k){for(var U=f(),j=this.fillLinearGradientStartPoint(),X=this.fillLinearGradientEndPoint(),W=U.createLinearGradient(j.x,j.y,X.x,X.y),Q=0;Q<k.length;Q+=2)W.addColorStop(k[Q],k[Q+1]);return W}}_getRadialGradient(){return this._getCache(u,this.__getRadialGradient)}__getRadialGradient(){var k=this.fillRadialGradientColorStops();if(k){for(var U=f(),j=this.fillRadialGradientStartPoint(),X=this.fillRadialGradientEndPoint(),W=U.createRadialGradient(j.x,j.y,this.fillRadialGradientStartRadius(),X.x,X.y,this.fillRadialGradientEndRadius()),Q=0;Q<k.length;Q+=2)W.addColorStop(k[Q],k[Q+1]);return W}}getShadowRGBA(){return this._getCache(h,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var k=e.Util.colorToRGBA(this.shadowColor());if(k)return"rgba("+k.r+","+k.g+","+k.b+","+k.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const k=this.hitStrokeWidth();return k==="auto"?this.hasStroke():this.strokeEnabled()&&!!k}intersects(k){var U=this.getStage(),j=U.bufferHitCanvas,X;return j.getContext().clear(),this.drawHit(j,null,!0),X=j.context.getImageData(Math.round(k.x),Math.round(k.y),1,1).data,X[3]>0}destroy(){return n.Node.prototype.destroy.call(this),delete i.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(k){var U;if(!this.getStage()||!((U=this.attrs.perfectDrawEnabled)!==null&&U!==void 0?U:!0))return!1;const X=k||this.hasFill(),W=this.hasStroke(),Q=this.getAbsoluteOpacity()!==1;if(X&&W&&Q)return!0;const ot=this.hasShadow(),it=this.shadowForStrokeEnabled();return!!(X&&W&&ot&&it)}setStrokeHitEnabled(k){e.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),k?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var k=this.size();return{x:this._centroid?-k.width/2:0,y:this._centroid?-k.height/2:0,width:k.width,height:k.height}}getClientRect(k={}){const U=k.skipTransform,j=k.relativeTo,X=this.getSelfRect(),Q=!k.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,ot=X.width+Q,it=X.height+Q,ct=!k.skipShadow&&this.hasShadow(),O=ct?this.shadowOffsetX():0,M=ct?this.shadowOffsetY():0,L=ot+Math.abs(O),H=it+Math.abs(M),Z=ct&&this.shadowBlur()||0,G=L+Z*2,F=H+Z*2,Y={width:G,height:F,x:-(Q/2+Z)+Math.min(O,0)+X.x,y:-(Q/2+Z)+Math.min(M,0)+X.y};return U?Y:this._transformedRect(Y,j)}drawScene(k,U){var j=this.getLayer(),X=k||j.getCanvas(),W=X.getContext(),Q=this._getCanvasCache(),ot=this.getSceneFunc(),it=this.hasShadow(),ct,O,M,L=X.isCache,H=U===this;if(!this.isVisible()&&!H)return this;if(Q){W.save();var Z=this.getAbsoluteTransform(U).getMatrix();return W.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),this._drawCachedSceneCanvas(W),W.restore(),this}if(!ot)return this;if(W.save(),this._useBufferCanvas()&&!L){ct=this.getStage(),O=ct.bufferCanvas,M=O.getContext(),M.clear(),M.save(),M._applyLineJoin(this);var G=this.getAbsoluteTransform(U).getMatrix();M.transform(G[0],G[1],G[2],G[3],G[4],G[5]),ot.call(this,M,this),M.restore();var F=O.pixelRatio;it&&W._applyShadow(this),W._applyOpacity(this),W._applyGlobalCompositeOperation(this),W.drawImage(O._canvas,0,0,O.width/F,O.height/F)}else{if(W._applyLineJoin(this),!H){var G=this.getAbsoluteTransform(U).getMatrix();W.transform(G[0],G[1],G[2],G[3],G[4],G[5]),W._applyOpacity(this),W._applyGlobalCompositeOperation(this)}it&&W._applyShadow(this),ot.call(this,W,this)}return W.restore(),this}drawHit(k,U,j=!1){if(!this.shouldDrawHit(U,j))return this;var X=this.getLayer(),W=k||X.hitCanvas,Q=W&&W.getContext(),ot=this.hitFunc()||this.sceneFunc(),it=this._getCanvasCache(),ct=it&&it.hit;if(this.colorKey||e.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),ct){Q.save();var O=this.getAbsoluteTransform(U).getMatrix();return Q.transform(O[0],O[1],O[2],O[3],O[4],O[5]),this._drawCachedHitCanvas(Q),Q.restore(),this}if(!ot)return this;if(Q.save(),Q._applyLineJoin(this),!(this===U)){var L=this.getAbsoluteTransform(U).getMatrix();Q.transform(L[0],L[1],L[2],L[3],L[4],L[5])}return ot.call(this,Q,this),Q.restore(),this}drawHitFromCache(k=0){var U=this._getCanvasCache(),j=this._getCachedSceneCanvas(),X=U.hit,W=X.getContext(),Q=X.getWidth(),ot=X.getHeight(),it,ct,O,M,L,H;W.clear(),W.drawImage(j._canvas,0,0,Q,ot);try{for(it=W.getImageData(0,0,Q,ot),ct=it.data,O=ct.length,M=e.Util._hexToRgb(this.colorKey),L=0;L<O;L+=4)H=ct[L+3],H>k?(ct[L]=M.r,ct[L+1]=M.g,ct[L+2]=M.b,ct[L+3]=255):ct[L+3]=0;W.putImageData(it,0,0)}catch(Z){e.Util.error("Unable to draw hit graph from cached scene canvas. "+Z.message)}return this}hasPointerCapture(k){return a.hasPointerCapture(k,this)}setPointerCapture(k){a.setPointerCapture(k,this)}releaseCapture(k){a.releaseCapture(k,this)}}i.Shape=A,A.prototype._fillFunc=v,A.prototype._strokeFunc=p,A.prototype._fillFuncHit=y,A.prototype._strokeFuncHit=b,A.prototype._centroid=!1,A.prototype.nodeType="Shape",(0,m._registerNode)(A),A.prototype.eventListeners={},A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",x),A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",S),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",w),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",E),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",P),r.Factory.addGetterSetter(A,"stroke",void 0,(0,o.getStringOrGradientValidator)()),r.Factory.addGetterSetter(A,"strokeWidth",2,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillAfterStrokeEnabled",!1),r.Factory.addGetterSetter(A,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),r.Factory.addGetterSetter(A,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),r.Factory.addGetterSetter(A,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),r.Factory.addGetterSetter(A,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),r.Factory.addGetterSetter(A,"lineJoin"),r.Factory.addGetterSetter(A,"lineCap"),r.Factory.addGetterSetter(A,"sceneFunc"),r.Factory.addGetterSetter(A,"hitFunc"),r.Factory.addGetterSetter(A,"dash"),r.Factory.addGetterSetter(A,"dashOffset",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowColor",void 0,(0,o.getStringValidator)()),r.Factory.addGetterSetter(A,"shadowBlur",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowOpacity",1,(0,o.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"shadowOffset",["x","y"]),r.Factory.addGetterSetter(A,"shadowOffsetX",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"shadowOffsetY",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternImage"),r.Factory.addGetterSetter(A,"fill",void 0,(0,o.getStringOrGradientValidator)()),r.Factory.addGetterSetter(A,"fillPatternX",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternY",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillLinearGradientColorStops"),r.Factory.addGetterSetter(A,"strokeLinearGradientColorStops"),r.Factory.addGetterSetter(A,"fillRadialGradientStartRadius",0),r.Factory.addGetterSetter(A,"fillRadialGradientEndRadius",0),r.Factory.addGetterSetter(A,"fillRadialGradientColorStops"),r.Factory.addGetterSetter(A,"fillPatternRepeat","repeat"),r.Factory.addGetterSetter(A,"fillEnabled",!0),r.Factory.addGetterSetter(A,"strokeEnabled",!0),r.Factory.addGetterSetter(A,"shadowEnabled",!0),r.Factory.addGetterSetter(A,"dashEnabled",!0),r.Factory.addGetterSetter(A,"strokeScaleEnabled",!0),r.Factory.addGetterSetter(A,"fillPriority","color"),r.Factory.addComponentsGetterSetter(A,"fillPatternOffset",["x","y"]),r.Factory.addGetterSetter(A,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"fillPatternScale",["x","y"]),r.Factory.addGetterSetter(A,"fillPatternScaleX",1,(0,o.getNumberValidator)()),r.Factory.addGetterSetter(A,"fillPatternScaleY",1,(0,o.getNumberValidator)()),r.Factory.addComponentsGetterSetter(A,"fillLinearGradientStartPoint",["x","y"]),r.Factory.addComponentsGetterSetter(A,"strokeLinearGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillLinearGradientStartPointX",0),r.Factory.addGetterSetter(A,"strokeLinearGradientStartPointX",0),r.Factory.addGetterSetter(A,"fillLinearGradientStartPointY",0),r.Factory.addGetterSetter(A,"strokeLinearGradientStartPointY",0),r.Factory.addComponentsGetterSetter(A,"fillLinearGradientEndPoint",["x","y"]),r.Factory.addComponentsGetterSetter(A,"strokeLinearGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillLinearGradientEndPointX",0),r.Factory.addGetterSetter(A,"strokeLinearGradientEndPointX",0),r.Factory.addGetterSetter(A,"fillLinearGradientEndPointY",0),r.Factory.addGetterSetter(A,"strokeLinearGradientEndPointY",0),r.Factory.addComponentsGetterSetter(A,"fillRadialGradientStartPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillRadialGradientStartPointX",0),r.Factory.addGetterSetter(A,"fillRadialGradientStartPointY",0),r.Factory.addComponentsGetterSetter(A,"fillRadialGradientEndPoint",["x","y"]),r.Factory.addGetterSetter(A,"fillRadialGradientEndPointX",0),r.Factory.addGetterSetter(A,"fillRadialGradientEndPointY",0),r.Factory.addGetterSetter(A,"fillPatternRotation",0),r.Factory.addGetterSetter(A,"fillRule",void 0,(0,o.getStringValidator)()),r.Factory.backCompat(A,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(Ve);Object.defineProperty(mo,"__esModule",{value:!0});mo.Layer=void 0;const Hr=Ie,bf=hs,ks=we,zd=$t,Tv=lr,z8=Mt,j8=Ve,Y8=qt;var $8="#",K8="beforeDraw",q8="draw",X1=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Z8=X1.length;class fa extends bf.Container{constructor(t){super(t),this.canvas=new Tv.SceneCanvas,this.hitCanvas=new Tv.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){ks.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var t=ks.Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return!e||!e.content?!1:(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(ks.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(ks.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return ks.Node.prototype.remove.call(this),t&&t.parentNode&&Hr.Util._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&Hr.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),ks.Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){Hr.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){Hr.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,Hr.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,r=!1;;){for(let n=0;n<Z8;n++){const o=X1[n],m=this._getIntersection({x:t.x+o.x*e,y:t.y+o.y*e}),a=m.shape;if(a)return a;if(r=!!m.antialiased,!m.antialiased)break}if(r)e+=1;else return null}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,r=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,n=r[3];if(n===255){const o=Hr.Util._rgbToHex(r[0],r[1],r[2]),m=j8.shapes[$8+o];return m?{shape:m}:{antialiased:!0}}else if(n>0)return{antialiased:!0};return{}}drawScene(t,e){var r=this.getLayer(),n=t||r&&r.getCanvas();return this._fire(K8,{node:this}),this.clearBeforeDraw()&&n.getContext().clear(),bf.Container.prototype.drawScene.call(this,n,e),this._fire(q8,{node:this}),this}drawHit(t,e){var r=this.getLayer(),n=t||r&&r.hitCanvas;return r&&r.clearBeforeDraw()&&r.getHitCanvas().getContext().clear(),bf.Container.prototype.drawHit.call(this,n,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){Hr.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return Hr.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return Hr.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}mo.Layer=fa;fa.prototype.nodeType="Layer";(0,Y8._registerNode)(fa);zd.Factory.addGetterSetter(fa,"imageSmoothingEnabled",!0);zd.Factory.addGetterSetter(fa,"clearBeforeDraw",!0);zd.Factory.addGetterSetter(fa,"hitGraphEnabled",!0,(0,z8.getBooleanValidator)());var kl={};Object.defineProperty(kl,"__esModule",{value:!0});kl.FastLayer=void 0;const J8=Ie,Q8=mo,t9=qt;class jd extends Q8.Layer{constructor(t){super(t),this.listening(!1),J8.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}kl.FastLayer=jd;jd.prototype.nodeType="FastLayer";(0,t9._registerNode)(jd);var da={};Object.defineProperty(da,"__esModule",{value:!0});da.Group=void 0;const e9=Ie,i9=hs,r9=qt;class Yd extends i9.Container{_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&e9.Util.throw("You may only add groups and shapes to groups.")}}da.Group=Yd;Yd.prototype.nodeType="Group";(0,r9._registerNode)(Yd);var ga={};Object.defineProperty(ga,"__esModule",{value:!0});ga.Animation=void 0;const Sf=qt,Ev=Ie;var Cf=function(){return Sf.glob.performance&&Sf.glob.performance.now?function(){return Sf.glob.performance.now()}:function(){return new Date().getTime()}}();class br{constructor(t,e){this.id=br.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Cf(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){var e=[];return t?t.length>0?e=t:e=[t]:e=[],this.layers=e,this}getLayers(){return this.layers}addLayer(t){var e=this.layers,r=e.length,n;for(n=0;n<r;n++)if(e[n]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){var t=br,e=t.animations,r=e.length,n;for(n=0;n<r;n++)if(e[n].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Cf(),br._addAnimation(this),this}stop(){return br._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){var e=t.id,r=this.animations,n=r.length,o;for(o=0;o<n;o++)if(r[o].id===e){this.animations.splice(o,1);break}}static _runFrames(){var t={},e=this.animations,r,n,o,m,a,s,h,d,l;for(m=0;m<e.length;m++)if(r=e[m],n=r.layers,o=r.func,r._updateFrameObject(Cf()),s=n.length,o?l=o.call(r,r.frame)!==!1:l=!0,!!l)for(a=0;a<s;a++)h=n[a],h._id!==void 0&&(t[h._id]=h);for(d in t)t.hasOwnProperty(d)&&t[d].batchDraw()}static _animationLoop(){var t=br;t.animations.length?(t._runFrames(),Ev.Util.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,Ev.Util.requestAnimFrame(this._animationLoop))}}ga.Animation=br;br.animations=[];br.animIdCounter=0;br.animRunning=!1;var V1={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Easings=i.Tween=void 0;const t=Ie,e=ga,r=we,n=qt;var o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},m=1,a=2,s=3,h=0,d=["fill","stroke","shadowColor"];class l{constructor(f,v,p,y,b,x,S){this.prop=f,this.propFunc=v,this.begin=y,this._pos=y,this.duration=x,this._change=0,this.prevPos=0,this.yoyo=S,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=p,this._change=b-this.begin,this.pause()}fire(f){var v=this[f];v&&v()}setTime(f){f>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():f<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=f,this.update())}getTime(){return this._time}setPosition(f){this.prevPos=this._pos,this.propFunc(f),this._pos=f}getPosition(f){return f===void 0&&(f=this._time),this.func(f,this.begin,this._change,this.duration)}play(){this.state=a,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=s,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(f){this.pause(),this._time=f,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var f=this.getTimer()-this._startTime;this.state===a?this.setTime(f):this.state===s&&this.setTime(this.duration-f)}pause(){this.state=m,this.fire("onPause")}getTimer(){return new Date().getTime()}}class u{constructor(f){var v=this,p=f.node,y=p._id,b,x=f.easing||i.Easings.Linear,S=!!f.yoyo,w;typeof f.duration>"u"?b=.3:f.duration===0?b=.001:b=f.duration,this.node=p,this._id=h++;var E=p.getLayer()||(p instanceof n.Konva.Stage?p.getLayers():null);E||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new e.Animation(function(){v.tween.onEnterFrame()},E),this.tween=new l(w,function(P){v._tweenFunc(P)},x,0,1,b*1e3,S),this._addListeners(),u.attrs[y]||(u.attrs[y]={}),u.attrs[y][this._id]||(u.attrs[y][this._id]={}),u.tweens[y]||(u.tweens[y]={});for(w in f)o[w]===void 0&&this._addAttr(w,f[w]);this.reset(),this.onFinish=f.onFinish,this.onReset=f.onReset,this.onUpdate=f.onUpdate}_addAttr(f,v){var p=this.node,y=p._id,b,x,S,w,E,P,A,N;if(S=u.tweens[y][f],S&&delete u.attrs[y][S][f],b=p.getAttr(f),t.Util._isArray(v))if(x=[],E=Math.max(v.length,b.length),f==="points"&&v.length!==b.length&&(v.length>b.length?(A=b,b=t.Util._prepareArrayForTween(b,v,p.closed())):(P=v,v=t.Util._prepareArrayForTween(v,b,p.closed()))),f.indexOf("fill")===0)for(w=0;w<E;w++)if(w%2===0)x.push(v[w]-b[w]);else{var k=t.Util.colorToRGBA(b[w]);N=t.Util.colorToRGBA(v[w]),b[w]=k,x.push({r:N.r-k.r,g:N.g-k.g,b:N.b-k.b,a:N.a-k.a})}else for(w=0;w<E;w++)x.push(v[w]-b[w]);else d.indexOf(f)!==-1?(b=t.Util.colorToRGBA(b),N=t.Util.colorToRGBA(v),x={r:N.r-b.r,g:N.g-b.g,b:N.b-b.b,a:N.a-b.a}):x=v-b;u.attrs[y][this._id][f]={start:b,diff:x,end:v,trueEnd:P,trueStart:A},u.tweens[y][f]=this._id}_tweenFunc(f){var v=this.node,p=u.attrs[v._id][this._id],y,b,x,S,w,E,P,A;for(y in p){if(b=p[y],x=b.start,S=b.diff,A=b.end,t.Util._isArray(x))if(w=[],P=Math.max(x.length,A.length),y.indexOf("fill")===0)for(E=0;E<P;E++)E%2===0?w.push((x[E]||0)+S[E]*f):w.push("rgba("+Math.round(x[E].r+S[E].r*f)+","+Math.round(x[E].g+S[E].g*f)+","+Math.round(x[E].b+S[E].b*f)+","+(x[E].a+S[E].a*f)+")");else for(E=0;E<P;E++)w.push((x[E]||0)+S[E]*f);else d.indexOf(y)!==-1?w="rgba("+Math.round(x.r+S.r*f)+","+Math.round(x.g+S.g*f)+","+Math.round(x.b+S.b*f)+","+(x.a+S.a*f)+")":w=x+S*f;v.setAttr(y,w)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var f=this.node,v=u.attrs[f._id][this._id];v.points&&v.points.trueEnd&&f.setAttr("points",v.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var f=this.node,v=u.attrs[f._id][this._id];v.points&&v.points.trueStart&&f.points(v.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(f){return this.tween.seek(f*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var f=this.node._id,v=this._id,p=u.tweens[f],y;this.pause();for(y in p)delete u.tweens[f][y];delete u.attrs[f][v]}}i.Tween=u,u.attrs={},u.tweens={},r.Node.prototype.to=function(c){var f=c.onFinish;c.node=this,c.onFinish=function(){this.destroy(),f&&f()};var v=new u(c);v.play()},i.Easings={BackEaseIn(c,f,v,p){var y=1.70158;return v*(c/=p)*c*((y+1)*c-y)+f},BackEaseOut(c,f,v,p){var y=1.70158;return v*((c=c/p-1)*c*((y+1)*c+y)+1)+f},BackEaseInOut(c,f,v,p){var y=1.70158;return(c/=p/2)<1?v/2*(c*c*(((y*=1.525)+1)*c-y))+f:v/2*((c-=2)*c*(((y*=1.525)+1)*c+y)+2)+f},ElasticEaseIn(c,f,v,p,y,b){var x=0;return c===0?f:(c/=p)===1?f+v:(b||(b=p*.3),!y||y<Math.abs(v)?(y=v,x=b/4):x=b/(2*Math.PI)*Math.asin(v/y),-(y*Math.pow(2,10*(c-=1))*Math.sin((c*p-x)*(2*Math.PI)/b))+f)},ElasticEaseOut(c,f,v,p,y,b){var x=0;return c===0?f:(c/=p)===1?f+v:(b||(b=p*.3),!y||y<Math.abs(v)?(y=v,x=b/4):x=b/(2*Math.PI)*Math.asin(v/y),y*Math.pow(2,-10*c)*Math.sin((c*p-x)*(2*Math.PI)/b)+v+f)},ElasticEaseInOut(c,f,v,p,y,b){var x=0;return c===0?f:(c/=p/2)===2?f+v:(b||(b=p*(.3*1.5)),!y||y<Math.abs(v)?(y=v,x=b/4):x=b/(2*Math.PI)*Math.asin(v/y),c<1?-.5*(y*Math.pow(2,10*(c-=1))*Math.sin((c*p-x)*(2*Math.PI)/b))+f:y*Math.pow(2,-10*(c-=1))*Math.sin((c*p-x)*(2*Math.PI)/b)*.5+v+f)},BounceEaseOut(c,f,v,p){return(c/=p)<1/2.75?v*(7.5625*c*c)+f:c<2/2.75?v*(7.5625*(c-=1.5/2.75)*c+.75)+f:c<2.5/2.75?v*(7.5625*(c-=2.25/2.75)*c+.9375)+f:v*(7.5625*(c-=2.625/2.75)*c+.984375)+f},BounceEaseIn(c,f,v,p){return v-i.Easings.BounceEaseOut(p-c,0,v,p)+f},BounceEaseInOut(c,f,v,p){return c<p/2?i.Easings.BounceEaseIn(c*2,0,v,p)*.5+f:i.Easings.BounceEaseOut(c*2-p,0,v,p)*.5+v*.5+f},EaseIn(c,f,v,p){return v*(c/=p)*c+f},EaseOut(c,f,v,p){return-v*(c/=p)*(c-2)+f},EaseInOut(c,f,v,p){return(c/=p/2)<1?v/2*c*c+f:-v/2*(--c*(c-2)-1)+f},StrongEaseIn(c,f,v,p){return v*(c/=p)*c*c*c*c+f},StrongEaseOut(c,f,v,p){return v*((c=c/p-1)*c*c*c*c+1)+f},StrongEaseInOut(c,f,v,p){return(c/=p/2)<1?v/2*c*c*c*c*c+f:v/2*((c-=2)*c*c*c*c+2)+f},Linear(c,f,v,p){return v*c/p+f}}})(V1);(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Konva=void 0;const t=qt,e=Ie,r=we,n=hs,o=G1,m=mo,a=kl,s=da,h=Fl,d=Ve,l=ga,u=V1,c=Kr,f=lr;i.Konva=e.Util._assign(t.Konva,{Util:e.Util,Transform:e.Transform,Node:r.Node,Container:n.Container,Stage:o.Stage,stages:o.stages,Layer:m.Layer,FastLayer:a.FastLayer,Group:s.Group,DD:h.DD,Shape:d.Shape,shapes:d.shapes,Animation:l.Animation,Tween:u.Tween,Easings:u.Easings,Context:c.Context,Canvas:f.Canvas}),i.default=i.Konva})(k1);var Bl={};Object.defineProperty(Bl,"__esModule",{value:!0});Bl.Arc=void 0;const Nl=$t,n9=Ve,Av=qt,Ul=Mt,s9=qt;class tn extends n9.Shape{_sceneFunc(t){var e=Av.Konva.getAngle(this.angle()),r=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,r),t.arc(0,0,this.innerRadius(),e,0,!r),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),r=this.clockwise(),n=Av.Konva.getAngle(r?360-this.angle():this.angle()),o=Math.cos(Math.min(n,Math.PI)),m=1,a=Math.sin(Math.min(Math.max(Math.PI,n),3*Math.PI/2)),s=Math.sin(Math.min(n,Math.PI/2)),h=o*(o>0?t:e),d=m*e,l=a*(a>0?t:e),u=s*(s>0?e:t);return{x:h,y:r?-1*u:l,width:d-h,height:u-l}}}Bl.Arc=tn;tn.prototype._centroid=!0;tn.prototype.className="Arc";tn.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,s9._registerNode)(tn);Nl.Factory.addGetterSetter(tn,"innerRadius",0,(0,Ul.getNumberValidator)());Nl.Factory.addGetterSetter(tn,"outerRadius",0,(0,Ul.getNumberValidator)());Nl.Factory.addGetterSetter(tn,"angle",0,(0,Ul.getNumberValidator)());Nl.Factory.addGetterSetter(tn,"clockwise",!1,(0,Ul.getBooleanValidator)());var Gl={},vo={};Object.defineProperty(vo,"__esModule",{value:!0});vo.Line=void 0;const Hl=$t,a9=Ve,z1=Mt,o9=qt;function yd(i,t,e,r,n,o,m){var a=Math.sqrt(Math.pow(e-i,2)+Math.pow(r-t,2)),s=Math.sqrt(Math.pow(n-e,2)+Math.pow(o-r,2)),h=m*a/(a+s),d=m*s/(a+s),l=e-h*(n-i),u=r-h*(o-t),c=e+d*(n-i),f=r+d*(o-t);return[l,u,c,f]}function Pv(i,t){var e=i.length,r=[],n,o;for(n=2;n<e-2;n+=2)o=yd(i[n-2],i[n-1],i[n],i[n+1],i[n+2],i[n+3],t),!isNaN(o[0])&&(r.push(o[0]),r.push(o[1]),r.push(i[n]),r.push(i[n+1]),r.push(o[2]),r.push(o[3]));return r}class En extends a9.Shape{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){var e=this.points(),r=e.length,n=this.tension(),o=this.closed(),m=this.bezier(),a,s,h;if(r){if(t.beginPath(),t.moveTo(e[0],e[1]),n!==0&&r>4){for(a=this.getTensionPoints(),s=a.length,h=o?0:4,o||t.quadraticCurveTo(a[0],a[1],a[2],a[3]);h<s-2;)t.bezierCurveTo(a[h++],a[h++],a[h++],a[h++],a[h++],a[h++]);o||t.quadraticCurveTo(a[s-2],a[s-1],e[r-2],e[r-1])}else if(m)for(h=2;h<r;)t.bezierCurveTo(e[h++],e[h++],e[h++],e[h++],e[h++],e[h++]);else for(h=2;h<r;h+=2)t.lineTo(e[h],e[h+1]);o?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Pv(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,r=this.tension(),n=yd(t[e-2],t[e-1],t[0],t[1],t[2],t[3],r),o=yd(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],r),m=Pv(t,r),a=[n[2],n[3]].concat(m).concat([o[0],o[1],t[e-2],t[e-1],o[2],o[3],n[0],n[1],t[0],t[1]]);return a}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:t=this.points();for(var e=t[0],r=t[0],n=t[1],o=t[1],m,a,s=0;s<t.length/2;s++)m=t[s*2],a=t[s*2+1],e=Math.min(e,m),r=Math.max(r,m),n=Math.min(n,a),o=Math.max(o,a);return{x:e,y:n,width:r-e,height:o-n}}}vo.Line=En;En.prototype.className="Line";En.prototype._attrsAffectingSize=["points","bezier","tension"];(0,o9._registerNode)(En);Hl.Factory.addGetterSetter(En,"closed",!1);Hl.Factory.addGetterSetter(En,"bezier",!1);Hl.Factory.addGetterSetter(En,"tension",0,(0,z1.getNumberValidator)());Hl.Factory.addGetterSetter(En,"points",[],(0,z1.getNumberArrayValidator)());var pa={},j1={};(function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.t2length=i.getQuadraticArcLength=i.getCubicArcLength=i.binomialCoefficients=i.cValues=i.tValues=void 0,i.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],i.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],i.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(m,a,s)=>{let h,d,l;h=s/2,d=0;for(let c=0;c<20;c++)l=h*i.tValues[20][c]+h,d+=i.cValues[20][c]*r(m,a,l);return h*d};i.getCubicArcLength=t;const e=(m,a,s)=>{s===void 0&&(s=1);const h=m[0]-2*m[1]+m[2],d=a[0]-2*a[1]+a[2],l=2*m[1]-2*m[0],u=2*a[1]-2*a[0],c=4*(h*h+d*d),f=4*(h*l+d*u),v=l*l+u*u;if(c===0)return s*Math.sqrt(Math.pow(m[2]-m[0],2)+Math.pow(a[2]-a[0],2));const p=f/(2*c),y=v/c,b=s+p,x=y-p*p,S=b*b+x>0?Math.sqrt(b*b+x):0,w=p*p+x>0?Math.sqrt(p*p+x):0,E=p+Math.sqrt(p*p+x)!==0?x*Math.log(Math.abs((b+S)/(p+w))):0;return Math.sqrt(c)/2*(b*S-p*w+E)};i.getQuadraticArcLength=e;function r(m,a,s){const h=n(1,s,m),d=n(1,s,a),l=h*h+d*d;return Math.sqrt(l)}const n=(m,a,s)=>{const h=s.length-1;let d,l;if(h===0)return 0;if(m===0){l=0;for(let u=0;u<=h;u++)l+=i.binomialCoefficients[h][u]*Math.pow(1-a,h-u)*Math.pow(a,u)*s[u];return l}else{d=new Array(h);for(let u=0;u<h;u++)d[u]=h*(s[u+1]-s[u]);return n(m-1,a,d)}},o=(m,a,s)=>{let h=1,d=m/a,l=(m-s(d))/a,u=0;for(;h>.001;){const c=s(d+l),f=Math.abs(m-c)/a;if(f<h)h=f,d+=l;else{const v=s(d-l),p=Math.abs(m-v)/a;p<h?(h=p,d-=l):l/=2}if(u++,u>500)break}return d};i.t2length=o})(j1);Object.defineProperty(pa,"__esModule",{value:!0});pa.Path=void 0;const h9=$t,l9=Ve,c9=qt,Bs=j1;class He extends l9.Shape{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=He.parsePathData(this.data()),this.pathLength=He.getPathLength(this.dataArray)}_sceneFunc(t){var e=this.dataArray;t.beginPath();for(var r=!1,n=0;n<e.length;n++){var o=e[n].command,m=e[n].points;switch(o){case"L":t.lineTo(m[0],m[1]);break;case"M":t.moveTo(m[0],m[1]);break;case"C":t.bezierCurveTo(m[0],m[1],m[2],m[3],m[4],m[5]);break;case"Q":t.quadraticCurveTo(m[0],m[1],m[2],m[3]);break;case"A":var a=m[0],s=m[1],h=m[2],d=m[3],l=m[4],u=m[5],c=m[6],f=m[7],v=h>d?h:d,p=h>d?1:h/d,y=h>d?d/h:1;t.translate(a,s),t.rotate(c),t.scale(p,y),t.arc(0,0,v,l,l+u,1-f),t.scale(1/p,1/y),t.rotate(-c),t.translate(-a,-s);break;case"z":r=!0,t.closePath();break}}!r&&!this.hasFill()?t.strokeShape(this):t.fillStrokeShape(this)}getSelfRect(){var t=[];this.dataArray.forEach(function(h){if(h.command==="A"){var d=h.points[4],l=h.points[5],u=h.points[4]+l,c=Math.PI/180;if(Math.abs(d-u)<c&&(c=Math.abs(d-u)),l<0)for(let f=d-c;f>u;f-=c){const v=He.getPointOnEllipticalArc(h.points[0],h.points[1],h.points[2],h.points[3],f,0);t.push(v.x,v.y)}else for(let f=d+c;f<u;f+=c){const v=He.getPointOnEllipticalArc(h.points[0],h.points[1],h.points[2],h.points[3],f,0);t.push(v.x,v.y)}}else if(h.command==="C")for(let f=0;f<=1;f+=.01){const v=He.getPointOnCubicBezier(f,h.start.x,h.start.y,h.points[0],h.points[1],h.points[2],h.points[3],h.points[4],h.points[5]);t.push(v.x,v.y)}else t=t.concat(h.points)});for(var e=t[0],r=t[0],n=t[1],o=t[1],m,a,s=0;s<t.length/2;s++)m=t[s*2],a=t[s*2+1],isNaN(m)||(e=Math.min(e,m),r=Math.max(r,m)),isNaN(a)||(n=Math.min(n,a),o=Math.max(o,a));return{x:e,y:n,width:r-e,height:o-n}}getLength(){return this.pathLength}getPointAtLength(t){return He.getPointAtLengthOfDataArray(t,this.dataArray)}static getLineLength(t,e,r,n){return Math.sqrt((r-t)*(r-t)+(n-e)*(n-e))}static getPathLength(t){let e=0;for(var r=0;r<t.length;++r)e+=t[r].pathLength;return e}static getPointAtLengthOfDataArray(t,e){var r,n=0,o=e.length;if(!o)return null;for(;n<o&&t>e[n].pathLength;)t-=e[n].pathLength,++n;if(n===o)return r=e[n-1].points.slice(-2),{x:r[0],y:r[1]};if(t<.01)return r=e[n].points.slice(0,2),{x:r[0],y:r[1]};var m=e[n],a=m.points;switch(m.command){case"L":return He.getPointOnLine(t,m.start.x,m.start.y,a[0],a[1]);case"C":return He.getPointOnCubicBezier((0,Bs.t2length)(t,He.getPathLength(e),v=>(0,Bs.getCubicArcLength)([m.start.x,a[0],a[2],a[4]],[m.start.y,a[1],a[3],a[5]],v)),m.start.x,m.start.y,a[0],a[1],a[2],a[3],a[4],a[5]);case"Q":return He.getPointOnQuadraticBezier((0,Bs.t2length)(t,He.getPathLength(e),v=>(0,Bs.getQuadraticArcLength)([m.start.x,a[0],a[2]],[m.start.y,a[1],a[3]],v)),m.start.x,m.start.y,a[0],a[1],a[2],a[3]);case"A":var s=a[0],h=a[1],d=a[2],l=a[3],u=a[4],c=a[5],f=a[6];return u+=c*t/m.pathLength,He.getPointOnEllipticalArc(s,h,d,l,u,f)}return null}static getPointOnLine(t,e,r,n,o,m,a){m===void 0&&(m=e),a===void 0&&(a=r);var s=(o-r)/(n-e+1e-8),h=Math.sqrt(t*t/(1+s*s));n<e&&(h*=-1);var d=s*h,l;if(n===e)l={x:m,y:a+d};else if((a-r)/(m-e+1e-8)===s)l={x:m+h,y:a+d};else{var u,c,f=this.getLineLength(e,r,n,o),v=(m-e)*(n-e)+(a-r)*(o-r);v=v/(f*f),u=e+v*(n-e),c=r+v*(o-r);var p=this.getLineLength(m,a,u,c),y=Math.sqrt(t*t-p*p);h=Math.sqrt(y*y/(1+s*s)),n<e&&(h*=-1),d=s*h,l={x:u+h,y:c+d}}return l}static getPointOnCubicBezier(t,e,r,n,o,m,a,s,h){function d(p){return p*p*p}function l(p){return 3*p*p*(1-p)}function u(p){return 3*p*(1-p)*(1-p)}function c(p){return(1-p)*(1-p)*(1-p)}var f=s*d(t)+m*l(t)+n*u(t)+e*c(t),v=h*d(t)+a*l(t)+o*u(t)+r*c(t);return{x:f,y:v}}static getPointOnQuadraticBezier(t,e,r,n,o,m,a){function s(c){return c*c}function h(c){return 2*c*(1-c)}function d(c){return(1-c)*(1-c)}var l=m*s(t)+n*h(t)+e*d(t),u=a*s(t)+o*h(t)+r*d(t);return{x:l,y:u}}static getPointOnEllipticalArc(t,e,r,n,o,m){var a=Math.cos(m),s=Math.sin(m),h={x:r*Math.cos(o),y:n*Math.sin(o)};return{x:t+(h.x*a-h.y*s),y:e+(h.x*s+h.y*a)}}static parsePathData(t){if(!t)return[];var e=t,r=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var n=0;n<r.length;n++)e=e.replace(new RegExp(r[n],"g"),"|"+r[n]);var o=e.split("|"),m=[],a=[],s=0,h=0,d=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,l;for(n=1;n<o.length;n++){var u=o[n],c=u.charAt(0);for(u=u.slice(1),a.length=0;l=d.exec(u);)a.push(l[0]);for(var f=[],v=0,p=a.length;v<p;v++){if(a[v]==="00"){f.push(0,0);continue}var y=parseFloat(a[v]);isNaN(y)?f.push(0):f.push(y)}for(;f.length>0&&!isNaN(f[0]);){var b=null,x=[],S=s,w=h,E,P,A,N,k,U,j,X,W,Q;switch(c){case"l":s+=f.shift(),h+=f.shift(),b="L",x.push(s,h);break;case"L":s=f.shift(),h=f.shift(),x.push(s,h);break;case"m":var ot=f.shift(),it=f.shift();if(s+=ot,h+=it,b="M",m.length>2&&m[m.length-1].command==="z"){for(var ct=m.length-2;ct>=0;ct--)if(m[ct].command==="M"){s=m[ct].points[0]+ot,h=m[ct].points[1]+it;break}}x.push(s,h),c="l";break;case"M":s=f.shift(),h=f.shift(),b="M",x.push(s,h),c="L";break;case"h":s+=f.shift(),b="L",x.push(s,h);break;case"H":s=f.shift(),b="L",x.push(s,h);break;case"v":h+=f.shift(),b="L",x.push(s,h);break;case"V":h=f.shift(),b="L",x.push(s,h);break;case"C":x.push(f.shift(),f.shift(),f.shift(),f.shift()),s=f.shift(),h=f.shift(),x.push(s,h);break;case"c":x.push(s+f.shift(),h+f.shift(),s+f.shift(),h+f.shift()),s+=f.shift(),h+=f.shift(),b="C",x.push(s,h);break;case"S":P=s,A=h,E=m[m.length-1],E.command==="C"&&(P=s+(s-E.points[2]),A=h+(h-E.points[3])),x.push(P,A,f.shift(),f.shift()),s=f.shift(),h=f.shift(),b="C",x.push(s,h);break;case"s":P=s,A=h,E=m[m.length-1],E.command==="C"&&(P=s+(s-E.points[2]),A=h+(h-E.points[3])),x.push(P,A,s+f.shift(),h+f.shift()),s+=f.shift(),h+=f.shift(),b="C",x.push(s,h);break;case"Q":x.push(f.shift(),f.shift()),s=f.shift(),h=f.shift(),x.push(s,h);break;case"q":x.push(s+f.shift(),h+f.shift()),s+=f.shift(),h+=f.shift(),b="Q",x.push(s,h);break;case"T":P=s,A=h,E=m[m.length-1],E.command==="Q"&&(P=s+(s-E.points[0]),A=h+(h-E.points[1])),s=f.shift(),h=f.shift(),b="Q",x.push(P,A,s,h);break;case"t":P=s,A=h,E=m[m.length-1],E.command==="Q"&&(P=s+(s-E.points[0]),A=h+(h-E.points[1])),s+=f.shift(),h+=f.shift(),b="Q",x.push(P,A,s,h);break;case"A":N=f.shift(),k=f.shift(),U=f.shift(),j=f.shift(),X=f.shift(),W=s,Q=h,s=f.shift(),h=f.shift(),b="A",x=this.convertEndpointToCenterParameterization(W,Q,s,h,j,X,N,k,U);break;case"a":N=f.shift(),k=f.shift(),U=f.shift(),j=f.shift(),X=f.shift(),W=s,Q=h,s+=f.shift(),h+=f.shift(),b="A",x=this.convertEndpointToCenterParameterization(W,Q,s,h,j,X,N,k,U);break}m.push({command:b||c,points:x,start:{x:S,y:w},pathLength:this.calcLength(S,w,b||c,x)})}(c==="z"||c==="Z")&&m.push({command:"z",points:[],start:void 0,pathLength:0})}return m}static calcLength(t,e,r,n){var o,m,a,s,h=He;switch(r){case"L":return h.getLineLength(t,e,n[0],n[1]);case"C":return(0,Bs.getCubicArcLength)([t,n[0],n[2],n[4]],[e,n[1],n[3],n[5]],1);case"Q":return(0,Bs.getQuadraticArcLength)([t,n[0],n[2]],[e,n[1],n[3]],1);case"A":o=0;var d=n[4],l=n[5],u=n[4]+l,c=Math.PI/180;if(Math.abs(d-u)<c&&(c=Math.abs(d-u)),m=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],d,0),l<0)for(s=d-c;s>u;s-=c)a=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],s,0),o+=h.getLineLength(m.x,m.y,a.x,a.y),m=a;else for(s=d+c;s<u;s+=c)a=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],s,0),o+=h.getLineLength(m.x,m.y,a.x,a.y),m=a;return a=h.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],u,0),o+=h.getLineLength(m.x,m.y,a.x,a.y),o}return 0}static convertEndpointToCenterParameterization(t,e,r,n,o,m,a,s,h){var d=h*(Math.PI/180),l=Math.cos(d)*(t-r)/2+Math.sin(d)*(e-n)/2,u=-1*Math.sin(d)*(t-r)/2+Math.cos(d)*(e-n)/2,c=l*l/(a*a)+u*u/(s*s);c>1&&(a*=Math.sqrt(c),s*=Math.sqrt(c));var f=Math.sqrt((a*a*(s*s)-a*a*(u*u)-s*s*(l*l))/(a*a*(u*u)+s*s*(l*l)));o===m&&(f*=-1),isNaN(f)&&(f=0);var v=f*a*u/s,p=f*-s*l/a,y=(t+r)/2+Math.cos(d)*v-Math.sin(d)*p,b=(e+n)/2+Math.sin(d)*v+Math.cos(d)*p,x=function(k){return Math.sqrt(k[0]*k[0]+k[1]*k[1])},S=function(k,U){return(k[0]*U[0]+k[1]*U[1])/(x(k)*x(U))},w=function(k,U){return(k[0]*U[1]<k[1]*U[0]?-1:1)*Math.acos(S(k,U))},E=w([1,0],[(l-v)/a,(u-p)/s]),P=[(l-v)/a,(u-p)/s],A=[(-1*l-v)/a,(-1*u-p)/s],N=w(P,A);return S(P,A)<=-1&&(N=Math.PI),S(P,A)>=1&&(N=0),m===0&&N>0&&(N=N-2*Math.PI),m===1&&N<0&&(N=N+2*Math.PI),[y,b,a,s,E,N,d,m]}}pa.Path=He;He.prototype.className="Path";He.prototype._attrsAffectingSize=["data"];(0,c9._registerNode)(He);h9.Factory.addGetterSetter(He,"data");Object.defineProperty(Gl,"__esModule",{value:!0});Gl.Arrow=void 0;const Wl=$t,u9=vo,Y1=Mt,f9=qt,Iv=pa;class cs extends u9.Line{_sceneFunc(t){super._sceneFunc(t);var e=Math.PI*2,r=this.points(),n=r,o=this.tension()!==0&&r.length>4;o&&(n=this.getTensionPoints());var m=this.pointerLength(),a=r.length,s,h;if(o){const u=[n[n.length-4],n[n.length-3],n[n.length-2],n[n.length-1],r[a-2],r[a-1]],c=Iv.Path.calcLength(n[n.length-4],n[n.length-3],"C",u),f=Iv.Path.getPointOnQuadraticBezier(Math.min(1,1-m/c),u[0],u[1],u[2],u[3],u[4],u[5]);s=r[a-2]-f.x,h=r[a-1]-f.y}else s=r[a-2]-r[a-4],h=r[a-1]-r[a-3];var d=(Math.atan2(h,s)+e)%e,l=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(r[a-2],r[a-1]),t.rotate(d),t.moveTo(0,0),t.lineTo(-m,l/2),t.lineTo(-m,-l/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(r[0],r[1]),o?(s=(n[0]+n[2])/2-r[0],h=(n[1]+n[3])/2-r[1]):(s=r[2]-r[0],h=r[3]-r[1]),t.rotate((Math.atan2(-h,-s)+e)%e),t.moveTo(0,0),t.lineTo(-m,l/2),t.lineTo(-m,-l/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){var e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x-e,y:t.y-e,width:t.width+e*2,height:t.height+e*2}}}Gl.Arrow=cs;cs.prototype.className="Arrow";(0,f9._registerNode)(cs);Wl.Factory.addGetterSetter(cs,"pointerLength",10,(0,Y1.getNumberValidator)());Wl.Factory.addGetterSetter(cs,"pointerWidth",10,(0,Y1.getNumberValidator)());Wl.Factory.addGetterSetter(cs,"pointerAtBeginning",!1);Wl.Factory.addGetterSetter(cs,"pointerAtEnding",!0);var Xl={};Object.defineProperty(Xl,"__esModule",{value:!0});Xl.Circle=void 0;const d9=$t,g9=Ve,p9=Mt,m9=qt;class ma extends g9.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}Xl.Circle=ma;ma.prototype._centroid=!0;ma.prototype.className="Circle";ma.prototype._attrsAffectingSize=["radius"];(0,m9._registerNode)(ma);d9.Factory.addGetterSetter(ma,"radius",0,(0,p9.getNumberValidator)());var Vl={};Object.defineProperty(Vl,"__esModule",{value:!0});Vl.Ellipse=void 0;const $d=$t,v9=Ve,$1=Mt,_9=qt;class An extends v9.Shape{_sceneFunc(t){var e=this.radiusX(),r=this.radiusY();t.beginPath(),t.save(),e!==r&&t.scale(1,r/e),t.arc(0,0,e,0,Math.PI*2,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}Vl.Ellipse=An;An.prototype.className="Ellipse";An.prototype._centroid=!0;An.prototype._attrsAffectingSize=["radiusX","radiusY"];(0,_9._registerNode)(An);$d.Factory.addComponentsGetterSetter(An,"radius",["x","y"]);$d.Factory.addGetterSetter(An,"radiusX",0,(0,$1.getNumberValidator)());$d.Factory.addGetterSetter(An,"radiusY",0,(0,$1.getNumberValidator)());var zl={};Object.defineProperty(zl,"__esModule",{value:!0});zl.Image=void 0;const wf=Ie,us=$t,y9=Ve,x9=qt,_o=Mt;let Ar=class K1 extends y9.Shape{constructor(t){super(t),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&t.readyState===4||t&&t.addEventListener&&t.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){return super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),r=this.getHeight(),n=this.cornerRadius(),o=this.attrs.image;let m;if(o){const a=this.attrs.cropWidth,s=this.attrs.cropHeight;a&&s?m=[o,this.cropX(),this.cropY(),a,s,0,0,e,r]:m=[o,0,0,e,r]}(this.hasFill()||this.hasStroke()||n)&&(t.beginPath(),n?wf.Util.drawRoundedRectPath(t,e,r,n):t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)),o&&(n&&t.clip(),t.drawImage.apply(t,m))}_hitFunc(t){var e=this.width(),r=this.height(),n=this.cornerRadius();t.beginPath(),n?wf.Util.drawRoundedRectPath(t,e,r,n):t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return(t=this.attrs.width)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.width}getHeight(){var t,e;return(t=this.attrs.height)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.height}static fromURL(t,e,r=null){var n=wf.Util.createImageElement();n.onload=function(){var o=new K1({image:n});e(o)},n.onerror=r,n.crossOrigin="Anonymous",n.src=t}};zl.Image=Ar;Ar.prototype.className="Image";(0,x9._registerNode)(Ar);us.Factory.addGetterSetter(Ar,"cornerRadius",0,(0,_o.getNumberOrArrayOfNumbersValidator)(4));us.Factory.addGetterSetter(Ar,"image");us.Factory.addComponentsGetterSetter(Ar,"crop",["x","y","width","height"]);us.Factory.addGetterSetter(Ar,"cropX",0,(0,_o.getNumberValidator)());us.Factory.addGetterSetter(Ar,"cropY",0,(0,_o.getNumberValidator)());us.Factory.addGetterSetter(Ar,"cropWidth",0,(0,_o.getNumberValidator)());us.Factory.addGetterSetter(Ar,"cropHeight",0,(0,_o.getNumberValidator)());var sa={};Object.defineProperty(sa,"__esModule",{value:!0});sa.Tag=sa.Label=void 0;const jl=$t,b9=Ve,S9=da,Kd=Mt,q1=qt;var Z1=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],C9="Change.konva",w9="none",xd="up",bd="right",Sd="down",Cd="left",T9=Z1.length;class qd extends S9.Group{constructor(t){super(t),this.on("add.konva",function(e){this._addListeners(e.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){var e=this,r,n=function(){e._sync()};for(r=0;r<T9;r++)t.on(Z1[r]+C9,n)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var t=this.getText(),e=this.getTag(),r,n,o,m,a,s,h;if(t&&e){switch(r=t.width(),n=t.height(),o=e.pointerDirection(),m=e.pointerWidth(),h=e.pointerHeight(),a=0,s=0,o){case xd:a=r/2,s=-1*h;break;case bd:a=r+m,s=n/2;break;case Sd:a=r/2,s=n+h;break;case Cd:a=-1*m,s=n/2;break}e.setAttrs({x:-1*a,y:-1*s,width:r,height:n}),t.setAttrs({x:-1*a,y:-1*s})}}}sa.Label=qd;qd.prototype.className="Label";(0,q1._registerNode)(qd);class fs extends b9.Shape{_sceneFunc(t){var e=this.width(),r=this.height(),n=this.pointerDirection(),o=this.pointerWidth(),m=this.pointerHeight(),a=this.cornerRadius();let s=0,h=0,d=0,l=0;typeof a=="number"?s=h=d=l=Math.min(a,e/2,r/2):(s=Math.min(a[0]||0,e/2,r/2),h=Math.min(a[1]||0,e/2,r/2),l=Math.min(a[2]||0,e/2,r/2),d=Math.min(a[3]||0,e/2,r/2)),t.beginPath(),t.moveTo(s,0),n===xd&&(t.lineTo((e-o)/2,0),t.lineTo(e/2,-1*m),t.lineTo((e+o)/2,0)),t.lineTo(e-h,0),t.arc(e-h,h,h,Math.PI*3/2,0,!1),n===bd&&(t.lineTo(e,(r-m)/2),t.lineTo(e+o,r/2),t.lineTo(e,(r+m)/2)),t.lineTo(e,r-l),t.arc(e-l,r-l,l,0,Math.PI/2,!1),n===Sd&&(t.lineTo((e+o)/2,r),t.lineTo(e/2,r+m),t.lineTo((e-o)/2,r)),t.lineTo(d,r),t.arc(d,r-d,d,Math.PI/2,Math.PI,!1),n===Cd&&(t.lineTo(0,(r+m)/2),t.lineTo(-1*o,r/2),t.lineTo(0,(r-m)/2)),t.lineTo(0,s),t.arc(s,s,s,Math.PI,Math.PI*3/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){var t=0,e=0,r=this.pointerWidth(),n=this.pointerHeight(),o=this.pointerDirection(),m=this.width(),a=this.height();return o===xd?(e-=n,a+=n):o===Sd?a+=n:o===Cd?(t-=r*1.5,m+=r):o===bd&&(m+=r*1.5),{x:t,y:e,width:m,height:a}}}sa.Tag=fs;fs.prototype.className="Tag";(0,q1._registerNode)(fs);jl.Factory.addGetterSetter(fs,"pointerDirection",w9);jl.Factory.addGetterSetter(fs,"pointerWidth",0,(0,Kd.getNumberValidator)());jl.Factory.addGetterSetter(fs,"pointerHeight",0,(0,Kd.getNumberValidator)());jl.Factory.addGetterSetter(fs,"cornerRadius",0,(0,Kd.getNumberOrArrayOfNumbersValidator)(4));var yo={};Object.defineProperty(yo,"__esModule",{value:!0});yo.Rect=void 0;const E9=$t,A9=Ve,P9=qt,I9=Ie,M9=Mt;class Yl extends A9.Shape{_sceneFunc(t){var e=this.cornerRadius(),r=this.width(),n=this.height();t.beginPath(),e?I9.Util.drawRoundedRectPath(t,r,n,e):t.rect(0,0,r,n),t.closePath(),t.fillStrokeShape(this)}}yo.Rect=Yl;Yl.prototype.className="Rect";(0,P9._registerNode)(Yl);E9.Factory.addGetterSetter(Yl,"cornerRadius",0,(0,M9.getNumberOrArrayOfNumbersValidator)(4));var $l={};Object.defineProperty($l,"__esModule",{value:!0});$l.RegularPolygon=void 0;const J1=$t,O9=Ve,Q1=Mt,R9=qt;class ds extends O9.Shape{_sceneFunc(t){const e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var r=1;r<e.length;r++)t.lineTo(e[r].x,e[r].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,r=[];for(var n=0;n<t;n++)r.push({x:e*Math.sin(n*2*Math.PI/t),y:-1*e*Math.cos(n*2*Math.PI/t)});return r}getSelfRect(){const t=this._getPoints();var e=t[0].x,r=t[0].y,n=t[0].x,o=t[0].y;return t.forEach(m=>{e=Math.min(e,m.x),r=Math.max(r,m.x),n=Math.min(n,m.y),o=Math.max(o,m.y)}),{x:e,y:n,width:r-e,height:o-n}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}$l.RegularPolygon=ds;ds.prototype.className="RegularPolygon";ds.prototype._centroid=!0;ds.prototype._attrsAffectingSize=["radius"];(0,R9._registerNode)(ds);J1.Factory.addGetterSetter(ds,"radius",0,(0,Q1.getNumberValidator)());J1.Factory.addGetterSetter(ds,"sides",0,(0,Q1.getNumberValidator)());var Kl={};Object.defineProperty(Kl,"__esModule",{value:!0});Kl.Ring=void 0;const ty=$t,D9=Ve,ey=Mt,F9=qt;var Mv=Math.PI*2;class gs extends D9.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,Mv,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),Mv,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}Kl.Ring=gs;gs.prototype.className="Ring";gs.prototype._centroid=!0;gs.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,F9._registerNode)(gs);ty.Factory.addGetterSetter(gs,"innerRadius",0,(0,ey.getNumberValidator)());ty.Factory.addGetterSetter(gs,"outerRadius",0,(0,ey.getNumberValidator)());var ql={};Object.defineProperty(ql,"__esModule",{value:!0});ql.Sprite=void 0;const ps=$t,L9=Ve,k9=ga,iy=Mt,B9=qt;class Pr extends L9.Shape{constructor(t){super(t),this._updated=!0,this.anim=new k9.Animation(()=>{var e=this._updated;return this._updated=!1,e}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(t){var e=this.animation(),r=this.frameIndex(),n=r*4,o=this.animations()[e],m=this.frameOffsets(),a=o[n+0],s=o[n+1],h=o[n+2],d=o[n+3],l=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,h,d),t.closePath(),t.fillStrokeShape(this)),l)if(m){var u=m[e],c=r*2;t.drawImage(l,a,s,h,d,u[c+0],u[c+1],h,d)}else t.drawImage(l,a,s,h,d,0,0,h,d)}_hitFunc(t){var e=this.animation(),r=this.frameIndex(),n=r*4,o=this.animations()[e],m=this.frameOffsets(),a=o[n+2],s=o[n+3];if(t.beginPath(),m){var h=m[e],d=r*2;t.rect(h[d+0],h[d+1],a,s)}else t.rect(0,0,a,s);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())}start(){if(!this.isRunning()){var t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var t=this.frameIndex(),e=this.animation(),r=this.animations(),n=r[e],o=n.length/4;t<o-1?this.frameIndex(t+1):this.frameIndex(0)}}ql.Sprite=Pr;Pr.prototype.className="Sprite";(0,B9._registerNode)(Pr);ps.Factory.addGetterSetter(Pr,"animation");ps.Factory.addGetterSetter(Pr,"animations");ps.Factory.addGetterSetter(Pr,"frameOffsets");ps.Factory.addGetterSetter(Pr,"image");ps.Factory.addGetterSetter(Pr,"frameIndex",0,(0,iy.getNumberValidator)());ps.Factory.addGetterSetter(Pr,"frameRate",17,(0,iy.getNumberValidator)());ps.Factory.backCompat(Pr,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});var Zl={};Object.defineProperty(Zl,"__esModule",{value:!0});Zl.Star=void 0;const Zd=$t,N9=Ve,Jd=Mt,U9=qt;class Pn extends N9.Shape{_sceneFunc(t){var e=this.innerRadius(),r=this.outerRadius(),n=this.numPoints();t.beginPath(),t.moveTo(0,0-r);for(var o=1;o<n*2;o++){var m=o%2===0?r:e,a=m*Math.sin(o*Math.PI/n),s=-1*m*Math.cos(o*Math.PI/n);t.lineTo(a,s)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}Zl.Star=Pn;Pn.prototype.className="Star";Pn.prototype._centroid=!0;Pn.prototype._attrsAffectingSize=["innerRadius","outerRadius"];(0,U9._registerNode)(Pn);Zd.Factory.addGetterSetter(Pn,"numPoints",5,(0,Jd.getNumberValidator)());Zd.Factory.addGetterSetter(Pn,"innerRadius",0,(0,Jd.getNumberValidator)());Zd.Factory.addGetterSetter(Pn,"outerRadius",0,(0,Jd.getNumberValidator)());var ns={};Object.defineProperty(ns,"__esModule",{value:!0});ns.Text=ns.stringToArray=void 0;const wd=Ie,pi=$t,G9=Ve,In=Mt,H9=qt;function ry(i){return Array.from(i)}ns.stringToArray=ry;var Ns="auto",W9="center",Ha="justify",X9="Change.konva",V9="2d",Ov="-",ny="left",z9="text",j9="Text",Y9="top",$9="bottom",Rv="middle",sy="normal",K9="px ",Lh=" ",q9="right",Z9="word",J9="char",Dv="none",Tf="…",ay=["fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Q9=ay.length;function tI(i){return i.split(",").map(t=>{t=t.trim();const e=t.indexOf(" ")>=0,r=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!r&&(t=`"${t}"`),t}).join(", ")}var kh;function Ef(){return kh||(kh=wd.Util.createCanvasElement().getContext(V9),kh)}function eI(i){i.fillText(this._partialText,this._partialTextX,this._partialTextY)}function iI(i){i.setAttr("miterLimit",2),i.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function rI(i){return i=i||{},!i.fillLinearGradientColorStops&&!i.fillRadialGradientColorStops&&!i.fillPatternImage&&(i.fill=i.fill||"black"),i}class ke extends G9.Shape{constructor(t){super(rI(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<Q9;e++)this.on(ay[e]+X9,this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,r=e.length;if(this.text()){var n=this.padding(),o=this.fontSize(),m=this.lineHeight()*o,a=this.verticalAlign(),s=0,h=this.align(),d=this.getWidth(),l=this.letterSpacing(),u=this.fill(),c=this.textDecoration(),f=c.indexOf("underline")!==-1,v=c.indexOf("line-through")!==-1,p,y=0,y=m/2,b=0,x=0;for(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",Rv),t.setAttr("textAlign",ny),a===Rv?s=(this.getHeight()-r*m-n*2)/2:a===$9&&(s=this.getHeight()-r*m-n*2),t.translate(n,s+n),p=0;p<r;p++){var b=0,x=0,S=e[p],w=S.text,E=S.width,P=S.lastInParagraph,A,N,k;if(t.save(),h===q9?b+=d-E-n*2:h===W9&&(b+=(d-E-n*2)/2),f){t.save(),t.beginPath(),t.moveTo(b,y+x+Math.round(o/2)),A=w.split(" ").length-1,N=A===0,k=h===Ha&&!P?d-n*2:E,t.lineTo(b+Math.round(k),y+x+Math.round(o/2)),t.lineWidth=o/15;const ot=this._getLinearGradient();t.strokeStyle=ot||u,t.stroke(),t.restore()}if(v){t.save(),t.beginPath(),t.moveTo(b,y+x),A=w.split(" ").length-1,N=A===0,k=h===Ha&&P&&!N?d-n*2:E,t.lineTo(b+Math.round(k),y+x),t.lineWidth=o/15;const ot=this._getLinearGradient();t.strokeStyle=ot||u,t.stroke(),t.restore()}if(l!==0||h===Ha){A=w.split(" ").length-1;for(var U=ry(w),j=0;j<U.length;j++){var X=U[j];X===" "&&!P&&h===Ha&&(b+=(d-n*2-E)/A),this._partialTextX=b,this._partialTextY=y+x,this._partialText=X,t.fillStrokeShape(this),b+=this.measureSize(X).width+l}}else this._partialTextX=b,this._partialTextY=y+x,this._partialText=w,t.fillStrokeShape(this);t.restore(),r>1&&(y+=m)}}}_hitFunc(t){var e=this.getWidth(),r=this.getHeight();t.beginPath(),t.rect(0,0,e,r),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=wd.Util._isString(t)?t:t==null?"":t+"";return this._setAttr(z9,e),this}getWidth(){var t=this.attrs.width===Ns||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var t=this.attrs.height===Ns||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return wd.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e=Ef(),r=this.fontSize(),n;return e.save(),e.font=this._getContextFont(),n=e.measureText(t),e.restore(),{width:n.width,height:r}}_getContextFont(){return this.fontStyle()+Lh+this.fontVariant()+Lh+(this.fontSize()+K9)+tI(this.fontFamily())}_addTextLine(t){this.align()===Ha&&(t=t.trim());var r=this._getTextWidth(t);return this.textArr.push({text:t,width:r,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),r=t.length;return Ef().measureText(t).width+(r?e*(r-1):0)}_setTextData(){var t=this.text().split(`
`),e=+this.fontSize(),r=0,n=this.lineHeight()*e,o=this.attrs.width,m=this.attrs.height,a=o!==Ns&&o!==void 0,s=m!==Ns&&m!==void 0,h=this.padding(),d=o-h*2,l=m-h*2,u=0,c=this.wrap(),f=c!==Dv,v=c!==J9&&f,p=this.ellipsis();this.textArr=[],Ef().font=this._getContextFont();for(var y=p?this._getTextWidth(Tf):0,b=0,x=t.length;b<x;++b){var S=t[b],w=this._getTextWidth(S);if(a&&w>d)for(;S.length>0;){for(var E=0,P=S.length,A="",N=0;E<P;){var k=E+P>>>1,U=S.slice(0,k+1),j=this._getTextWidth(U)+y;j<=d?(E=k+1,A=U,N=j):P=k}if(A){if(v){var X,W=S[A.length],Q=W===Lh||W===Ov;Q&&N<=d?X=A.length:X=Math.max(A.lastIndexOf(Lh),A.lastIndexOf(Ov))+1,X>0&&(E=X,A=A.slice(0,E),N=this._getTextWidth(A))}A=A.trimRight(),this._addTextLine(A),r=Math.max(r,N),u+=n;var ot=this._shouldHandleEllipsis(u);if(ot){this._tryToAddEllipsisToLastLine();break}if(S=S.slice(E),S=S.trimLeft(),S.length>0&&(w=this._getTextWidth(S),w<=d)){this._addTextLine(S),u+=n,r=Math.max(r,w);break}}else break}else this._addTextLine(S),u+=n,r=Math.max(r,w),this._shouldHandleEllipsis(u)&&b<x-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),s&&u+n>l)break}this.textHeight=e,this.textWidth=r}_shouldHandleEllipsis(t){var e=+this.fontSize(),r=this.lineHeight()*e,n=this.attrs.height,o=n!==Ns&&n!==void 0,m=this.padding(),a=n-m*2,s=this.wrap(),h=s!==Dv;return!h||o&&t+r>a}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e=t!==Ns&&t!==void 0,r=this.padding(),n=t-r*2,o=this.ellipsis(),m=this.textArr[this.textArr.length-1];if(!(!m||!o)){if(e){var a=this._getTextWidth(m.text+Tf)<n;a||(m.text=m.text.slice(0,m.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(m.text+Tf)}}getStrokeScaleEnabled(){return!0}}ns.Text=ke;ke.prototype._fillFunc=eI;ke.prototype._strokeFunc=iI;ke.prototype.className=j9;ke.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];(0,H9._registerNode)(ke);pi.Factory.overWriteSetter(ke,"width",(0,In.getNumberOrAutoValidator)());pi.Factory.overWriteSetter(ke,"height",(0,In.getNumberOrAutoValidator)());pi.Factory.addGetterSetter(ke,"fontFamily","Arial");pi.Factory.addGetterSetter(ke,"fontSize",12,(0,In.getNumberValidator)());pi.Factory.addGetterSetter(ke,"fontStyle",sy);pi.Factory.addGetterSetter(ke,"fontVariant",sy);pi.Factory.addGetterSetter(ke,"padding",0,(0,In.getNumberValidator)());pi.Factory.addGetterSetter(ke,"align",ny);pi.Factory.addGetterSetter(ke,"verticalAlign",Y9);pi.Factory.addGetterSetter(ke,"lineHeight",1,(0,In.getNumberValidator)());pi.Factory.addGetterSetter(ke,"wrap",Z9);pi.Factory.addGetterSetter(ke,"ellipsis",!1,(0,In.getBooleanValidator)());pi.Factory.addGetterSetter(ke,"letterSpacing",0,(0,In.getNumberValidator)());pi.Factory.addGetterSetter(ke,"text","",(0,In.getStringValidator)());pi.Factory.addGetterSetter(ke,"textDecoration","");var Jl={};Object.defineProperty(Jl,"__esModule",{value:!0});Jl.TextPath=void 0;const Af=Ie,ur=$t,nI=Ve,Wa=pa,Pf=ns,oy=Mt,sI=qt;var aI="",hy="normal";function ly(i){i.fillText(this.partialText,0,0)}function cy(i){i.strokeText(this.partialText,0,0)}class ze extends nI.Shape{constructor(t){super(t),this.dummyCanvas=Af.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Wa.Path.getPathLength(this.dataArray)}_getPointAtLength(t){if(!this.attrs.data)return null;const e=this.pathLength;return t-1>e?null:Wa.Path.getPointAtLengthOfDataArray(t,this.dataArray)}_readDataAttribute(){this.dataArray=Wa.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();var e=this.textDecoration(),r=this.fill(),n=this.fontSize(),o=this.glyphInfo;e==="underline"&&t.beginPath();for(var m=0;m<o.length;m++){t.save();var a=o[m].p0;t.translate(a.x,a.y),t.rotate(o[m].rotation),this.partialText=o[m].text,t.fillStrokeShape(this),e==="underline"&&(m===0&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}e==="underline"&&(t.strokeStyle=r,t.lineWidth=n/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();var e=this.glyphInfo;if(e.length>=1){var r=e[0].p0;t.moveTo(r.x,r.y)}for(var n=0;n<e.length;n++){var o=e[n].p1;t.lineTo(o.x,o.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return Af.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return Pf.Text.prototype.setText.call(this,t)}_getContextFont(){return Pf.Text.prototype._getContextFont.call(this)}_getTextSize(t){var e=this.dummyCanvas,r=e.getContext("2d");r.save(),r.font=this._getContextFont();var n=r.measureText(t);return r.restore(),{width:n.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:t,height:e}=this._getTextSize(this.attrs.text);if(this.textWidth=t,this.textHeight=e,this.glyphInfo=[],!this.attrs.data)return null;const r=this.letterSpacing(),n=this.align(),o=this.kerningFunc(),m=Math.max(this.textWidth+((this.attrs.text||"").length-1)*r,0);let a=0;n==="center"&&(a=Math.max(0,this.pathLength/2-m/2)),n==="right"&&(a=Math.max(0,this.pathLength-m));const s=(0,Pf.stringToArray)(this.text());let h=a;for(var d=0;d<s.length;d++){const l=this._getPointAtLength(h);if(!l)return;let u=this._getTextSize(s[d]).width+r;if(s[d]===" "&&n==="justify"){const b=this.text().split(" ").length-1;u+=(this.pathLength-m)/b}const c=this._getPointAtLength(h+u);if(!c)return;const f=Wa.Path.getLineLength(l.x,l.y,c.x,c.y);let v=0;if(o)try{v=o(s[d-1],s[d])*this.fontSize()}catch{v=0}l.x+=v,c.x+=v,this.textWidth+=v;const p=Wa.Path.getPointOnLine(v+f/2,l.x,l.y,c.x,c.y),y=Math.atan2(c.y-l.y,c.x-l.x);this.glyphInfo.push({transposeX:p.x,transposeY:p.y,text:s[d],rotation:y,p0:l,p1:c}),h+=u}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var t=[];this.glyphInfo.forEach(function(d){t.push(d.p0.x),t.push(d.p0.y),t.push(d.p1.x),t.push(d.p1.y)});for(var e=t[0]||0,r=t[0]||0,n=t[1]||0,o=t[1]||0,m,a,s=0;s<t.length/2;s++)m=t[s*2],a=t[s*2+1],e=Math.min(e,m),r=Math.max(r,m),n=Math.min(n,a),o=Math.max(o,a);var h=this.fontSize();return{x:e-h/2,y:n-h/2,width:r-e+h,height:o-n+h}}destroy(){return Af.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}Jl.TextPath=ze;ze.prototype._fillFunc=ly;ze.prototype._strokeFunc=cy;ze.prototype._fillFuncHit=ly;ze.prototype._strokeFuncHit=cy;ze.prototype.className="TextPath";ze.prototype._attrsAffectingSize=["text","fontSize","data"];(0,sI._registerNode)(ze);ur.Factory.addGetterSetter(ze,"data");ur.Factory.addGetterSetter(ze,"fontFamily","Arial");ur.Factory.addGetterSetter(ze,"fontSize",12,(0,oy.getNumberValidator)());ur.Factory.addGetterSetter(ze,"fontStyle",hy);ur.Factory.addGetterSetter(ze,"align","left");ur.Factory.addGetterSetter(ze,"letterSpacing",0,(0,oy.getNumberValidator)());ur.Factory.addGetterSetter(ze,"textBaseline","middle");ur.Factory.addGetterSetter(ze,"fontVariant",hy);ur.Factory.addGetterSetter(ze,"text",aI);ur.Factory.addGetterSetter(ze,"textDecoration",null);ur.Factory.addGetterSetter(ze,"kerningFunc",null);var Ql={};Object.defineProperty(Ql,"__esModule",{value:!0});Ql.Transformer=void 0;const ce=Ie,le=$t,Fv=we,oI=Ve,hI=yo,Lv=da,er=qt,Mn=Mt,lI=qt;var uy="tr-konva",cI=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(i=>i+`.${uy}`).join(" "),kv="nodesRect",uI=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],fI={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const dI="ontouchstart"in er.Konva._global;function gI(i,t){if(i==="rotater")return"crosshair";t+=ce.Util.degToRad(fI[i]||0);var e=(ce.Util.radToDeg(t)%360+360)%360;return ce.Util._inRange(e,315+22.5,360)||ce.Util._inRange(e,0,22.5)?"ns-resize":ce.Util._inRange(e,45-22.5,45+22.5)?"nesw-resize":ce.Util._inRange(e,90-22.5,90+22.5)?"ew-resize":ce.Util._inRange(e,135-22.5,135+22.5)?"nwse-resize":ce.Util._inRange(e,180-22.5,180+22.5)?"ns-resize":ce.Util._inRange(e,225-22.5,225+22.5)?"nesw-resize":ce.Util._inRange(e,270-22.5,270+22.5)?"ew-resize":ce.Util._inRange(e,315-22.5,315+22.5)?"nwse-resize":(ce.Util.error("Transformer has unknown angle for cursor detection: "+e),"pointer")}var dl=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Bv=1e8;function pI(i){return{x:i.x+i.width/2*Math.cos(i.rotation)+i.height/2*Math.sin(-i.rotation),y:i.y+i.height/2*Math.cos(i.rotation)+i.width/2*Math.sin(i.rotation)}}function fy(i,t,e){const r=e.x+(i.x-e.x)*Math.cos(t)-(i.y-e.y)*Math.sin(t),n=e.y+(i.x-e.x)*Math.sin(t)+(i.y-e.y)*Math.cos(t);return Object.assign(Object.assign({},i),{rotation:i.rotation+t,x:r,y:n})}function mI(i,t){const e=pI(i);return fy(i,t,e)}function vI(i,t,e){let r=t;for(let n=0;n<i.length;n++){const o=er.Konva.getAngle(i[n]),m=Math.abs(o-t)%(Math.PI*2);Math.min(m,Math.PI*2-m)<e&&(r=o)}return r}class se extends Lv.Group{constructor(t){super(t),this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(cI,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return ce.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return uy+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();const e=t.filter(n=>n.isAncestorOf(this)?(ce.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=t=e,t.length===1&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(n=>{const o=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},m=n._attrsAffectingSize.map(a=>a+"Change."+this._getEventNamespace()).join(" ");n.on(m,o),n.on(uI.map(a=>a+`.${this._getEventNamespace()}`).join(" "),o),n.on(`absoluteTransformChange.${this._getEventNamespace()}`,o),this._proxyDrag(n)}),this._resetTransformCache();var r=!!this.findOne(".top-left");return r&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,r=>{e=t.getAbsolutePosition(),!this.isDragging()&&t!==this.findOne(".back")&&this.startDrag(r,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,r=>{if(!e)return;const n=t.getAbsolutePosition(),o=n.x-e.x,m=n.y-e.y;this.nodes().forEach(a=>{if(a===t||a.isDragging())return;const s=a.getAbsolutePosition();a.setAbsolutePosition({x:s.x+o,y:s.y+m}),a.startDrag(r)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(kv),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(kv,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),r){var n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),o=t.getAbsoluteScale(r),m=t.getAbsolutePosition(r),a=n.x*o.x-t.offsetX()*o.x,s=n.y*o.y-t.offsetY()*o.y;const h=(er.Konva.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),d={x:m.x+a*Math.cos(h)+s*Math.sin(-h),y:m.y+s*Math.cos(h)+a*Math.sin(h),width:n.width*o.x,height:n.height*o.y,rotation:h};return fy(d,-er.Konva.getAngle(e),{x:0,y:0})}__getNodeRect(){var t=this.getNode();if(!t)return{x:-Bv,y:-Bv,width:0,height:0,rotation:0};const e=[];this.nodes().map(h=>{const d=h.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var l=[{x:d.x,y:d.y},{x:d.x+d.width,y:d.y},{x:d.x+d.width,y:d.y+d.height},{x:d.x,y:d.y+d.height}],u=h.getAbsoluteTransform();l.forEach(function(c){var f=u.point(c);e.push(f)})});const r=new ce.Transform;r.rotate(-er.Konva.getAngle(this.rotation()));var n,o,m,a;e.forEach(function(h){var d=r.point(h);n===void 0&&(n=m=d.x,o=a=d.y),n=Math.min(n,d.x),o=Math.min(o,d.y),m=Math.max(m,d.x),a=Math.max(a,d.y)}),r.invert();const s=r.point({x:n,y:o});return{x:s.x,y:s.y,width:m-n,height:a-o,rotation:er.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),dl.forEach(function(t){this._createAnchor(t)}.bind(this)),this._createAnchor("rotater")}_createAnchor(t){var e=new hI.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:dI?10:"auto"}),r=this;e.on("mousedown touchstart",function(n){r._handleMouseDown(n)}),e.on("dragstart",n=>{e.stopDrag(),n.cancelBubble=!0}),e.on("dragend",n=>{n.cancelBubble=!0}),e.on("mouseenter",()=>{var n=er.Konva.getAngle(this.rotation()),o=gI(t,n);e.getStage().content&&(e.getStage().content.style.cursor=o),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){var t=new oI.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(e){var r=this.getParent(),n=r.padding();e.beginPath(),e.rect(-n,-n,this.width()+n*2,this.height()+n*2),e.moveTo(this.width()/2,-n),r.rotateEnabled()&&e.lineTo(this.width()/2,-r.rotateAnchorOffset()*ce.Util._sign(this.height())-n),e.fillStrokeShape(this)},hitFunc:(e,r)=>{if(this.shouldOverdrawWholeArea()){var n=this.padding();e.beginPath(),e.rect(-n,-n,r.width()+n*2,r.height()+n*2),e.fillStrokeShape(r)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",e=>{e.cancelBubble=!0}),t.on("dragmove",e=>{e.cancelBubble=!0}),t.on("dragend",e=>{e.cancelBubble=!0}),this.on("dragmove",e=>{this.update()})}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),r=e.width,n=e.height,o=Math.sqrt(Math.pow(r,2)+Math.pow(n,2));this.sin=Math.abs(n/o),this.cos=Math.abs(r/o),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var m=t.target.getAbsolutePosition(),a=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:a.x-m.x,y:a.y-m.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(s=>{s._fire("transformstart",{evt:t.evt,target:s})})}_handleMouseMove(t){var e,r,n,o=this.findOne("."+this._movingAnchorName),m=o.getStage();m.setPointersPositions(t);const a=m.getPointerPosition();let s={x:a.x-this._anchorDragOffset.x,y:a.y-this._anchorDragOffset.y};const h=o.getAbsolutePosition();this.anchorDragBoundFunc()&&(s=this.anchorDragBoundFunc()(h,s,t)),o.setAbsolutePosition(s);const d=o.getAbsolutePosition();if(!(h.x===d.x&&h.y===d.y)){if(this._movingAnchorName==="rotater"){var l=this._getNodeRect();e=o.x()-l.width/2,r=-o.y()+l.height/2;let X=Math.atan2(-r,e)+Math.PI/2;l.height<0&&(X-=Math.PI);var u=er.Konva.getAngle(this.rotation());const W=u+X,Q=er.Konva.getAngle(this.rotationSnapTolerance()),it=vI(this.rotationSnaps(),W,Q)-l.rotation,ct=mI(l,it);this._fitNodesInto(ct,t);return}var c=this.shiftBehavior(),f;c==="inverted"?f=this.keepRatio()&&!t.shiftKey:c==="none"?f=this.keepRatio():f=this.keepRatio()||t.shiftKey;var x=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(f){var v=x?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(v.x-o.x(),2)+Math.pow(v.y-o.y(),2));var p=this.findOne(".top-left").x()>v.x?-1:1,y=this.findOne(".top-left").y()>v.y?-1:1;e=n*this.cos*p,r=n*this.sin*y,this.findOne(".top-left").x(v.x-e),this.findOne(".top-left").y(v.y-r)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(o.y());else if(this._movingAnchorName==="top-right"){if(f){var v=x?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(o.x()-v.x,2)+Math.pow(v.y-o.y(),2));var p=this.findOne(".top-right").x()<v.x?-1:1,y=this.findOne(".top-right").y()>v.y?-1:1;e=n*this.cos*p,r=n*this.sin*y,this.findOne(".top-right").x(v.x+e),this.findOne(".top-right").y(v.y-r)}var b=o.position();this.findOne(".top-left").y(b.y),this.findOne(".bottom-right").x(b.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(o.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(o.x());else if(this._movingAnchorName==="bottom-left"){if(f){var v=x?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(v.x-o.x(),2)+Math.pow(o.y()-v.y,2));var p=v.x<o.x()?-1:1,y=o.y()<v.y?-1:1;e=n*this.cos*p,r=n*this.sin*y,o.x(v.x-e),o.y(v.y+r)}b=o.position(),this.findOne(".top-left").x(b.x),this.findOne(".bottom-right").y(b.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(o.y());else if(this._movingAnchorName==="bottom-right"){if(f){var v=x?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(o.x()-v.x,2)+Math.pow(o.y()-v.y,2));var p=this.findOne(".bottom-right").x()<v.x?-1:1,y=this.findOne(".bottom-right").y()<v.y?-1:1;e=n*this.cos*p,r=n*this.sin*y,this.findOne(".bottom-right").x(v.x+e),this.findOne(".bottom-right").y(v.y+r)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var x=this.centeredScaling()||t.altKey;if(x){var S=this.findOne(".top-left"),w=this.findOne(".bottom-right"),E=S.x(),P=S.y(),A=this.getWidth()-w.x(),N=this.getHeight()-w.y();w.move({x:-E,y:-P}),S.move({x:A,y:N})}var k=this.findOne(".top-left").getAbsolutePosition();e=k.x,r=k.y;var U=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),j=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:r,width:U,height:j,rotation:er.Konva.getAngle(this.rotation())},t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach(r=>{r._fire("transformend",{evt:t,target:r})}),this._movingAnchorName=null}}_fitNodesInto(t,e){var r=this._getNodeRect();const n=1;if(ce.Util._inRange(t.width,-this.padding()*2-n,n)){this.update();return}if(ce.Util._inRange(t.height,-this.padding()*2-n,n)){this.update();return}const o=this.flipEnabled();var m=new ce.Transform;if(m.rotate(er.Konva.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const l=m.point({x:-this.padding()*2,y:0});if(t.x+=l.x,t.y+=l.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,!o){this.update();return}}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const l=m.point({x:this.padding()*2,y:0});if(this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,t.width+=this.padding()*2,!o){this.update();return}}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const l=m.point({x:0,y:-this.padding()*2});if(t.x+=l.x,t.y+=l.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,t.height+=this.padding()*2,!o){this.update();return}}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const l=m.point({x:0,y:this.padding()*2});if(this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=l.x,this._anchorDragOffset.y-=l.y,t.height+=this.padding()*2,!o){this.update();return}}if(this.boundBoxFunc()){const l=this.boundBoxFunc()(r,t);l?t=l:ce.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const a=1e7,s=new ce.Transform;s.translate(r.x,r.y),s.rotate(r.rotation),s.scale(r.width/a,r.height/a);const h=new ce.Transform;h.translate(t.x,t.y),h.rotate(t.rotation),h.scale(t.width/a,t.height/a);const d=h.multiply(s.invert());this._nodes.forEach(l=>{var u;const c=l.getParent().getAbsoluteTransform(),f=l.getTransform().copy();f.translate(l.offsetX(),l.offsetY());const v=new ce.Transform;v.multiply(c.copy().invert()).multiply(d).multiply(c).multiply(f);const p=v.decompose();l.setAttrs(p),this._fire("transform",{evt:e,target:l}),l._fire("transform",{evt:e,target:l}),(u=l.getLayer())===null||u===void 0||u.batchDraw()}),this.rotation(ce.Util._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(ce.Util._getRotation(e.rotation));var r=e.width,n=e.height,o=this.enabledAnchors(),m=this.resizeEnabled(),a=this.padding(),s=this.anchorSize();const h=this.find("._anchor");h.forEach(l=>{l.setAttrs({width:s,height:s,offsetX:s/2,offsetY:s/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:s/2+a,offsetY:s/2+a,visible:m&&o.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:r/2,y:0,offsetY:s/2+a,visible:m&&o.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:r,y:0,offsetX:s/2-a,offsetY:s/2+a,visible:m&&o.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:s/2+a,visible:m&&o.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:r,y:n/2,offsetX:s/2-a,visible:m&&o.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:s/2+a,offsetY:s/2-a,visible:m&&o.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:r/2,y:n,offsetY:s/2-a,visible:m&&o.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:r,y:n,offsetX:s/2-a,offsetY:s/2-a,visible:m&&o.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:r/2,y:-this.rotateAnchorOffset()*ce.Util._sign(n)-a,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:r,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const d=this.anchorStyleFunc();d&&h.forEach(l=>{d(l)}),(t=this.getLayer())===null||t===void 0||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),Lv.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return Fv.Node.prototype.toObject.call(this)}clone(t){var e=Fv.Node.prototype.clone.call(this,t);return e}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Ql.Transformer=se;function _I(i){return i instanceof Array||ce.Util.warn("enabledAnchors value should be an array"),i instanceof Array&&i.forEach(function(t){dl.indexOf(t)===-1&&ce.Util.warn("Unknown anchor name: "+t+". Available names are: "+dl.join(", "))}),i||[]}se.prototype.className="Transformer";(0,lI._registerNode)(se);le.Factory.addGetterSetter(se,"enabledAnchors",dl,_I);le.Factory.addGetterSetter(se,"flipEnabled",!0,(0,Mn.getBooleanValidator)());le.Factory.addGetterSetter(se,"resizeEnabled",!0);le.Factory.addGetterSetter(se,"anchorSize",10,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"rotateEnabled",!0);le.Factory.addGetterSetter(se,"rotationSnaps",[]);le.Factory.addGetterSetter(se,"rotateAnchorOffset",50,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"rotationSnapTolerance",5,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"borderEnabled",!0);le.Factory.addGetterSetter(se,"anchorStroke","rgb(0, 161, 255)");le.Factory.addGetterSetter(se,"anchorStrokeWidth",1,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"anchorFill","white");le.Factory.addGetterSetter(se,"anchorCornerRadius",0,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"borderStroke","rgb(0, 161, 255)");le.Factory.addGetterSetter(se,"borderStrokeWidth",1,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"borderDash");le.Factory.addGetterSetter(se,"keepRatio",!0);le.Factory.addGetterSetter(se,"shiftBehavior","default");le.Factory.addGetterSetter(se,"centeredScaling",!1);le.Factory.addGetterSetter(se,"ignoreStroke",!1);le.Factory.addGetterSetter(se,"padding",0,(0,Mn.getNumberValidator)());le.Factory.addGetterSetter(se,"node");le.Factory.addGetterSetter(se,"nodes");le.Factory.addGetterSetter(se,"boundBoxFunc");le.Factory.addGetterSetter(se,"anchorDragBoundFunc");le.Factory.addGetterSetter(se,"anchorStyleFunc");le.Factory.addGetterSetter(se,"shouldOverdrawWholeArea",!1);le.Factory.addGetterSetter(se,"useSingleNodeRotation",!0);le.Factory.backCompat(se,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});var tc={};Object.defineProperty(tc,"__esModule",{value:!0});tc.Wedge=void 0;const ec=$t,yI=Ve,xI=qt,dy=Mt,bI=qt;class en extends yI.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,xI.Konva.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}tc.Wedge=en;en.prototype.className="Wedge";en.prototype._centroid=!0;en.prototype._attrsAffectingSize=["radius"];(0,bI._registerNode)(en);ec.Factory.addGetterSetter(en,"radius",0,(0,dy.getNumberValidator)());ec.Factory.addGetterSetter(en,"angle",0,(0,dy.getNumberValidator)());ec.Factory.addGetterSetter(en,"clockwise",!1);ec.Factory.backCompat(en,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});var ic={};Object.defineProperty(ic,"__esModule",{value:!0});ic.Blur=void 0;const Nv=$t,SI=we,CI=Mt;function Uv(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var wI=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],TI=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function EI(i,t){var e=i.data,r=i.width,n=i.height,o,m,a,s,h,d,l,u,c,f,v,p,y,b,x,S,w,E,P,A,N,k,U,j,X=t+t+1,W=r-1,Q=n-1,ot=t+1,it=ot*(ot+1)/2,ct=new Uv,O=null,M=ct,L=null,H=null,Z=wI[t],G=TI[t];for(a=1;a<X;a++)M=M.next=new Uv,a===ot&&(O=M);for(M.next=ct,l=d=0,m=0;m<n;m++){for(S=w=E=P=u=c=f=v=0,p=ot*(A=e[d]),y=ot*(N=e[d+1]),b=ot*(k=e[d+2]),x=ot*(U=e[d+3]),u+=it*A,c+=it*N,f+=it*k,v+=it*U,M=ct,a=0;a<ot;a++)M.r=A,M.g=N,M.b=k,M.a=U,M=M.next;for(a=1;a<ot;a++)s=d+((W<a?W:a)<<2),u+=(M.r=A=e[s])*(j=ot-a),c+=(M.g=N=e[s+1])*j,f+=(M.b=k=e[s+2])*j,v+=(M.a=U=e[s+3])*j,S+=A,w+=N,E+=k,P+=U,M=M.next;for(L=ct,H=O,o=0;o<r;o++)e[d+3]=U=v*Z>>G,U!==0?(U=255/U,e[d]=(u*Z>>G)*U,e[d+1]=(c*Z>>G)*U,e[d+2]=(f*Z>>G)*U):e[d]=e[d+1]=e[d+2]=0,u-=p,c-=y,f-=b,v-=x,p-=L.r,y-=L.g,b-=L.b,x-=L.a,s=l+((s=o+t+1)<W?s:W)<<2,S+=L.r=e[s],w+=L.g=e[s+1],E+=L.b=e[s+2],P+=L.a=e[s+3],u+=S,c+=w,f+=E,v+=P,L=L.next,p+=A=H.r,y+=N=H.g,b+=k=H.b,x+=U=H.a,S-=A,w-=N,E-=k,P-=U,H=H.next,d+=4;l+=r}for(o=0;o<r;o++){for(w=E=P=S=c=f=v=u=0,d=o<<2,p=ot*(A=e[d]),y=ot*(N=e[d+1]),b=ot*(k=e[d+2]),x=ot*(U=e[d+3]),u+=it*A,c+=it*N,f+=it*k,v+=it*U,M=ct,a=0;a<ot;a++)M.r=A,M.g=N,M.b=k,M.a=U,M=M.next;for(h=r,a=1;a<=t;a++)d=h+o<<2,u+=(M.r=A=e[d])*(j=ot-a),c+=(M.g=N=e[d+1])*j,f+=(M.b=k=e[d+2])*j,v+=(M.a=U=e[d+3])*j,S+=A,w+=N,E+=k,P+=U,M=M.next,a<Q&&(h+=r);for(d=o,L=ct,H=O,m=0;m<n;m++)s=d<<2,e[s+3]=U=v*Z>>G,U>0?(U=255/U,e[s]=(u*Z>>G)*U,e[s+1]=(c*Z>>G)*U,e[s+2]=(f*Z>>G)*U):e[s]=e[s+1]=e[s+2]=0,u-=p,c-=y,f-=b,v-=x,p-=L.r,y-=L.g,b-=L.b,x-=L.a,s=o+((s=m+ot)<Q?s:Q)*r<<2,u+=S+=L.r=e[s],c+=w+=L.g=e[s+1],f+=E+=L.b=e[s+2],v+=P+=L.a=e[s+3],L=L.next,p+=A=H.r,y+=N=H.g,b+=k=H.b,x+=U=H.a,S-=A,w-=N,E-=k,P-=U,H=H.next,d+=r}}const AI=function(t){var e=Math.round(this.blurRadius());e>0&&EI(t,e)};ic.Blur=AI;Nv.Factory.addGetterSetter(SI.Node,"blurRadius",0,(0,CI.getNumberValidator)(),Nv.Factory.afterSetFilter);var rc={};Object.defineProperty(rc,"__esModule",{value:!0});rc.Brighten=void 0;const Gv=$t,PI=we,II=Mt,MI=function(i){var t=this.brightness()*255,e=i.data,r=e.length,n;for(n=0;n<r;n+=4)e[n]+=t,e[n+1]+=t,e[n+2]+=t};rc.Brighten=MI;Gv.Factory.addGetterSetter(PI.Node,"brightness",0,(0,II.getNumberValidator)(),Gv.Factory.afterSetFilter);var nc={};Object.defineProperty(nc,"__esModule",{value:!0});nc.Contrast=void 0;const Hv=$t,OI=we,RI=Mt,DI=function(i){var t=Math.pow((this.contrast()+100)/100,2),e=i.data,r=e.length,n=150,o=150,m=150,a;for(a=0;a<r;a+=4)n=e[a],o=e[a+1],m=e[a+2],n/=255,n-=.5,n*=t,n+=.5,n*=255,o/=255,o-=.5,o*=t,o+=.5,o*=255,m/=255,m-=.5,m*=t,m+=.5,m*=255,n=n<0?0:n>255?255:n,o=o<0?0:o>255?255:o,m=m<0?0:m>255?255:m,e[a]=n,e[a+1]=o,e[a+2]=m};nc.Contrast=DI;Hv.Factory.addGetterSetter(OI.Node,"contrast",0,(0,RI.getNumberValidator)(),Hv.Factory.afterSetFilter);var sc={};Object.defineProperty(sc,"__esModule",{value:!0});sc.Emboss=void 0;const wn=$t,ac=we,FI=Ie,gy=Mt,LI=function(i){var t=this.embossStrength()*10,e=this.embossWhiteLevel()*255,r=this.embossDirection(),n=this.embossBlend(),o=0,m=0,a=i.data,s=i.width,h=i.height,d=s*4,l=h;switch(r){case"top-left":o=-1,m=-1;break;case"top":o=-1,m=0;break;case"top-right":o=-1,m=1;break;case"right":o=0,m=1;break;case"bottom-right":o=1,m=1;break;case"bottom":o=1,m=0;break;case"bottom-left":o=1,m=-1;break;case"left":o=0,m=-1;break;default:FI.Util.error("Unknown emboss direction: "+r)}do{var u=(l-1)*d,c=o;l+c<1&&(c=0),l+c>h&&(c=0);var f=(l-1+c)*s*4,v=s;do{var p=u+(v-1)*4,y=m;v+y<1&&(y=0),v+y>s&&(y=0);var b=f+(v-1+y)*4,x=a[p]-a[b],S=a[p+1]-a[b+1],w=a[p+2]-a[b+2],E=x,P=E>0?E:-E,A=S>0?S:-S,N=w>0?w:-w;if(A>P&&(E=S),N>P&&(E=w),E*=t,n){var k=a[p]+E,U=a[p+1]+E,j=a[p+2]+E;a[p]=k>255?255:k<0?0:k,a[p+1]=U>255?255:U<0?0:U,a[p+2]=j>255?255:j<0?0:j}else{var X=e-E;X<0?X=0:X>255&&(X=255),a[p]=a[p+1]=a[p+2]=X}}while(--v)}while(--l)};sc.Emboss=LI;wn.Factory.addGetterSetter(ac.Node,"embossStrength",.5,(0,gy.getNumberValidator)(),wn.Factory.afterSetFilter);wn.Factory.addGetterSetter(ac.Node,"embossWhiteLevel",.5,(0,gy.getNumberValidator)(),wn.Factory.afterSetFilter);wn.Factory.addGetterSetter(ac.Node,"embossDirection","top-left",null,wn.Factory.afterSetFilter);wn.Factory.addGetterSetter(ac.Node,"embossBlend",!1,null,wn.Factory.afterSetFilter);var oc={};Object.defineProperty(oc,"__esModule",{value:!0});oc.Enhance=void 0;const Wv=$t,kI=we,BI=Mt;function If(i,t,e,r,n){var o=e-t,m=n-r,a;return o===0?r+m/2:m===0?r:(a=(i-t)/o,a=m*a+r,a)}const NI=function(i){var t=i.data,e=t.length,r=t[0],n=r,o,m=t[1],a=m,s,h=t[2],d=h,l,u,c=this.enhance();if(c!==0){for(u=0;u<e;u+=4)o=t[u+0],o<r?r=o:o>n&&(n=o),s=t[u+1],s<m?m=s:s>a&&(a=s),l=t[u+2],l<h?h=l:l>d&&(d=l);n===r&&(n=255,r=0),a===m&&(a=255,m=0),d===h&&(d=255,h=0);var f,v,p,y,b,x,S,w,E;for(c>0?(v=n+c*(255-n),p=r-c*(r-0),b=a+c*(255-a),x=m-c*(m-0),w=d+c*(255-d),E=h-c*(h-0)):(f=(n+r)*.5,v=n+c*(n-f),p=r+c*(r-f),y=(a+m)*.5,b=a+c*(a-y),x=m+c*(m-y),S=(d+h)*.5,w=d+c*(d-S),E=h+c*(h-S)),u=0;u<e;u+=4)t[u+0]=If(t[u+0],r,n,p,v),t[u+1]=If(t[u+1],m,a,x,b),t[u+2]=If(t[u+2],h,d,E,w)}};oc.Enhance=NI;Wv.Factory.addGetterSetter(kI.Node,"enhance",0,(0,BI.getNumberValidator)(),Wv.Factory.afterSetFilter);var hc={};Object.defineProperty(hc,"__esModule",{value:!0});hc.Grayscale=void 0;const UI=function(i){var t=i.data,e=t.length,r,n;for(r=0;r<e;r+=4)n=.34*t[r]+.5*t[r+1]+.16*t[r+2],t[r]=n,t[r+1]=n,t[r+2]=n};hc.Grayscale=UI;var lc={};Object.defineProperty(lc,"__esModule",{value:!0});lc.HSL=void 0;const aa=$t,Qd=we,tg=Mt;aa.Factory.addGetterSetter(Qd.Node,"hue",0,(0,tg.getNumberValidator)(),aa.Factory.afterSetFilter);aa.Factory.addGetterSetter(Qd.Node,"saturation",0,(0,tg.getNumberValidator)(),aa.Factory.afterSetFilter);aa.Factory.addGetterSetter(Qd.Node,"luminance",0,(0,tg.getNumberValidator)(),aa.Factory.afterSetFilter);const GI=function(i){var t=i.data,e=t.length,r=1,n=Math.pow(2,this.saturation()),o=Math.abs(this.hue()+360)%360,m=this.luminance()*127,a,s=r*n*Math.cos(o*Math.PI/180),h=r*n*Math.sin(o*Math.PI/180),d=.299*r+.701*s+.167*h,l=.587*r-.587*s+.33*h,u=.114*r-.114*s-.497*h,c=.299*r-.299*s-.328*h,f=.587*r+.413*s+.035*h,v=.114*r-.114*s+.293*h,p=.299*r-.3*s+1.25*h,y=.587*r-.586*s-1.05*h,b=.114*r+.886*s-.2*h,x,S,w,E;for(a=0;a<e;a+=4)x=t[a+0],S=t[a+1],w=t[a+2],E=t[a+3],t[a+0]=d*x+l*S+u*w+m,t[a+1]=c*x+f*S+v*w+m,t[a+2]=p*x+y*S+b*w+m,t[a+3]=E};lc.HSL=GI;var cc={};Object.defineProperty(cc,"__esModule",{value:!0});cc.HSV=void 0;const oa=$t,eg=we,ig=Mt,HI=function(i){var t=i.data,e=t.length,r=Math.pow(2,this.value()),n=Math.pow(2,this.saturation()),o=Math.abs(this.hue()+360)%360,m,a=r*n*Math.cos(o*Math.PI/180),s=r*n*Math.sin(o*Math.PI/180),h=.299*r+.701*a+.167*s,d=.587*r-.587*a+.33*s,l=.114*r-.114*a-.497*s,u=.299*r-.299*a-.328*s,c=.587*r+.413*a+.035*s,f=.114*r-.114*a+.293*s,v=.299*r-.3*a+1.25*s,p=.587*r-.586*a-1.05*s,y=.114*r+.886*a-.2*s,b,x,S,w;for(m=0;m<e;m+=4)b=t[m+0],x=t[m+1],S=t[m+2],w=t[m+3],t[m+0]=h*b+d*x+l*S,t[m+1]=u*b+c*x+f*S,t[m+2]=v*b+p*x+y*S,t[m+3]=w};cc.HSV=HI;oa.Factory.addGetterSetter(eg.Node,"hue",0,(0,ig.getNumberValidator)(),oa.Factory.afterSetFilter);oa.Factory.addGetterSetter(eg.Node,"saturation",0,(0,ig.getNumberValidator)(),oa.Factory.afterSetFilter);oa.Factory.addGetterSetter(eg.Node,"value",0,(0,ig.getNumberValidator)(),oa.Factory.afterSetFilter);var uc={};Object.defineProperty(uc,"__esModule",{value:!0});uc.Invert=void 0;const WI=function(i){var t=i.data,e=t.length,r;for(r=0;r<e;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2]};uc.Invert=WI;var fc={};Object.defineProperty(fc,"__esModule",{value:!0});fc.Kaleidoscope=void 0;const gl=$t,py=we,Xv=Ie,my=Mt;var XI=function(i,t,e){var r=i.data,n=t.data,o=i.width,m=i.height,a=e.polarCenterX||o/2,s=e.polarCenterY||m/2,h,d,l,u=0,c=0,f=0,v=0,p,y=Math.sqrt(a*a+s*s);d=o-a,l=m-s,p=Math.sqrt(d*d+l*l),y=p>y?p:y;var b=m,x=o,S,w,E=360/x*Math.PI/180,P,A;for(w=0;w<x;w+=1)for(P=Math.sin(w*E),A=Math.cos(w*E),S=0;S<b;S+=1)d=Math.floor(a+y*S/b*A),l=Math.floor(s+y*S/b*P),h=(l*o+d)*4,u=r[h+0],c=r[h+1],f=r[h+2],v=r[h+3],h=(w+S*o)*4,n[h+0]=u,n[h+1]=c,n[h+2]=f,n[h+3]=v},VI=function(i,t,e){var r=i.data,n=t.data,o=i.width,m=i.height,a=e.polarCenterX||o/2,s=e.polarCenterY||m/2,h,d,l,u,c,f=0,v=0,p=0,y=0,b,x=Math.sqrt(a*a+s*s);d=o-a,l=m-s,b=Math.sqrt(d*d+l*l),x=b>x?b:x;var S=m,w=o,E,P,A=e.polarRotation||0,N,k;for(d=0;d<o;d+=1)for(l=0;l<m;l+=1)u=d-a,c=l-s,E=Math.sqrt(u*u+c*c)*S/x,P=(Math.atan2(c,u)*180/Math.PI+360+A)%360,P=P*w/360,N=Math.floor(P),k=Math.floor(E),h=(k*o+N)*4,f=r[h+0],v=r[h+1],p=r[h+2],y=r[h+3],h=(l*o+d)*4,n[h+0]=f,n[h+1]=v,n[h+2]=p,n[h+3]=y};const zI=function(i){var t=i.width,e=i.height,r,n,o,m,a,s,h,d,l,u,c=Math.round(this.kaleidoscopePower()),f=Math.round(this.kaleidoscopeAngle()),v=Math.floor(t*(f%360)/360);if(!(c<1)){var p=Xv.Util.createCanvasElement();p.width=t,p.height=e;var y=p.getContext("2d").getImageData(0,0,t,e);Xv.Util.releaseCanvas(p),XI(i,y,{polarCenterX:t/2,polarCenterY:e/2});for(var b=t/Math.pow(2,c);b<=8;)b=b*2,c-=1;b=Math.ceil(b);var x=b,S=0,w=x,E=1;for(v+b>t&&(S=x,w=0,E=-1),n=0;n<e;n+=1)for(r=S;r!==w;r+=E)o=Math.round(r+v)%t,l=(t*n+o)*4,a=y.data[l+0],s=y.data[l+1],h=y.data[l+2],d=y.data[l+3],u=(t*n+r)*4,y.data[u+0]=a,y.data[u+1]=s,y.data[u+2]=h,y.data[u+3]=d;for(n=0;n<e;n+=1)for(x=Math.floor(b),m=0;m<c;m+=1){for(r=0;r<x+1;r+=1)l=(t*n+r)*4,a=y.data[l+0],s=y.data[l+1],h=y.data[l+2],d=y.data[l+3],u=(t*n+x*2-r-1)*4,y.data[u+0]=a,y.data[u+1]=s,y.data[u+2]=h,y.data[u+3]=d;x*=2}VI(y,i,{polarRotation:0})}};fc.Kaleidoscope=zI;gl.Factory.addGetterSetter(py.Node,"kaleidoscopePower",2,(0,my.getNumberValidator)(),gl.Factory.afterSetFilter);gl.Factory.addGetterSetter(py.Node,"kaleidoscopeAngle",0,(0,my.getNumberValidator)(),gl.Factory.afterSetFilter);var dc={};Object.defineProperty(dc,"__esModule",{value:!0});dc.Mask=void 0;const Vv=$t,jI=we,YI=Mt;function Bh(i,t,e){var r=(e*i.width+t)*4,n=[];return n.push(i.data[r++],i.data[r++],i.data[r++],i.data[r++]),n}function Xa(i,t){return Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)+Math.pow(i[2]-t[2],2))}function $I(i){for(var t=[0,0,0],e=0;e<i.length;e++)t[0]+=i[e][0],t[1]+=i[e][1],t[2]+=i[e][2];return t[0]/=i.length,t[1]/=i.length,t[2]/=i.length,t}function KI(i,t){var e=Bh(i,0,0),r=Bh(i,i.width-1,0),n=Bh(i,0,i.height-1),o=Bh(i,i.width-1,i.height-1),m=t||10;if(Xa(e,r)<m&&Xa(r,o)<m&&Xa(o,n)<m&&Xa(n,e)<m){for(var a=$I([r,e,o,n]),s=[],h=0;h<i.width*i.height;h++){var d=Xa(a,[i.data[h*4],i.data[h*4+1],i.data[h*4+2]]);s[h]=d<m?0:255}return s}}function qI(i,t){for(var e=0;e<i.width*i.height;e++)i.data[4*e+3]=t[e]}function ZI(i,t,e){for(var r=[1,1,1,1,0,1,1,1,1],n=Math.round(Math.sqrt(r.length)),o=Math.floor(n/2),m=[],a=0;a<e;a++)for(var s=0;s<t;s++){for(var h=a*t+s,d=0,l=0;l<n;l++)for(var u=0;u<n;u++){var c=a+l-o,f=s+u-o;if(c>=0&&c<e&&f>=0&&f<t){var v=c*t+f,p=r[l*n+u];d+=i[v]*p}}m[h]=d===255*8?255:0}return m}function JI(i,t,e){for(var r=[1,1,1,1,1,1,1,1,1],n=Math.round(Math.sqrt(r.length)),o=Math.floor(n/2),m=[],a=0;a<e;a++)for(var s=0;s<t;s++){for(var h=a*t+s,d=0,l=0;l<n;l++)for(var u=0;u<n;u++){var c=a+l-o,f=s+u-o;if(c>=0&&c<e&&f>=0&&f<t){var v=c*t+f,p=r[l*n+u];d+=i[v]*p}}m[h]=d>=255*4?255:0}return m}function QI(i,t,e){for(var r=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],n=Math.round(Math.sqrt(r.length)),o=Math.floor(n/2),m=[],a=0;a<e;a++)for(var s=0;s<t;s++){for(var h=a*t+s,d=0,l=0;l<n;l++)for(var u=0;u<n;u++){var c=a+l-o,f=s+u-o;if(c>=0&&c<e&&f>=0&&f<t){var v=c*t+f,p=r[l*n+u];d+=i[v]*p}}m[h]=d}return m}const tM=function(i){var t=this.threshold(),e=KI(i,t);return e&&(e=ZI(e,i.width,i.height),e=JI(e,i.width,i.height),e=QI(e,i.width,i.height),qI(i,e)),i};dc.Mask=tM;Vv.Factory.addGetterSetter(jI.Node,"threshold",0,(0,YI.getNumberValidator)(),Vv.Factory.afterSetFilter);var gc={};Object.defineProperty(gc,"__esModule",{value:!0});gc.Noise=void 0;const zv=$t,eM=we,iM=Mt,rM=function(i){var t=this.noise()*255,e=i.data,r=e.length,n=t/2,o;for(o=0;o<r;o+=4)e[o+0]+=n-2*n*Math.random(),e[o+1]+=n-2*n*Math.random(),e[o+2]+=n-2*n*Math.random()};gc.Noise=rM;zv.Factory.addGetterSetter(eM.Node,"noise",.2,(0,iM.getNumberValidator)(),zv.Factory.afterSetFilter);var pc={};Object.defineProperty(pc,"__esModule",{value:!0});pc.Pixelate=void 0;const jv=$t,nM=Ie,sM=we,aM=Mt,oM=function(i){var t=Math.ceil(this.pixelSize()),e=i.width,r=i.height,n,o,m,a,s,h,d,l=Math.ceil(e/t),u=Math.ceil(r/t),c,f,v,p,y,b,x,S=i.data;if(t<=0){nM.Util.error("pixelSize value can not be <= 0");return}for(y=0;y<l;y+=1)for(b=0;b<u;b+=1){for(a=0,s=0,h=0,d=0,c=y*t,f=c+t,v=b*t,p=v+t,x=0,n=c;n<f;n+=1)if(!(n>=e))for(o=v;o<p;o+=1)o>=r||(m=(e*o+n)*4,a+=S[m+0],s+=S[m+1],h+=S[m+2],d+=S[m+3],x+=1);for(a=a/x,s=s/x,h=h/x,d=d/x,n=c;n<f;n+=1)if(!(n>=e))for(o=v;o<p;o+=1)o>=r||(m=(e*o+n)*4,S[m+0]=a,S[m+1]=s,S[m+2]=h,S[m+3]=d)}};pc.Pixelate=oM;jv.Factory.addGetterSetter(sM.Node,"pixelSize",8,(0,aM.getNumberValidator)(),jv.Factory.afterSetFilter);var mc={};Object.defineProperty(mc,"__esModule",{value:!0});mc.Posterize=void 0;const Yv=$t,hM=we,lM=Mt,cM=function(i){var t=Math.round(this.levels()*254)+1,e=i.data,r=e.length,n=255/t,o;for(o=0;o<r;o+=1)e[o]=Math.floor(e[o]/n)*n};mc.Posterize=cM;Yv.Factory.addGetterSetter(hM.Node,"levels",.5,(0,lM.getNumberValidator)(),Yv.Factory.afterSetFilter);var vc={};Object.defineProperty(vc,"__esModule",{value:!0});vc.RGB=void 0;const pl=$t,rg=we,uM=Mt,fM=function(i){var t=i.data,e=t.length,r=this.red(),n=this.green(),o=this.blue(),m,a;for(m=0;m<e;m+=4)a=(.34*t[m]+.5*t[m+1]+.16*t[m+2])/255,t[m]=a*r,t[m+1]=a*n,t[m+2]=a*o,t[m+3]=t[m+3]};vc.RGB=fM;pl.Factory.addGetterSetter(rg.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});pl.Factory.addGetterSetter(rg.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});pl.Factory.addGetterSetter(rg.Node,"blue",0,uM.RGBComponent,pl.Factory.afterSetFilter);var _c={};Object.defineProperty(_c,"__esModule",{value:!0});_c.RGBA=void 0;const oo=$t,yc=we,dM=Mt,gM=function(i){var t=i.data,e=t.length,r=this.red(),n=this.green(),o=this.blue(),m=this.alpha(),a,s;for(a=0;a<e;a+=4)s=1-m,t[a]=r*m+t[a]*s,t[a+1]=n*m+t[a+1]*s,t[a+2]=o*m+t[a+2]*s};_c.RGBA=gM;oo.Factory.addGetterSetter(yc.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});oo.Factory.addGetterSetter(yc.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)});oo.Factory.addGetterSetter(yc.Node,"blue",0,dM.RGBComponent,oo.Factory.afterSetFilter);oo.Factory.addGetterSetter(yc.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i});var xc={};Object.defineProperty(xc,"__esModule",{value:!0});xc.Sepia=void 0;const pM=function(i){var t=i.data,e=t.length,r,n,o,m;for(r=0;r<e;r+=4)n=t[r+0],o=t[r+1],m=t[r+2],t[r+0]=Math.min(255,n*.393+o*.769+m*.189),t[r+1]=Math.min(255,n*.349+o*.686+m*.168),t[r+2]=Math.min(255,n*.272+o*.534+m*.131)};xc.Sepia=pM;var bc={};Object.defineProperty(bc,"__esModule",{value:!0});bc.Solarize=void 0;const mM=function(i){var t=i.data,e=i.width,r=i.height,n=e*4,o=r;do{var m=(o-1)*n,a=e;do{var s=m+(a-1)*4,h=t[s],d=t[s+1],l=t[s+2];h>127&&(h=255-h),d>127&&(d=255-d),l>127&&(l=255-l),t[s]=h,t[s+1]=d,t[s+2]=l}while(--a)}while(--o)};bc.Solarize=mM;var Sc={};Object.defineProperty(Sc,"__esModule",{value:!0});Sc.Threshold=void 0;const $v=$t,vM=we,_M=Mt,yM=function(i){var t=this.threshold()*255,e=i.data,r=e.length,n;for(n=0;n<r;n+=1)e[n]=e[n]<t?0:255};Sc.Threshold=yM;$v.Factory.addGetterSetter(vM.Node,"threshold",.5,(0,_M.getNumberValidator)(),$v.Factory.afterSetFilter);Object.defineProperty(Ol,"__esModule",{value:!0});Ol.Konva=void 0;const Kv=k1,xM=Bl,bM=Gl,SM=Xl,CM=Vl,wM=zl,qv=sa,TM=vo,EM=pa,AM=yo,PM=$l,IM=Kl,MM=ql,OM=Zl,RM=ns,DM=Jl,FM=Ql,LM=tc,kM=ic,BM=rc,NM=nc,UM=sc,GM=oc,HM=hc,WM=lc,XM=cc,VM=uc,zM=fc,jM=dc,YM=gc,$M=pc,KM=mc,qM=vc,ZM=_c,JM=xc,QM=bc,tO=Sc;Ol.Konva=Kv.Konva.Util._assign(Kv.Konva,{Arc:xM.Arc,Arrow:bM.Arrow,Circle:SM.Circle,Ellipse:CM.Ellipse,Image:wM.Image,Label:qv.Label,Tag:qv.Tag,Line:TM.Line,Path:EM.Path,Rect:AM.Rect,RegularPolygon:PM.RegularPolygon,Ring:IM.Ring,Sprite:MM.Sprite,Star:OM.Star,Text:RM.Text,TextPath:DM.TextPath,Transformer:FM.Transformer,Wedge:LM.Wedge,Filters:{Blur:kM.Blur,Brighten:BM.Brighten,Contrast:NM.Contrast,Emboss:UM.Emboss,Enhance:GM.Enhance,Grayscale:HM.Grayscale,HSL:WM.HSL,HSV:XM.HSV,Invert:VM.Invert,Kaleidoscope:zM.Kaleidoscope,Mask:jM.Mask,Noise:YM.Noise,Pixelate:$M.Pixelate,Posterize:KM.Posterize,RGB:qM.RGB,RGBA:ZM.RGBA,Sepia:JM.Sepia,Solarize:QM.Solarize,Threshold:tO.Threshold}});var eO=Xd.exports;Object.defineProperty(eO,"__esModule",{value:!0});const iO=Ol;Xd.exports=iO.Konva;var rO=Xd.exports;const ts=Td(rO);class nO{constructor(t,e,r){ht(this,"height");ht(this,"width");ht(this,"stage");ht(this,"layer");ht(this,"components");ht(this,"movedComponents");ht(this,"positionManager");this.components=[],this.width=e,this.height=t,this.movedComponents=[],this.positionManager=new ha({viewWidth:this.width,viewHeight:this.height}),this.stage=new ts.Stage({container:r,width:this.width,height:this.height}),this.layer=new ts.Layer,this.stage.add(this.layer),window.addEventListener("wheel",n=>{n.preventDefault();const o=this.stage,m=o.scaleX(),a={x:o.getPointerPosition().x/m-o.x()/m,y:o.getPointerPosition().y/m-o.y()/m},s=n.deltaY>0?m*1.1:m/1.1;o.scale({x:s,y:s});const h={x:-(a.x-o.getPointerPosition().x/s)*s,y:-(a.y-o.getPointerPosition().y/s)*s};o.position(h),o.batchDraw()},{passive:!1})}getLayer(){return this.layer}addComponent(t){this.components.push(t)}start(){this.components.forEach(t=>{t.draw(0)}),this.updateComponentsCount()}updateComponentsCount(){const t=document.getElementById("componentCount");t.innerText=this.components.length.toString()}moveTest(t=0){this.movedComponents=this.components,t!==0&&(this.movedComponents=this.components.slice(0,t)),this.movedComponents.forEach(e=>{const r=e.getUIElement();this.positionManager.addPosition(r.x,r.y)}),this.moveElements()}moveElements(){for(let t=0;t<this.movedComponents.length;t++){const[e,r]=this.positionManager.calculateNextPosition(t);this.movedComponents[t].getUIElement().move(e,r)}requestAnimationFrame(()=>this.moveElements())}zoomTransform(t){this.stage.scale({x:t,y:t});const e={x:this.stage.width()/2-this.stage.width()/2*t,y:this.stage.height()/2-this.stage.height()/2*t};this.stage.position(e),this.stage.batchDraw()}}const Zv=[{getFigure:(i,t,e,r)=>new ts.Rect({left:i,top:t,fill:Xe(),width:e,height:r})},{getFigure:(i,t,e,r)=>new ts.Circle({x:i,y:t,radius:(e+r)/2/2,fill:Xe(),draggable:!0})},{getFigure:(i,t,e,r)=>new ts.Line({x:i,y:t,points:[0,0,e,0,r,e,0,0],fill:Xe(),closed:!0,draggable:!0})}];class sO{constructor(t){ht(this,"x");ht(this,"y");ht(this,"layer");ht(this,"group");ht(this,"text");this.layer=t,this.x=Ht.random(Ze-be),this.y=Ht.random(qe-me);const e=Ht.random(2,be),r=Ht.random(2,me),n=Ht.random(Zv.length-1),o=Zv[n].getFigure(0,0,e,r);this.group=new ts.Group({x:this.x,y:this.y,draggable:!0}),this.text=new ts.Text({x:20,y:20,text:"..",fontSize:30,fill:Xe()}),this.group.add(o),this.group.add(this.text),this.layer.add(this.group)}draw(t){this.text.text(t.toString())}getElement(){return this}move(t,e){this.group.position({x:t,y:e})}}class aO{constructor(t){ht(this,"appElement");ht(this,"dataSource");ht(this,"view");this.appElement=t,this.appElement.style.position="relative",this.appElement.style.width=Ze+"px",this.appElement.style.height=qe+"px",this.view=void 0,this.dataSource=new Oi;const e=new xn;e.onChange=r=>{var n;(n=this.view)==null||n.zoomTransform(r)},this.initButtonBindings()}initButtonBindings(){Se("addCanvasKonvaComponent",()=>{const t=xe("konvaComponentsCount");this.addKonvaComponents(t)}),Se("setDataSourceSettings",()=>{const t=xe("updateInterval");this.dataSource.updateInterval(t*1e3)}),Se("startMoveTest",()=>{const t=xe("movedComponentsCount");this.moveTest(t)})}start(){this.view=new nO(qe,Ze,this.appElement),this.dataSource=new Oi,this.dataSource.start()}addComponents(t,e,r){switch(t){case"CanvasKonva":this.addKonvaComponents(e);break;default:throw new Error(`Canvas Konva App: unknown component type:${t}`)}}addKonvaComponents(t){var e,r;if(this.view){for(let n=0;n<t;n++){const o=new sO(this.view.getLayer()),m=new zr(o);(e=this.view)==null||e.addComponent(m)}(r=this.view)==null||r.start()}}moveTest(t=0){var e;(e=this.view)==null||e.moveTest(t)}stopDataSource(){this.dataSource.updateInterval(0)}}class oO{constructor(){ht(this,"frameCount");ht(this,"lastTime");ht(this,"totalFrames");ht(this,"totalSeconds");ht(this,"shouldCalculateFPS");this.frameCount=0,this.lastTime=performance.now(),this.totalFrames=0,this.totalSeconds=0,this.shouldCalculateFPS=!1}start(){this.shouldCalculateFPS=!0,this.calculateFPS()}test(t){return this.totalFrames=0,this.totalSeconds=0,this.lastTime=performance.now(),this.start(),new Promise(e=>{const r=setInterval(()=>{this.totalSeconds>=t&&(clearInterval(r),this.shouldCalculateFPS=!1,e(Math.round(this.totalFrames/(this.totalSeconds-1))))},1e3)})}calculateFPS(){if(!this.shouldCalculateFPS)return;this.frameCount++;const t=performance.now();t-this.lastTime>=1e3&&(console.log(`FPS ${this.totalSeconds===0?"(ignore)":""}:`,this.frameCount),this.totalSeconds>0&&(this.totalFrames+=this.frameCount),this.totalSeconds++,this.frameCount=0,this.lastTime=t),requestAnimationFrame(()=>this.calculateFPS())}}const hO=25,Jv=5,Vn=[50,500,1e3,2e3,3e3,5e3,6e3,1e4],Mf=[{viewType:ti.HTML,note:"Html view with HTML components",componentsType:"HTML",componentsCount:Vn,elementsCount:2},{viewType:ti.HTML,note:"Html view with HTML components. Dependence on the number of elements",componentsType:"HTML",componentsCount:Vn,elementsCount:20},{viewType:ti.HTML,note:"Html view with SVG components",componentsType:"SVG",componentsCount:Vn,elementsCount:2},{viewType:ti.SVG,note:"SVG view",componentsType:"SVG",componentsCount:Vn,elementsCount:2},{viewType:ti.SVG,note:"SVG view; Dependence on the number of elements",componentsType:"SVG",componentsCount:Vn,elementsCount:20},{viewType:ti.CANVAS,note:"Canvas view",componentsType:"Canvas",componentsCount:Vn,elementsCount:2},{viewType:ti.HTML,note:"Html view with Canvas components",componentsType:"Canvas",componentsCount:Vn,elementsCount:2},{viewType:ti.HTML,note:"Html view with Canvas components",componentsType:"Canvas",componentsCount:1,elementsCount:2}];class lO{constructor(){ht(this,"localStorageKey");this.localStorageKey="performanceTest",Se("startPerformanceTest",()=>{this.start()})}start(){this.cleanResults(),this.navigateToTest(0)}async runTestCase(t,e,r){const{viewType:n,note:o,componentsType:m,componentsCount:a,elementsCount:s}=Mf[e];let h;Array.isArray(a)?h=a[r]:h=a,console.log(`Test #${e} View type:${n}; Component type:${m}; Components:${h} ; Elements:${s}`);const d=new oO;t.addComponents(m,h,s),t.moveTest();const l=await d.test(Jv);console.log("Average FPS:",l),console.log("Disable DataSource"),t.stopDataSource();const u=await d.test(Jv);console.log("No DataSource Averages FPS:",u);const c=[{viewType:n,note:o,componentsCount:h,elementsCount:s,isDataSource:!0,FPS:l},{viewType:n,note:o,componentsCount:h,elementsCount:s,isDataSource:!1,FPS:u}];this.saveResults(c);const f=u>hO,v=Array.isArray(a),p=v&&r+1<a.length;if(f&&v&&p)console.log("Go to next test step:",r+1),this.navigateToTest(e,n,r+1);else if(Mf.length===e+1){console.log("All test cases are finisined!"),console.warn("Copy all the results and transfer them to a general table including the characteristics of your hardware");const y=this.getResults();console.table(y)}else{console.log("Go to next test case");const y=Mf[e+1].viewType;this.navigateToTest(e+1,y)}}navigateToTest(t=0,e=ti.HTML,r=0){const n=new URL(window.location.href),o=new URLSearchParams(n.search);o.has("test")?o.set("test",t.toString()):o.has("test")||o.append("test",t.toString()),o.has("testStep")?o.set("testStep",r.toString()):o.has("testStep")||o.append("testStep",r.toString()),o.set("view",e),n.search=o.toString(),window.location.href=n.toString()}cleanResults(){localStorage.removeItem(this.localStorageKey)}saveResults(t){let e=this.getResults();e=[...e,...t],localStorage.setItem(this.localStorageKey,JSON.stringify(e))}getResults(){const t=localStorage.getItem(this.localStorageKey);let e=t?JSON.parse(t):null;return e||(e=[]),e}}class Qv{constructor(t,e){ht(this,"canvas");ht(this,"context");ht(this,"height");ht(this,"width");ht(this,"components");ht(this,"zoomFactor");ht(this,"offsetX");ht(this,"offsetY");ht(this,"isPanning");ht(this,"lastPosition");ht(this,"needsRedraw");ht(this,"handleMouseDown",t=>{this.isPanning=!0,this.lastPosition={x:t.clientX,y:t.clientY}});ht(this,"handleMouseMove",t=>{if(!this.isPanning)return;const e=t.clientX-this.lastPosition.x,r=t.clientY-this.lastPosition.y;this.offsetX+=e,this.offsetY+=r,this.lastPosition={x:t.clientX,y:t.clientY},this.needsRedraw=!0});ht(this,"handleMouseUp",t=>{this.isPanning=!1});ht(this,"handleWheel",t=>{t.preventDefault();const e=1.1,r=t.clientX-this.canvas.getBoundingClientRect().left,n=t.clientY-this.canvas.getBoundingClientRect().top;t.deltaY<0?(this.zoomFactor*=e,this.offsetX-=(e-1)*(r-this.offsetX)/this.zoomFactor,this.offsetY-=(e-1)*(n-this.offsetY)/this.zoomFactor):(this.zoomFactor/=e,this.offsetX+=(1-1/e)*(r-this.offsetX)/this.zoomFactor,this.offsetY+=(1-1/e)*(n-this.offsetY)/this.zoomFactor),this.needsRedraw=!0});this.width=e,this.height=t,this.components=[],this.zoomFactor=1,this.offsetX=0,this.offsetY=0,this.isPanning=!1,this.lastPosition={x:0,y:0},this.needsRedraw=!1,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.border="1px solid blue",this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseup",this.handleMouseUp),this.canvas.addEventListener("mouseout",this.handleMouseUp),this.canvas.addEventListener("wheel",this.handleWheel)}getContext(){return this.context}addComponent(t){this.components.push(t)}start(){return this.context.clearRect(0,0,this.width,this.height),this.needsRedraw=!0,this.draw(),this.canvas}drawComponents(){this.components.forEach(t=>{t.draw()})}draw(){const t=this.components.some(e=>e.needsRedraw);(this.needsRedraw||t)&&(this.context.save(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.translate(this.offsetX,this.offsetY),this.context.scale(this.zoomFactor,this.zoomFactor),this.drawComponents(),this.context.restore(),this.needsRedraw=!1),requestAnimationFrame(this.draw.bind(this))}}class cO{constructor(t,e){ht(this,"componentUI");ht(this,"x");ht(this,"y");ht(this,"data");ht(this,"index");ht(this,"needsRedraw");this.x=0,this.y=0,this.data=0,this.componentUI=t,this.index=e,this.needsRedraw=!1}draw(){return this.needsRedraw=!1,this.componentUI.draw(this.x,this.y,this.data,this.index)}addSource(t){t.addListener(this)}onDataChange(t){this.data=t,this.needsRedraw=!0}position(t,e){this.x=t,this.y=e}}class uO{constructor(t){ht(this,"context");ht(this,"x");ht(this,"y");ht(this,"data");ht(this,"barColor");this.context=t,this.data=0,this.barColor=Xe(),this.x=0,this.y=0}draw(t,e,r,n){this.data=r,this.x=t,this.y=e;const o=6,m=9,a=o-2,s=Math.round(m*r/100);this.context.fillStyle="green",this.context.fillRect(this.x,this.y,o,m),this.context.fillStyle=this.barColor,this.context.fillRect(this.x+1,this.y+(m-s),a,s),n!==void 0&&(this.context.fillStyle="black",this.context.font="3px Arial",this.context.fillText(n.toString(),this.x,this.y+m))}}const Nh=1500,t_=1e3,e_=10,fO=10;class dO{constructor(t){ht(this,"appElement");ht(this,"dataSource1");ht(this,"dataSource2");ht(this,"view");this.appElement=t,this.view=new Qv(t_,Nh),this.dataSource1=new Oi(2e3),this.dataSource2=new Oi(4e3)}start(){this.view=new Qv(t_,Nh),this.appElement.appendChild(this.view.start());const t=1e4;this.addBarComponent(t),this.dataSource1.start(),this.dataSource2.start()}addBarComponent(t){for(let e=0;e<t;e++){const r=new uO(this.view.getContext()),n=new cO(r,e),o=e_*e%Nh,m=Math.floor(e_*e/Nh)*fO;n.position(o,m),n.addSource(e%2?this.dataSource1:this.dataSource2),this.view.addComponent(n)}this.view.start()}}document.addEventListener("DOMContentLoaded",async()=>{const i=new URLSearchParams(window.location.search),t=i.get("view")||ti.HTML,e=i.get("test")||null,r=i.get("testStep")||0,n=new lO,o=document.getElementById("viewName");o.innerText=t,document.querySelectorAll(`.view_${t}_only`).forEach(h=>{h.style.display="block"});let a;const s=document.querySelector("#app");if(t===ti.HTML)a=new o3(s),a.start();else if(t===ti.SVG)a=new l3(s),a.start();else if(t===ti.CANVAS)a=new u3(s),a.start();else if(t===ti.CANVAS_FABRIC)a=new g3(s),a.start();else if(t===ti.PIXIJS)a=new s8(s),a.start();else if(t===ti.CANVAS_KONVA)a=new aO(s),a.start();else if(t===ti.APP_CANVAS_1){const h=document.getElementById("apps1");h.style.display="none";const d=document.getElementById("apps2");d.style.display="block",new dO(d).start()}else{alert('"view" is unknown. Please set correct view');return}e&&a&&await n.runTestCase(a,Number(e),Number(r))});
